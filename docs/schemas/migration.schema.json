{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://intelgraph.local/schemas/migration.schema.json",
  "title": "MigrationPlan",
  "type": "object",
  "required": ["name", "steps", "guardrails"],
  "properties": {
    "name": { "type": "string" },
    "database": { "type": "string", "enum": ["postgres", "mysql", "rds"] },
    "guardrails": {
      "type": "object",
      "properties": {
        "latency_p95_max_delta": { "type": "number" },
        "replica_lag_max_s": { "type": "number" },
        "lock_wait_ms_p95": { "type": "number" }
      }
    },
    "shadowVerify": { "type": "boolean", "default": true },
    "steps": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["type", "sql"],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["ddl", "dml", "index", "backfill"]
          },
          "sql": { "type": "string" }
        }
      }
    }
  }
}
