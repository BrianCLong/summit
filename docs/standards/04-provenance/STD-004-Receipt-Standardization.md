# STD-004: Receipt & Provenance Standardization

**Status:** Draft (v1.0.0)
**Owner:** Jules (Deep Spec Writer)
**Scope:** All system operations (Ingest, Actions, Workflows, Controls)

## 1. Overview

This standard defines the structure, verification protocols, and lifecycle for **Receipts** within the Summit (IntelGraph) ecosystem. Receipts are the foundational unit of provenance, providing verifiable evidence that an operation was performed under specific policy conditions.

## 2. Receipt Hierarchy

Operations must emit receipts according to their type:

| Receipt Type             | Purpose                                                       | Schema Reference                                                                                    |
| :----------------------- | :------------------------------------------------------------ | :-------------------------------------------------------------------------------------------------- |
| `IngestReceipt`          | Records data ingestion, counts, and cursors.                  | [ingest_receipt.schema.json](../../schemas/receipts/ingest_receipt.schema.json)                     |
| `ActionRunReceipt`       | Records a single system action, approvals, and side effects.  | [action_run_receipt.schema.json](../../schemas/receipts/action_run_receipt.schema.json)             |
| `WorkflowRunReceipt`     | Records multi-step orchestrations and transitions.            | [workflow_run_receipt.schema.json](../../schemas/receipts/workflow_run_receipt.schema.json)         |
| `ControlCheckReceipt`    | Records the pass/fail result of a compliance control check.   | [control_check_receipt.schema.json](../../schemas/receipts/control_check_receipt.schema.json)       |
| `EvidenceBundleManifest` | Aggregates multiple receipts into a signed compliance bundle. | [evidence_bundle_manifest.schema.json](../../schemas/receipts/evidence_bundle_manifest.schema.json) |

## 3. Core Principles

- **Immutability:** Once issued, a receipt must never be modified. Any correction must issue a new receipt linking to the original.
- **Verifiability:** Every receipt includes an `integrity` block (hashes) and a `signature` block (cryptographic proof).
- **Policy Binding:** Every receipt must reference a `policy_decision_id` from the Policy Engine.
- **Redaction-Friendliness:** Sensitive data must be redacted from the receipt payload while preserving the ability to verify the canonical hash.

## 4. Standardization Roadmap

To move from paperwork to a live, enforceable system, the following initiatives are prioritized:

1.  **Canonical JSON (JCS/RFC8785):** Standardize on JCS for `payload_hash` stability across TypeScript, Python, and Go implementations.
2.  **Receipt Verification CLI:** Develop a `verify-receipt` tool that validates signatures and integrity chains: `verify --bundle evidence.json --keyring keys.json`.
3.  **Conformance Runner:** Implement the `certify-connector` tool to automate the Bronze/Silver/Gold testing tiers as defined in the [Connector Conformance Test Plan](../../connectors/CONFORMANCE_TEST_PLAN.md).
4.  **Connector SDK Integration:** Update the Connector SDK to automatically emit `IngestReceipt` and `ActionRunReceipt` as part of the standard execution lifecycle.
5.  **OPA Policy Contract:** Define a standard OPA input/output contract so policy decision traces align perfectly with receipt structures.

## 5. Certification Tiers

Connectors are certified based on their ability to emit and verify these receipts under the [Conformance Test Plan](../../connectors/CONFORMANCE_TEST_PLAN.md):

- **Bronze:** Required `IngestReceipt` with idempotency and isolation.
- **Silver:** Adds `ActionRunReceipt` with policy preflight and approval chains.
- **Gold:** Adds `ControlCheckReceipt` and `EvidenceBundleManifest` for audit-readiness.

---

_Generated by Jules (Deep Spec Writer & Standards Author)_
