schema_version: "1"
required_job_name: "Governance / Unified Gate"
execution:
  fail_fast: true
  default_mode: "pr"         # pr|main|nightly
gates:
  - id: "evidence_bundle"
    required: true
    command: "pnpm ci:evidence:bundle"
    outputs:
      report: "artifacts/evidence/${sha}/manifest.json"
      # receipt.json is not generated by current script, but manifest is.
      # We adhere to what is generated.
  - id: "evidence_map"
    required: true
    command: "pnpm ci:ga-evidence:verify"
    outputs:
      stamp: "artifacts/ga-verify/${sha}/stamp.json"
      # Report is not generated as json by ga-verify, only logs.
      # We check stamp.
  - id: "dependency_risk"
    required: false
    command: "pnpm ci:dependency-risk"
    modes: ["main","nightly"]
  - id: "secrets_scan"
    required: true
    command: "pnpm ci:secrets-scan"
  - id: "repro_build"
    required: false
    command: "pnpm ci:repro-build"
    outputs:
      report: "artifacts/repro/${sha}/reproducibility-report.json"
    modes: ["main","nightly"]
  - id: "hermetic"
    required: false
    command: "echo 'Hermetic gate not implemented' && exit 0"
    modes: ["main", "nightly"]
  - id: "cas_integrity"
    required: false
    command: "pnpm ci:cas:verify"
    modes: ["main", "nightly"]

mode_overrides:
  pr:
    gates:
      dependency_risk: {required: false}
      repro_build: {required: false}
      hermetic: {required: false}
      cas_integrity: {required: false}
  main:
    gates:
      dependency_risk: {required: true}
      repro_build: {required: true}
      hermetic: {required: false} # Not implemented yet
      cas_integrity: {required: false} # Not implemented yet
