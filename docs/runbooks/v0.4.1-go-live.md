# v0.4.1 Go-Live — Sovereign Safeguards

## Overview

The v0.4.1 Sovereign Safeguards Go-Live process provides a one-command production launch with comprehensive validation, rollback capabilities, alerting, and evidence bundling.

## Preflight Requirements

### Secrets Configuration

- `SLACK_WEBHOOK_URL`: Slack webhook for deployment notifications
- `GRAPHQL_URL`: GraphQL endpoint for sovereign operations
- `AWS_ACCESS_KEY_ID` / `AWS_SECRET_ACCESS_KEY`: AWS credentials for EKS access
- Post-quantum cryptography keys (if enabled)

### Prerequisites

- Kubernetes cluster access (staging/production)
- Prometheus and Grafana monitoring stack deployed
- Helm v3.12+ installed
- kubectl v1.28+ configured

### Validation Gates

The following 10 hard gates must pass:

1. `GATE_ATTESTOR_OK` - External attestor validation
2. `GATE_CONTAINMENT` - Containment readiness verified
3. `GATE_SCOPE` - Scope boundaries validated
4. `GATE_PQ` - Post-quantum cryptography ready
5. `GATE_CSE` - Compatibility Safety Equivalence
6. `GATE_FAIRNESS` - Fairness validation complete
7. `GATE_BUDGET` - Budget constraints verified
8. `GATE_PODR` - Purpose and Data Residency compliance
9. `GATE_RESIDENCY` - Data residency requirements met
10. `GATE_AUDIT` - Audit trail integrity verified

## Launch Procedures

### Local Execution

```bash
# Validate configuration
make validate-v041

# Execute go-live
make go-live-v041
```

### CI/CD Execution

1. Navigate to Actions tab in GitHub repository
2. Select "v041-go-live" workflow
3. Click "Run workflow"
4. Provide required inputs:
   - **GraphQL URL**: Target environment endpoint
   - **Slack webhook**: Secret name for notifications
   - **Environment**: staging or production

### Manual Steps

```bash
# 1. Pre-flight validation
promtool check rules monitoring/prometheus/rules/mc-platform-v041.yml
conftest test policy/v041/sovereign-safeguards.rego
kubectl apply --dry-run=client -k helm/overlays/v041/

# 2. Deploy sovereign safeguards
kubectl apply -k helm/overlays/v041/

# 3. Wait for readiness
kubectl rollout status deployment/sovereign-safeguards-service -n mc-platform-v041
kubectl rollout status deployment/verification-service -n mc-platform-v041

# 4. Validate deployment
kubectl get pods -n mc-platform-v041
kubectl logs -n mc-platform-v041 deployment/sovereign-safeguards-service

# 5. Test sovereign operations
curl -f http://localhost:8080/health  # via port-forward
```

## Post-Cutover Validation

### Monitoring Tiles

Verify the following dashboard tiles show green status:

1. **Sovereign Compliance Score**: ≥95% (0.95)
2. **Independent Verification Success**: ≥80%
3. **Containment Response Time**: ≤100ms
4. **Jurisdictional Compliance**: All green
5. **Autonomy Reversal Time**: ≤60s
6. **Verification Sources Active**: ≥2
7. **Emergency Stop Ready**: True
8. **Human Control Available**: True
9. **Audit Trail Integrity**: No violations
10. **Service Availability**: All services UP

### SLO Metrics

- **Sovereign Compliance**: 95%+ sustained over 10 minutes
- **Verification Success Rate**: 80%+ over 5 minutes
- **Containment Response**: P95 ≤ 100ms
- **Service Availability**: 99.9%+ uptime

### Alert Validation

Ensure the following alerts route correctly to Slack:

- `SovereignComplianceScoreLow`
- `IndependentVerificationFailing`
- `EmergencyStopNotReady`
- `AutonomyNotReversible`
- `JurisdictionComplianceViolation`

## Rollback Procedures

### Immediate Rollback (Emergency)

```bash
# 1. Disable sovereign operations
kubectl patch deployment mc-platform -n mc-platform-v041 -p '{"spec":{"replicas":0}}'

# 2. Scale down sovereign services
kubectl scale deployment/sovereign-safeguards-service --replicas=0 -n mc-platform-v041
kubectl scale deployment/verification-service --replicas=0 -n mc-platform-v041

# 3. Restore previous version
kubectl rollout undo deployment/mc-platform -n mc-platform-v041
```

### Graceful Rollback

```bash
# 1. Disable transcendent mode via GraphQL
curl -sS -H 'content-type: application/json' \
  -d '{"query":"mutation{disableTranscendentMode(tenant:\"ALL\"){ok}}"}' \
  "$GRAPHQL_URL"

# 2. Helm rollback
helm rollback mc-admin -n mc-platform-v041

# 3. Verify rollback
kubectl get pods -n mc-platform-v041
kubectl logs -n mc-platform-v041 deployment/mc-platform
```

### Evidence Collection

After rollback, collect the following evidence:

```bash
# Generate incident evidence bundle
kubectl get events -n mc-platform-v041 --sort-by='.lastTimestamp' > incident-events.log
kubectl describe pods -n mc-platform-v041 > incident-pods.log
kubectl logs -n mc-platform-v041 --previous=true --all-containers=true > incident-logs.log

# Create incident pack
tar -czf incident-$(date +%Y%m%d%H%M%S).tar.gz incident-*.log dist/evidence-v0.4.1-mc.json
```

## Troubleshooting

### Common Issues

**Issue**: Sovereign compliance score below threshold
**Solution**: Check individual component scores and verify verification sources

**Issue**: Containment readiness failing
**Solution**: Verify emergency stop mechanisms and test containment systems

**Issue**: Verification service unavailable
**Solution**: Check external verification source connectivity and credentials

**Issue**: Jurisdiction compliance violations
**Solution**: Review data residency requirements and cross-border approvals

### Debug Commands

```bash
# Check sovereign safeguards status
kubectl port-forward -n mc-platform-v041 svc/sovereign-safeguards-service 8080:8080
curl http://localhost:8080/health

# View sovereign metrics
kubectl port-forward -n monitoring svc/prometheus 9090:9090
# Navigate to http://localhost:9090 and query mc_platform_sovereign_*

# Check verification logs
kubectl logs -n mc-platform-v041 deployment/verification-service -f

# Review OPA policy decisions
kubectl logs -n mc-platform-v041 deployment/mc-platform | grep -i "opa\|policy"
```

### Support Contacts

- **Platform Team**: #mc-platform-alerts
- **Security Team**: #security-incidents
- **On-Call**: Use PagerDuty escalation for P0/P1 issues

## Success Criteria

The v0.4.1 go-live is considered successful when:

✅ All 10 validation gates pass
✅ Sovereign compliance score ≥ 95%
✅ All services show healthy status
✅ Independent verification operational
✅ Containment systems ready
✅ Alerts routing to Slack correctly
✅ Evidence bundle generated and signed
✅ SLO metrics within acceptable ranges
✅ No critical alerts firing
✅ Rollback procedures tested and documented
