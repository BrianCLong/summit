# MC Platform v0.3.4 Go-Live Runbook

**Epic: Trust, Throughput, Tenants**
**Version: v0.3.4-mc**
**Target: Production Deployment**

## üéØ Pre-Deployment Checklist

### Required Personnel

- [ ] Deployment Lead (Primary)
- [ ] Platform Engineer (Secondary)
- [ ] Security Lead (On-call)
- [ ] Product Owner (Approval authority)

### Environment Validation

- [ ] Staging environment healthy
- [ ] Production capacity verified
- [ ] All dependencies updated
- [ ] Rollback plan reviewed

## üöÄ Deployment Phases

### Phase 0: Pre-Flight Gates (MANDATORY)

#### Config Attestation

```bash
python3 ops/config-attest.py snapshot --out evidence/v0.3.4/config/pre-snapshot.json
```

**Expected**: Cryptographically signed config snapshot
**Gate**: Must pass signature verification

#### Quality Gates

```bash
# Unit + Integration Tests
pytest -q
echo "Exit code: $?"

# Prometheus Rules Validation
promtool check rules prom/**/*.y*ml
echo "Exit code: $?"

# Grounding Validation
python3 ops/grounding/check-grounding.py --report out/grounding-v034.json
```

**Required Thresholds**:

- Test suite: 100% pass rate
- Promtool: Zero rule errors
- Grounding: ‚â•95% pass rate

**üö® HARD STOP**: If any pre-flight gate fails, deployment is BLOCKED

### Phase 1: Release Preparation

#### Git Tagging & Evidence Collection

```bash
# Tag release
git tag v0.3.4-mc
git push origin v0.3.4-mc

# Generate pre-deployment evidence
python3 tools/mc.py evidence pack --out dist/evidence-v0.3.4-mc-pre.json
python3 tools/mc.py evidence verify dist/evidence-v0.3.4-mc-pre.json
```

#### Slack Notification

```
üöÄ MC Platform v0.3.4 "Trust, Throughput, Tenants" - DEPLOYMENT INITIATED

Epic Features:
‚Ä¢ üîê Differential Privacy Telemetry (Œµ/Œ¥ budgets)
‚Ä¢ ‚öôÔ∏è Config Auto-Remediation (<10min MTTR)
‚Ä¢ üí∞ Budget Guard + Auto-Tune (<120s enforcement)
‚Ä¢ üîç Provenance Query API (<200ms response)
‚Ä¢ ü§ñ Autonomy Tier-3 (TENANT_004/005)

Status: Pre-flight gates ‚úÖ | Evidence verified ‚úÖ
Next: Stage canary validation
```

### Phase 2: Staging Validation

#### Canary Analysis (Stage)

```bash
gh workflow run canary-analysis.yml \
  -f baseline=https://stage-blue.example.com \
  -f candidate=https://stage-green.example.com \
  -f minutes=10
```

**Validation Criteria**:

- GraphQL p95 latency: <350ms
- Error rate: No regression vs baseline
- All 5 epic features functional

### Phase 3: Production Canary Waves

#### Wave 1: 20% Traffic

```bash
python3 .mc/v0.2/mc-gates-runner.py \
  --stage canary_20 \
  --strict \
  --report out/gates-canary20-v034.json
```

**Gates**:

- p95 latency: ‚â§+5% vs baseline
- Error rate: Non-worse
- Duration: 60 minutes bake time

**Slack Update**:

```
üéØ v0.3.4 Canary 20% - IN PROGRESS
‚è±Ô∏è Bake time: 60 minutes
üìä Gates: p95 latency, error rate
üîó Monitoring: [Grafana Dashboard]
```

#### Wave 2: 50% Traffic

```bash
python3 .mc/v0.2/mc-gates-runner.py \
  --stage canary_50 \
  --strict \
  --report out/gates-canary50-v034.json
```

**Additional Gates**:

- Throughput degradation: ‚â§10%
- Availability: ‚â•99.9%

#### Wave 3: 100% Production

```bash
python3 .mc/v0.2/mc-gates-runner.py \
  --stage production \
  --strict \
  --report out/gates-prod-v034.json
```

### Phase 4: Feature-Specific Validation

#### Differential Privacy Telemetry

```bash
# Validate Œµ consumption
curl -sS $PROM_URL/api/v1/query \
  --data-urlencode 'query=delta(mc_dp_epsilon_total[24h])' | jq .

# Check for PII violations
curl -sS $PROM_URL/api/v1/query \
  --data-urlencode 'query=mc_dp_pii_violations_total' | jq .
```

**Expected**: Œµ usage >0, PII violations = 0

#### Config Auto-Remediation Drill

```bash
python3 ops/config-auto-remediate.py \
  --simulate-drift \
  --open-pr \
  --sign \
  --out out/remediate-v034.json
```

**Expected**: PR created within 10 minutes, deployment blocked until resolved

#### Budget Guard Enforcement Test

```bash
python3 services/guard/budgets.py \
  --tenant TENANT_001 \
  --simulate-breach 0.92 \
  --window 120 \
  --report out/budget-sim-v034.json
```

**Expected**: Throttling applied within 120 seconds

#### Provenance API Load Test

```bash
k6 run tests/k6/provenance-100rps-200ms.js
```

**Expected**: p95 ‚â§ 200ms at 100 RPS

#### Autonomy Tier-3 Validation

Monitor TENANT_004 and TENANT_005 for 48 hours:

- Success rate: ‚â•99.9%
- Compensation rate: ‚â§0.5%
- Zero privacy/residency violations

### Phase 5: Final Evidence & Communications

#### Evidence Bundle Generation

```bash
python3 tools/mc.py evidence pack --out dist/evidence-v0.3.4-mc.json
python3 tools/mc.py evidence verify dist/evidence-v0.3.4-mc.json
```

#### Success Notification

```bash
gh workflow run release-slack.yml -f version=v0.3.4-mc
```

**Slack Success Message**:

```
üèÜ MC Platform v0.3.4 "Trust, Throughput, Tenants" - DEPLOYMENT COMPLETE ‚úÖ

All Epic Features Successfully Deployed:
‚úÖ Differential Privacy: Zero PII violations, Œµ budgets operational
‚úÖ Config Auto-Remediation: <10min MTTR validated
‚úÖ Budget Guard: <120s enforcement confirmed
‚úÖ Provenance API: <200ms p95 achieved
‚úÖ Autonomy Tier-3: TENANT_004/005 operational with 99.9%+ safety

Evidence Bundle: dist/evidence-v0.3.4-mc.json
Deployment Time: [DURATION]
Status: PRODUCTION READY üöÄ
```

## üö® Rollback Procedures

### Automatic Rollback Triggers

| Metric                     | Threshold  | Duration | Action                               |
| -------------------------- | ---------- | -------- | ------------------------------------ |
| GraphQL p95                | >350ms     | 30min    | Pause promotion                      |
| A/A Replication Lag        | >120s      | 10min    | Immediate rollback                   |
| Autonomy Compensation      | >0.5%      | 24h      | Halt enactments                      |
| SIEM Delivery              | <95%       | 15min    | Failover + page SecOps               |
| PII Violations             | >0         | 1h       | Immediate halt + security escalation |
| Budget Enforcement Timeout | >0.01 rate | 5min     | Disable auto-enforcement             |
| Provenance Query p95       | >200ms     | 5min     | Scale out query layer                |

### Manual Rollback Commands

#### Emergency Rollback

```bash
# Immediate traffic cutover to previous version
kubectl patch deployment mc-platform -p '{"spec":{"template":{"metadata":{"labels":{"version":"v0.3.3"}}}}}'

# Disable all v0.3.4 feature flags
kubectl patch configmap feature-flags -p '{"data":{"v034_features":"false"}}'

# Notify teams
gh workflow run emergency-rollback.yml -f version=v0.3.4-mc -f reason="[REASON]"
```

#### Selective Feature Rollback

```bash
# Disable specific features
kubectl patch configmap feature-flags -p '{"data":{"differential_privacy_enabled":"false"}}'
kubectl patch configmap feature-flags -p '{"data":{"autonomy_tier3_enabled":"false"}}'
```

## üìä Post-Deployment Monitoring

### Day-1 Tasks

- [ ] Run `scripts/generate-operations-delta.sh`
- [ ] Verify DP Œµ/Œ¥ budgets in Grafana
- [ ] Check provenance API p95 metrics
- [ ] Monitor budget guard events
- [ ] Post Slack snapshot to #deployment-updates

### Day-7 Tasks

- [ ] DR drill for GA tenants
- [ ] Privacy red-team validation subset
- [ ] Publish Ops Delta report
- [ ] Attach Day-7 evidence to bundle

## üîó Resources

- **Monitoring Dashboard**: [Grafana MC Platform v0.3.4](https://grafana.example.com/d/mc-v034)
- **Alert Channels**: #mc-alerts, #deployment-status
- **Escalation**: PagerDuty - MC Platform On-Call
- **Evidence Storage**: `dist/evidence-v0.3.4-mc.json`
- **Rollback Runbook**: [Emergency Response Guide](./emergency-rollback.md)

## ‚úÖ Sign-Off

- [ ] Deployment Lead: ******\_\_\_\_******
- [ ] Security Lead: ******\_\_\_\_******
- [ ] Product Owner: ******\_\_\_\_******
- [ ] Date/Time: ******\_\_\_\_******

---

**Document Version**: 1.0
**Last Updated**: 2025-09-26
**Next Review**: Post-deployment retrospective
