# Customer Migration Factory Playbook

This document outlines the standard procedures for migrating customers from competitor platforms to our system.

## Supported Sources (Top 5)

We prioritize the following source systems for automated migration:

1.  **Salesforce** (CRM & Service Cloud)
2.  **HubSpot** (CRM & Tickets)
3.  **Jira** (Issue Tracking & Projects)
4.  **Zendesk** (Support Tickets)
5.  **Asana** (Project Management)

## 1. Migration Lifecycle

### Phase 1: Assessment & Planning (Days 1-2)

- **Parity Checklist**: Run the source-specific parity checklist to identify data that will not be migrated (e.g., legacy custom objects, obscure metadata).
- **Volume Analysis**: Estimate record counts (Entities, Edges, Documents) to size the migration window.
- **Mapping**: Define field mappings in the `MigrationConfig`.

### Phase 2: Dry Run (Day 3)

- Execute migration with `dryRun: true`.
- Generate `MigrationResult` report.
- Review `recordsFailed` and `errors`.
- Adjust mappings and filters based on errors.

### Phase 3: Initial Load (Day 4-5)

- Execute full migration.
- Monitor `MigrationOrchestrator` logs.
- Verify `recordsSuccess` matches source counts.

### Phase 4: Delta Sync & Cutover (Day 14)

- Freeze source system (read-only).
- Run delta migration (if supported by connector).
- Verify final counts.
- Switch DNS/Traffic.

## 2. Ingestion Framework

The migration engine is located at `server/src/ingestion/migration/`.

### Components

- **Orchestrator**: Manages the workflow, error handling, and reporting.
- **Connectors**: Source-specific adapters (e.g., `SalesforceMigrationConnector`).
- **ValidationService**: Enforces schema constraints and data quality.
- **IdempotencyService**: Prevents duplicate records during re-runs.

### Configuration

Example `MigrationConfig`:

```json
{
  "id": "mig-tenant-123",
  "tenantId": "tenant-123",
  "sourceType": "salesforce",
  "sourceConfig": {
    "instanceUrl": "https://na01.salesforce.com",
    "clientId": "..."
  },
  "dryRun": true,
  "mappings": {
    "Phone": "phoneNumber",
    "Description": "bio"
  }
}
```

## 3. Rollback Plan

If critical errors occur after cutover:

1.  **Stop Ingestion**: Halt any running migration jobs.
2.  **Restore Backup**: If target data was corrupted, restore from pre-migration snapshot.
3.  **Revert DNS**: Point users back to the legacy system.
4.  **Analyze Logs**: Check `MigrationError` details in the result report.

## 4. Parity Checklists

### Salesforce

- [x] Accounts
- [x] Contacts
- [x] Opportunities
- [ ] Custom Objects (requires manual mapping)
- [ ] Chatter Feeds (not supported)

### HubSpot

- [x] Companies
- [x] Contacts
- [x] Deals
- [ ] Engagement/Calls (partial support)

---

_Generated by the Customer Migration Factory_
