# GA Evidence Map Runbook

## Purpose

This runbook defines how Summit captures, verifies, and evolves GA evidence using the canonical
`docs/ga/evidence_map.yml` and the dependency-free verifier. The verification flow is designed to
remain deterministic, audit-ready, and continuously enforced in CI.

Refer to the [Summit Readiness Assertion](../SUMMIT_READINESS_ASSERTION.md) to align readiness
language and evidence expectations across artifacts.

## Canonical Evidence Map

The authoritative map lives at `docs/ga/evidence_map.yml`. Each entry includes:

- `id`: Stable evidence identifier.
- `path`: Evidence location (supports `${sha}`, `${ref}`, `${run_id}`).
- `producer`: Command or pipeline that emits the artifact.
- `verifier`: Validation rules (hash, JSON schema fields, freshness, etc.).
- `when`: Optional conditions (for example, tag-only evidence).

## Evidence Manifest Standard

Evidence bundles are indexed in `artifacts/evidence/<sha>/manifest.json`.
The manifest schema is:

```json
{
  "schema_version": "1",
  "sha": "<git sha>",
  "generated_at": "2026-01-01T00:00:00Z",
  "metadata": {
    "ref": "refs/heads/main",
    "run_id": "123456"
  },
  "entries": [
    {
      "id": "sbom_monorepo",
      "path": "artifacts/evidence/<sha>/sbom/monorepo.cdx.json",
      "sha256": "<digest>",
      "producer": "pnpm ci:evidence:bundle"
    }
  ]
}
```

## Adding a New Evidence Requirement

1. **Update the map**: Add a new entry under `required_evidence` or `optional_evidence` in
   `docs/ga/evidence_map.yml`.
2. **Define the producer**: Ensure the evidence is generated by `pnpm ci:evidence:bundle` or another
   deterministic command.
3. **Add manifest coverage**: Update the bundler to add a manifest entry for the new artifact.
4. **Map GA-critical changes**: Append the new control to `docs/ga/MVP-4-GA-VERIFICATION.md` and
   `docs/ga/verification-map.json`.
5. **Run locally**:

   ```bash
   pnpm ci:evidence:bundle
   pnpm ci:evidence:verify
   pnpm ci:ga-evidence:verify
   ```

6. **Confirm reports**: Verify `artifacts/ga-verify/<sha>/report.json`, `report.md`, and
   `stamp.json` are produced.

## Running the Verifier Locally

```bash
pnpm ci:evidence:bundle
pnpm ci:evidence:verify
pnpm ci:ga-evidence:verify --map docs/ga/evidence_map.yml
```

Use `SOURCE_DATE_EPOCH=<unix>` for deterministic timestamps when comparing outputs.

## CI Enforcement

The **GA Evidence Map Verification** job in `ci-core.yml` runs:

1. `pnpm ci:evidence:bundle`
2. `pnpm ci:evidence:verify`
3. `pnpm ci:ga-evidence:verify`

The job uploads `artifacts/ga-verify/<sha>/` for audit retention.

## Report and Stamp Interpretation

- `report.json`: Machine-readable status for each evidence entry, including hashes and errors.
- `report.md`: Human-readable summary for audit review.
- `stamp.json`: Canonical pass/fail receipt containing policy and report hashes.

## Control Mapping (SOC 2 / ISO 27001)

This evidence map aligns to high-level controls without embedding private regulatory language:

- **SOC 2 CC1/CC2**: Evidence integrity (hash validation, freshness checks).
- **SOC 2 CC7**: Change management and monitoring (CI gate + audit report).
- **ISO 27001 A.5/A.8**: Information security policies and asset management (manifested evidence).
- **ISO 27001 A.12**: Operational controls (deterministic verification runbook).

## Upgrade Path

- Increment `schema_version` when introducing backward-incompatible map changes.
- Extend the verifier by adding new `verifier.type` handlers with documented constraints.
- Keep the manifest schema stable and add optional fields under `metadata` for new provenance data.

