# Compliance Snapshot Generator

This directory contains the tools and data for generating a "Compliance Snapshot," an evidence-mapping document derived from the project's release artifacts.

## What This Is (and Is Not)

### It Is:
- An **automated tool** for gathering and organizing evidence.
- A **snapshot** that links internal controls to objective artifacts (e.g., SBOMs, checksums, policy files).
- A **facilitator** for internal reviews and audit preparation.
- A **deterministic process** where the output is directly tied to a specific release commit.

### It Is Not:
- A **certification or attestation** of compliance with any standard (e.g., SOC 2, ISO 27001).
- A **substitute for a formal audit** by a qualified third party.
- A **guarantee of security or compliance**.

The purpose is to provide a clear, traceable, and objective view of the evidence generated by our release process, not to make claims about meeting external compliance requirements.

## How It Works

The process is driven by two key components:

1.  **`CONTROLS_CATALOG.yml`**: This file is the heart of the snapshot. It defines a list of internal controls, each with:
    - A unique `id`.
    - A `area` (e.g., "Supply Chain Integrity").
    - A `statement` describing the control's objective in plain language.
    - A list of `evidence` sources that satisfy the control.

    The evidence sources are pointers to artifacts within the repository, the release evidence bundle, or CI/CD job logs.

2.  **`scripts/releases/generate_compliance_snapshot.mjs`**: This Node.js script performs the following steps:
    - Loads the `CONTROLS_CATALOG.yml`.
    - Takes a release `bundle-index.json` as input, which acts as a manifest for all release artifacts.
    - Iterates through each control in the catalog.
    - Resolves the evidence pointers against the bundle index and repository structure.
    - Generates a Markdown document (`COMPLIANCE_SNAPSHOT_<target>.md`) with a table mapping each control to its corresponding evidence artifacts.

## How to Regenerate and Verify

The snapshot is designed to be generated as part of the release process. To regenerate it manually, you must have a complete release evidence bundle available.

**Command:**
```bash
# Run from the repository root
node scripts/releases/generate_compliance_snapshot.mjs \
  --target "<git-sha-or-tag>" \
  --bundle-index "<path/to/bundle-index.json>" \
  --output "docs/releases/compliance/COMPLIANCE_SNAPSHOT_<target>.md"
```

- `--target`: The Git commit SHA or tag for which the bundle was created.
- `--bundle-index`: The path to the `bundle-index.json` file from the evidence bundle.
- `--output`: The path where the generated Markdown file will be saved.

Verification of the snapshot involves confirming that the links in the generated document point to the correct, unmodified artifacts from the specified release.
