# IntelGraph Investigator & Analyst Guide

This guide walks IntelGraph investigators, analysts, and mission leads through the end-to-end workflows that drive insight generation: querying the intelligence graph, ingesting fresh data, and building visual narratives for decision makers. The playbooks below assume the standard Summit deployment with the React experience served from `client/` (or the workspace app at `apps/web`) and the Node.js GraphQL backend running from `server/` or `apps/intelgraph-api`.

> **Audience**: OSINT/All-source analysts, investigative leads, and intelligence fusion cell operators using IntelGraph.

---

## 1. Before You Begin

| Requirement | Details |
| --- | --- |
| Platform access | IntelGraph web experience (React) at `https://<your-domain>/intelgraph`. Ensure SSO or MFA policies are satisfied. |
| Backend connectivity | Node.js GraphQL API reachable at `https://<api-domain>/graphql`. Validate the deployment with `curl -sS https://<api-domain>/healthz` and, for authenticated access, send `curl -H "authorization: Bearer <token>" -H "content-type: application/json" --data '{"query":"query Health{ health }"}' https://<api-domain>/graphql`. |
| Browser | Chromium-based browser, Firefox ESR, or hardened mission workstation. Enable WebGL for graph rendering. |
| Data sources | Credentials for OSINT connectors (RSS, JSON, STIX/TAXII), CSV uploads, or live mission feeds. Connector defaults live in `server/src/services/IntegrationService.js`. |
| Neo4j/Graph DB | Ensure the Neo4j Aura or self-hosted cluster configured via `server/scripts/setup-env.js` (`NEO4J_URI`, `NEO4J_USER`, `NEO4J_PASSWORD`) is reachable from both API and ingestion workers. |

### Compatibility Checklist

1. Confirm the React front-end version in **Settings → About** matches the API package versions declared in `client/package.json` and `server/package.json`. Tag Helm releases with both versions to prevent schema drift.
2. Run `pnpm lint` and `pnpm typecheck` from the repo root before pushing UI changes. This guards against regressions in the explorer panes located under `client/src/features/explorer/*`.
3. If deploying custom widgets, export them from `client/src/features/explorer` and expose companion GraphQL fields in `server/src/graphql/intelgraph`. Keep schema changes backwards-compatible by adding nullable fields first and rebuilding the API with `pnpm -C server build`.

---

## 2. Quick Orientation

The IntelGraph workspace is organized into the following panels:

1. **Mission Switcher** – filter by workspace, operation, or customer enclave. The selector state is stored in `client/src/features/explorer/ExplorerContext.js`.
2. **Query Builder** – craft graph traversals without writing Cypher. UI selections are converted into persisted GraphQL queries.
3. **Canvas & Timeline** – visualize entity connections, annotate nodes, and create timeline narratives powered by the React components in `client/src/features/explorer`.
4. **Insights Drawer** – review AI-summarized findings generated by the GraphRAG services under `server/src/maestro/assistant`.

---

## 3. Tutorial: Running Graph Queries

1. **Pick a Template**: From **Queries → Templates**, select *Multi-Hop Threat Surface*. Template definitions live alongside the explorer panes in `client/src/features/explorer`, so analysts can version-control new presets.
2. **Set Anchors**: In the **Anchor Entities** panel, start typing an indicator (domain, wallet, persona). Autocomplete is backed by the Node.js `entitySearch` resolver implemented in `server/src/graphql/intelgraph/resolvers.ts`.
3. **Adjust Depth**: Use the *Traverse up to* selector to set max hop count. Anything above 3 triggers the bounded traversal guard in `client/src/features/explorer/ExplorerContext.js` to avoid runaway queries.
4. **Add Constraints**: Toggle **Edge Filters → Confidence ≥ 0.6** and **Tactics = Lateral Movement**. These filters map to GraphQL arguments on the `threatPaths` resolver, ensuring server-side filtering.
5. **Preview Traversal**: Click **Show Generated Query** to review the payload. For deeper inspections, compare the shape with the schema in `server/src/graphql/intelgraph/schema.ts` and replay it using the GraphQL IDE at `/graphql`.
6. **Run**: Hit **Execute**. The React client streams partial results over the GraphQL endpoint while logging telemetry through `server/logs/combined.log`. Monitor the progress bar and node count badge for saturation warnings.
7. **Bookmark**: Save results to a workspace collection for collaboration. Bookmarks persist to PostgreSQL via the helpers in `server/src/graphql/intelgraph/persisted-queries.ts`.

**Power User Tip**: Combine the query builder with the *AI Assist* toggle to receive GraphRAG-suggested follow-up traversals. These suggestions are written to `server/logs/combined.log` with the `graphrag` label for auditing.

### Troubleshooting

- **Query Hangs at 0%**: Verify the GraphQL endpoint is reachable. Run `just conductor-status` to confirm `/healthz` and `/graphql` respond, then inspect `server/logs/combined.log` for resolver errors.
- **Missing Entities**: Confirm ingestion job tags align with the workspace. Review the ingestion pipelines under `server/src/ingest/*.ts` and reconcile Neo4j indexes with `node server/scripts/migrate-neo4j.js` if lagging.
- **GraphQL Validation Errors**: Update the React template definitions when the schema evolves. Re-run `pnpm typecheck` so new types flow into the UI without runtime mismatches.

---

## 4. Tutorial: Data Ingestion Pipelines

1. **Launch the Ingestion Wizard**: Navigate to **Ingest → New Source**.
2. **Select Connector Type**:
   - *Stream*: Kafka, Kinesis, or WebSocket sources managed by the Node ingestion service.
   - *Batch*: CSV, JSON Lines, or STIX archives uploaded through the React dropzone.
3. **Map Fields**: Use the schema mapper to bind source attributes to IntelGraph entity definitions. Mapping metadata is persisted through the Maestro ingestion API (`server/src/maestro/pipelines/pipelines-api.ts`).
4. **Set Transform Rules**: Configure entity deduplication and enrichment logic. Rules compile to the ingestion helpers in `server/src/ingest/dedupe.ts`, `server/src/ingest/http.ts`, and `server/src/ingest/kafka.ts`.
5. **Validate**: Run the dry-run preview. The client displays sample nodes and edges; validation errors surface from `/api/ingest/validate` and are mirrored in `server/logs/error.log`.
6. **Activate**: Start the job and monitor status via the **Pipeline Monitor** tab. Health signals hydrate from the Maestro pipelines repository defined in `server/src/maestro/pipelines/pipelines-repo.ts`.

### Monitoring & Recovery

- Review ingestion metrics in **Observability → Pipelines** (pulls from the observability stack configured under `infra/observability`). Alerts fire to Slack via the webhook patterns documented in `docs/maestro/EXECUTION_PLAN.md`.
- Pause a problematic job by toggling **Pause**; the backend persists state through the pipelines repository so restarts resume without data loss.
- For connector updates, adjust integration stubs in `server/src/services/IntegrationService.js` and redeploy using the Maestro Conductor workflow (see companion guide).

### Troubleshooting

| Symptom | Resolution |
| --- | --- |
| CSV upload fails at 95% | Increase `INGEST_MAX_PAYLOAD_SIZE` in the ingestion validator configuration (see `server/src/middleware/ingestValidator.ts`) and restart the API with `just conductor-restart`. |
| Duplicate nodes appear | Ensure `mergeOn` keys are defined in the mapping stage. Review the helpers in `server/src/ingest/dedupe.ts` and confirm Redis/PostgreSQL lookups succeed. |
| Kafka lag spikes | Scale the ingestion worker deployment via Maestro: `kubectl scale deployment/maestro-worker --replicas=4` and verify offsets with `kubectl logs -n intelgraph maestro-worker-<pod>`. |

---

## 5. Tutorial: Visualizing Intelligence Products

1. From the query results, select **Create Storyboard**.
2. Arrange snapshots on the canvas; drag nodes into focus frames using the explorer pane components in `client/src/features/explorer/GraphPane.jsx`.
3. Use **Narrative Blocks** to auto-generate prose. The Node backend routes the summarization call through `server/src/maestro/assistant/graphrag-service.ts`.
4. Insert timeline clips: highlight key timestamps and render them into the lower panel managed by `client/src/features/explorer/TimelinePane.jsx`.
5. Export to PDF or share a live link. Export flows originate from `client/src/features/export/ExportCaseDialog.tsx` and respect the Node auth tokens enforced in `server/src/auth/context.ts`.

### Publishing & Collaboration

- Share to Slack/MS Teams via the **Share** button. Webhook helpers live in `client/src/lib/integrations`.
- Archive completed boards to object storage by configuring `MEDIA_UPLOAD_PATH` and related settings in `server/src/services/MediaUploadService.ts`.

### Troubleshooting

- **Visualization Not Loading**: Confirm WebGL is enabled and GPU drivers meet minimum spec. Fallback 2D canvas can be forced with the `?renderMode=canvas` query param implemented in the explorer components.
- **Annotations Missing**: Ensure the Node backend has write access to PostgreSQL. Apply pending migrations with `node server/scripts/db_migrate.cjs`.
- **PDF Export Fails**: The export worker runs in the Maestro-controlled build plane. Inspect the pipelines API via `kubectl logs deployment/maestro-worker` for export job errors.

---

## 6. Next Steps & Resources

- Review [`docs/OPERATIONS-RUNBOOK.md`](../OPERATIONS-RUNBOOK.md) for escalations.
- Coordinate cross-team workflows with Maestro Conductor using the [Maestro Conductor Build & Orchestration Guide](maestro-conductor-user-guide.md).
- Use `just conductor-logs` for rapid troubleshooting and open GitHub issues when pipelines or exports fail. Contribute improvements by updating both the React UI and Node schema in tandem while following the linting standards defined in the root `AGENTS.md`.

