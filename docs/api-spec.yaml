openapi: 3.0.0
info:
  title: Summit API
  version: 1.0.0
  description: API for Summit, the IntelGraph agent platform.
  contact:
    name: IntelGraph Support
    email: support@intelgraph.com
servers:
  - url: http://localhost:3000
    description: Local development server
tags:
  - name: Monitoring
    description: System health and metrics
  - name: Tenants
    description: Tenant management
  - name: Policy
    description: Policy simulation and enforcement
  - name: Export
    description: Data export and compliance
  - name: Maestro
    description: Orchestration and workflow management

paths:
  /monitoring/metrics:
    get:
      operationId: getMetrics
      summary: Get system metrics
      description: Retrieve current system metrics including CPU, memory, and request counts.
      tags: [Monitoring]
      responses:
        '200':
          description: Metrics object
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: number

  /health:
    get:
      operationId: getHealth
      summary: Health check
      description: Check the health status of the API and its dependencies.
      tags: [Monitoring]
      responses:
        '200':
          description: System is healthy
          content:
            application/json:
              schema:
                : '#/components/schemas/HealthStatus'
        '503':
          description: System is unhealthy
          content:
            application/json:
              schema:
                : '#/components/schemas/HealthStatus'

  /api/tenants:
    post:
      operationId: createTenant
      summary: Create a new tenant
      description: Provision a new tenant with the specified configuration.
      tags: [Tenants]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              : '#/components/schemas/CreateTenantRequest'
      responses:
        '201':
          description: Tenant created
          content:
            application/json:
              schema:
                : '#/components/schemas/Tenant'
    get:
      operationId: listTenants
      summary: List all tenants
      description: Retrieve a list of all registered tenants.
      tags: [Tenants]
      responses:
        '200':
          description: List of tenants
          content:
            application/json:
              schema:
                type: array
                items:
                  : '#/components/schemas/Tenant'

  /api/policy/simulate:
    post:
      operationId: simulatePolicy
      summary: Simulate policy enforcement
      description: Simulate a policy decision for a given subject, resource, and action.
      tags: [Policy]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              : '#/components/schemas/PolicySimulationInput'
      responses:
        '200':
          description: Simulation result
          content:
            application/json:
              schema:
                : '#/components/schemas/PolicySimulationResult'

  /api/export/bundles:
    post:
      operationId: createExportBundle
      summary: Create an export bundle
      description: Initiate a job to create an export bundle for a specific run.
      tags: [Export]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              : '#/components/schemas/CreateBundleRequest'
      responses:
        '202':
          description: Export job started
          content:
            application/json:
              schema:
                : '#/components/schemas/JobStatus'

  /api/receipts/{id}:
    get:
      operationId: getReceipt
      summary: Get a receipt by ID
      description: Retrieve a specific receipt by its unique identifier.
      tags: [Export]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Receipt details
          content:
            application/json:
              schema:
                : '#/components/schemas/Receipt'
        '404':
          description: Receipt not found

  /api/maestro/route/preview:
    post:
      operationId: previewRoute
      summary: Preview routing decision
      description: Preview the candidates and estimated costs for a routing request.
      tags: [Maestro]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                prompt:
                  type: string
      responses:
        '200':
          description: Routing candidates
          content:
            application/json:
              schema:
                : '#/components/schemas/RoutePreviewResponse'

  /api/maestro/route/execute:
    post:
      operationId: executeRoute
      summary: Execute routed request
      description: Execute a request using the Maestro routing logic.
      tags: [Maestro]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                prompt:
                  type: string
                models:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Execution result
          content:
            application/json:
              schema:
                : '#/components/schemas/RouteExecuteResponse'

  /api/maestro/web/interfaces:
    get:
      operationId: listWebInterfaces
      summary: List available web interfaces
      description: Retrieve a list of available web interfaces for orchestration.
      tags: [Maestro]
      responses:
        '200':
          description: List of interfaces
          content:
            application/json:
              schema:
                : '#/components/schemas/WebInterfacesResponse'

  /api/maestro/web/run:
    post:
      operationId: runWebOrchestration
      summary: Run web orchestration
      description: Orchestrate a task across multiple web interfaces.
      tags: [Maestro]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                task:
                  type: string
      responses:
        '200':
          description: Orchestration result
          content:
            application/json:
              schema:
                : '#/components/schemas/OrchestrateWebResponse'

  /api/maestro/budgets:
    get:
      operationId: getBudgets
      summary: Get budget status
      description: Retrieve the current budget status and usage for the tenant.
      tags: [Maestro]
      responses:
        '200':
          description: Budget details
          content:
            application/json:
              schema:
                : '#/components/schemas/BudgetsResponse'

  /api/maestro/policy/check:
    post:
      operationId: checkPolicy
      summary: Check policy compliance
      description: Check if a proposed action complies with the configured policies.
      tags: [Maestro]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                action:
                  type: string
      responses:
        '200':
          description: Policy check result
          content:
            application/json:
              schema:
                : '#/components/schemas/PolicyCheckResponse'

  /api/maestro/runs:
    post:
      operationId: createRun
      summary: Start a new run
      description: Initiate a new workflow run.
      tags: [Maestro]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                workflowId:
                  type: string
      responses:
        '201':
          description: Run created
          content:
            application/json:
              schema:
                type: object
                properties:
                  runId:
                    type: string

  /api/tenants/{tenantId}/workflows:
    post:
      operationId: createWorkflow
      summary: Create a workflow definition
      description: Define a new workflow for a specific tenant.
      tags: [Maestro]
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              : '#/components/schemas/WorkflowDefinitionInput'
      responses:
        '201':
          description: Workflow created
          content:
            application/json:
              schema:
                : '#/components/schemas/WorkflowDefinition'

  /api/tenants/{tenantId}/runs:
    post:
      operationId: startTenantRun
      summary: Start a run for a tenant
      description: Start a workflow run within a specific tenant context.
      tags: [Maestro]
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              : '#/components/schemas/StartRunInput'
      responses:
        '201':
          description: Run started
          content:
            application/json:
              schema:
                : '#/components/schemas/Run'

  /api/tenants/{tenantId}/runs/{runId}:
    get:
      operationId: getRunDetails
      summary: Get run details
      description: Retrieve the details and status of a specific run.
      tags: [Maestro]
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
        - name: runId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Run details
          content:
            application/json:
              schema:
                : '#/components/schemas/Run'

  /api/tenants/{tenantId}/runs/{runId}/approve:
    post:
      operationId: approveRun
      summary: Approve or reject a run/step
      description: Submit an approval decision for a specific step in a run.
      tags: [Maestro]
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
        - name: runId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              : '#/components/schemas/ApprovalInput'
      responses:
        '200':
          description: Approval processed
          content:
            application/json:
              schema:
                : '#/components/schemas/ApprovalResult'

  /api/tenants/{tenantId}/runs/{runId}/events:
    get:
      operationId: getRunEvents
      summary: Get timeline events for a run
      description: Retrieve the event timeline for a specific run.
      tags: [Maestro]
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
        - name: runId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of events
          content:
            application/json:
              schema:
                type: array
                items:
                  : '#/components/schemas/RunEvent'

components:
  schemas:
    HealthStatus:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, unhealthy]
        timestamp:
          type: string
          format: date-time
        error:
          type: string

    CreateTenantRequest:
      type: object
      required: [name, slug, adminEmail]
      properties:
        name:
          type: string
        slug:
          type: string
        adminEmail:
          type: string
        tier:
          type: string
          enum: [internal, partner, hosted]
        policyProfile:
          type: string
          enum: [strict, balanced, fast_ops]

    Tenant:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        slug:
          type: string
        tier:
          type: string
        status:
          type: string

    PolicySimulationInput:
      type: object
      required: [subjectTenantId, resourceTenantId, action]
      properties:
        subjectTenantId:
          type: string
        resourceTenantId:
          type: string
        action:
          type: string
        purpose:
          type: string
        justification:
          type: string
        profile:
          type: string
          enum: [strict, balanced, fast_ops]
          description: Optional profile to simulate against

    PolicySimulationResult:
      type: object
      properties:
        allow:
          type: boolean
        reason:
          type: string
        overlaysApplied:
          type: array
          items:
            type: string
        evaluationPath:
          type: array
          items:
            type: string

    CreateBundleRequest:
      type: object
      required: [runId]
      properties:
        runId:
          type: string
        redactionProfile:
          type: string
          enum: [none, sources, raw_content, actor_ids, minimize_pii]
        includeReceipts:
          type: boolean

    JobStatus:
      type: object
      properties:
        jobId:
          type: string
        status:
          type: string
          enum: [queued, processing, completed, failed]

    Receipt:
      type: object
      properties:
        id:
          type: string
        timestamp:
          type: string
          format: date-time
        action:
          type: string
        actor:
          type: string
        resource:
          type: string
        inputHash:
          type: string
        policyDecisionId:
          type: string
        signature:
          type: string
        signerKeyId:
          type: string

    Candidate:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [model, web]
        name:
          type: string
        score:
          type: number
        cost_est:
          type: number
        latency_est_ms:
          type: number
        rationale:
          type: string

    RoutePreviewResponse:
      type: object
      properties:
        candidates:
          type: array
          items:
            : '#/components/schemas/Candidate'

    RouteExecuteStep:
      type: object
      properties:
        id:
          type: string
        source:
          type: string
        status:
          type: string
          enum: [ok, fail]
        tokens:
          type: number
        cost:
          type: number
        citations:
          type: array
          items:
            type: object
            properties:
              title:
                type: string
              url:
                type: string
        elapsed_ms:
          type: number

    RouteExecuteResponse:
      type: object
      properties:
        runId:
          type: string
        steps:
          type: array
          items:
            : '#/components/schemas/RouteExecuteStep'

    WebInterface:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        category:
          type: string
        reliability:
          type: number
        cost_hint:
          type: number

    WebInterfacesResponse:
      type: object
      properties:
        items:
          type: array
          items:
            : '#/components/schemas/WebInterface'

    OrchestrateWebResponse:
      type: object
      properties:
        responses:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              interface:
                type: string
              text:
                type: string
              citations:
                type: array
                items:
                  type: object
                  properties:
                    title:
                      type: string
                    url:
                      type: string
        synthesized:
          type: object
          properties:
            text:
              type: string
            citations:
              type: array
              items:
                type: object
                properties:
                  title:
                    type: string
                  url:
                    type: string

    BudgetsResponse:
      type: object
      properties:
        tier:
          type: string
          enum: [bronze, silver, gold]
        remaining:
          type: object
          properties:
            tokens:
              type: number
            usd:
              type: number
        burndown:
          type: array
          items:
            type: object
            properties:
              t:
                type: string
              usd:
                type: number
              tokens:
                type: number

    PolicyCheckResponse:
      type: object
      properties:
        allowed:
          type: boolean
        reason:
          type: string
        elevation:
          type: object
          properties:
            contact:
              type: string
            sla_hours:
              type: number

    WorkflowDefinitionInput:
      type: object
      required: [version, env, retentionClass, costCenter, inputSchema, outputSchema, body]
      properties:
        version:
          type: string
        env:
          type: string
        retentionClass:
          type: string
        costCenter:
          type: string
        inputSchema:
          type: string
        outputSchema:
          type: string
        body:
          type: string

    WorkflowDefinition:
      allOf:
        - : '#/components/schemas/WorkflowDefinitionInput'
        - type: object
          properties:
            id:
              type: string
            tenantId:
              type: string
            createdAt:
              type: string
            updatedAt:
              type: string

    StartRunInput:
      type: object
      required: [workflowId, input]
      properties:
        workflowId:
          type: string
        input:
          type: string
        env:
          type: string

    Run:
      type: object
      properties:
        id:
          type: string
        tenantId:
          type: string
        workflowId:
          type: string
        status:
          type: string
          enum: [PENDING, RUNNING, COMPLETED, FAILED, CANCELLED, NEEDS_APPROVAL]
        startedAt:
          type: string
        completedAt:
          type: string
        input:
          type: string
        output:
          type: string
        receipts:
          type: array
          items:
            : '#/components/schemas/Receipt'

    ApprovalInput:
      type: object
      required: [decision, rationale]
      properties:
        decision:
          type: string
          enum: [APPROVE, REJECT]
        rationale:
          type: string
        stepId:
          type: string

    ApprovalResult:
      type: object
      properties:
        status:
          type: string

    RunEvent:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
        timestamp:
          type: string
        payload:
          type: string
