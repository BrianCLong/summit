# Release Evidence Provenance Attestation

## Overview
This document describes the provenance attestation generated for each release of the platform.
The goal is to provide a single, cryptographically verifiable statement that binds a release tag to its build environment, source commit, and the resulting evidence bundle.

## Attestation Format
The attestation uses the [in-toto](https://in-toto.io/) statement format with a SLSA-style provenance predicate.

### File Location
- **Inside Evidence Bundle**: `attestations/release_evidence_provenance.intoto.json`
- **GitHub Release Asset**: `release-evidence-provenance-<TAG>.intoto.json`

### Statement Structure
```json
{
  "_type": "https://in-toto.io/Statement/v0.1",
  "subject": [
    {
      "name": "ga-evidence-bundle-<TAG>.tar.gz",
      "digest": {
        "sha256": "<SHA256_HEX>"
      }
    }
  ],
  "predicateType": "https://slsa.dev/provenance/v0.2",
  "predicate": {
    "builder": {
      "id": "https://github.com/actions/runner"
    },
    "buildType": "https://github.com/actions/workflow",
    "invocation": {
      "configSource": {
        "uri": "git+https://github.com/<OWNER>/<REPO>@<REF>",
        "digest": {
          "sha1": "<COMMIT_SHA>"
        },
        "entryPoint": ".github/workflows/release-evidence-provenance.yml"
      },
      "parameters": {
        "tag": "<TAG>",
        "run_id": "<RUN_ID>",
        "run_url": "<RUN_URL>"
      }
    },
    "metadata": {
      "buildStartedOn": "<TIMESTAMP>",
      "buildFinishedOn": "<TIMESTAMP>",
      "completeness": {
        "parameters": true,
        "environment": false,
        "materials": false
      },
      "reproducible": false
    },
    "materials": [
      {
        "uri": "git+https://github.com/<OWNER>/<REPO>@<REF>",
        "digest": {
          "sha1": "<COMMIT_SHA>"
        }
      }
    ]
  }
}
```

## Verification
The attestation is signed keylessly using GitHub OIDC (via `cosign`).
To verify the provenance of a release:

1. Download the provenance file (`.intoto.json`), signature (`.sig`), and certificate (`.cert`) from the GitHub Release.
2. Download the evidence bundle tarball.
3. Run the verification script:
   ```bash
   ./scripts/evidence/verify_release_provenance.sh \
     --attestation release-evidence-provenance-<TAG>.intoto.json \
     --signature release-evidence-provenance-<TAG>.sig \
     --certificate release-evidence-provenance-<TAG>.cert \
     --bundle ga-evidence-bundle-<TAG>.tar.gz
   ```

## Signing Identity
The signature is generated by the GitHub Actions workflow in this repository.
- **Issuer**: `https://token.actions.githubusercontent.com`
- **Subject**: `repo:<OWNER>/<REPO>:ref:refs/tags/<TAG>` or similar workflow identity.
