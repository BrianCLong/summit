
# slo-config.yaml
# Defines the Service Level Objectives for a service in the catalog.

apiVersion: maestro.intelgraph.io/v1alpha1
kind: ServiceLevelObjective
metadata:
  # This should match the component name in catalog-info.yaml
  name: maestro-api
spec:
  # Human-readable description of the service.
  description: "Core API for the Maestro CI/CD Platform"

  # A list of objectives for this service.
  objectives:
    - name: "API Availability"
      description: "The API should be available and serving non-5xx responses."
      # 99.9% availability over a 28-day window.
      target: 99.9
      window: 28d
      # Service Level Indicator (SLI) definition.
      sli:
        type: "prometheus"
        query: |
          sum(rate(maestro_api_requests_total{status!~"5.."}[5m]))
          /
          sum(rate(maestro_api_requests_total[5m]))

    - name: "API Latency"
      description: "95% of API requests should complete in under 250ms."
      # 99% of the time, the latency target should be met.
      target: 99.0
      window: 28d
      sli:
        type: "prometheus"
        query: |
          sum(rate(maestro_api_request_latency_seconds_bucket{le="0.25"}[5m]))
          /
          sum(rate(maestro_api_request_latency_seconds_count[5m]))

    - name: "Docling Parse Latency"
      description: "Docling parse p95 latency stays under 900ms for build artifacts."
      target: 99.0
      window: 28d
      sli:
        type: "prometheus"
        query: |
          sum(rate(docling_inference_duration_seconds_bucket{operation="parse",le="0.9"}[5m]))
          /
          sum(rate(docling_inference_duration_seconds_count{operation="parse"}[5m]))

    - name: "Docling Summarize Latency"
      description: "Docling summarize p95 latency stays under 1.5s for build logs."
      target: 99.0
      window: 28d
      sli:
        type: "prometheus"
        query: |
          sum(rate(docling_inference_duration_seconds_bucket{operation="summarize",le="1.5"}[5m]))
          /
          sum(rate(docling_inference_duration_seconds_count{operation="summarize"}[5m]))
    - name: "Canary Rollback Time"
      description: "Median rollback duration stays under five minutes during canary aborts."
      target: 99.0
      window: 28d
      sli:
        type: "prometheus"
        query: |
          1 - clamp_max((histogram_quantile(0.5,
            sum(rate(maestro_api_rollback_duration_seconds_bucket[5m])) by (le)) - 300) / 300, 1)
    - name: "Synthetic False Abort Rate"
      description: "Synthetic probe false abort rate remains under 2% per quarter."
      target: 98.0
      window: 90d
      sli:
        type: "prometheus"
        query: |
          1 - clamp_max(max(synthetic_probe_false_abort_rate{suite="maestro-api-canary"}), 1)
    - name: "Synthetic Probe Uptime"
      description: "Synthetic HTTP flows maintain 99.9% uptime."
      target: 99.9
      window: 28d
      sli:
        type: "prometheus"
        query: |
          avg_over_time(synthetic_probe_availability{suite="maestro-api-canary"}[28d])
