{{- range $name, $config := .Values.configMaps }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ $name }}
  namespace: {{ $.Release.Namespace }}
  labels:
    {{- include "maestro.labels" $ | nindent 4 }}
data:
  {{- toYaml $config.data | nindent 2 }}
---
{{- end }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "maestro.fullname" . }}-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "maestro.labels" . | nindent 4 }}
data:
  application.yaml: |
    server:
      port: {{ .Values.service.targetPort }}
      host: "0.0.0.0"
      environment: {{ .Values.global.environment | default "production" }}
    orchestration:
      enabled: true
      maxConcurrentSources: 15
      defaultStrategy: consensus
    compliance:
      enabled: true
      auditTrail: true
    monitoring:
      metrics:
        enabled: {{ .Values.metrics.enabled }}
        path: "/metrics"
        port: 9090
      tracing:
        enabled: true
        endpoint: "http://otel-collector.monitoring:4317"
