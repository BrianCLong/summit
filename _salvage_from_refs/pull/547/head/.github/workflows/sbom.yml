name: sbom
on:
  push:
    branches: ['main', 'feature/**']
  pull_request:
jobs:
  sbom:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install CycloneDX
        run: npm install -g @cyclonedx/cyclonedx-npm
      - name: Server SBOM
        run: cyclonedx-npm --output-file sbom-server.json --package-lock-path server/package-lock.json
      - name: Client SBOM
        run: cyclonedx-npm --output-file sbom-client.json --package-lock-path client/package-lock.json
      - name: Audit
        run: npm audit --production --audit-level=critical
