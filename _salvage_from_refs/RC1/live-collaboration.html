<!DOCTYPE html>
<html>
<head>
    <title>IntelGraph Live Collaboration - Multi-User Intelligence Operations</title>
    <style>
        body { margin: 0; font-family: 'Arial', sans-serif; background: #1a1a2e; color: #eee; }
        
        .collaboration-header { background: linear-gradient(135deg, #16213e 0%, #0f3460 100%); padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #0ea5e9; }
        .collaboration-header h1 { margin: 0; color: #0ea5e9; font-size: 24px; }
        .user-status { display: flex; gap: 15px; align-items: center; }
        .user-indicator { display: flex; align-items: center; gap: 5px; padding: 5px 10px; background: rgba(14, 165, 233, 0.1); border-radius: 15px; font-size: 12px; }
        .user-dot { width: 8px; height: 8px; border-radius: 50%; }
        .user-online { background: #00ff88; }
        .user-offline { background: #ff4444; }
        
        .collab-workspace { display: grid; grid-template-columns: 300px 1fr 300px; height: calc(100vh - 70px); }
        
        .sidebar { background: rgba(0,0,0,0.3); padding: 20px; border-right: 1px solid #333; overflow-y: auto; }
        .sidebar h3 { color: #0ea5e9; margin: 0 0 15px 0; font-size: 16px; }
        
        .main-workspace { padding: 20px; overflow-y: auto; }
        .workspace-card { background: rgba(255,255,255,0.05); border: 1px solid #333; border-radius: 8px; padding: 20px; margin: 20px 0; }
        .workspace-card h3 { color: #0ea5e9; margin: 0 0 15px 0; }
        
        .active-users { margin-bottom: 30px; }
        .user-card { background: rgba(14, 165, 233, 0.1); border: 1px solid #0ea5e9; border-radius: 8px; padding: 12px; margin: 8px 0; }
        .user-name { font-weight: bold; color: #0ea5e9; }
        .user-activity { font-size: 12px; color: #ccc; margin-top: 5px; }
        .user-cursor { color: #00ff88; }
        
        .shared-investigations { margin-bottom: 30px; }
        .investigation-item { background: rgba(0,0,0,0.3); border-left: 3px solid #0ea5e9; padding: 10px; margin: 5px 0; cursor: pointer; }
        .investigation-item:hover { background: rgba(14, 165, 233, 0.1); }
        .investigation-shared { border-left-color: #00ff88; }
        .investigation-private { border-left-color: #888; }
        
        .live-chat { background: rgba(0,0,0,0.5); border-radius: 8px; }
        .chat-header { background: #0ea5e9; color: white; padding: 10px; border-radius: 8px 8px 0 0; font-weight: bold; }
        .chat-messages { height: 200px; overflow-y: auto; padding: 10px; }
        .chat-message { margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 4px; }
        .chat-user { color: #0ea5e9; font-weight: bold; font-size: 12px; }
        .chat-text { color: #eee; font-size: 14px; margin-top: 3px; }
        .chat-timestamp { color: #888; font-size: 10px; }
        .chat-input-container { padding: 10px; border-top: 1px solid #333; }
        .chat-input { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid #333; color: #eee; padding: 8px; border-radius: 4px; }
        
        .collaborative-investigation { background: rgba(14, 165, 233, 0.05); border: 1px solid #0ea5e9; }
        .investigation-header { display: flex; justify-content: between; align-items: center; margin-bottom: 15px; }
        .investigation-title { color: #0ea5e9; font-size: 20px; margin: 0; }
        .collaborators { display: flex; gap: 10px; margin-top: 10px; }
        .collaborator-avatar { width: 32px; height: 32px; border-radius: 50%; background: #0ea5e9; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px; }
        
        .shared-entities { margin: 20px 0; }
        .entity-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
        .entity-card { background: rgba(0,0,0,0.3); border: 1px solid #333; border-radius: 6px; padding: 12px; position: relative; }
        .entity-card.editing { border-color: #00ff88; box-shadow: 0 0 10px rgba(0, 255, 136, 0.3); }
        .entity-name { color: #0ea5e9; font-weight: bold; margin-bottom: 5px; }
        .entity-type { color: #888; font-size: 12px; }
        .entity-editor { color: #00ff88; font-size: 10px; position: absolute; top: 5px; right: 8px; }
        
        .realtime-activity { background: rgba(0,0,0,0.5); border-radius: 8px; }
        .activity-header { background: #16213e; color: #0ea5e9; padding: 10px; border-radius: 8px 8px 0 0; font-weight: bold; }
        .activity-feed { height: 250px; overflow-y: auto; padding: 10px; }
        .activity-item { margin: 5px 0; padding: 8px; border-left: 3px solid #0ea5e9; background: rgba(255,255,255,0.05); font-size: 12px; }
        .activity-user { border-left-color: #00ff88; }
        .activity-system { border-left-color: #888; }
        .activity-ai { border-left-color: #ff6b35; }
        
        .controls { margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap; }
        .control-btn { background: #0ea5e9; border: none; color: white; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; }
        .control-btn:hover { background: #0284c7; }
        .control-btn.secondary { background: #374151; }
        .control-btn.secondary:hover { background: #4b5563; }
        
        .presence-cursors { position: relative; }
        .user-cursor-indicator { position: absolute; width: 20px; height: 20px; border-radius: 50%; z-index: 1000; pointer-events: none; }
        .cursor-analyst1 { background: #00ff88; }
        .cursor-analyst2 { background: #ff6b35; }
        .cursor-analyst3 { background: #fbbf24; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .live-indicator { animation: pulse 2s infinite; }
        
        .typing-indicator { color: #888; font-style: italic; font-size: 12px; margin: 5px 0; }
    </style>
</head>
<body>
    <div class="collaboration-header">
        <h1>ü§ù IntelGraph Live Collaboration</h1>
        <div class="user-status">
            <div class="user-indicator">
                <div class="user-dot user-online"></div>
                <span>You (Lead Analyst)</span>
            </div>
            <div class="user-indicator">
                <div class="user-dot user-online live-indicator"></div>
                <span id="online-count">3 users online</span>
            </div>
        </div>
    </div>

    <div class="collab-workspace">
        <!-- Left Sidebar: Active Users & Investigations -->
        <div class="sidebar">
            <div class="active-users">
                <h3>üë• Active Users</h3>
                <div class="user-card">
                    <div class="user-name">Sarah Chen</div>
                    <div class="user-activity">üìä Editing: Network Analysis Investigation</div>
                    <div class="user-cursor">Currently viewing: Entity Network</div>
                </div>
                <div class="user-card">
                    <div class="user-name">Mike Rodriguez</div>
                    <div class="user-activity">üß† Running AI analysis on Project Alpha</div>
                    <div class="user-cursor">Currently analyzing: Threat Patterns</div>
                </div>
                <div class="user-card">
                    <div class="user-name">Alex Thompson</div>
                    <div class="user-activity">üîç Searching entities in Investigation #001</div>
                    <div class="user-cursor">Currently browsing: Entity Database</div>
                </div>
            </div>

            <div class="shared-investigations">
                <h3>üìã Shared Investigations</h3>
                <div class="investigation-item investigation-shared" onclick="loadInvestigation('network-security')">
                    <div style="font-weight: bold; color: #0ea5e9;">Network Security Analysis</div>
                    <div style="font-size: 12px; color: #888;">3 collaborators ‚Ä¢ 12 entities</div>
                </div>
                <div class="investigation-item investigation-shared" onclick="loadInvestigation('project-alpha')">
                    <div style="font-weight: bold; color: #0ea5e9;">Project Alpha Intelligence</div>
                    <div style="font-size: 12px; color: #888;">2 collaborators ‚Ä¢ 8 entities</div>
                </div>
                <div class="investigation-item investigation-private">
                    <div style="font-weight: bold; color: #888;">Personal Research Notes</div>
                    <div style="font-size: 12px; color: #888;">Private ‚Ä¢ 5 entities</div>
                </div>
            </div>
        </div>

        <!-- Main Workspace: Collaborative Investigation -->
        <div class="main-workspace presence-cursors" id="main-workspace">
            <div class="workspace-card collaborative-investigation">
                <div class="investigation-header">
                    <h3 class="investigation-title">Network Security Analysis</h3>
                    <div class="collaborators">
                        <div class="collaborator-avatar" style="background: #00ff88;" title="Sarah Chen">SC</div>
                        <div class="collaborator-avatar" style="background: #ff6b35;" title="Mike Rodriguez">MR</div>
                        <div class="collaborator-avatar" style="background: #fbbf24;" title="Alex Thompson">AT</div>
                    </div>
                </div>
                <p style="color: #ccc; margin-bottom: 20px;">Real-time collaborative investigation of suspicious network activities. All team members can simultaneously edit entities, relationships, and analysis notes.</p>
                
                <div class="controls">
                    <button class="control-btn" onclick="createSharedEntity()">‚ûï Add Entity</button>
                    <button class="control-btn" onclick="runCollaborativeAI()">üß† AI Analysis</button>
                    <button class="control-btn secondary" onclick="shareInvestigation()">üì§ Share</button>
                    <button class="control-btn secondary" onclick="exportResults()">üíæ Export</button>
                </div>
            </div>

            <div class="workspace-card">
                <h3>üîó Shared Entity Network</h3>
                <div class="shared-entities">
                    <div class="entity-grid" id="entity-grid">
                        <div class="entity-card editing">
                            <div class="entity-editor">Sarah editing...</div>
                            <div class="entity-name">John Anderson</div>
                            <div class="entity-type">PERSON</div>
                            <div style="font-size: 12px; color: #ccc; margin-top: 8px;">
                                Senior Analyst ‚Ä¢ Intelligence Dept<br>
                                <span style="color: #00ff88;">Real-time: Access patterns being analyzed</span>
                            </div>
                        </div>
                        <div class="entity-card">
                            <div class="entity-name">192.168.1.100</div>
                            <div class="entity-type">IP_ADDRESS</div>
                            <div style="font-size: 12px; color: #ccc; margin-top: 8px;">
                                Internal Network ‚Ä¢ Risk Score: 0.7<br>
                                <span style="color: #ff6b35;">Mike analyzing connections</span>
                            </div>
                        </div>
                        <div class="entity-card">
                            <div class="entity-name">Project Alpha</div>
                            <div class="entity-type">PROJECT</div>
                            <div style="font-size: 12px; color: #ccc; margin-top: 8px;">
                                Classified ‚Ä¢ Active Status<br>
                                <span style="color: #888;">Recently updated by team</span>
                            </div>
                        </div>
                        <div class="entity-card">
                            <div class="entity-name">malware.exe</div>
                            <div class="entity-type">FILE</div>
                            <div style="font-size: 12px; color: #ccc; margin-top: 8px;">
                                Threat Level: HIGH ‚Ä¢ Detected<br>
                                <span style="color: #fbbf24;">Alex investigating origins</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="workspace-card">
                <h3>üß† Collaborative AI Analysis</h3>
                <div id="ai-analysis-results">
                    <div style="padding: 15px; background: rgba(0,0,0,0.3); border-radius: 6px; margin: 10px 0;">
                        <div style="color: #0ea5e9; font-weight: bold; margin-bottom: 10px;">Latest Team Analysis</div>
                        <div style="color: #ccc; font-size: 14px; line-height: 1.5;">
                            <strong>Risk Assessment:</strong> MEDIUM threat level detected<br>
                            <strong>Confidence:</strong> 84% (AI analysis by Mike Rodriguez)<br>
                            <strong>Key Findings:</strong> Unusual access patterns from John Anderson account<br>
                            <strong>Recommendations:</strong> Enhanced monitoring, access review (Sarah Chen adding details)<br>
                            <strong>Status:</strong> <span style="color: #00ff88;">Analysis in progress - Real-time updates</span>
                        </div>
                        <div class="typing-indicator" id="typing-indicator">Alex is adding threat correlation data...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar: Chat & Activity -->
        <div class="sidebar">
            <div class="live-chat">
                <div class="chat-header">üí¨ Team Chat</div>
                <div class="chat-messages" id="chat-messages">
                    <div class="chat-message">
                        <div class="chat-user">Sarah Chen</div>
                        <div class="chat-text">Found some interesting patterns in John's access logs</div>
                        <div class="chat-timestamp">2 minutes ago</div>
                    </div>
                    <div class="chat-message">
                        <div class="chat-user">Mike Rodriguez</div>
                        <div class="chat-text">Running AI analysis on the network connections now</div>
                        <div class="chat-timestamp">1 minute ago</div>
                    </div>
                    <div class="chat-message">
                        <div class="chat-user">Alex Thompson</div>
                        <div class="chat-text">The malware signature matches known APT group tools</div>
                        <div class="chat-timestamp">30 seconds ago</div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" placeholder="Type message..." onkeypress="handleChatInput(event)" id="chat-input">
                </div>
            </div>

            <div class="realtime-activity" style="margin-top: 20px;">
                <div class="activity-header">üì° Live Activity</div>
                <div class="activity-feed" id="activity-feed">
                    <div class="activity-item activity-user">
                        Sarah Chen updated entity: John Anderson
                    </div>
                    <div class="activity-item activity-ai">
                        AI analysis completed: Network threat assessment
                    </div>
                    <div class="activity-item activity-user">
                        Mike Rodriguez added relationship: IP ‚Üí Malware
                    </div>
                    <div class="activity-item activity-system">
                        System: Real-time sync completed
                    </div>
                    <div class="activity-item activity-user">
                        Alex Thompson joined investigation
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Cursor Indicators -->
    <div class="user-cursor-indicator cursor-analyst1" id="cursor-sarah" style="top: 200px; left: 400px;"></div>
    <div class="user-cursor-indicator cursor-analyst2" id="cursor-mike" style="top: 300px; left: 600px;"></div>
    <div class="user-cursor-indicator cursor-analyst3" id="cursor-alex" style="top: 250px; left: 800px;"></div>

    <script>
        let collaborationSocket = null;
        let currentInvestigation = 'network-security';
        let chatMessages = [];
        let activityLog = [];

        // Initialize Collaboration System
        function initCollaboration() {
            simulateRealtimeCollaboration();
            setupCursorTracking();
            startLiveUpdates();
            
            console.log('ü§ù IntelGraph Live Collaboration initialized');
        }

        // Simulate Real-time Collaboration
        function simulateRealtimeCollaboration() {
            // Simulate user activities
            setInterval(() => {
                simulateUserActivity();
            }, 3000);

            // Simulate chat messages
            setInterval(() => {
                if (Math.random() > 0.7) {
                    simulateChatMessage();
                }
            }, 8000);

            // Simulate cursor movements
            setInterval(() => {
                animateUserCursors();
            }, 2000);

            // Simulate typing indicators
            setInterval(() => {
                updateTypingIndicators();
            }, 5000);
        }

        function simulateUserActivity() {
            const activities = [
                { user: 'Sarah Chen', action: 'updated entity: Network Router', type: 'user' },
                { user: 'Mike Rodriguez', action: 'ran AI analysis on threat vectors', type: 'ai' },
                { user: 'Alex Thompson', action: 'added new relationship: User ‚Üí Access', type: 'user' },
                { user: 'System', action: 'synchronized data across all clients', type: 'system' },
                { user: 'Sarah Chen', action: 'shared investigation with security team', type: 'user' },
                { user: 'Mike Rodriguez', action: 'detected anomaly in access patterns', type: 'ai' },
                { user: 'Alex Thompson', action: 'updated threat assessment', type: 'user' }
            ];

            const activity = activities[Math.floor(Math.random() * activities.length)];
            addActivity(activity.user, activity.action, activity.type);
        }

        function simulateChatMessage() {
            const users = ['Sarah Chen', 'Mike Rodriguez', 'Alex Thompson'];
            const messages = [
                'Great findings on the network analysis!',
                'I see some correlation with previous cases',
                'Should we escalate this to Level 2?',
                'The AI analysis confirms our suspicions',
                'Adding more context to the entity data',
                'This pattern matches the APT indicators',
                'Let me cross-reference with threat intel',
                'Excellent collaborative work team!'
            ];

            const user = users[Math.floor(Math.random() * users.length)];
            const message = messages[Math.floor(Math.random() * messages.length)];
            
            addChatMessage(user, message);
        }

        // Interactive Functions
        function createSharedEntity() {
            const entityName = `Entity-${Date.now()}`;
            addActivity('You', `created new entity: ${entityName}`, 'user');
            
            // Simulate other users reacting
            setTimeout(() => {
                addActivity('Sarah Chen', 'viewing new entity details', 'user');
                addChatMessage('Sarah Chen', 'Nice addition! I\'ll add some properties');
            }, 2000);
        }

        function runCollaborativeAI() {
            addActivity('You', 'initiated collaborative AI analysis', 'ai');
            addChatMessage('You', 'Running AI analysis on current investigation');
            
            // Simulate AI processing with collaboration
            setTimeout(() => {
                addActivity('AI System', 'processing entity relationships...', 'ai');
                setTimeout(() => {
                    addActivity('AI System', 'analysis complete: 3 anomalies detected', 'ai');
                    addChatMessage('Mike Rodriguez', 'AI results look promising - reviewing now');
                }, 3000);
            }, 1000);
        }

        function shareInvestigation() {
            addActivity('You', 'shared investigation with external team', 'user');
            addChatMessage('You', 'Investigation shared with Security Operations Center');
            
            setTimeout(() => {
                addActivity('System', 'external team member joined investigation', 'system');
            }, 2000);
        }

        function exportResults() {
            addActivity('You', 'exported collaborative investigation results', 'user');
            addChatMessage('You', 'Exporting current analysis for documentation');
            
            setTimeout(() => {
                addActivity('System', 'export completed: INTEL-COLLAB-' + Date.now(), 'system');
            }, 1500);
        }

        function loadInvestigation(id) {
            currentInvestigation = id;
            const investigations = {
                'network-security': 'Network Security Analysis',
                'project-alpha': 'Project Alpha Intelligence'
            };
            
            addActivity('You', `switched to investigation: ${investigations[id]}`, 'user');
            addChatMessage('You', `Now working on: ${investigations[id]}`);
            
            // Update investigation title
            document.querySelector('.investigation-title').textContent = investigations[id];
        }

        // Chat Functions
        function handleChatInput(event) {
            if (event.key === 'Enter' && event.target.value.trim()) {
                const message = event.target.value.trim();
                addChatMessage('You', message);
                event.target.value = '';
                
                // Simulate others reacting to your message
                setTimeout(() => {
                    const reactions = [
                        'Good point!',
                        'I agree with that assessment',
                        'Let me check that theory',
                        'Interesting observation'
                    ];
                    const users = ['Sarah Chen', 'Mike Rodriguez', 'Alex Thompson'];
                    const user = users[Math.floor(Math.random() * users.length)];
                    const reaction = reactions[Math.floor(Math.random() * reactions.length)];
                    addChatMessage(user, reaction);
                }, Math.random() * 3000 + 1000);
            }
        }

        function addChatMessage(user, message) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            
            messageDiv.innerHTML = `
                <div class="chat-user">${user}</div>
                <div class="chat-text">${message}</div>
                <div class="chat-timestamp">just now</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Keep only last 10 messages
            while (chatMessages.children.length > 10) {
                chatMessages.removeChild(chatMessages.firstChild);
            }
        }

        // Activity Feed Functions
        function addActivity(user, action, type) {
            const activityFeed = document.getElementById('activity-feed');
            const activityDiv = document.createElement('div');
            activityDiv.className = `activity-item activity-${type}`;
            activityDiv.textContent = `${user}: ${action}`;
            
            activityFeed.insertBefore(activityDiv, activityFeed.firstChild);
            
            // Keep only last 15 activities
            while (activityFeed.children.length > 15) {
                activityFeed.removeChild(activityFeed.lastChild);
            }
        }

        // Cursor and Presence Functions
        function setupCursorTracking() {
            const workspace = document.getElementById('main-workspace');
            
            workspace.addEventListener('mousemove', (e) => {
                // In a real implementation, this would broadcast cursor position
                // to other users via WebSocket
            });
        }

        function animateUserCursors() {
            const cursors = [
                { id: 'cursor-sarah', color: 'cursor-analyst1' },
                { id: 'cursor-mike', color: 'cursor-analyst2' },
                { id: 'cursor-alex', color: 'cursor-analyst3' }
            ];
            
            cursors.forEach(cursor => {
                const element = document.getElementById(cursor.id);
                const maxX = window.innerWidth - 100;
                const maxY = window.innerHeight - 100;
                
                const newX = Math.random() * maxX;
                const newY = Math.random() * maxY;
                
                element.style.transition = 'all 2s ease-in-out';
                element.style.left = newX + 'px';
                element.style.top = newY + 'px';
            });
        }

        function updateTypingIndicators() {
            const typingIndicator = document.getElementById('typing-indicator');
            const typingMessages = [
                'Sarah is adding entity properties...',
                'Mike is analyzing threat vectors...',
                'Alex is correlating with external data...',
                'Team member is updating analysis...',
                ''  // Sometimes no one is typing
            ];
            
            const message = typingMessages[Math.floor(Math.random() * typingMessages.length)];
            typingIndicator.textContent = message;
            
            if (message) {
                typingIndicator.style.display = 'block';
            } else {
                typingIndicator.style.display = 'none';
            }
        }

        // Live Updates
        function startLiveUpdates() {
            // Simulate live entity updates
            setInterval(() => {
                updateEntityStates();
            }, 4000);
            
            // Update online user count
            setInterval(() => {
                const onlineCount = Math.floor(Math.random() * 2) + 3; // 3-4 users
                document.getElementById('online-count').textContent = `${onlineCount} users online`;
            }, 10000);
        }

        function updateEntityStates() {
            const entityCards = document.querySelectorAll('.entity-card');
            
            // Remove all editing states
            entityCards.forEach(card => card.classList.remove('editing'));
            
            // Randomly assign editing state to one entity
            if (Math.random() > 0.5) {
                const randomCard = entityCards[Math.floor(Math.random() * entityCards.length)];
                randomCard.classList.add('editing');
                
                // Update editor info
                const editors = ['Sarah editing...', 'Mike analyzing...', 'Alex updating...'];
                const editorSpan = randomCard.querySelector('.entity-editor');
                if (editorSpan) {
                    editorSpan.textContent = editors[Math.floor(Math.random() * editors.length)];
                }
            }
        }

        // Initialize when page loads
        window.addEventListener('load', () => {
            initCollaboration();
            
            // Add initial messages
            setTimeout(() => {
                addChatMessage('System', 'Live collaboration session started');
                addActivity('System', 'real-time collaboration enabled', 'system');
            }, 1000);
            
            console.log(`
ü§ù IntelGraph Live Collaboration

Features:
‚úÖ Real-time multi-user collaboration
‚úÖ Live chat and communication
‚úÖ Shared entity editing
‚úÖ Collaborative AI analysis
‚úÖ User presence indicators
‚úÖ Live activity feeds
‚úÖ Cursor tracking simulation
‚úÖ Investigation sharing

COLLABORATION SYSTEM ACTIVE! üöÄ
            `);
        });
    </script>
</body>
</html>