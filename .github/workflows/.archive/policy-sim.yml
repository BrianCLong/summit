name: policy-simulation
on:
  pull_request:
    branches: [main, feature/merge-closed-prs-s25]
jobs:
  opa:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
    - name: Ensure opa path is clean
      run: rm -rf opa
      - name: Install OPA        run: curl -L -o opa https://openpolicyagent.org/downloads/latest/opa_linux_amd64 && chmod +x ./opa
      - name: Run simulations (hard fail)
        run: |
          ./opa test policies/ -v
