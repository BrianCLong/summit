name: CI Sharded Example

on:
  workflow_dispatch:
  pull_request:
    paths:
      - 'ci/**'
      - '.github/workflows/ci-sharded-example.yml'

jobs:
  test-sharded:
    name: Test Shard ${{ matrix.shard }}/${{ strategy.job-total }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        shard: [1, 2, 3, 4]

    steps:
      - uses: actions/checkout@v4

      - uses: pnpm/action-setup@v2
        with:


      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Run Tests (Shard ${{ matrix.shard }})
        # Note: Actual sharding depends on the test runner support.
        # Jest supports --shard directly.
        # For demonstration, we assume a script `test:shard` exists or use jest directly.
        run: |
          echo "Running shard ${{ matrix.shard }}/4"
          # Example command:
          # npx jest --shard=${{ matrix.shard }}/${{ strategy.job-total }}
