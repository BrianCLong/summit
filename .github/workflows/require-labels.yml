name: Require Governance Labels

on:
  pull_request:
    types: [opened, reopened, synchronize]

permissions:
  pull-requests: read

jobs:
  require-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Ensure governance labels exist
        uses: actions/github-script@v7
        with:
          script: |
            const labels = context.payload.pull_request.labels.map(label => label.name);

            const scopeLabels = labels.filter(name => name.startsWith('scope:'));
            const riskLabels = labels.filter(name => name.startsWith('risk:'));

            if (scopeLabels.length === 0) {
              core.setFailed('PR must include at least one scope:* label.');
              return;
            }

            if (riskLabels.length === 0) {
              core.setFailed('PR must include exactly one risk:* label.');
              return;
            }

            if (riskLabels.length > 1) {
              core.setFailed('PR must include exactly one risk:* label.');
              return;
            }

            console.log('Required governance labels present.');
