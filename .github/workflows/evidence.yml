name: evidence-gates

on:
  pull_request:
    paths:
      - "docs/tech-radar/**"
      - "docs/cogwar/**"
      - "schemas/cogwar/**"
      - "policy/**"
      - "evidence/**"
      - "tools/evidence/verify_evidence.py"
      - "tests/iw/**"
      - "tests/policy/**"
      - "tests/provenance/**"
      - "tests/tech_radar/**"

jobs:
  verify_evidence_and_policy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install dependencies
        run: pnpm install --no-frozen-lockfile
      - name: Verify evidence and policy
        run: python tools/evidence/verify_evidence.py
      - name: Run cogwar contract tests
        run: pytest tests/policy tests/iw tests/provenance tests/tech_radar
