name: OIDC Authentication (AWS)

on:
  workflow_call:
    inputs:
      role-to-assume:
        description: "The ARN of the AWS role to assume"
        required: true
        type: string
      aws-region:
        description: "The AWS region"
        required: false
        type: string
        default: "us-east-1"
    outputs:
      status:
        description: "Authentication status"
        value: ${{ jobs.auth.outputs.status }}

permissions:
  id-token: write
  contents: read

jobs:
  auth:
    name: AWS OIDC Auth
    runs-on: ubuntu-latest
    outputs:
      status: success
    steps:
      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@e301518471c62803a63119ac606994770289f660 # v4.0.2
          role-to-assume: ${{ inputs.role-to-assume }}
          aws-region: ${{ inputs.aws-region }}
          mask-aws-account-id: true
      - name: Verify Identity
        run: aws sts get-caller-identity
