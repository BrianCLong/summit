name: chatops
on:
  repository_dispatch:
    types: [chatops]
jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Execute command
        env: { KUBECONFIG: ${{ secrets.PROD_KUBECONFIG }} }
        run: |
          case "${{ github.event.client_payload.command }}" in
            rollback) argo rollouts abort app -n prod || true ; argo rollouts promote --to-last-stable app -n prod ;;
            status) kubectl -n prod get rollouts ;;
          esac