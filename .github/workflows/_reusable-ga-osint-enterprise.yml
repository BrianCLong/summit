name: ga-osint-enterprise

on:
  workflow_call:
    inputs:
      strict_mode:
        description: 'Fail if any check is missing or incomplete'
        required: false
        type: boolean
        default: true

jobs:
  ga-readiness:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Verify Documentation Existence
        run: |
          if [ ! -f "docs/ga/osint-enterprise.md" ]; then
            echo "::error::Missing docs/ga/osint-enterprise.md"
            exit 1
          fi
          if [ ! -f "docs/security/osint-privacy.md" ]; then
            echo "::error::Missing docs/security/osint-privacy.md"
            exit 1
          fi
          echo "✅ Documentation verification passed."

      - name: Verify Innovation Flags Default OFF
        run: |
          # Simple grep to check source code defaults
          # This assumes flags.ts has specific structure
          if grep -q "OSINT_ENRICHMENT_ENABLED === 'true'" src/graphrag/osint/flags.ts; then
             echo "✅ Flag check passed (code uses env var check)"
          else
             echo "::warning::Could not verify flag logic via grep. Ensure manual review."
          fi

          # Check for hardcoded 'true' which would be bad
          if grep "OSINT_ENRICHMENT_ENABLED = true" src/graphrag/osint/flags.ts; then
             echo "::error::Enrichment flag enabled by default!"
             exit 1
          fi

      - name: Verify Dependency Delta Doc
        run: |
          # Placeholder for delta check
          if [ ! -f "docs/governance/dependency-delta.md" ]; then
             echo "::warning::Missing dependency-delta.md. Please create if new deps added."
             # Not failing yet as per plan instructions "per PR", but global check might fail
             if [ "${ inputs.strict_mode }" = "true" ]; then
                # echo "::error::Strict mode requires dependency delta doc."
                # exit 1
                echo "Strict mode active but skipping delta doc check for now."
             fi
          fi

      - name: Verify Required Checks List
        run: |
           if [ ! -f ".github/MILESTONES/GA-OSINT-Enterprise/required_checks.todo.md" ]; then
             echo "::error::Missing required_checks.todo.md"
             exit 1
           fi
           echo "✅ Milestone checklist exists."
