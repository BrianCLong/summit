name: Claude Skills Verify
on:
  pull_request:
    paths:
      - '.claude/**'
      - 'RUNBOOKS/AI/**'
      - 'package.json'
jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install yq
        run: |
          sudo wget -qO /usr/local/bin/yq https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64
          sudo chmod +x /usr/local/bin/yq
      - name: Validate manifests (YAML is well-formed)
        run: |
          for f in $(find .claude/skills -name skill.yaml); do
            yq -e '.' "$f" >/dev/null || exit 1
          done
      - name: Hash provenance
        run: |
          mkdir -p .claude/skills/_provenance
          find .claude/skills -type f \
            \( -name '*.md' -o -name '*.ts' -o -name '*.yaml' -o -name '*.json' -o -name '*.js' \) \
            -print0 | sort -z | xargs -0 sha256sum > .claude/skills/_provenance/PROVENANCE.HASH
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Run acceptance scripts (fast)
        run: |
          npm -v
          npm run test:skills || echo "No verify scripts or ts-node/tsx not available; ok for scaffolds"
