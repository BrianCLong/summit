name: PR Dashboard (v25)

on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch: {}

permissions:
  contents: read
  issues: write
  pull-requests: read

jobs:
  update:
    name: Update v25 PR Dashboard Issue
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build dashboard & create/update issue
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const path = require('path');
            const { owner, repo } = context.repo;
            const draftsDir = 'project_management/pr_drafts/v25';
            const marker = '<!-- v25-pr-dashboard -->';
            const dashboardTitle = 'v25: PR Dashboard';
            const dashboardLabel = 'v25';

            function listDraftFiles() {
              try {
                return fs.readdirSync(draftsDir)
                  .filter(f => /^PR-\d+-.+\.md$/.test(f) && f !== 'SHARED-SECTIONS.md')
                  .sort((a,b)=> a.localeCompare(b, undefined, { numeric:true }));
              } catch { return []; }
            }
            function firstH1(filePath) {
              const raw = fs.readFileSync(filePath, 'utf8');
              const line = raw.split(/\r?\n/).find(l => l.trim().startsWith('# '));
              if (line) return line.replace(/^#\s*/, '').trim();
              const base = path.basename(filePath).replace(/^PR-\d+-/, '').replace(/\.md$/, '');
              return base.replace(/-/g, ' ');
            }
            async function findPRByTitle(title) {
              const q = `repo:${owner}/${repo} is:pr in:title "${title.replace(/
