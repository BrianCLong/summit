name: wf-reuse-deploy
on:
  workflow_call:
    inputs:
      environment: { type: string, required: true }
    secrets:
      KUBE_CONFIG: { required: true }
jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    steps:
      - uses: actions/checkout@v4
      - uses: azure/setup-kubectl@v4
      - name: Kubeconfig
        run: |
          mkdir -p ~/.kube
          echo "${{ secrets.KUBE_CONFIG }}" > ~/.kube/config
      - name: Helm Canary
        run: |
          helm upgrade --install summit ./helm \
            -f helm/values-canary.yaml \
            --set image.tag=sha-${{ github.sha }} \
            --wait --timeout 15m
      - name: Verify golden signals
        run: ./.ci/scripts/verify_goldens.sh
