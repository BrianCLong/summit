apiVersion: batch/v1
kind: CronJob
metadata:
  name: neo4j-backup
  namespace: default
spec:
  schedule: "0 2 * * *"
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          containers:
            - name: neo4j-backup
              image: neo4j:5.22.0
              command: ["/bin/sh","-lc"]
              args:
                - apk add --no-cache aws-cli bash && \
                  wget -qO /neo4j_backup.sh https://raw.githubusercontent.com/BrianCLong/intelgraph/main/scripts/backups/neo4j_backup.sh || true && \
                  bash /neo4j_backup.sh
              env:
                - name: BACKUP_BUCKET
                  valueFrom:
                    secretKeyRef:
                      name: backup-dest
                      key: bucket
              volumeMounts:
                - name: neo4j-data
                  mountPath: /data
          volumes:
            - name: neo4j-data
              persistentVolumeClaim:
                claimName: neo4j-data

