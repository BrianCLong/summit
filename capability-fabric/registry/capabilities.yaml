version: 1
capabilities:
  - capability_id: maestro.mcp.invoke
    name: Invoke MCP tool
    description: Execute a registered MCP tool through Maestro sessions.
    business_domain: orchestration
    owner_team: maestro
    oncall: maestro-oncall
    repo: server
    service: maestro
    data_classification: internal
    allowed_identities:
      - mcp:invoke
    authn:
      method: session_token
    authz:
      mode: scopes
      required_scopes:
        - mcp:invoke
    schemas:
      input_schema_ref: capability-fabric/schemas/mcp-invoke.input.schema.json
      output_schema_ref: capability-fabric/schemas/mcp-invoke.output.schema.json
    operations:
      - exec
    risk_controls:
      rate_limit:
        max_per_minute: 60
      approvals_required: false
      redaction_fields:
        - secrets
        - tokens
      allowlist_fields: []
    dependency_edges:
      - type: downstream
        target: mcp.server
        description: Executes tool on external MCP server.
    policy_refs:
      - policies/capability-fabric/mcp-invoke.rego
    matchers:
      - type: mcp_tool
        server: '*'
        tool: '*'
  - capability_id: maestro.mcp.sessions.create
    name: Create MCP session
    description: Create a scoped MCP session for a Maestro run.
    business_domain: orchestration
    owner_team: maestro
    oncall: maestro-oncall
    repo: server
    service: maestro
    data_classification: internal
    allowed_identities:
      - mcp:session
    authn:
      method: session_token
    authz:
      mode: scopes
      required_scopes:
        - mcp:session
    schemas:
      input_schema_ref: capability-fabric/schemas/mcp-session.input.schema.json
      output_schema_ref: capability-fabric/schemas/mcp-session.output.schema.json
    operations:
      - write
    risk_controls:
      rate_limit:
        max_per_minute: 30
      approvals_required: false
      redaction_fields: []
      allowlist_fields:
        - scopes
        - servers
    dependency_edges:
      - type: downstream
        target: mcp.server
        description: Session scopes control downstream MCP execution.
    policy_refs:
      - policies/capability-fabric/mcp-session.rego
    matchers:
      - type: http_endpoint
        method: POST
        path: /api/maestro/v1/runs/:id/mcp/sessions
  - capability_id: maestro.runs.read
    name: Read Maestro runs
    description: Read Maestro runs for operational visibility.
    business_domain: orchestration
    owner_team: maestro
    oncall: maestro-oncall
    repo: server
    service: maestro
    data_classification: internal
    allowed_identities:
      - run_maestro
    authn:
      method: session_token
    authz:
      mode: scopes
      required_scopes:
        - run_maestro
    schemas:
      input_schema_ref: capability-fabric/schemas/maestro-runs.input.schema.json
      output_schema_ref: capability-fabric/schemas/maestro-runs.output.schema.json
    operations:
      - read
    risk_controls:
      rate_limit:
        max_per_minute: 120
      approvals_required: false
      redaction_fields:
        - tokens
      allowlist_fields: []
    dependency_edges:
      - type: downstream
        target: postgres.maestro
        description: Reads Maestro run metadata.
    policy_refs:
      - policies/capability-fabric/maestro-runs-read.rego
    matchers:
      - type: http_endpoint
        method: GET
        path: /api/maestro/v1/runs
