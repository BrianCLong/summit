<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IntelGraph React Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border: 1px solid #ccc; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <h1>IntelGraph React Debug Test</h1>
    <div id="status"></div>
    <div id="root"></div>
    
    <script>
        const statusDiv = document.getElementById('status');
        const rootDiv = document.getElementById('root');
        
        function addStatus(message, isError = false) {
            const div = document.createElement('div');
            div.className = 'status ' + (isError ? 'error' : 'success');
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            statusDiv.appendChild(div);
            console.log(message);
        }
        
        addStatus('Starting React test...');
        
        // Test 1: Check if we can reach the Vite dev server
        addStatus('Testing Vite dev server connection...');
        fetch('http://localhost:3000/@vite/client')
            .then(response => {
                if (response.ok) {
                    addStatus('âœ… Vite dev server is accessible');
                    testReactImport();
                } else {
                    addStatus('âŒ Vite dev server returned: ' + response.status, true);
                }
            })
            .catch(err => {
                addStatus('âŒ Cannot reach Vite dev server: ' + err.message, true);
            });
            
        function testReactImport() {
            addStatus('Testing React import from Vite...');
            
            // Try to import React directly from the Vite dev server
            const script = document.createElement('script');
            script.type = 'module';
            script.innerHTML = `
                try {
                    console.log('Importing React from Vite...');
                    import('http://localhost:3000/node_modules/.vite/deps/react.js?v=74b74509')
                        .then(React => {
                            window.React = React.default || React;
                            window.addStatus('âœ… React imported successfully');
                            testReactDOM();
                        })
                        .catch(err => {
                            window.addStatus('âŒ React import failed: ' + err.message, true);
                        });
                } catch (err) {
                    window.addStatus('âŒ React import error: ' + err.message, true);
                }
            `;
            document.head.appendChild(script);
        }
        
        window.addStatus = addStatus;
        
        function testReactDOM() {
            addStatus('Testing ReactDOM import...');
            
            const script = document.createElement('script');
            script.type = 'module';
            script.innerHTML = `
                try {
                    import('http://localhost:3000/node_modules/.vite/deps/react-dom_client.js?v=74b74509')
                        .then(ReactDOM => {
                            window.ReactDOM = ReactDOM.default || ReactDOM;
                            window.addStatus('âœ… ReactDOM imported successfully');
                            testReactRender();
                        })
                        .catch(err => {
                            window.addStatus('âŒ ReactDOM import failed: ' + err.message, true);
                        });
                } catch (err) {
                    window.addStatus('âŒ ReactDOM import error: ' + err.message, true);
                }
            `;
            document.head.appendChild(script);
        }
        
        function testReactRender() {
            addStatus('Testing React render...');
            
            try {
                if (window.React && window.ReactDOM) {
                    const root = window.ReactDOM.createRoot(rootDiv);
                    const element = window.React.createElement('div', {
                        style: { 
                            padding: '20px', 
                            background: '#4caf50', 
                            color: 'white',
                            borderRadius: '5px',
                            marginTop: '20px'
                        }
                    }, [
                        window.React.createElement('h2', { key: 'title' }, 'ðŸŽ‰ SUCCESS!'),
                        window.React.createElement('p', { key: 'message' }, 'React is working correctly!'),
                        window.React.createElement('p', { key: 'time' }, 'Rendered at: ' + new Date().toLocaleString())
                    ]);
                    
                    root.render(element);
                    addStatus('âœ… React component rendered successfully!');
                } else {
                    addStatus('âŒ React or ReactDOM not available', true);
                }
            } catch (err) {
                addStatus('âŒ React render failed: ' + err.message, true);
            }
        }
        
        // Global error handling
        window.addEventListener('error', (event) => {
            addStatus('ðŸš¨ Global error: ' + event.error.message, true);
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            addStatus('ðŸš¨ Promise rejection: ' + event.reason, true);
        });
    </script>
</body>
</html>