{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Narrative Operating Graph",
  "type": "object",
  "required": ["version", "nodes", "edges"],
  "properties": {
    "version": {"type": "string"},
    "nodes": {
      "type": "array",
      "items": {"$ref": "#/definitions/node"}
    },
    "edges": {
      "type": "array",
      "items": {"$ref": "#/definitions/edge"}
    }
  },
  "additionalProperties": false,
  "definitions": {
    "node": {
      "type": "object",
      "required": ["id", "type", "attrs", "lifecycle", "classification"],
      "properties": {
        "id": {"type": "string"},
        "type": {
          "type": "string",
          "enum": ["narrative_state", "actor", "channel", "event", "artifact"]
        },
        "attrs": {"type": "object"},
        "lifecycle": {
          "type": "string",
          "enum": ["seeding", "propagation", "peak", "mutation", "decline"]
        },
        "classification": {
          "type": "string",
          "enum": ["public", "internal", "restricted"]
        }
      },
      "additionalProperties": false
    },
    "edge": {
      "type": "object",
      "required": ["src", "dst", "type", "attrs"],
      "properties": {
        "src": {"type": "string"},
        "dst": {"type": "string"},
        "type": {
          "type": "string",
          "enum": [
            "temporal_precedes",
            "causal_influences",
            "mentions",
            "propagates_via",
            "attributed_to"
          ]
        },
        "attrs": {"type": "object"}
      },
      "additionalProperties": false
    }
  }
}
