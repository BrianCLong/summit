groups:
  - name: maestro-slo
    interval: 30s
    rules:
      - alert: MaestroHighLatencyP95
        expr: |
          histogram_quantile(0.95, sum by (le) (rate(maestro_http_request_duration_seconds_bucket{route=~"/maestro.*"}[5m]))) > 0.35
        for: 10m
        labels:
          severity: warning
          service: maestro
        annotations:
          summary: Maestro UI p95 latency above 350ms
          description: 'p95 latency over last 10m is {{ $value | printf "%.3f" }}s'
          runbook_url: https://github.com/BrianCLong/summit/blob/main/RUNBOOKS/maestro-rollback.md

      - alert: MaestroAPIHealthDegraded
        expr: |
          sum(rate(http_requests_total{route="/api/maestro/v1/health",status=~"5.."}[5m]))
          /
          clamp_min(sum(rate(http_requests_total{route="/api/maestro/v1/health"}[5m])), 1) > 0.02
        for: 5m
        labels:
          severity: critical
          service: maestro
        annotations:
          summary: API health endpoint 5xx > 2%
          description: '5xx ratio {{ $value | printf "%.2f" }} over 5m on /api/maestro/v1/health'
          runbook_url: https://github.com/BrianCLong/summit/blob/main/RUNBOOKS/maestro-rollback.md

      - alert: MaestroErrorRateHigh
        expr: |
          sum(rate(http_requests_total{service="maestro",status=~"5.."}[5m]))
          /
          clamp_min(sum(rate(http_requests_total{service="maestro"}[5m])), 1) > 0.05
        for: 10m
        labels:
          severity: warning
          service: maestro
        annotations:
          summary: Maestro error rate > 5%
          description: 'HTTP 5xx ratio over last 10m is {{ $value | printf "%.2f" }}'
          runbook_url: https://github.com/BrianCLong/summit/blob/main/RUNBOOKS/maestro-rollback.md

  - name: maestro-burn
    interval: 30s
    rules:
      - alert: MaestroSLOBurnRate4x
        expr: |
          (
            sum(rate(http_requests_total{service="maestro",status=~"5.."}[5m]))
            /
            clamp_min(sum(rate(http_requests_total{service="maestro"}[5m])), 1)
          ) > 0.04
        for: 10m
        labels:
          severity: critical
          service: maestro
        annotations:
          summary: SLO burn >4x on Maestro
          description: "5xx over total >4% for 10m (approx 4x burn)"
          runbook_url: https://github.com/BrianCLong/summit/blob/main/RUNBOOKS/maestro-rollback.md
