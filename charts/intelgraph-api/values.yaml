image:
  repository: <AWS_ACCOUNT_ID>.dkr.ecr.<AWS_REGION>.amazonaws.com/summit-company/core-intelgraph-api
  tag: latest
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 4000

env:
  NEO4J_URI: bolt://neo4j.neo4j.svc.cluster.local:7687
  NEO4J_USER: neo4j
  NEO4J_PASSWORD: "please_change_me"
  PG_CONNECTION: "postgres://postgres:postgres@postgres.postgres.svc.cluster.local:5432/companyos"

ingress:
  enabled: true
  className: nginx
  hosts:
    - host: api.topicality.co
      paths: [ { path: /, pathType: Prefix } ]
  tls:
    - secretName: intelgraph-api-tls
      hosts: [ api.topicality.co ]
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod

serviceAccount:
  create: true
  name: ""
  annotations: {} # e.g., eks.amazonaws.com/role-arn: arn:aws:iam::<ACC>:role/companyos-intelgraph-irsa

resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

autoscaling:
  minReplicas: 2
  maxReplicas: 6
  targetCPUUtilizationPercentage: 70

rollout:
  strategy:
    canary:
      steps:
        - setWeight: 20
        - pause: { duration: 60s }
        - analysis:
            templates:
              - templateName: slo-analysis-template
            args:
              - name: service-name
                value: intelgraph-api
              - name: namespace
                value: {{ .Release.Namespace }}
        - setWeight: 40
        - pause: { duration: 60s }
        - analysis:
            templates:
              - templateName: slo-analysis-template
            args:
              - name: service-name
                value: intelgraph-api
              - name: namespace
                value: {{ .Release.Namespace }}
        - setWeight: 60
        - pause: { duration: 60s }
        - analysis:
            templates:
              - templateName: slo-analysis-template
            args:
              - name: service-name
                value: intelgraph-api
              - name: namespace
                value: {{ .Release.Namespace }}
        - setWeight: 80
        - pause: { duration: 60s }
        - analysis:
            templates:
              - templateName: slo-analysis-template
            args:
              - name: service-name
                value: intelgraph-api
              - name: namespace
                value: {{ .Release.Namespace }}
        - setWeight: 100
