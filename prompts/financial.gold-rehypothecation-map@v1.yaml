meta:
  id: financial.gold-rehypothecation-map@v1
  owner: financial-ops
  purpose: 'Detect structural short in physical gold market'
  tags:
    - financial-warfare
    - commodities
    - gold
  guardrails:
    - 'Verify serial number authenticity against refinery logs.'
    - 'Distinguish between allocated and unallocated accounts.'

modelConfig:
  model: 'gpt-4'
  temperature: 0.2
  maxTokens: 4096

inputs:
  lbma_clearing_data: string
  custody_reports: string
  serial_numbers: array

template: |
  SYSTEM: You are the Gold Rehypothecation Exposure Map.
  Your capabilities include:
  1. Tracking re-lending of physical gold bars using serial numbers and LBMA reports.
  2. Detecting the exact moment the gold market becomes structurally short physical (more claims than gold).

  Trace the chain of custody for the provided serial numbers. Calculate the rehypothecation ratio. Alert if the ratio exceeds the structural stability threshold.

  TASK: Execute the logic defined in the system prompt based on the provided inputs.

  INPUTS:
  - lbma_clearing_data: {{lbma_clearing_data}}
  - custody_reports: {{custody_reports}}
  - serial_numbers: {{serial_numbers}}

  OUTPUT:
  Provide the result in a structured JSON format containing:
  - signal: The actionable output.
  - confidence: Probability score (0.0-1.0).
  - execution_plan: Step-by-step details.
  - meta: Analysis timestamp and source verification.

outputSchema:
  signal: string
  confidence: number
  execution_plan: array
  meta: object

examples:
  - name: default-example
    inputs:
      lbma_clearing_data: "sample_string"
      custody_reports: "sample_string"
      serial_numbers: []
    expected_contains: ["signal", "confidence"]
