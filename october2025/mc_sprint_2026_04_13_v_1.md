```md
# Maestro Conductor (MC) — Sprint Plan *(v1.0.0)*

**Slug:** `mc-sprint-2026-04-13-v1`  
**Dates (America/Denver):** 2026-04-13 → 2026-04-24  
**Owner/DRI:** Architect‑General  
**Teams:** Orchestrator Platform, SRE, Security, Data, UX, RevOps  
**Tracks:** A) Now‑value; B) Enduring moats  
**Prereq:** `mc-1.3.0` shipped (public curated marketplace, incident v2 with hints, run windows & caps, edge policy GA, CDC→lakehouse, 25k conc perf)

---

## 0) Context & Carry‑Forward
**Done**: Curated public marketplace browse/search + moderation; on‑call digest with root‑cause hints; tenant run windows & per‑pkg caps; edge bundle quarantine + delta updates; lakehouse incremental merge with freshness SLO; queue auto‑tune & image diet cost wins.  
**Carry‑forward**: Marketplace reviewer tools ergonomics; window/cap explain UX polish; edge multi‑CDN evaluation; lakehouse schema change automation.

---

## 1) Objectives & Key Results — **Trust & Throughput**
| # | Objective | KR (measurable) |
|---|---|---|
| A1 | **Marketplace Entitlements & Update Channels** | Tenant entitlements + canary channels; upgrade success > **99.7%**; rollback < **2m** |
| A2 | **Real‑time Audit & Disclosure v3** | Sub‑minute export of key audit streams; disclosure pack link ready < **60s** post‑run |
| A3 | **PQL v1.2 (Time Buckets & Top‑K)** | `BUCKET BY` time windows + `TOP K` operators; p95 < **260ms** @ 120 QPS |
| B1 | **Multi‑CDN Edge Policy** | Anycast/multi‑CDN with digest pinning; cache hit > **95%**; stale incidents ↓ **80%** |
| B2 | **Zero‑Trust Everywhere** | mTLS (SPIFFE) extended to marketplace signer & CDN fetchers; key rotation with zero downtime |
| B3 | **Privacy Budgets & Access Reviews** | Per‑tenant privacy budget counters; quarterly access reviews exported; violations = **0** |

---

## 2) Scope (In/Out)
**In**: Entitlements & channels, real‑time audit/export, PQL 1.2 DSL + engine, multi‑CDN policy distribution, SPIFFE to edge/signers, privacy budgets + access review exporter, perf & SRE artifacts.  
**Out**: Marketplace payments/revenue share; PQL ad‑hoc UDFs; cross‑org data joins.

---

## 3) Epics, Swimlanes & Stories

### 3.1 Marketplace Entitlements & Channels
- **MC‑MKT‑1901**: *Entitlements model & API*  
  **AC:** `entitlements` table; `GET/PUT /api/market/entitlements` (tenant‑scoped); enforced at install & run.  
- **MC‑MKT‑1902**: *Update channels (stable/canary)*  
  **AC:** Package metadata `channel`; `maestro market upgrade --channel canary`; rollback macro.

### 3.2 Real‑time Audit & Disclosure v3
- **MC‑AUD‑1911**: *Streaming audit exporter*  
  **AC:** < 60s lag for `mc.execution.started/receipt.signed/policy.decision`; signed Parquet manifests.  
- **MC‑AUD‑1912**: *Disclosure quick‑link*  
  **AC:** `/api/executions/{id}/disclosure:link` returns signed URL within 60s of finish.

### 3.3 PQL v1.2
- **MC‑PQL‑1921**: *Grammar: BUCKET BY / TOP K*  
  **AC:** Time bucketing (1m, 5m, 1h); `TOP K field LIMIT n`; safe subset only.  
- **MC‑PQL‑1922**: *Indexes & planner tweaks*  
  **AC:** p95 < 260ms @ 120 QPS; no full scans; plan cost limits.

### 3.4 Multi‑CDN Edge Policy
- **MC‑EDGE‑1931**: *CDN abstraction & digest pinning*  
  **AC:** Providers A+B; route by health/latency; digest pin verified.  
- **MC‑EDGE‑1932**: *Stale suppression telemetry*  
  **AC:** New metrics; stale incident rate ↓ 80% vs last sprint.

### 3.5 Zero‑Trust Everywhere
- **MC‑ZTE‑1941**: *SPIFFE for signer & fetchers*  
  **AC:** SVIDs for marketplace signer and edge fetcher; OPA checks `spiffe://` IDs.  
- **MC‑ZTE‑1942**: *Key rotation drill*  
  **AC:** Rotate signer & fetcher certs; zero downtime; evidence archived.

### 3.6 Privacy Budgets & Access Reviews
- **MC‑PRV‑1951**: *Privacy budget counters*  
  **AC:** Per‑tenant budget with leak‑rate; deny when exceeded; dashboards + alerts.  
- **MC‑PRV‑1952**: *Access review exporter*  
  **AC:** Quarterly export (roles, entitlements, keys); signed CSV/PDF with attestations.

### 3.7 SRE & Ops
- **MC‑SRE‑1961**: *GameDay: multi‑CDN swap + entitlement deny*  
  **AC:** Swap providers seamlessly; entitlement deny explains; rollback < 2m.

---

## 4) Milestones (America/Denver)
- **Kickoff**: Mon 2026‑04‑13 10:00  
- **Design/ADR Review**: Tue 04‑14 15:00  
- **Mid‑sprint Evidence Review**: Fri 04‑17 16:00  
- **GameDay (Edge+Entitlements)**: Wed 04‑22 14:00  
- **Sprint Review & Release**: Fri 04‑24 15:00  
- **Retro**: Fri 04‑24 16:00

---

## 5) Artifacts & Scaffolds

### 5.1 OpenAPI (Entitlements, Audit, PQL)
```yaml
paths:
  /api/market/entitlements:
    get: { summary: Get tenant entitlements }
    put: { summary: Upsert tenant entitlements }
  /api/executions/{id}/disclosure:link:
    get: { summary: Get a signed quick-link to disclosure pack }
  /api/pql:
    post: { summary: Execute PQL v1.2 (with BUCKET BY / TOP K) }
```

### 5.2 Entitlements DDL
`apps/mc-api/db/20260413_entitlements.sql`
```sql
create table if not exists entitlements (
  tenant_id uuid not null references tenants(id),
  package text not null,
  channel text not null check (channel in ('stable','canary')) default 'stable',
  allowed boolean not null default true,
  primary key (tenant_id, package)
);
```

### 5.3 PQL v1.2 Grammar (EBNF excerpt)
`docs/pql/GRAMMAR_v1_2.ebnf`
```ebnf
query   = "FIND" subject ("WHERE" predicate)? ("BUCKET" "BY" duration)? ("TOP" integer "BY" field)? ("SINCE" duration)? ;
```

### 5.4 Multi‑CDN Config (Helm)
`infra/helm/mc/values.edge.multicdn.yaml`
```yaml
edge:
  cdn:
    providers:
      - name: cdnA
        baseUrl: https://cdnA/policies
      - name: cdnB
        baseUrl: https://cdnB/policies
    strategy: health-latency
    digestPin: true
```

### 5.5 SPIFFE IDs (policy check)
`policy/rego/spiffe_check.rego`
```rego
package mc.authz

allow {
  startswith(input.caller.spiffe_id, "spiffe://mc.local/")
  input.caller.role == "fetcher" # or signer
}
```

### 5.6 Privacy Budgets (rego)
`policy/rego/privacy_budget.rego`
```rego
package mc.privacy

deny[msg] {
  input.tenant.privacy.budget_remaining <= 0
  msg := {"reason":"privacy_budget_exceeded"}
}
```

### 5.7 Access Review Export (spec)
`docs/governance/ACCESS_REVIEW.md`
```md
Includes: tenant roles, packages installed, entitlements, keys in scope, last rotation.  
Formats: CSV, PDF (signed).  
Schedule: quarterly; on-demand via API.
```

### 5.8 Streaming Audit Export (Kafka → Lakehouse)
`infra/kafka/topics.audit.yaml`
```yaml
- name: mc.audit
  partitions: 24
  retention: 7d
```

`jobs/audit/exporter.yaml`
```yaml
apiVersion: batch/v1
kind: CronJob
metadata: { name: audit-exporter }
spec:
  schedule: "*/2 * * * *"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: exporter
              image: ghcr.io/${ORG}/mc-audit-exporter:latest
          restartPolicy: OnFailure
```

---

## 6) Observability & SLOs (adds)
- Metrics: `mc_entitlement_denies_total`, `mc_channel_upgrades_total`, `mc_disclosure_link_tat_ms`, `mc_pql12_query_ms`, `mc_edge_stale_rate`, `mc_spiffe_rotations_total`, `mc_privacy_budget_remaining`, `mc_access_reviews_emitted_total`.  
- Dashboards: Entitlements & channels; Audit quick‑links; PQL 1.2 latency; Multi‑CDN edge; Zero‑trust coverage; Privacy posture.  
- Alerts: disclosure link TAT > 60s p95; edge stale rate > 2%; privacy budget breach > 0.

---

## 7) Security & Compliance
- Entitlements enforced server‑side; signatures verified on upgrade/install; rollback produces audit entry.  
- Multi‑CDN fetchers authenticate via SPIFFE; digest pinning mandatory; fail‑closed on mismatch.  
- Privacy budgets & access reviews become part of disclosure pack (appendix).

---

## 8) GameDay & Drills
- **CDN swap** under load: provider A outage → B active; hit > 95%, no user impact.  
- **Entitlement misconfig**: deny with explain; operator fixes via API; rollback under 2m.  
- **PQL 1.2 load**: 120 QPS, p95 < 260ms maintained.

---

## 9) Release & Rollback
- Tag: `mc-1.4.0`.  
- Flags: `market_entitlements`, `market_channels`, `audit_rt_export`, `pql_v1_2`, `edge_multicdn`, `spiffe_everywhere`, `privacy_budgets`.  
- Rollback: disable flags; single CDN; disclosure v2 path; PQL v1.1 only.

---

## 10) Jira Import (CSV)
```csv
Summary,Issue Type,Parent,Labels,Description
Entitlements API,Story,EPIC-MC-MKT,mc;marketplace,Tenant package entitlements & channels
Update channels + rollback,Story,EPIC-MC-MKT,mc;marketplace,Stable/canary channels and rollback macro
Streaming audit exporter,Story,EPIC-MC-AUD,mc;audit,<60s lag for key event streams
Disclosure quick-link API,Story,EPIC-MC-AUD,mc;audit,Signed link <60s post-run
PQL 1.2 grammar & planner,Story,EPIC-MC-PQL,mc;pql,BUCKET BY and TOP K with limits
Multi-CDN edge policy,Story,EPIC-MC-EDGE,mc;policy,Providers A+B with digest pinning
SPIFFE for signer/fetchers,Story,EPIC-MC-ZTE,mc;security,SVIDs + OPA checks
Privacy budgets counters,Story,EPIC-MC-PRV,mc;privacy,Per-tenant budgets and denies
Access review exporter,Story,EPIC-MC-PRV,mc;privacy,Quarterly export with signatures
```

---

## 11) DoR / DoD (adds)
**Adds**: entitlement model threat notes; CDN fail‑closed evidence; audit <60s TAT report; PQL v1.2 perf; privacy budget drill; access‑review signatures log.

---

## 12) Risks & Mitigations
| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Multi‑CDN drift/mismatch | M | H | Digest pinning + SPIFFE + last‑good fallback |
| PQL 1.2 heavy queries | M | M | Cost limits + indexes + cached buckets |
| Entitlement misassignment | M | M | Explain denies; change review + audit + rollback macro |

---

## 13) Evidence Links (populate during sprint)
- ADRs: `/docs/adr/ADR-12xx-*`  
- CDN swap drill: `/docs/evidence/multicdn-2026-04-22/*`  
- Audit TAT: `/docs/evidence/audit-rt-2026-04-18/*`  
- Release: `releases/mc-1.4.0`

---

> Trust & throughput: entitlement‑aware marketplace, sub‑minute audit links, faster safe PQL, and edge policy that never blinks.
```

