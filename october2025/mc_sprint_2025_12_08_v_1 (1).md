---
slug: mc-sprint-2025-12-08-v1
version: 1.0.0
date: 2025-12-08
status: Proposed
owner: Platform Eng • DevSecOps (MC)
confidentiality: Internal
---

# MC Sprint Plan — v27.6 Compliance Automation & Golden Paths

> Theme: **Prove-and-publish trust**. Automate compliance evidence (SOC 2/ISO 27001 control mapping), standardize service onboarding via golden paths, and reduce policy friction with self-service waivers + step-up auth. Keep DR posture from v27.5.

**Scope anchor:** `/orchestrations/mc`  
**Prereqs:** v27.5 DR drill green; offline verify + quorum bypass operational  
**Timebox:** 2 weeks (Dec 8–Dec 19, 2025, America/Denver)

---

## 0) Retro Snapshot (from 2025‑11‑24)

- ✅ DR nightly: evidence packs with Merkle roots generated successfully.
- ✅ Quorum bypass flow functional; 0 abuses; logs tamper‑evident.
- ⚠️ Some apps missing owner metadata for bypass approvals.
- ❌ Control mapping to SOC2/ISO not automated; waivers remain manual.

---

## 1) Sprint Goals (Outcomes)

1. **Compliance Evidence Automation v1:** MC emits a signed **Control Evidence Manifest** per release that maps to SOC2 CC1.x/CC7.x & ISO Annex A controls.
2. **Golden Path Onboarding:** New service template (`api`, `web`, `worker`) scaffolds MC, gates, dashboards, and DR hooks in ≤ 5 minutes.
3. **Self‑Service Waivers:** Developers request time‑boxed waivers via PR comment bot with **step‑up (WebAuthn)**; auto‑close on TTL expiry.
4. **License Compliance:** SBOM → license policy gate with allow/deny lists; report exported.
5. **Policy Friction ↓ 30%:** Reduce average time-to-green after gate failure, measured week-over-week.

---

## 2) Swimlanes

### A) Compliance Automation (Owner: DevSecOps)

- Control mapping generator; signed manifests; evidence bundle enrichment.

### B) Golden Paths (Owner: Platform + DX)

- `create-service` template (api/web/worker) with MC files, workflows, dashboards wiring.

### C) Waivers & Step-up (Owner: SecOps + CI Guild)

- PR bot for waiver requests; WebAuthn step-up for approval; TTL auto-revert.

### D) License & Policy (Owner: DevSecOps)

- SPDX/CycloneDX license extraction; OPA policy; exceptions with TTL.

### E) Observability & KPIs (Owner: SRE)

- Measure time-to-green, waiver volume, license violations; publish scoreboard.

---

## 3) User Stories & Acceptance Criteria

> ID: `MC6-<lane>-<n>`

### Compliance Automation

1. **MC6-COMP-1** — _Control Evidence Manifest_
   - **AC:** `mc evidence` outputs `controls.json` mapping artifacts/logs to SOC2/ISO controls; signed with cosign.
2. **MC6-COMP-2** — _Export for auditors_
   - **AC:** ZIP includes manifest + references; CSV export of pass/fail per control.

### Golden Paths

3. **MC6-GOLD-1** — _create-service templates_
   - **AC:** `npx create-service` produces repo with MC workflow, policy bundle, dashboards, DR nightly.
4. **MC6-GOLD-2** — _Onboarding time ≤ 5 min_
   - **AC:** Dry runs show ≤ 5 min from zero to first green MC run.

### Waivers & Step-up

5. **MC6-WVR-1** — _PR Waiver Bot_
   - **AC:** `/waiver request <digest> <7d>` opens waiver with owner + TTL; requires WebAuthn; status posted.
6. **MC6-WVR-2** — _Auto-close & audit_
   - **AC:** Expired waivers auto‑close; weekly audit report generated.

### License & Policy

7. **MC6-LIC-1** — _License gate_
   - **AC:** Builds fail on denied license types; allow list honored; waivers allowed with TTL.

### Observability & KPIs

8. **MC6-OBS-1** — _Time-to-green metric_
   - **AC:** Dashboard panel and SLO added; friction ↓ 30% vs last sprint.

---

## 4) Deliverables & Artifacts

- `scripts/controls-generate.js` — build control manifest from run metadata.
- `docs/compliance/mapping.yaml` — SOC2/ISO control → evidence mapping.
- `packages/create-service/` — golden-path scaffolder (Node).
- `.github/workflows/waiver-bot.yml` — PR command handler + WebAuthn check.
- `policy/opa/license.rego` — license allow/deny enforcement.
- `dashboards/mc-scoreboard.json` — adoption, time-to-green, waivers, license issues.

---

## 5) Scaffolds & Snippets

### A) Control Mapping (example mapping file)

```yaml
# file: docs/compliance/mapping.yaml
controls:
  soc2:
    CC1.1:
      ['evidence:signatures', 'evidence:provenance', 'policy:change-approval']
    CC7.2: ['scanner:secrets', 'scanner:sbom', 'policy:waiver-ttl']
  iso27001:
    A.12.1.2: ['ci:workflow-controls', 'dr:nightly']
    A.14.2.5: ['supply-chain:provenance', 'policy:code-review']
```

### B) Controls Generator (Node)

```js
// file: scripts/controls-generate.js
import fs from 'node:fs';
import crypto from 'node:crypto';
const map = JSON.parse(fs.readFileSync('docs/compliance/mapping.json', 'utf8'));
const run = JSON.parse(fs.readFileSync('run-metadata.json', 'utf8'));
const manifest = {
  created: new Date().toISOString(),
  run: run.id,
  controls: {},
};
for (const [ctrl, refs] of Object.entries(map.controls.soc2)) {
  manifest.controls[ctrl] = refs.map((r) => ({ ref: r, ok: true }));
}
const body = JSON.stringify(manifest, null, 2);
fs.writeFileSync('controls.json', body);
fs.writeFileSync(
  'controls.sha256',
  crypto.createHash('sha256').update(body).digest('hex'),
);
```

### C) Waiver Bot (workflow excerpt)

```yaml
# file: .github/workflows/waiver-bot.yml
name: Waiver Bot
on:
  issue_comment:
    types: [created]
permissions:
  { contents: write, issues: write, pull-requests: write, id-token: write }
jobs:
  handle:
    if: contains(github.event.comment.body, '/waiver request')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Parse request
        id: parse
        run: |
          echo "digest=$(echo '${{ github.event.comment.body }}' | awk '{print $3}')" >> $GITHUB_OUTPUT
          echo "ttl=604800000000000" >> $GITHUB_OUTPUT # default 7d
      - name: Step-up (WebAuthn required)
        run: echo "Require security approver with WebAuthn" # placeholder
      - name: Append waiver
        run: |
          yq -i '.waivers += [{"digest":"${{ steps.parse.outputs.digest }}","created":"'$(date -u +%FT%TZ)'","ttl_ns":${{ steps.parse.outputs.ttl }}}]' policy/waivers.yaml
      - name: Commit
        run: |
          git config user.email ci@bots
          git config user.name waiver-bot
          git commit -am "chore(waiver): add ${{ steps.parse.outputs.digest }}" && git push || true
```

### D) License Policy (OPA)

```rego
# file: policy/opa/license.rego
package license

deny[msg] {
  some c in input.components
  c.license in {"GPL-3.0-only", "AGPL-3.0-only"}
  not waived(c.purl)
  msg := sprintf("Denied license: %s (%s)", [c.license, c.name])
}

waived(purl) {
  some w in input.waivers
  w.purl == purl
  time.now_ns() < time.add_ns(w.created, w.ttl_ns)
}
```

### E) Golden Path: service template layout

```text
packages/create-service/templates/api/
  .github/workflows/ci-main.yml
  .github/workflows/_reusable-ci-security.yml
  orchestrations/mc/build.yaml
  policy/opa/{supplychain.rego,license.rego}
  policy/waivers.yaml
  argo/hooks/verify-provenance.yaml
  docs/mc/getting-started.md
  tests/{smoke,perf}
```

---

## 6) Observability & KPIs

```json
// file: dashboards/mc-scoreboard.json
{
  "title": "MC Scoreboard",
  "panels": [
    {
      "type": "stat",
      "title": "Time to Green (median)",
      "targets": [
        {
          "expr": "histogram_quantile(0.5, sum(rate(mc_time_to_green_seconds_bucket[5m])) by (le))"
        }
      ]
    },
    {
      "type": "graph",
      "title": "Waivers (open vs expired)",
      "targets": [
        { "expr": "mc_waivers_open" },
        { "expr": "mc_waivers_expired" }
      ]
    },
    {
      "type": "table",
      "title": "License Violations",
      "targets": [{ "expr": "mc_license_violations" }]
    },
    {
      "type": "table",
      "title": "Controls Coverage",
      "targets": [{ "expr": "mc_controls_covered" }]
    }
  ]
}
```

```yaml
# file: alerts/mc-rules-v5.yaml
groups:
  - name: mc
    rules:
      - alert: MCFrictionHigh
        expr: histogram_quantile(0.5, sum(rate(mc_time_to_green_seconds_bucket[30m])) by (le)) > 1800
        for: 30m
        labels: { severity: ticket }
      - alert: MCLicenseDenied
        expr: mc_license_violations > 0
        for: 10m
        labels: { severity: page }
```

---

## 7) Risks & Mitigations

1. **Over‑blocking via license gate** — start in advisory, publish allow/deny list, offer temporary waivers with TTL.
2. **Golden path drift** — nightly template test; renovate to bump actions and policies.
3. **Auditor export gaps** — manual checklist in early sprint; backstop CSV export.
4. **Bot misuse** — require CODEOWNERS review + WebAuthn for waiver additions.

---

## 8) DOD, Gates & Rollback

**DOD**

- [ ] Controls manifest generated, signed, and included in evidence packs.
- [ ] Golden path templates published and validated E2E.
- [ ] Waiver bot live with step‑up and TTL auto‑close.
- [ ] License gate in advisory (dev) and enforce (prod) with allow list.
- [ ] Time‑to‑green reduced by ≥ 30%.

**Rollback**

- Set `LICENSE_GATE=advisory`; disable waiver-bot workflow; revert template publish tag.

---

## 9) Timeline & Capacity (2 weeks)

- **D1–D3:** Controls mapping + generator; waiver bot MVP.
- **D4–D6:** Golden paths; license policy & allowlist.
- **D7–D9:** Dashboards/KPIs; advisory→enforce for license gate in prod.
- **D10:** Demo evidence export + golden-path create‑service walkthrough.

**Estimate:** 25–29 pts across Platform, Sec, CI, SRE, DX.

---

## 10) Ticket Seed (importable)

```yaml
# file: .project/tickets/mc-sprint-2025-12-08.yaml
sprint: mc-2025-12-08
board:
  columns: [Backlog, Ready, In Progress, Review, Blocked, Done]
issues:
  - id: MC6-COMP-1
    title: Generate & sign Control Evidence Manifest
    labels: [mc, compliance]
    assignees: [owner-sec]
    points: 5
  - id: MC6-COMP-2
    title: Auditor export (ZIP + CSV)
    labels: [mc, compliance]
    assignees: [owner-sec]
    points: 3
  - id: MC6-GOLD-1
    title: Golden path templates (api/web/worker)
    labels: [mc, platform, dx]
    assignees: [owner-platform, owner-dx]
    points: 6
  - id: MC6-WVR-1
    title: PR Waiver Bot with WebAuthn step-up
    labels: [mc, policy, ci]
    assignees: [owner-ci, owner-sec]
    points: 5
  - id: MC6-LIC-1
    title: License gate + allow/deny list
    labels: [mc, policy]
    assignees: [owner-sec]
    points: 4
  - id: MC6-OBS-1
    title: Time-to-green KPI & dashboard
    labels: [mc, observability]
    assignees: [owner-sre]
    points: 3
```

---

## 11) Evidence & Reporting

- KPIs: time‑to‑green median, #waivers opened/expired, license violations, controls coverage %.
- Artifacts: signed controls manifest, waiver bot logs, template test runs, scoreboard screenshots.
- Store under `docs/mc/evidence/2025-12-08/`.

---

## 12) Changelog

- **Added:** Controls manifest; golden paths; waiver bot; license gate.
- **Changed:** Evidence packs now include compliance CSV.
- **Fixed:** Manual waiver handling and slow time-to-green.
