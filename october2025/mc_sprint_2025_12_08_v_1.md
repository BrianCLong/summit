```md
# Maestro Conductor (MC) — Sprint Plan *(v1.0.0)*

**Slug:** `mc-sprint-2025-12-08-v1`  
**Dates (America/Denver):** 2025-12-08 → 2025-12-19  
**Owner/DRI:** Architect‑General  
**Teams:** Orchestrator Platform, SRE, Security, Data, UX  
**Tracks:** A) Now‑value; B) Enduring moats  
**Prereq:** `mc-0.5.0` shipped (tenant isolation, residency auditor, read‑only Ops Console, in‑toto attestations, SDKs, post‑release validation)

---

## 0) Context & Carry‑Forward
**Done**: Isolation posture proven, region‑scoped disclosures, console read‑only shipped, in‑toto in CI, SDKs + golden samples, auto post‑release validation.  
**Carry‑forward**: Finish remaining SDK docs/examples, tune console search latency on large tenants, expand residency auditor coverage to backfills.

---

## 1) Objectives & Key Results
| # | Objective | KR (measurable) |
|---|---|---|
| A1 | **Ops Console — Controlled Actions v1** | Enable **safe writes** behind flags: `replay`, `cancel`, `retry` with step‑up auth; p95 action round‑trip < **800ms** |
| A2 | **Disclosure & Evidence API v2** | On‑demand **evidence manifests** (JSON) and pre‑signed URLs; pack build TAT < **45s** for 95% of runs |
| A3 | **Policy Pack QA Harness** | Golden tests for packs (residency/PII/budget/quotas/access) auto‑run per PR; flake rate < **1%** |
| B1 | **Drift & Integrity** | Continuous config drift detection (Helm/Terraform) with auto‑create remediation PRs; mean detection < **5m** |
| B2 | **Runner Sandboxing v2** | Per‑task network policies + egress allowlists; blocked calls detected; 0 escapes in chaos tests |
| B3 | **Data Lifecycle Enforcement** | TTL controllers GA (logs 90d, receipts 7y), per‑tenant overrides with audit events |

---

## 2) Scope (In/Out)
**In**: Console actions (write) with guardrails, evidence API & manifest, pack QA pipeline, drift detection & PR bot, runner egress policy, lifecycle TTL jobs, SLO/alert updates, Jira scaffolding.  
**Out**: Full console editor for manifests; new runner types; multi‑cloud runtime.

---

## 3) Epics, Swimlanes & Stories

### 3.1 Ops Console — Controlled Actions
- **MC‑UI‑1101**: *Action API (cancel/retry/replay)*  
  **AC:** `POST /api/executions/{id}:{cancel|retry|replay}`; idempotent; audit event `mc.exec.action` with actor+reason.  
- **MC‑UI‑1102**: *Step‑up auth & flags*  
  **AC:** WebAuthn step‑up required; flags `console_actions_enabled` per‑tenant.  
- **MC‑UI‑1103**: *UI wires*  
  **AC:** Buttons gated by policy/role; confirmation modals; rollback affordances.

### 3.2 Evidence & Disclosure v2
- **MC‑DISC‑1111**: *Evidence manifest API*  
  **AC:** `GET /api/executions/{id}/evidence` lists artifacts (digests, sizes, signed URIs).  
- **MC‑DISC‑1112**: *Faster pack builder*  
  **AC:** Stream builder w/ parallel fetch; p95 < 45s on 1GB log sets.

### 3.3 Policy Pack QA Harness
- **MC‑POL‑1121**: *Golden test data & runner*  
  **AC:** Standard inputs/fixtures; `conftest` + `rego` unit; coverage report.  
- **MC‑POL‑1122**: *CI gate & flake tracker*  
  **AC:** PRs fail on flake >1%; nightly report published.

### 3.4 Drift & Integrity
- **MC‑DRFT‑1131**: *Drift detector daemon*  
  **AC:** Compares live vs desired (Helm/Terraform); pages on sev; opens PR w/ diff.  
- **MC‑DRFT‑1132**: *Remediation PR bot*  
  **AC:** Generates patch; requires human approval; evidence linked.

### 3.5 Runner Sandboxing v2
- **MC‑RUN‑1141**: *Egress allowlist*  
  **AC:** Per‑task `egress:` section; default deny; audit blocked calls.  
- **MC‑RUN‑1142**: *Chaos: network escapes*  
  **AC:** Tests simulate DNS exfil/SMTP; 0 passes.

### 3.6 Data Lifecycle Enforcement
- **MC‑DATA‑1151**: *TTL controllers GA*  
  **AC:** Logs purge @90d; receipts retain 7y; per‑tenant override; audit events emitted.  
- **MC‑DATA‑1152**: *Disclosure redaction check*  
  **AC:** Ensure PII scrubs in packs via redaction lib; tests prove.

### 3.7 SRE & Ops
- **MC‑SRE‑1161**: *Action rollback drill*  
  **AC:** Simulate bad retry; auto‑rollback within 2m; evidence recorded.  
- **MC‑SRE‑1162**: *SLO refresh*  
  **AC:** Add `action_latency_ms`; update burn policies.

---

## 4) Milestones (America/Denver)
- **Kickoff**: Mon 2025‑12‑08 10:00  
- **Design/ADR Review**: Tue 12‑09 15:00  
- **Mid‑sprint Evidence Review**: Fri 12‑12 16:00  
- **Chaos (egress/step‑up)**: Wed 12‑17 14:00  
- **Sprint Review & Release**: Fri 12‑19 15:00  
- **Retro**: Fri 12‑19 16:00

---

## 5) Artifacts & Scaffolds

### 5.1 OpenAPI (Action & Evidence)
```yaml
paths:
  /api/executions/{id}:cancel:
    post: { summary: Cancel an execution, responses: { '202': { description: Accepted } } }
  /api/executions/{id}:retry:
    post: { summary: Retry a failed execution }
  /api/executions/{id}:replay:
    post: { summary: Replay with same manifest & inputs }
  /api/executions/{id}/evidence:
    get: { summary: Evidence manifest (JSON with digests & signed URLs) }
```

### 5.2 Policy QA — CI gate
`.github/workflows/policy-qa.yml`
```yaml
name: policy-qa
on: [pull_request]
jobs:
  rego:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Lint & Test Rego
        run: |
          curl -sSfL https://raw.githubusercontent.com/open-policy-agent/conftest/master/install.sh | sh -s -- -b ./bin
          ./bin/conftest test policy/ -p policy/rego --all-namespaces
      - name: Coverage
        run: ./scripts/rego-coverage.sh --min 85
```

### 5.3 Runner Egress Policy (manifest extension)
```yaml
# workflow manifest v1 extension
tasks:
  - id: fetch
    uses: pkg:http/get@1.0.0
    egress:
      allow:
        - host: api.example.com
          ports: [443]
```

### 5.4 Drift Detector (spec)
`docs/ops/DRIFT_DETECTOR.md`
```md
- Sources: Helm release manifests, Terraform state.
- Compare cadence: every 2m.
- Actions: page on critical; open PR with patch; label `drift:auto`.
- Evidence: attach diff, env, timestamps.
```

### 5.5 Console Actions (React snippets)
```tsx
// Confirm + step-up wrapper
export function ActionButton({execId, kind}:{execId:string; kind:'cancel'|'retry'|'replay'}){
  const stepUp = async ()=> await navigator.credentials.get({ publicKey: {/* ... */} })
  const run = async ()=> fetch(`/api/executions/${execId}:${kind}`, {method:'POST'})
  return <button onClick={async()=>{ await stepUp(); await run(); }} className="btn">{kind}</button>
}
```

### 5.6 TTL Controllers (K8s CronJobs)
```yaml
apiVersion: batch/v1
kind: CronJob
metadata: { name: mc-logs-ttl }
spec:
  schedule: "0 3 * * *"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: purge
              image: ghcr.io/${ORG}/mc-janitor:latest
              args: ["--kind=logs","--ttl=90d"]
          restartPolicy: OnFailure
```

### 5.7 Audit Event (exec action)
```json
{
  "type": "mc.exec.action",
  "actor": {"sub": "alice@company", "tenant": "acme"},
  "subject": {"executionId": "exec_123"},
  "data": {"action": "retry", "reason": "transient_error"},
  "ts": "2025-12-10T18:04:21Z"
}
```

### 5.8 SLO Additions
`docs/slo/MC_SLO.yaml` (delta)
```yaml
  - name: action_latency
    objective: 0.95
    windowDays: 28
    metric: histogram:mc_action_latency_ms
    thresholdMs: 800
```

---

## 6) Observability & Dashboards (adds)
- Metrics: `mc_action_latency_ms`, `mc_drift_findings_total`, `mc_egress_block_total`, `mc_evidence_pack_ms`.  
- Dashboards: Console actions; Drift & integrity; Egress blocks; Evidence build times.  
- Alerts: action p95 > 800ms; drift > 0 critical; egress blocks spike; evidence p95 > 45s.

---

## 7) Security & Compliance
- Step‑up auth mandatory for write actions; scoped OAuth; audit every action.  
- Egress allowlist **deny‑by‑default**; violations produce disclosure note.  
- Evidence API returns pre‑signed URLs limited to 10m; access logged.  
- TTL controllers produce signed deletion manifests for auditors.

---

## 8) GameDay & Drills
- **Step‑up outage**: ensure graceful degradation (read‑only) + clear comms.  
- **Drift storm**: inject misconfig; bot proposes PRs; human approves; recovery < 10m.  
- **Egress exfil attempt**: blocked + alert + audit.

---

## 9) Release & Rollback
- Tag: `mc-0.6.0`.  
- Flags: `console_actions_enabled`, `evidence_v2_enabled`, `egress_policy_enforce`, `drift_pr_bot_enabled`.  
- Rollback: disable flags; revert API routes; keep receipts immutable.

---

## 10) Jira Import (CSV)
```csv
Summary,Issue Type,Parent,Labels,Description
Action API (cancel/retry/replay),Story,EPIC-MC-UI,mc;console,Idempotent action endpoints + audits
Step-up auth & flags,Story,EPIC-MC-UI,mc;console,WebAuthn + per-tenant flags
Console wires (buttons & modals),Story,EPIC-MC-UI,mc;console,Controlled UI writes
Evidence manifest API,Story,EPIC-MC-DISC,mc;disclosure,JSON manifest with signed URLs
Faster pack builder,Story,EPIC-MC-DISC,mc;disclosure,Parallel fetch+stream builder
Policy pack QA harness,Story,EPIC-MC-POL,mc;policy,Golden tests + CI gate
Drift detector daemon,Story,EPIC-MC-DRFT,mc;ops,Detect & alert on config drift
Remediation PR bot,Story,EPIC-MC-DRFT,mc;ops,Open patch PRs automatically
Runner egress allowlist,Story,EPIC-MC-RUN,mc;security,Per-task network policy default deny
Chaos: network escapes,Story,EPIC-MC-RUN,mc;security,Simulate exfil & verify blocks
TTL controllers GA,Story,EPIC-MC-DATA,mc;data,Logs 90d / Receipts 7y with audit
Disclosure redaction check,Story,EPIC-MC-DATA,mc;data,PII scrub proof in packs
Action rollback drill,Story,EPIC-MC-SRE,mc;sre,Simulate bad retry → rollback
SLO refresh (actions),Story,EPIC-MC-SRE,mc;sre,Add action latency SLO + alerts
```

---

## 11) DoR / DoD (adds)
**Adds**: step‑up auth test evidence; drift PR links; egress deny proofs; evidence packing benchmarks; console write UX copy review.

---

## 12) Risks & Mitigations
| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Console writes misuse | M | H | Step‑up + confirmations + audit + feature flags |
| Drift bot false positives | M | M | Label `drift:needs-review`; low‑risk autopatch only |
| Egress allowlist breakages | M | M | Shadow (audit‑only) phase; per‑tenant gradual enforce |

---

## 13) Evidence Links (populate during sprint)
- ADRs: `/docs/adr/ADR-04xx-*`  
- Chaos (egress/step‑up): `/docs/evidence/chaos-2025-12-17/*`  
- Drift drill: `/docs/evidence/drift-2025-12-15/*`  
- Release: `releases/mc-0.6.0`

---

> Decisive, not reckless: enable the right writes with guardrails, make evidence faster, and keep the railhead true with drift detection.
```

