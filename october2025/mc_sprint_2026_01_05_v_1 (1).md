---
slug: mc-sprint-2026-01-05-v1
version: 1.0.0
date: 2026-01-05
status: Proposed
owner: Platform Eng • DevSecOps (MC)
confidentiality: Internal
---

# MC Sprint Plan — v28.0 Unified Policy, Secretless Builds & Multi‑Tenant Safety

> Theme: **Consolidate policies, remove long‑lived secrets from builds, and make MC safe-by-default for multi‑tenant repos.** Deliver policy bundle v28.0, OIDC‑only execution, hermetic builds, and per‑tenant guardrails.

**Scope anchor:** `/orchestrations/mc`  
**Prereqs:** v27.7 policy coverage ≥85%, multi‑lang golden paths in place  
**Timebox:** 2 weeks (Jan 5–Jan 16, 2026, America/Denver)

---

## 0) Retro Snapshot (from 2025‑12‑22)

- ✅ Multi‑language golden paths for Go/Python/Java.
- ✅ Policy coverage ≥85%; mutation kill‑rate ≈82%.
- ⚠️ Waiver‑bot adoption still uneven; some repos lack CODEOWNERS step‑up.
- ❌ Secretless/OIDC‑only not enforced org‑wide; runners not yet isolated per‑tenant.

---

## 1) Sprint Goals (Outcomes)

1. **Unified policy bundle v28.0** (OPA + JSONSchema) published & version‑pinned across all repos.
2. **Secretless builds**: remove static credentials from CI; **OIDC only** for cloud + registry; fail closed on fallback.
3. **Hermetic build option** for high‑risk services (no network during build) + SBOM completeness check.
4. **Multi‑tenant runner safety**: per‑tenant workspaces, artifact isolation, and egress guardrails.
5. **Developer guardrails**: MC lints (pre‑commit + PR) to prevent unsafe workflow steps.

---

## 2) Swimlanes

### A) Policy Unification (Owner: DevSecOps)

- Merge supply‑chain, license, bypass, waiver TTL into `policy/bundles/v28.0` with tests.

### B) Secretless/OIDC (Owner: CI Guild)

- Remove PATs/long‑lived creds; configure cloud + registry OIDC trust; block legacy auth paths.

### C) Hermetic Builds (Owner: Platform)

- Add `hermetic: true` flag in MC pipeline; sandbox toolchain; network off; reproducibility hash recorded.

### D) Multi‑Tenant Runner Safety (Owner: SRE)

- Ephemeral runners; workspace cleanup; egress allow‑list; artifact quarantine by repo.

### E) DX Guardrails (Owner: DX)

- Pre‑commit hooks; MC workflow linter; docs & quick fixes; PR bot suggestions.

---

## 3) User Stories & Acceptance Criteria

> ID: `MC8-<lane>-<n>`

### Policy Unification

1. **MC8-POL-1** — _Bundle v28.0 publish & pin_
   - **AC:** Bundle tarball + checksum; all MC workflows consume `bundle:v28.0`; tests pass.
2. **MC8-POL-2** — _Policy tests ≥ 90%_
   - **AC:** Coverage report ≥90%; mutation kill‑rate ≥85%.

### Secretless/OIDC

3. **MC8-OIDC-1** — _OIDC to cloud + registry_
   - **AC:** All workflows use `id-token: write`; secrets removed; cloud roles limited by audience & subject.
4. **MC8-OIDC-2** — _Legacy auth block_
   - **AC:** Job fails if `GITHUB_TOKEN` or PAT used to push images or call cloud APIs.

### Hermetic Builds

5. **MC8-HRM-1** — _Hermetic option_
   - **AC:** `hermetic: true` disables network; build completes from pinned cache; SBOM includes full dependency graph.

### Multi‑Tenant Runner Safety

6. **MC8-MTR-1** — _Ephemeral & isolated_
   - **AC:** Runners auto‑destroy; workspace scrub verified; egress only to allow‑list; artifacts ACL’d to repo.

### DX Guardrails

7. **MC8-DX-1** — _MC linter_
   - **AC:** `mc lint-workflow` flags dangerous steps (curl|wget to arbitrary, unpinned actions); PR comments suggest fixes.

---

## 4) Deliverables & Artifacts

- `policy/bundles/v28.0/` with `policy.rego`, `schema.json`, tests, `checksums.txt`.
- `.github/workflows/_reusable-ci-security.yml` updates for OIDC‑only.
- `runner/egress-allowlist.yaml`, `runner/scrub.sh` for isolation.
- `orchestrations/mc/build.schema.v28.json` with `hermetic` flag.
- `cmd/mc` updates: `lint-workflow`, `enable-hermetic`.
- Dashboards: `dashboards/mc-security-posture-v28.json`.

---

## 5) Scaffolds & Snippets

### A) Policy Bundle Layout

```text
policy/bundles/v28.0/
  policy.rego
  license.rego
  waiver.rego
  bypass.rego
  tests/*.yaml
  schema.json
  checksums.txt
```

### B) OIDC‑Only Guard (workflow excerpt)

```yaml
# file: .github/workflows/_reusable-ci-security.yml
permissions:
  contents: read
  id-token: write
jobs:
  build:
    steps:
      - uses: actions/checkout@v4
      - name: Guard: block legacy secrets
        run: |
          if env | grep -E 'AWS_ACCESS_KEY_ID|AWS_SECRET_ACCESS_KEY|DOCKER_PASSWORD'; then
            echo "Legacy secrets not allowed" && exit 1; fi
```

### C) Hermetic Build Flag (schema + usage)

```json
// file: orchestrations/mc/build.schema.v28.json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": { "hermetic": { "type": "boolean", "default": false } }
}
```

```yaml
# file: orchestrations/mc/build.yaml
hermetic: true
```

```yaml
# file: .github/workflows/hermetic.yml
name: Hermetic Build
jobs:
  hermetic:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Disable network
        run: sudo iptables -P OUTPUT DROP
      - name: Build
        run: npm ci --offline && npm run build
```

### D) Runner Egress Allow‑List

```yaml
# file: runner/egress-allowlist.yaml
allow:
  - ghcr.io
  - api.github.com
  - token.actions.githubusercontent.com
  - rekor.sigstore.dev
  - fulcio.sigstore.dev
```

### E) Workspace Scrub (ephemeral runner)

```bash
# file: runner/scrub.sh
set -euo pipefail
sudo rm -rf "$RUNNER_WORK_DIRECTORY/_work/*"
sudo shred -u -z -n 1 "$RUNNER_WORK_DIRECTORY"/** || true
```

### F) MC Workflow Linter (Node stub)

```js
// file: cmd/mc/lint-workflow.js
import fs from 'node:fs';
const y = fs.readFileSync(process.argv[2], 'utf8');
if (/curl\s+http/.test(y) || /uses:\s+[^@]+@main/.test(y)) {
  console.error('Unsafe: network curl or unpinned action');
  process.exit(1);
}
console.log('OK');
```

---

## 6) Observability & Dashboards

```json
// file: dashboards/mc-security-posture-v28.json
{
  "title": "MC Security Posture v28",
  "panels": [
    {
      "type": "stat",
      "title": "OIDC Adoption %",
      "targets": [{ "expr": "100 * mc_oidc_runs / mc_total_runs" }]
    },
    {
      "type": "stat",
      "title": "Secretful Runs (blocked)",
      "targets": [{ "expr": "increase(mc_secretful_blocked_total[1d])" }]
    },
    {
      "type": "graph",
      "title": "Hermetic Builds",
      "targets": [{ "expr": "rate(mc_hermetic_runs_total[1d])" }]
    },
    {
      "type": "table",
      "title": "Runner Egress Denials",
      "targets": [{ "expr": "mc_runner_egress_denied" }]
    }
  ]
}
```

---

## 7) Risks & Mitigations

1. **Builds needing network break under hermetic** — dry‑run + allow pinned proxies; per‑repo opt‑in flag.
2. **OIDC trust misconfig** — staged rollout; `Audit` mode; fallback denied; rollback plan to advisory.
3. **Runner isolation overhead** — use ephemeral runners for hot paths only; cache warmers on schedule.
4. **Developer friction** — MC linter suggests auto‑fix PRs; office hours.

---

## 8) DOD, Gates & Rollback

**DOD**

- [ ] Bundle v28.0 pinned; tests ≥90%; mutation ≥85%.
- [ ] OIDC‑only across all workflows; secretful runs blocked with clear error.
- [ ] Hermetic builds green for high‑risk services; SBOM complete.
- [ ] Ephemeral runner isolation + egress guardrails verified.
- [ ] MC linter enforced in PRs.

**Rollback**

- Revert bundle pin to v27.7; set `MC_OIDC_ENFORCE=false`; disable hermetic job; return runners to standard pool.

---

## 9) Timeline & Capacity (2 weeks)

- **D1–D3:** Publish bundle v28.0; raise coverage.
- **D4–D6:** OIDC‑only rollout; block legacy secrets.
- **D7–D8:** Hermetic builds for 2 services; SBOM validation.
- **D9–D10:** Runner isolation; linter + docs; demo & retro.

**Estimate:** 26–30 pts across Platform, Sec, CI, SRE, DX.

---

## 10) Ticket Seed (importable)

```yaml
# file: .project/tickets/mc-sprint-2026-01-05.yaml
sprint: mc-2026-01-05
board:
  columns: [Backlog, Ready, In Progress, Review, Blocked, Done]
issues:
  - id: MC8-POL-1
    title: Publish & pin policy bundle v28.0
    labels: [mc, policy]
    assignees: [owner-sec]
    points: 5
  - id: MC8-POL-2
    title: Raise policy tests to 90% & mutation ≥85%
    labels: [mc, policy, tests]
    assignees: [owner-sec]
    points: 4
  - id: MC8-OIDC-1
    title: Enforce OIDC-only to cloud & registry
    labels: [mc, ci]
    assignees: [owner-ci]
    points: 6
  - id: MC8-HRM-1
    title: Hermetic build option + SBOM completeness
    labels: [mc, platform]
    assignees: [owner-platform]
    points: 5
  - id: MC8-MTR-1
    title: Ephemeral runner isolation + egress allowlist
    labels: [mc, sre]
    assignees: [owner-sre]
    points: 5
  - id: MC8-DX-1
    title: MC workflow linter + PR comments
    labels: [mc, dx]
    assignees: [owner-dx]
    points: 3
```

---

## 11) Evidence & Reporting

- KPIs: OIDC adoption %, secretful run blocks, hermetic run count, policy coverage %, runner egress denials.
- Artifacts: bundle checksums, CI logs, SBOMs, linter outputs, runner scrub logs.
- Store under `docs/mc/evidence/2026-01-05/`.

---

## 12) Changelog

- **Added:** Unified policy bundle v28.0; hermetic builds; runner isolation; workflow linter.
- **Changed:** OIDC‑only everywhere; dashboards reflect new posture.
- **Fixed:** Residual long‑lived secrets and unpinned workflows.
