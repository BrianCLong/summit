---
slug: mc-sprint-2025-11-24-v1
version: 1.0.0
date: 2025-11-24
status: Proposed
owner: Platform Eng • DevSecOps (MC)
confidentiality: Internal
---

# MC Sprint Plan — v27.5 Resilience, DR, and Forensics

> Theme: **Prove we can lose infra and still deliver signed, attestable releases within RTO/RPO.** Build automated backup/restore, cross‑region promotion, and tamper‑evident evidence packs. Keep gates; add safe bypass with quorum.

**Scope anchor:** `/orchestrations/mc`  
**Prereqs:** v27.4 adoption=100%, evidence packs + SLO gate live  
**Timebox:** 2 weeks (Nov 24–Dec 6, 2025, America/Denver)

---

## 0) Retro Snapshot (from 2025‑11‑10)

- ✅ Evidence pack generator + signed manifest.
- ✅ CI/CD minutes reduced ~22%.
- ⚠️ Noise reduced but ownership mapping incomplete for 3 repos.
- ❌ Not done: disaster‑time verify cache; automated restore drill.

---

## 1) Sprint Goals (Outcomes)

1. **RTO ≤ 60m, RPO ≤ 15m** for build provenance and artifact promotion in a region loss scenario.
2. **Disaster‑time verify**: offline cosign verification via **trusted mirror** (Fulcio/Rekor backup) + pinned roots.
3. **Automated restore drill**: nightly synthetic release builds into an isolated project; publish evidence pack.
4. **Quorum bypass** (SEV‑1 only): time‑boxed, 3‑approver flow with full audit + auto‑revert.
5. **Forensics packet**: immutable log bundle per release (hash chain + Merkle root stored).

---

## 2) Swimlanes

### A) Backup & Verify Cache (Owner: DevSecOps)

- Mirror transparency logs (read‑only) + store trust roots; cosign offline verify path.
- SBOM + attestation mirrors with retention.

### B) DR Build & Promotion (Owner: Platform + CI Guild)

- Shadow CI project (reduced concurrency) capable of building & signing.
- Cross‑region registry push; promotable label replication.

### C) Forensics & Evidence (Owner: SRE)

- Tamper‑evident log chain; evidence store with write‑once policy.
- Grafana+Loki views for DR runs.

### D) Bypass Governance (Owner: SecOps + Release)

- OPA policy: **bypass only with 3 approvals** (Security, Release, Service Owner) + TTL ≤ 4h.
- PR template + automation posting to #release‑approvals.

### E) DX & Runbooks (Owner: DX)

- `mc` CLI: `dr simulate`, `dr restore`, `evidence verify-offline`.
- Step‑by‑step runbooks and tabletop drill materials.

---

## 3) User Stories & Acceptance Criteria

> ID: `MC5-<lane>-<n>`

### Backup & Verify Cache

1. **MC5-BKP-1** — _Sigstore mirror & pinned trust_
   - **AC:** `cosign verify*` succeeds using local mirror endpoints; failure if roots mismatch; roots rotated test passes.
2. **MC5-BKP-2** — _SBOM/attestation mirror_
   - **AC:** Evidence retrievable from mirror when primary down; retention policy enforced.

### DR Build & Promotion

3. **MC5-DR-1** — _Shadow CI project builds & signs_
   - **AC:** Synthetic tag triggers shadow pipeline; artifacts signed; provenance generated.
4. **MC5-DR-2** — _Cross‑region promotion_
   - **AC:** Image copied to secondary registry; label `promotable=true` replicated; Argo PreSync verify passes using mirror.

### Forensics & Evidence

5. **MC5-FOR-1** — _Tamper‑evident logs_
   - **AC:** Per‑step log digests chained; Merkle root stored; integrity check job green.

### Bypass Governance

6. **MC5-GOV-1** — _Quorum bypass with TTL_
   - **AC:** Bypass requires 3 named approvals; expires ≤ 4h; auto‑revert and report generated.

### DX & Runbooks

7. **MC5-DX-1** — _CLI DR simulate/restore/offline verify_
   - **AC:** Commands run E2E against sandbox; docs published; demo recorded.

---

## 4) Deliverables & Artifacts

- `SECURITY/trust-roots/fulcio.pem`, `SECURITY/trust-roots/rekor.pub`, `SECURITY/trust-policy.yaml` (pinned).
- `infra/sigstore-mirror/*` (chart values / Terraform vars).
- `.github/workflows/dr-nightly.yml` for synthetic build/restore drill.
- `cmd/mc`: `dr simulate|restore`, `evidence verify-offline`.
- `policy/opa/bypass.rego`, `policy/tests/bypass_test.yaml`.
- `docs/mc/runbooks/dr-*`, tabletop deck.

---

## 5) Scaffolds & Snippets

### A) Offline/Disaster‑Mode Verify (cosign)

```bash
# file: scripts/verify-offline.sh
set -euo pipefail
IMG="$1"
COSIGN_EXPERIMENTAL=1 \
cosign verify "$IMG" \
  --rekor-url ${REKOR_MIRROR_URL:-https://rekor-mirror.internal} \
  --certificate-identity-regexp ".*" \
  --certificate-oidc-issuer https://token.actions.githubusercontent.com \
  --certificate-chain SECURITY/trust-roots/fulcio.pem
cosign verify-attestation "$IMG" \
  --rekor-url ${REKOR_MIRROR_URL:-https://rekor-mirror.internal}
```

### B) DR Nightly Synthetic Build

```yaml
# file: .github/workflows/dr-nightly.yml
name: DR Nightly
on:
  schedule: [{ cron: '7 3 * * *' }]
  workflow_dispatch: {}
jobs:
  build_sign_prove:
    runs-on: ubuntu-latest
    permissions: { contents: read, id-token: write }
    steps:
      - uses: actions/checkout@v4
      - run: npm ci && npm run build
      - uses: sigstore/cosign-installer@v3
      - name: Sign artifacts
        run: |
          for a in $(ls dist/**/* 2>/dev/null || true); do cosign sign-blob --yes "$a"; done
      - name: Generate SBOM
        run: npx @cyclonedx/cyclonedx-npm --output-file sbom.json
      - name: Verify via mirror
        env: { REKOR_MIRROR_URL: https://rekor-mirror.internal }
        run: ./scripts/verify-offline.sh ghcr.io/${{ github.repository }}@${IMAGE_DIGEST}
      - name: Evidence pack
        run: ./scripts/mc-evidence.sh dr-$(date +%F)
```

### C) OPA Quorum Bypass (time‑boxed)

```rego
# file: policy/opa/bypass.rego
package bypass

default allow := false

valid_quorum {
  count({a | a := input.approvals[_]; a.role == "Security"}) >= 1
  count({a | a := input.approvals[_]; a.role == "Release"}) >= 1
  count({a | a := input.approvals[_]; a.role == "Owner"}) >= 1
}

not_expired {
  time.now_ns() < time.add_ns(input.created, input.ttl_ns)
}

allow { valid_quorum; not_expired }
```

### D) Tamper‑evident Log Chain (hash link)

```bash
# file: scripts/log-chain.sh
set -euo pipefail
PREV=${1:-}
CUR=$(sha256sum "$2" | awk '{print $1}')
LINK=$(printf "%s|%s" "${PREV:-0}" "$CUR" | sha256sum | awk '{print $1}')
echo "$LINK" | tee -a logs/.chain
```

### E) Cross‑Region Promotion (placeholder)

```bash
# file: scripts/cross-region-promote.sh
set -euo pipefail
SRC=$1 # ghcr.io/org/app@sha256:...
DST=$2 # registry.secondary.example.com/org/app
oras copy "$SRC" "$DST"
./scripts/verify-offline.sh "$DST@${SRC##*@}"
./scripts/label-promotable.sh "$DST@${SRC##*@}"
```

---

## 6) Observability (DR views & SLOs)

```json
// file: dashboards/mc-dr.json
{
  "title": "MC DR",
  "panels": [
    {
      "type": "stat",
      "title": "DR RTO (last)",
      "targets": [{ "expr": "mc_dr_rto_seconds_last" }]
    },
    {
      "type": "stat",
      "title": "DR RPO (last)",
      "targets": [{ "expr": "mc_dr_rpo_seconds_last" }]
    },
    {
      "type": "graph",
      "title": "Mirror Verify Success",
      "targets": [{ "expr": "rate(mc_verify_mirror_success_total[1h])" }]
    },
    {
      "type": "table",
      "title": "Bypass Events",
      "targets": [{ "expr": "mc_bypass_events_total" }]
    }
  ]
}
```

```yaml
# file: alerts/mc-dr-rules.yaml
groups:
  - name: mc-dr
    rules:
      - alert: MCRTOExceeded
        expr: mc_dr_rto_seconds_last > 3600
        for: 5m
        labels: { severity: page }
      - alert: MCRPOExceeded
        expr: mc_dr_rpo_seconds_last > 900
        for: 5m
        labels: { severity: page }
      - alert: MCMirrorVerifyFail
        expr: rate(mc_verify_mirror_success_total[15m]) == 0
        for: 15m
        labels: { severity: ticket }
```

---

## 7) Risks & Mitigations

1. **Mirror trust misconfig → false negatives** — Validate roots; run canary verifies; rollback to primary when healthy.
2. **Bypass abuse** — Strict roles; TTL ≤ 4h; post‑mortem required; auto‑revert.
3. **Oras/registry compat issues** — Test on canary image; retain legacy path as fallback.
4. **Log chain overhead** — Only chain step boundaries; compress archived logs.

---

## 8) DOD, Gates & Rollback

**DOD**

- [ ] RTO/RPO thresholds met in DR drill; evidence pack published.
- [ ] Offline verify OK with mirror; roots pinned and rotated test passes.
- [ ] Quorum bypass enforced & audited; sample event executed and auto‑reverted.
- [ ] Log chain/forensics packet generated for demo release.
- [ ] Runbooks published and reviewed by on‑call.

**Rollback**

- Disable mirror flag `VERIFY_USE_MIRROR=false`; revert trust roots to previous.
- Remove bypass policy binding; require full gates.
- Disable DR Nightly workflow; keep manual dispatch only.

---

## 9) Timeline & Capacity (2 weeks)

- **D1–D2:** Mirror deploy + roots pin; CLI offline verify.
- **D3–D5:** Shadow CI + cross‑region copy; DR nightly workflow.
- **D6–D8:** Quorum bypass policy + automation; log chain.
- **D9–D10:** Full DR drill; evidence; demo & retro.

**Estimate:** 27–31 pts across Platform, Sec, CI, SRE, DX.

---

## 10) Ticket Seed (importable)

```yaml
# file: .project/tickets/mc-sprint-2025-11-24.yaml
sprint: mc-2025-11-24
board:
  columns: [Backlog, Ready, In Progress, Review, Blocked, Done]
issues:
  - id: MC5-BKP-1
    title: Deploy Sigstore mirror + pinned trust roots
    labels: [mc, supply-chain, dr]
    assignees: [owner-sec]
    points: 5
  - id: MC5-BKP-2
    title: Mirror SBOMs & attestations with retention
    labels: [mc, supply-chain, dr]
    assignees: [owner-sec]
    points: 3
  - id: MC5-DR-1
    title: Shadow CI project builds & signs
    labels: [mc, ci, dr]
    assignees: [owner-ci]
    points: 6
  - id: MC5-DR-2
    title: Cross‑region promotion path
    labels: [mc, cd, dr]
    assignees: [owner-platform]
    points: 5
  - id: MC5-FOR-1
    title: Tamper‑evident log chain + integrity check
    labels: [mc, forensics]
    assignees: [owner-sre]
    points: 4
  - id: MC5-GOV-1
    title: Quorum bypass with TTL and auto‑revert
    labels: [mc, policy]
    assignees: [owner-sec, owner-release]
    points: 3
  - id: MC5-DX-1
    title: mc CLI (dr simulate/restore, evidence verify-offline)
    labels: [mc, developer-experience]
    assignees: [owner-dx]
    points: 5
```

---

## 11) Evidence & Reporting

- KPIs: DR RTO/RPO, mirror verify success %, #bypass events, integrity check pass %.
- Artifacts: evidence zips, Merkle roots, mirror configs, drill run URLs.
- Store under `docs/mc/evidence/2025-11-24/`.

---

## 12) Changelog

- **Added:** DR nightly drill; Sigstore mirror; quorum bypass policy; log chain.
- **Changed:** Promotion path supports cross‑region; evidence verification offline.
- **Fixed:** Gaps in DR readiness for supply‑chain gates.
