```md
# Maestro Conductor (MC) — Sprint Plan _(v1.0.0)_

**Slug:** `mc-sprint-2025-09-29-v1`  
**Date:** 2025-09-29 (America/Denver)  
**Owner/DRI:** Architect‑General  
**Teams:** Orchestrator Platform, SRE, Security, Data, UX  
**Horizon:** 10 workdays → **2025-09-29 → 2025-10-10**  
**Tracks:** A) Now‑value; B) Enduring moats

---

## 0) Context & Evidence Review (Repo Snapshot → Next Moves)

**Inputs reviewed**: `MAESTRO_PRODUCTION_READINESS.md`, `OPERATIONS_READINESS_COMPLETE_STATUS.md`, `SUMMIT_MAESTRO_DELIVERY_PLAN.md`, `MERGE_TRAIN_PLAN.md`, prior sprints (`SPRINT_MAESTRO_COMPOSER_BACKEND*.md`).

**State**

- Core orchestration, policy integration (OPA/ABAC), provenance scaffolding, SRE frameworks, and CI/CD gates are documented as **production‑ready**.
- Merge train completed; paved‑road patterns available across the monorepo. Ops/SLO baselines exist; golden dashboards are live.

**Gaps to close this sprint**

1. **Composer→MC E2E**: Draft→Validate→Publish→Dry‑Run→Execute path hardened with **immutable receipts** and **policy gates**.
2. **Receipts→Disclosure**: Move provenance receipts from alpha to **GA‑ready** (sign, store, export).
3. **Canary & Rollbacks**: Red/black + automated rollback hooks integrated with error budgets.
4. **Policy Packs (OPA)**: Shipping default guardrails (PII, residency, budget caps, runner quotas).
5. **Templates/Scaffolds**: CLI + repo templates that enforce golden path (SBOM, attestations, tests, runbooks).

**Definition of Success (binary)**

- Composer can publish a workflow **with signed, versioned manifest**, execute a **dry‑run** in MC, and launch a **canaried** production run with receipts and policy decisions attached.
- **Receipts** are **tamper‑evident**, exportable (disclosure pack), and verifiable (sigstore/cosign).
- **SLOs** wired into budgets; automated rollback proven in canary.

---

## 1) Objectives & Key Results

| #   | Objective       | KR (measurable)                                                                                   |
| --- | --------------- | ------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------- |
| A1  | Composer→MC E2E | 95% p95 publish‑to‑start < **5s**; schema‑valid manifests only; draft/publish lifecycle enforced  |
| A2  | Receipts GA     | 100% executions emit **signed** receipts; verifier passes in CI & prod; export pack < **2MB**/run |
| A3  | Canary+Rollback | Canary manager chooses safe rollout; automated rollback < **2 min** to green                      |
| B1  | Policy Packs    | 4 packs shipped (PII, Residency, Budget, Runner Quotas); deny+explain enabled                     |
| B2  | Templates       | `maestro new workflow                                                                             | service` scaffolds create green CI (SBOM, tests, policies) in < **2 min** |

---

## 2) Scope (In/Out)

**In**: API hardening; workflow schema & validator; OPA bundles; receipts signing/verification; canary/rollback integration; templates; dashboards; runbooks; release notes.  
**Out**: New runner types; UI feature work beyond required endpoints; multi‑cloud data plane expansion.

---

## 3) Swimlanes & Stories

> Each story carries DoR/DoD checklists and evidence artifacts.

### 3.1 Control Plane & DAG Engine (Backend)

- **MC‑CP‑101**: _Manifest v1 schema & validator_  
  **AC:** JSON Schema published; `POST /api/workflows` rejects invalid; semver enforced.  
  **DoR:** ADR‑001, test plan. **DoD:** schema doc, examples, 95% validator coverage.
- **MC‑CP‑102**: _Publish lifecycle_ (`draft→published`, immutable snapshot, provenance record)  
  **AC:** `/publish` bumps semver; snapshot content‑addressed; receipt ID returns.
- **MC‑CP‑103**: _Dry‑run executor_ (no side‑effects, full policy eval)  
  **AC:** Dry‑run produces plan, costs, policy decisions; no writes to external sinks.
- **MC‑CP‑104**: _Execute with receipts_  
  **AC:** Every step logs inputs/outputs digests; final **signed receipt** persisted & retrievable.

### 3.2 Runners & Sandboxes

- **MC‑RUN‑201**: _Resource classes & quotas_ (small/med/large)  
  **AC:** Quotas enforced via policy; deny with explain.
- **MC‑RUN‑202**: _Idempotency & retries_  
  **AC:** Exactly‑once via idempotency keys; exponential backoff; compensation hooks.

### 3.3 Policy & Provenance

- **MC‑POL‑301**: _OPA policy packs v1_  
  **AC:** Residency/PII/Budget/Quota packs load as bundles; unit tests + sample policies.
- **MC‑PROV‑302**: _Cosign signing of receipts_  
  **AC:** Receipts signed; `cosign verify --certificate-identity` passes.
- **MC‑PROV‑303**: _Disclosure exporter_  
  **AC:** `GET /api/executions/:id/disclosure.tgz` emits SBOM, receipt, policy proof, logs.

### 3.4 SDK/CLI & Templates

- **MC‑SDK‑401**: _`maestro` CLI: init/plan/run/status_  
  **AC:** `maestro init` writes golden files; `plan` validates; `run` hits control plane.
- **MC‑TPL‑402**: _Repo template_  
  **AC:** `maestro new workflow` creates repo with green CI and policy gate.

### 3.5 Observability & SRE (Release)

- **MC‑SRE‑501**: _Canary manager + rollback_  
  **AC:** Canary + red/black; automated rollback on budget breach; runbook updated.
- **MC‑SRE‑502**: _Golden dashboards_ (MC metrics, receipt counts, policy decisions)  
  **AC:** p95 latency, error budget burn, policy deny rate, receipt verification success.

### 3.6 Security & Compliance

- **MC‑SEC‑601**: _SBOMs & vuln budgets in CI_  
  **AC:** SBOM attached to artifact; CI blocks on budget; attestation stored.
- **MC‑SEC‑602**: _Secret scanning + drift detection_  
  **AC:** gitleaks/Trivy wired; drift alerting on infra.

---

## 4) Backlog Items (if ahead of schedule)

- Runtime cost governor, per‑tenant budgets with breach notifications.
- Executor sandboxing hardening (seccomp/apparmor profiles).
- Additional disclosure formats (CycloneDX attestations).

---

## 5) Milestones & Calendar (America/Denver)

- **Kickoff**: Mon 2025‑09‑29 10:00
- **Design/ADR Review**: Tue 09‑30 15:00
- **Mid‑sprint Evidence Review**: Fri 10‑03 16:00
- **Canary DR Drill**: Wed 10‑08 14:00
- **Sprint Review & Release**: Fri 10‑10 15:00
- **Retro**: Fri 10‑10 16:00

---

## 6) Required Evidence & Artifacts (per story)

- **ADR** (Architecture Decision Record) — numbered, signed.
- **C4 diagrams** — Context/Container/Component with threat model notes.
- **Test artifacts** — unit/integration/e2e, coverage.
- **Security** — SAST/DAST, secret scan, SBOM, vuln budget report.
- **Release** — notes, migration notes, rollback script.
- **Ops** — SLOs, dashboards, runbooks, canary proof.
- **Provenance** — cosign signature & verification log, attestation JSON.

---

## 7) Deliverables Directory Layout (scaffold)
```

apps/
mc-api/
openapi.yaml
src/
tests/
policy/
bundles/
residency/
pii/
budget/
quotas/
receipts/
mc-runner/
mc-cli/
composer-adapter/

infra/
helm/mc/
Chart.yaml
values.yaml
templates/
terraform/mc/
main.tf
variables.tf
outputs.tf

.github/workflows/
mc-ci.yml
mc-release.yml

policy/
rego/
tests/

docs/
adr/ADR-0001-manifest-schema.md
adr/ADR-0002-receipt-signing.md
c4/
runbooks/MC_RUNBOOK.md
slo/MC_SLO.yaml

scripts/
make_receipt.sh
verify_receipt.sh

```

---

## 8) Scaffolds & Templates

### 8.1 ADR template
```

# ADR-<number>: <decision title>

Date: 2025-09-29  
Status: Proposed | Accepted | Superseded  
Owners: <names>

## Context

<problem, constraints, goals, non-goals>

## Decision

<what we decided; include diagrams/links>

## Consequences

<trade-offs, risks, rollbacks>

## Alternatives Considered

<A, B, C>

````

### 8.2 Workflow Manifest (v1) — JSON Schema (excerpt)
```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://companyos/internal/maestro/manifest.v1.json",
  "type": "object",
  "required": ["name", "version", "tasks"],
  "properties": {
    "name": {"type": "string", "pattern": "^[a-zA-Z0-9-_]{3,64}$"},
    "version": {"type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-z0-9.]+)?$"},
    "inputs": {"type": "object"},
    "tasks": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "uses"],
        "properties": {
          "id": {"type": "string"},
          "uses": {"type": "string", "pattern": "^pkg:[a-z0-9-]+/.+@.+$"},
          "with": {"type": "object"},
          "needs": {"type": "array", "items": {"type": "string"}},
          "retries": {"type": "integer", "minimum": 0, "maximum": 10}
        }
      }
    }
  }
}
````

### 8.3 OPA Policy Pack — Residency (rego excerpt)

```rego
package mc.residency

default allow = false

allow {
  input.workflow.region == input.request.region
  not banned_country[input.request.region]
}

banned_country["RU"]
banned_country["KP"]
```

### 8.4 GitHub Actions — MC CI

```yaml
name: mc-ci
on:
  pull_request:
    paths:
      - 'apps/mc-**/**'
      - 'policy/**'
      - 'infra/**'
  push:
    branches: [main]

jobs:
  build-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: '20' }
      - run: npm ci
      - run: npm test --workspaces
      - name: SBOM (syft)
        run: |
          curl -sSfL https://raw.githubusercontent.com/anchore/syft/main/install.sh | sh -s -- -b ./bin
          ./bin/syft packages dir:. -o cyclonedx-json > sbom.json
      - name: Sign & attest (cosign)
        env:
          COSIGN_EXPERIMENTAL: '1'
        run: |
          curl -sSfL https://raw.githubusercontent.com/sigstore/cosign/main/install.sh | sh -s -- -b ./bin
          ./bin/cosign attest --predicate sbom.json --type cyclonedx ./dist/mc-api.tgz || true
      - name: Policy Gate (conftest)
        run: |
          curl -sSfL https://raw.githubusercontent.com/open-policy-agent/conftest/master/install.sh | sh -s -- -b ./bin
          ./bin/conftest test policy/ -p policy/rego
```

### 8.5 Helm values (canary + budgets)

```yaml
replicaCount: 6
canary:
  enabled: true
  weight: 10
  metrics:
    - name: error_rate
      threshold: 1.0
    - name: p95_latency_ms
      threshold: 900
budgets:
  errorBudgetMinutes: 30
  maxCostPerRunUSD: 1.50
```

### 8.6 Terraform module skeleton (mc)

```hcl
module "mc" {
  source = "./modules/mc"
  name   = var.name
  region = var.region

  tags = {
    service = "mc"
    owner   = var.owner
  }
}
```

### 8.7 OpenAPI (excerpt)

```yaml
paths:
  /api/workflows:
    post:
      operationId: createWorkflow
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Workflow'
      responses:
        '201': { description: Created }
  /api/workflows/{id}/publish:
    post:
      operationId: publishWorkflow
      responses:
        '200': { description: Published }
```

### 8.8 Runbook skeleton (MC_RUNBOOK.md)

```
# MC Production Runbook
## Service Overview
- APIs: /api/workflows, /api/executions
- Dependencies: Postgres, S3‑compatible store, OPA PDP

## SLOs
- Publish→Start p95 < 5s; Availability 99.9%

## Dashboards
- Grafana: MC Overview, Policy Decisions, Receipts

## Alerts
- High deny rate (>5% 10m)
- Receipt verification failure
- Error budget burn > 10% hour

## On‑Call
- Rotations, escalation matrix, sev levels

## Rollback
- `helm rollback mc <rev>`
- Canary manager auto‑rollback on breach (webhook)
```

---

## 9) Acceptance Criteria (global)

- All new code paths typed, unit + integration tests with coverage ≥ **85%** on critical paths.
- SBOM attached to every artifact; cosign verification succeeds in CI.
- OPA gate **blocking** on high‑risk violations; explain mode for low risk.
- SLO dashboards updated; synthetic probes green; canary + automated rollback demonstrated and recorded.

---

## 10) Risk Register & Mitigations

| Risk                    | Likelihood | Impact | Mitigation                                          |
| ----------------------- | ---------- | ------ | --------------------------------------------------- |
| Receipt signing latency | M          | M      | Async signer + queue; budgeted <250ms               |
| Policy false negatives  | L          | H      | Deny‑by‑default for sensitive paths, staged rollout |
| Schema drift            | M          | M      | JSON Schema in repo + contract tests                |
| Canary misconfig        | L          | H      | Default safe weights + preflight checks             |

---

## 11) Reporting & Evidence Links (to fill during sprint)

- ADRs: `/docs/adr/ADR-0001`, `/docs/adr/ADR-0002`, ...
- Receipts samples: `/apps/mc-api/receipts/*`
- Dashboards: `Grafana/mc-*`
- Release: `releases/mc-<semver>`

---

## 12) Jira Import (CSV minimal)

```
Summary,Issue Type,Parent,Labels,Description
Manifest v1 schema,Story,EPIC-SM-WF,mvp;mc,See AC in sprint doc
Publish lifecycle,Story,EPIC-SM-CP,mvp;mc,See AC in sprint doc
Dry-run executor,Story,EPIC-SM-RUN,mvp;mc,See AC in sprint doc
Receipts signing,Story,EPIC-SM-PROV,ga;mc,See AC in sprint doc
Policy packs v1,Story,EPIC-SM-POL,ga;mc,See AC in sprint doc
Canary manager+rollback,Story,EPIC-SM-REL,mvp;mc,See AC in sprint doc
```

---

## 13) DoR / DoD (attach to every story PR)

**DoR**

- Problem statement & ROI
- ADR draft linked
- Test strategy & observability plan
- Data classification & policy annotations
- Rollout/rollback owner

**DoD**

- Green CI with SBOM & attestations
- SLO dashboards updated; alerts tested
- Runbook updated; release notes written
- Post‑deploy validation evidence archived

---

## 14) Commands (paved road)

```bash
# Validate schema locally
maestro plan -m workflow.yaml

# Create signed receipt (dev)
./scripts/make_receipt.sh workflow.yaml > receipt.json
cosign sign-blob --yes receipt.json > receipt.sig
cosign verify-blob --signature receipt.sig receipt.json

# Canary rollout
helm upgrade mc ./infra/helm/mc -f values.canary.yaml

# Automated rollback (simulate budget breach)
curl -X POST $CANARY_WEBHOOK -d '{"breach":true}'
```

---

## 15) Release Notes Template

```
# MC <version>
## Highlights
- ...
## Changes
- ...
## Security
- SBOM: ...; CVE budget: ...
## Ops
- SLO deltas: ...; canary results: ...
## Migrations
- ...
```

---

> Logistics wins; evidence speaks. Ship.

```

```
