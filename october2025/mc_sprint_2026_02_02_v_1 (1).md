---
slug: mc-sprint-2026-02-02-v1
version: 1.0.0
date: 2026-02-02
status: Proposed
owner: Platform Eng • DevSecOps (MC)
confidentiality: Internal
---

# MC Sprint Plan — v28.2 Secrets Lifecycle, Red‑Team (Defensive) & Auto‑Containment

> Theme: **Automate key/secret hygiene, simulate compromise, and auto‑contain blast radius.** Tie lineage to revocations, add session‑bound deploy auth, and deliver runbooks + tests that prove recovery without collateral harm.

**Scope anchor:** `/orchestrations/mc`  
**Prereqs:** v28.1 ABAC + provenance graph in place; OIDC‑only builds enabled  
**Timebox:** 2 weeks (Feb 2–Feb 13, 2026, America/Denver)

---

## 0) Retro Snapshot (from 2026‑01‑19)

- ✅ ABAC admission in Audit→Enforce on canary clusters; initial egress allow‑lists.  
- ✅ Neo4j lineage MVP and `mc graph why` working.  
- ⚠️ Attestation enrichment deployed for 70% of services.  
- ❌ No automated secret rotation/containment paths; incident drills manual.

---

## 1) Sprint Goals (Outcomes)

1. **Secrets lifecycle automation**: rotate CI/CD ephemeral creds (OIDC only), eliminate static tokens, and add 30‑day rotation SLO with evidence.  
2. **Assume‑breach drill**: token‑leak simulation in a canary service with **auto‑containment** (revoke → isolate → rebuild) and ≤ **30 min rollback**.  
3. **Session‑bound deploys**: bind deploy approvals to **WebAuthn + device + time**; prevent replay.  
4. **Lineage‑aware revocations**: given a compromised digest or key, list and block all descendant artifacts and running workloads within 10 minutes.  
5. **Counter‑influence v2**: correlate PR/ticket narratives with risk events; advisory alerts + training links.

---

## 2) Swimlanes

### A) Secrets & Identity (Owner: CI Guild + SecOps)
- OIDC audiences/claims tightened; remove static secrets; auto‑rotation playbooks and GitHub org rules.

### B) Auto‑Containment & Quarantine (Owner: SRE + Platform)
- NetworkPolicy isolate flows; scale‑to‑zero canary; artifact quarantine label; automated rollback script.

### C) Lineage‑Aware Revocation (Owner: Data/Graph + DevSecOps)
- Neo4j queries + webhook that marks descendants **non‑promotable**; Argo block with reason.

### D) Session‑Bound Deploys (Owner: Release + SecOps)
- Step‑up WebAuthn challenge; bind approval JWT to user+device+time; verify at CD gate.

### E) Counter‑Influence v2 & Training (Owner: SecOps + DX)
- Pattern detection tied to incidents; generate non‑accusatory advisories and short micro‑lessons.

---

## 3) User Stories & Acceptance Criteria

> ID: `MC10-<lane>-<n>`

### Secrets & Identity
1. **MC10-ID-1** — *Static secret eradication*
   - **AC:** Zero PATs/long‑lived secrets in workflows; scanner proves 0 findings; exceptions require waiver TTL ≤ 7d.
2. **MC10-ID-2** — *Rotation SLO*
   - **AC:** Evidence shows all rotatable creds touched within 30 days; dashboard panel added.

### Auto‑Containment & Quarantine
3. **MC10-CT-1** — *Quarantine flow*
   - **AC:** `mc contain <service>` applies NetworkPolicy isolate, scales canary to zero, flips `promotable=false` label; rollback works in ≤ 30m.

### Lineage‑Aware Revocation
4. **MC10-LIN-1** — *Descendant block*
   - **AC:** Given digest or key id, graph job marks descendants non‑promotable; Argo denies; evidence stored.

### Session‑Bound Deploys
5. **MC10-DEP-1** — *WebAuthn‑bound approval*
   - **AC:** Deploy requires WebAuthn; CD gate validates signed approval JWT (exp ≤ 30m, nonce checked).

### Counter‑Influence v2
6. **MC10-CINF-1** — *Risk‑correlated advisories*
   - **AC:** When a security incident label appears, PR/ticket analyzer posts advisory with neutral wording + training link.

---

## 4) Deliverables & Artifacts

- **Workflows**: `.github/workflows/rotation-report.yml`, `.github/workflows/session-approval.yml`.  
- **CLI**: `cmd/mc/contain`, `cmd/mc/revoke --digest|--key`.  
- **Graph**: `graph/jobs/revoke-descendants.ts`.  
- **Policies**: `k8s/network/quarantine.yaml`, `policy/opa/deploy-approval.rego`.  
- **Dashboards**: `dashboards/mc-identity.json`, `dashboards/mc-containment.json`.  
- **Runbooks**: `docs/mc/runbooks/assume-breach.md` (contain → eradicate → recover).

---

## 5) Scaffolds & Snippets

### A) Rotation Report (secrets = 0, OIDC only)
```yaml
# file: .github/workflows/rotation-report.yml
name: Rotation Report
on: { schedule: [{ cron: '17 2 * * *' }], workflow_dispatch: {} }
jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Scan for long-lived secrets
        uses: zricethezav/gitleaks-action@v2
      - name: Verify OIDC‑only
        run: |
          if grep -R "AWS_SECRET_ACCESS_KEY\|DOCKER_PASSWORD" .github/workflows; then exit 1; fi
      - name: Emit metric
        run: echo "mc_secret_longlived=0" # placeholder to push to prometheus pushgateway
```

### B) Quarantine NetworkPolicy (isolate workload)
```yaml
# file: k8s/network/quarantine.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata: { name: quarantine }
spec:
  podSelector: { matchLabels: { mc.quarantine: 'true' } }
  policyTypes: [Ingress, Egress]
  ingress: []
  egress: []
```

### C) `mc contain` (skeleton)
```ts
// file: cmd/mc/contain.ts
import { execSync } from 'node:child_process';
export default function contain(svc: string){
  execSync(`kubectl -n ${svc} label deploy ${svc} mc.quarantine=true --overwrite`);
  execSync(`kubectl -n ${svc} scale deploy ${svc} --replicas=0`);
  console.log('Quarantine applied');
}
```

### D) Revocation Job (descendants → non‑promotable)
```ts
// file: graph/jobs/revoke-descendants.ts
import neo4j from 'neo4j-driver';
const drv = neo4j.driver(process.env.NEO4J_URI!, neo4j.auth.basic(process.env.NEO4J_USER!, process.env.NEO4J_PASS!));
export async function revokeByDigest(d: string){
  const s = drv.session();
  await s.run(`MATCH (i:Image {digest:$d})-[:PARENT_OF*0..]->(c:Image)
               SET c.promotable=false, c.revokedAt=timestamp()`, { d });
  await s.close(); await drv.close();
}
```

### E) Deploy Approval Policy (OPA)
```rego
# file: policy/opa/deploy-approval.rego
package deploy

default allow := false

valid(jwt) {
  jwt.exp <= time.now() + 1800
  jwt.binds.device_id != ""
  jwt.binds.user != ""
  jwt.nonce == input.expected_nonce
}

allow { valid(input.jwt) }
```

### F) Session‑Bound Approval (workflow excerpt)
```yaml
# file: .github/workflows/session-approval.yml
name: Session Approval
on: [workflow_dispatch]
jobs:
  approve:
    runs-on: ubuntu-latest
    permissions: { id-token: write, contents: read }
    steps:
      - name: WebAuthn Challenge
        run: echo "(placeholder) prompt approver with WebAuthn; mint short‑lived JWT"
      - name: Attach approval JWT
        run: echo "JWT=eyJ..." >> $GITHUB_OUTPUT
```

---

## 6) Observability & Dashboards

```json
// file: dashboards/mc-identity.json
{ "title": "MC Identity & Secrets", "panels": [
  {"type":"stat","title":"Long-lived secrets (findings)","targets":[{"expr":"mc_secret_longlived"}]},
  {"type":"graph","title":"OIDC Adoption %","targets":[{"expr":"100 * mc_oidc_runs / mc_total_runs"}]}
]}
```

```json
// file: dashboards/mc-containment.json
{ "title": "MC Auto-Containment", "panels": [
  {"type":"stat","title":"Containment MTTR (min)","targets":[{"expr":"mc_containment_mttr_minutes"}]},
  {"type":"table","title":"Revoked Artifacts","targets":[{"expr":"mc_revoked_artifacts"}]}
]}
```

---

## 7) Risks & Mitigations

1. **Quarantine overreach** — start with label‑based opt‑in; clear rollback; owner approvals.  
2. **False revocations** — dry‑run graph job; require two‑person review for bulk actions.  
3. **WebAuthn rollout friction** — pilot with release managers; provide fallback advisory mode for first week.  
4. **Secret scanners noisy** — maintain baseline allow‑list + TTL; weekly trend reporting.

---

## 8) DOD, Gates & Rollback

**DOD**
- [ ] Long‑lived secrets = 0; rotation SLO evidence published.  
- [ ] Auto‑containment drill completes with ≤ 30m rollback.  
- [ ] Revocation job marks descendants non‑promotable; Argo blocks; evidence stored.  
- [ ] Session‑bound deploy approvals verified at gate.  
- [ ] Counter‑influence v2 advisories live.

**Rollback**
- Disable quarantine label processing; set `REVOCATION_ENFORCE=false`; revert deploy approval gate to advisory; pause rotation workflow.

---

## 9) Timeline & Capacity (2 weeks)

- **D1–D3:** Secrets scan clean‑up; OIDC claim tightening; rotation report.  
- **D4–D6:** Quarantine path + `mc contain`; revocation job + Argo deny.  
- **D7–D8:** WebAuthn session approvals; deploy gate.  
- **D9–D10:** Drill, dashboards, docs, demo & retro.

**Estimate:** 26–30 pts across Platform, Sec, CI, SRE, DX.

---

## 10) Ticket Seed (importable)

```yaml
# file: .project/tickets/mc-sprint-2026-02-02.yaml
sprint: mc-2026-02-02
board:
  columns: [Backlog, Ready, In Progress, Review, Blocked, Done]
issues:
  - id: MC10-ID-1
    title: Eradicate static secrets from workflows
    labels: [mc, identity]
    assignees: [owner-ci]
    points: 5
  - id: MC10-ID-2
    title: Rotation SLO and dashboard
    labels: [mc, identity, observability]
    assignees: [owner-sec]
    points: 3
  - id: MC10-CT-1
    title: Auto-containment flow (`mc contain`)
    labels: [mc, sre]
    assignees: [owner-sre, owner-platform]
    points: 6
  - id: MC10-LIN-1
    title: Lineage-aware revocation job
    labels: [mc, graph]
    assignees: [owner-ci, owner-sec]
    points: 6
  - id: MC10-DEP-1
    title: WebAuthn-bound deploy approvals
    labels: [mc, release, identity]
    assignees: [owner-release, owner-sec]
    points: 4
  - id: MC10-CINF-1
    title: Counter-influence v2 advisories
    labels: [mc, security]
    assignees: [owner-sec, owner-dx]
    points: 2
```

---

## 11) Evidence & Reporting

- KPIs: long‑lived secret findings, rotation SLO %, containment MTTR, #revoked artifacts, session‑bound deploy coverage.  
- Artifacts: rotation reports, quarantine/rollback logs, graph job outputs, gate logs, advisory posts.  
- Store under `docs/mc/evidence/2026-02-02/`.

---

## 12) Changelog

- **Added:** Auto‑containment, lineage‑aware revocation, session‑bound deploys.  
- **Changed:** Secrets lifecycle automated with rotation SLO.  
- **Fixed:** Residual static secrets and manual incident flow.

