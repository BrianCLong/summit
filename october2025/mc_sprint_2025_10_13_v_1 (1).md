---
slug: mc-sprint-2025-10-13-v1
version: 1.0.0
date: 2025-10-13
status: Proposed
owner: Platform Eng • DevSecOps (MC)
confidentiality: Internal
---

# MC Sprint Plan — v27.2 Rollout & Enforcement

> Theme: **Adopt MC everywhere** (migration + enforcement), **backfill provenance**, and **codify waivers** with TTL. Default to defense, auditability, and least privilege.

**Scope anchor:** `/orchestrations/mc`  
**Baseline sprint:** `mc-sprint-2025-09-29-v1`  
**Timebox:** 2 weeks (Oct 13–Oct 24, 2025, America/Denver)

---

## 0) Retro Snapshot (from 2025‑09‑29)

- ✅ Shipped schema v27.1, SBOM gate, cosign verify, project scaffolds, PR bundles.
- ⚠️Partial: SLSA provenance verify in CD; org-wide CODEOWNERS; dashboards tuned.
- ❌Not done: Repo‑wide migration to MC; waiver registry & TTL checks; Argo PreSync hook in all apps.

**Carry‑over risks:** scanner false positives, policy drift, long CI on mono repos.

---

## 1) Sprint Goals (Outcomes)

1. **Org‑wide MC adoption ≥ 80% of active repos** (measured by CI runs invoking MC reusable workflow).
2. **Enforce gates in prod**: provenance verified, signatures valid, SBOM policy clean or approved waiver.
3. **Backfill provenance** for last 30 days of images; mark non‑attestable images **non‑promotable**.
4. **Waiver registry** with TTL + owners + auto‑reminder; conftest tests for expiry.
5. **Operator UX**: MC Overview dashboard v1 + alert on gate failures; PR comment bundle standardized.

---

## 2) Swimlanes

### A) Migration & Adoption (Owner: Platform)

- Repo discovery → create PRs to adopt MC reusable workflow.
- Paths‑filter tuning; merge‑queue status wiring.

### B) Enforcement & Waivers (Owner: DevSecOps)

- Turn on **enforce** in prod profiles; advisory in dev.
- Implement waiver registry + TTL check; audit report.

### C) Provenance Backfill (Owner: CI Guild)

- Generate attestations for recent images; verify + tag promotable.

### D) Observability v2 (Owner: SRE)

- Grafana panels (runs, failures, time to green); PromQL alert rules; evidence packet export.

### E) Developer Experience v2 (Owner: DX)

- `mc` CLI commands `plan`, `dry-run`, and `open-logs`; quickstarts per service.

---

## 3) User Stories & Acceptance Criteria

> ID format: `MC2-<lane>-<n>`

### Migration & Adoption

1. **MC2-MIG-1** — _Detect repos lacking MC and open PRs_
   - **AC:** Script lists repos; PRs created with `_reusable-ci-security.yml` call; CODEOWNERS tagged.
   - **Artifacts:** `.scripts/find-and-prepare-mc.sh`, PR template body.
2. **MC2-MIG-2** — _Adoption ≥ 80%_
   - **AC:** Dashboard shows ≥80% repos ran MC workflow ≥1× this sprint.

### Enforcement & Waivers

3. **MC2-ENF-1** — _Enable enforce in prod_
   - **AC:** Prod runs block on failed verify/SBOM; dev emits advisory.
4. **MC2-ENF-2** — _Waiver registry with TTL_
   - **AC:** `policy/waivers.yaml` validated; expired waivers fail; weekly reminder issue filed.

### Provenance Backfill

5. **MC2-PROV-1** — _Backfill last 30 days_
   - **AC:** Script walks image digests; attestations present; non‑attestable labeled; report stored.

### Observability v2

6. **MC2-OBS-1** — _Dashboard & alert rules_
   - **AC:** Panels for runs, gate failures, median CI, top failing rules; alert on spike >0.5/10m.

### Developer Experience v2

7. **MC2-DX-1** — _`mc` CLI plan/dry‑run_
   - **AC:** `mc plan` prints DAG; `mc dry-run` executes without side‑effects; examples pass.

---

## 4) Deliverables & Artifacts

- `.scripts/find-and-prepare-mc.sh` — discover + PR open.
- `.github/workflows/_reusable-ci-security.yml` — tuned with enforce flags per env.
- `policy/waivers.yaml` + `policy/tests/waiver_expiry_test.yaml`.
- `dashboards/mc-overview.json`, `alerts/mc-rules.yaml` (v2).
- `cmd/mc` CLI (plan/dry-run/logs).
- Evidence reports: `docs/mc/evidence/2025-10-13/*.md`.

---

## 5) Scaffolds & Templates

```bash
# file: .scripts/find-and-prepare-mc.sh
set -euo pipefail
ORG="${ORG:-acme}"
REPOS=$(gh repo list "$ORG" --limit 200 --json name -q '.[].name')
for r in $REPOS; do
  gh api repos/$ORG/$r/contents/.github/workflows --silent >/dev/null || continue
  if ! gh api repos/$ORG/$r/contents/.github/workflows/_reusable-ci-security.yml --silent >/dev/null; then
    gh pr create -R $ORG/$r -t "chore(mc): adopt MC reusable workflow" -b "This PR wires MC gates. See runbook." -H mc/adopt || true
  fi
done
```

```yaml
# file: policy/tests/waiver_expiry_test.yaml
input:
  findings:
    - component: { name: demo, digest: sha256:deadbeef }
      severity: HIGH
      fixed_version: ''
  waivers:
    - digest: sha256:deadbeef
      created: 2025-10-06T00:00:00Z
      ttl_ns: 604800000000000 # 7d (expired by sprint start)
expect:
  allow: false
```

```yaml
# file: .github/workflows/release-verify.yml
name: Release Verify
on:
  workflow_dispatch:
    inputs:
      { image_digest: { description: 'ghcr image digest', required: true } }
jobs:
  verify:
    runs-on: ubuntu-latest
    permissions: { contents: read, id-token: write }
    steps:
      - uses: actions/checkout@v4
      - uses: sigstore/cosign-installer@v3
      - run: |
          IMAGE="ghcr.io/${{ github.repository }}@${{ inputs.image_digest }}"
          cosign verify "$IMAGE" --certificate-oidc-issuer=https://token.actions.githubusercontent.com
          cosign verify-attestation "$IMAGE" --certificate-oidc-issuer=https://token.actions.githubusercontent.com
```

---

## 6) Risks & Mitigations (v2)

1. **Adoption stalls** → add PR bot + office hours; track % adoption daily.
2. **Expired waivers block releases** → pre‑flight report + Slack reminder 48h prior.
3. **Longer CI times** → enable caching, parallelize scanners, use SBOM diffing.
4. **Legacy images lack provenance** → mark non‑promotable; emergency waiver reviewed by Release Mgr + DevSecOps.

---

## 7) DOD, Gates & Rollback

**DOD**

- [ ] ≥80% repos on MC workflow.
- [ ] Prod enforce enabled and observed blocking behavior.
- [ ] Waiver tests pass; expired waivers fail as expected.
- [ ] Backfill report saved; non‑promotable list published.
- [ ] Dashboards & alerts deployed.

**Rollback**

- Feature flag: `MC_ENFORCE=false` for org; revert PRs via merge‑queue batch.
- Keep advisory mode script `scripts/disable-enforce.sh` for 15‑min restore.

---

## 8) Timeline & Capacity (2 weeks)

- **D1–D3:** Repo discovery + PRs; CLI plan/dry‑run MVP.
- **D4–D6:** Enforce in prod; waiver registry + tests.
- **D7–D9:** Provenance backfill; dashboards & alerts.
- **D10:** Canary verification; demo & retro.

**Estimate:** 26–30 pts across Platform, Sec, CI, SRE, DX.

---

## 9) Ticket Seed (importable)

```yaml
# file: .project/tickets/mc-sprint-2025-10-13.yaml
sprint: mc-2025-10-13
board:
  columns: [Backlog, Ready, In Progress, Review, Blocked, Done]
issues:
  - id: MC2-MIG-1
    title: Detect & PR repos to adopt MC
    labels: [mc, migration]
    assignees: [owner-platform]
    points: 5
  - id: MC2-MIG-2
    title: Achieve 80% adoption
    labels: [mc, migration, kpi]
    assignees: [owner-platform]
    points: 3
  - id: MC2-ENF-1
    title: Enable enforce mode in prod
    labels: [mc, enforce]
    assignees: [owner-sec]
    points: 5
  - id: MC2-ENF-2
    title: Waiver registry with TTL + reminders
    labels: [mc, supply-chain, policy]
    assignees: [owner-sec]
    points: 5
  - id: MC2-PROV-1
    title: Backfill attestations for last 30 days
    labels: [mc, provenance]
    assignees: [owner-ci]
    points: 5
  - id: MC2-OBS-1
    title: MC Overview v2 + alert rules
    labels: [mc, observability]
    assignees: [owner-sre]
    points: 4
  - id: MC2-DX-1
    title: mc CLI plan/dry-run/logs
    labels: [mc, developer-experience]
    assignees: [owner-dx]
    points: 3
```

---

## 10) Snippets (Policy & Actions)

### A) OPA: Waiver TTL enforcement (extend)

```rego
package supplychain

expired_waiver[w] {
  some w in input.waivers
  time.now_ns() >= time.add_ns(w.created, w.ttl_ns)
}

violation[msg] {
  some f in input.findings
  (f.severity == "CRITICAL" or f.severity == "HIGH")
  not waived(f.component.digest)
  msg := sprintf("Blocked: %s %s", [f.component.name, f.severity])
}

waived(d) { some w in input.waivers; w.digest == d; not expired_waiver[w] }
allow { count(violation) == 0 }
```

### B) PR Body Template (migration)

```md
This PR wires **MC reusable workflow** with SBOM + signature + provenance gates.

- Dev: advisory only; Prod: enforce.
- Docs: `/docs/mc/getting-started.md`
- Rollback: set `MC_ENFORCE=false`.
```

---

## 11) Tabletop Drill (Assume‑Breach)

- Scenario: token leak in CI runner → malicious artifact published.
- Drill steps: rotate tokens → verify old artifacts non‑promotable → rebuild with provenance → staged restore 1→10→50→100%.
- Metrics: MTTA < 10m, MTTR < 60m; no unauthorized promotion.

---

## 12) Evidence & Reporting

- KPIs: adoption %, failed→fixed gates count, median CI duration, #expired waivers.
- Artifacts: run URLs, digests, attestation logs, policy test outputs, dashboard screenshots.
- Store under `docs/mc/evidence/2025-10-13/`.

---

## 13) Changelog (to be updated during sprint)

- **Added:** Waiver TTL checks; migration bot; backfill scripts.
- **Changed:** Enforce in prod; dashboards v2.
- **Fixed:** Missing provenance verify before release.
