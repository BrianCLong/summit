````md
# Maestro Conductor (MC) — Sprint Plan _(v1.0.0)_

**Slug:** `mc-sprint-2026-01-19-v1`  
**Dates (America/Denver):** 2026-01-19 → 2026-01-30  
**Owner/DRI:** Architect‑General  
**Teams:** Orchestrator Platform, SRE, Security, Data, UX  
**Tracks:** A) Now‑value; B) Enduring moats  
**Prereq:** `mc-0.7.0` shipped (multi‑cloud runners AWS+GCP, policy simulate/staged enforce, showback, SLSA3 gates, DSR pipeline, flag hygiene)

---

## 0) Context & Carry‑Forward

**Done**: AWS+GCP runner parity, staged enforce toggles, cost exports + drift <= 7% on top flows, SLSA3 release gates, DSR intake→redaction→evidence, flag registry & janitor, 10k conc p95 < 3.8s.  
**Carry‑forward**: GCP runner perf tail p99 spikes; DSR anonymize edge‑cases for nested logs; showback model documentation.

---

## 1) Objectives & Key Results

| #   | Objective                      | KR (measurable)                                                                                                   |
| --- | ------------------------------ | ----------------------------------------------------------------------------------------------------------------- |
| A1  | **Azure Runner (preview)**     | Azure driver executes parity suite; residency + egress policies enforced; p95 publish→start < **4.2s** at 2k conc |
| A2  | **Policy Change Safety Rails** | Sim→Warn→Enforce rollout automation; policy mis‑config MTTR < **30m**; false‑allow rate **0.0%** in canary        |
| A3  | **Customer SLAs & Credits**    | Per‑tenant SLA tracking + auto credit calc; credit issuance workflow; 100% incidents produce signed credit notes  |
| B1  | **Provenance Graph v1**        | Store graph across manifests, packages, receipts, bundles; query p95 < **350ms** on 20M edges                     |
| B2  | **Estimator v2 (hybrid)**      | Add feature‑based model + guardrails; drift ≤ **±5%** on top 10 workflows; graceful fallback to v1                |
| B3  | **Secrets & KMS Discipline**   | Rotate signing & runner KMS keys; enforce envelope encryption for receipts/logs; rotation evidence captured       |

---

## 2) Scope (In/Out)

**In**: Azure driver module, policy rollout controller, SLA tracking & credits, provenance graph store & API, estimator v2 with fallback, KMS rotation playbooks & automation, observability & runbooks, Jira scaffolds.  
**Out**: UI console write features beyond existing; cross‑account marketplace; ML autoscaling.

---

## 3) Epics, Swimlanes & Stories

### 3.1 Multi‑Cloud Runner — Azure (Preview)

- **MC‑AZ‑1301**: _Azure driver (AKS/ACI) implementation_  
  **AC:** Contract tests pass (provision/execute/collect); network egress allowlist + RO FS enforced; receipts parity.
- **MC‑AZ‑1302**: _Residency & placement policy_  
  **AC:** OPA placement adds `cloud=AZURE`; allowed regions list; deny with explain if mismatch.
- **MC‑AZ‑1303**: _Perf validation_  
  **AC:** 2k conc publish→start p95 < 4.2s; queue p95 < 900ms.

### 3.2 Policy Change Safety Rails

- **MC‑POL‑1311**: _Rollout controller_  
  **AC:** Automates phase gates (sim→warn→enforce) by tenant/percentile; abort on deny spike; emits audit events.
- **MC‑POL‑1312**: _Mis‑config guard_  
  **AC:** Static checks + conftest against pack annotations; CI blocks risky patterns; hot rollback script.

### 3.3 Customer SLAs & Credits

- **MC‑SLA‑1321**: _SLA budget calculator_  
  **AC:** Tracks availability/latency vs plan; breach amount computed per tenant/day.
- **MC‑SLA‑1322**: _Credit workflow & attestation_  
  **AC:** `POST /api/credits` issues signed credit note; attached to disclosure pack.

### 3.4 Provenance Graph v1

- **MC‑PRG‑1331**: _Graph store & ingest_  
  **AC:** Nodes: {manifest, package, execution, receipt, bundle}; Edges: {uses, produces, signs, verifies}.
- **MC‑PRG‑1332**: _Graph query API_  
  **AC:** `GET /api/provenance/graph?node=<id>&depth=...` returns subgraph JSON; filtered by tenant.

### 3.5 Estimator v2 (Hybrid)

- **MC‑EST‑1341**: _Feature model + guardrails_  
  **AC:** Linear + rules; drift ≤ 5% on target set; auto‑fallback when confidence < threshold.
- **MC‑EST‑1342**: _Backtest & calibration_  
  **AC:** 90‑day backtest; report attached; CI drift alerts.

### 3.6 Secrets & KMS Discipline

- **MC‑KMS‑1351**: _Key rotation automation_  
  **AC:** Rotate signer & S3/GCS/Azure KMS keys; zero downtime; attest rotation in audit.
- **MC‑KMS‑1352**: _Envelope encryption enforcement_  
  **AC:** All receipts/logs encrypted; policy denies unencrypted writes.

### 3.7 SRE & Ops

- **MC‑SRE‑1361**: _Policy rollout GameDay_  
  **AC:** Inject bad rule; controller halts at WARN; MTTR < 30m proven.
- **MC‑SRE‑1362**: _Azure failback drill_  
  **AC:** Drain Azure; rebalance to AWS/GCP; SLOs honored.

---

## 4) Milestones (America/Denver)

- **Kickoff**: Mon 2026‑01‑19 10:00
- **Design/ADR Review**: Tue 01‑20 15:00
- **Mid‑sprint Evidence Review**: Fri 01‑23 16:00
- **GameDay (Policy Rails)**: Wed 01‑28 14:00
- **Sprint Review & Release**: Fri 01‑30 15:00
- **Retro**: Fri 01‑30 16:00

---

## 5) Artifacts & Scaffolds

### 5.1 Azure Driver Skeleton (Go)

`apps/mc-runner/driver/azure/azure.go`

```go
package azure
import (
  "context"
  "github.com/company/mc/driver"
)

type Azure struct{}
func (a *Azure) Provision(ctx context.Context, cfg driver.Config) error { /* TODO */ return nil }
func (a *Azure) Execute(ctx context.Context, p []byte) (driver.Result, error) { /* TODO */ return driver.Result{}, nil }
func (a *Azure) CollectLogs(ctx context.Context, execID string) (string, error) { return "", nil }
```
````

### 5.2 Placement Policy (Rego delta)

`policy/rego/placement.rego` (add)

```rego
allowed("AZURE", r) { r == "eastus" }
```

### 5.3 OpenAPI (deltas)

`apps/mc-api/openapi.deltas.yaml`

```yaml
paths:
  /api/policy/rollout:
    post: { summary: Advance or abort policy rollout phase }
  /api/credits:
    post: { summary: Issue a signed SLA credit note }
  /api/provenance/graph:
    get:
      summary: Fetch provenance subgraph
      parameters:
        - in: query
          name: node
          required: true
          schema: { type: string }
        - in: query
          name: depth
          schema: { type: integer, minimum: 1, maximum: 5 }
```

### 5.4 Graph Model (JSON Schema)

`docs/provenance/GRAPH.schema.json`

```json
{
  "$id": "https://companyos/internal/mc/provenance.graph.v1.json",
  "type": "object",
  "required": ["nodes", "edges"],
  "properties": {
    "nodes": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "kind"],
        "properties": {
          "id": { "type": "string" },
          "kind": {
            "type": "string",
            "enum": ["manifest", "package", "execution", "receipt", "bundle"]
          }
        }
      }
    },
    "edges": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["from", "to", "type"],
        "properties": {
          "from": { "type": "string" },
          "to": { "type": "string" },
          "type": {
            "type": "string",
            "enum": ["uses", "produces", "signs", "verifies"]
          }
        }
      }
    }
  }
}
```

### 5.5 Estimator v2 Guardrail (pseudocode)

`apps/mc-estimator/hybrid.ts`

```ts
export function estimate(features: number[], v1: number) {
  const v2 = dot(features, weights);
  const conf = confidence(features);
  return conf >= 0.7 ? clamp(v2, v1 * 0.5, v1 * 1.5) : v1;
}
```

### 5.6 SLA Credit Note (JSON)

`docs/sla/CREDIT_NOTE.sample.json`

```json
{
  "tenant": "acme",
  "period": "2026-01-19/2026-01-25",
  "breach": { "availability": 99.7, "target": 99.9 },
  "creditUSD": 123.45,
  "signature": "BASE64..."
}
```

### 5.7 KMS Rotation Playbook

`docs/security/KMS_ROTATION.md`

```md
- Keys: signer, receipts‑bucket, logs‑bucket, index store.
- Steps: create new key → update aliases → rolling restart → verify → schedule old key revoke.
- Evidence: cosign verify; KMS key list with creation time; audit events.
```

### 5.8 Policy Rollout Controller (spec)

`docs/policy/ROLLOUT_CONTROLLER.md`

```md
Phases: simulate → warn → enforce  
Advances when: deny rate delta < 0.2% & error budget stable  
Aborts when: deny spike > 2x baseline or p95 eval > 50ms
```

---

## 6) Observability & SLOs (adds)

- Metrics: `mc_azure_runs_total`, `mc_policy_rollout_phase`, `mc_sla_breach_usd`, `mc_graph_query_ms`, `mc_estimator_drift`, `mc_kms_rotations_total`.
- Dashboards: Azure runner perf; Policy rollout safety; SLA credits; Provenance graph latency; Estimator drift; KMS rotation status.
- Alerts: rollout abort; Azure p95 > 4.2s; graph p95 > 350ms; estimator drift > 5%; pending KMS rotation > 7d.

---

## 7) Security & Compliance

- Key rotations logged & attested; receipts/logs encrypted with envelope keys; provenance graph access ABAC‑guarded.
- SLA credits treat as financial artifacts — signed, verifiable, exportable to disclosure pack.

---

## 8) GameDay & Drills

- **Policy rails**: introduce breaking pack; rollout controller halts in WARN; MTTR < 30m.
- **Azure failback**: blackhole AKS; recovery to AWS/GCP with SLOs intact.
- **Estimator guardrail**: force low‑confidence inputs; fallback to v1 observed.

---

## 9) Release & Rollback

- Tag: `mc-0.8.0`.
- Flags: `runner_azure_preview`, `policy_rollout_controller`, `provenance_graph_v1`, `estimator_v2`, `sla_credits`.
- Rollback: disable flags; revert to AWS/GCP only; estimator v1; credits API read‑only.

---

## 10) Jira Import (CSV)

```csv
Summary,Issue Type,Parent,Labels,Description
Azure driver (AKS/ACI),Story,EPIC-MC-AZ,mc;multicloud,Implement Azure runner with parity
Placement policy for AZURE,Story,EPIC-MC-AZ,mc;policy,Residency+region rules for Azure
Azure perf validation,Story,EPIC-MC-AZ,mc;perf,2k conc p95 < 4.2s
Policy rollout controller,Story,EPIC-MC-POL,mc;policy,Automate sim→warn→enforce
Policy mis-config guard,Story,EPIC-MC-POL,mc;policy,Static checks + hot rollback
SLA budget calculator,Story,EPIC-MC-SLA,mc;sla,Compute per-tenant breaches
Credit issuance API,Story,EPIC-MC-SLA,mc;sla,Signed credit notes API
Provenance graph store,Story,EPIC-MC-PRG,mc;provenance,Ingest nodes/edges
Provenance graph API,Story,EPIC-MC-PRG,mc;provenance,Query subgraph endpoint
Estimator v2 hybrid,Story,EPIC-MC-EST,mc;cost,Feature model + guardrails
Estimator backtest & calibrate,Story,EPIC-MC-EST,mc;cost,90-day backtest + drift alerts
KMS key rotation automation,Story,EPIC-MC-KMS,mc;security,Rotate signer and storage keys
Envelope encryption enforcement,Story,EPIC-MC-KMS,mc;security,Policy denies unencrypted writes
```

---

## 11) DoR / DoD (adds)

**Adds**: Azure threat notes; rollout controller acceptance tests; SLA credit financial review; estimator v2 backtest evidence; KMS rotation logs.

---

## 12) Risks & Mitigations

| Risk                                | Likelihood | Impact | Mitigation                                         |
| ----------------------------------- | ---------- | ------ | -------------------------------------------------- |
| Azure driver instability            | M          | H      | Preview flag + small tenant canary + parity tests  |
| Policy rollout automation overreach | M          | M      | Manual hold override; step thresholds conservative |
| Graph store cost                    | M          | M      | Tiered storage; TTL on low‑value edges             |
| Credit issuance errors              | L          | H      | Two‑person review + signatures + audit events      |

---

## 13) Evidence Links (populate during sprint)

- ADRs: `/docs/adr/ADR-06xx-*`
- Azure perf: `/docs/evidence/azure-perf-2026-01-27/*`
- Policy rails GameDay: `/docs/evidence/policy-rails-2026-01-28/*`
- Release: `releases/mc-0.8.0`

---

> Keep the trains running while opening a new line: Azure preview, safer policy rollouts, verifiable SLA credits, and a provenance graph that compounds.

```

```
