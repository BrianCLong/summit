```md
# Maestro Conductor (MC) — Sprint Plan *(v1.0.0)*

**Slug:** `mc-sprint-2026-03-16-v1`  
**Dates (America/Denver):** 2026-03-16 → 2026-03-27  
**Owner/DRI:** Architect‑General  
**Teams:** Orchestrator Platform, SRE, Security, Data, UX, RevOps  
**Tracks:** A) Now‑value; B) Enduring moats  
**Prereq:** `mc-1.1.0` shipped (tenant ops, PQL 1.1, incident correlator, residency v2, policy deprecations, adaptive autoscaler)

---

## 0) Context & Carry‑Forward
**Done**: Tenancy APIs & onboarding runbook; PQL v1.1 with joins/aggregates; incident correlator + auto‑draft; partitioned residency & auditor; policy deprecation tooling; adaptive autoscaler + cache warmers.  
**Carry‑forward**: a few PQL safety corner cases; correlator signal weighting; autoscaler savings report automation.

---

## 1) Objectives & Key Results — **Enterprise Flywheel**
| # | Objective | KR (measurable) |
|---|---|---|
| A1 | **Self‑Serve Tenant Onboarding** | Guided flow + API; median time‑to‑first‑run < **10 min**; zero critical misconfigs |
| A2 | **Packages Marketplace — Private Beta → Staged Public** | Allow curated partner orgs; 50 signed packages; install success rate > **99.5%** |
| A3 | **PQL in Console (Read‑only UI)** | Saved queries list & run; p95 < **250ms**; guardrails surfaced in UI |
| B1 | **CDC Spine (Receipts→Warehouse)** | Near‑real‑time stream (< **2 min** lag); schema contracts; backfill path |
| B2 | **Policy Delivery at Edge** | Signed OPA bundles via CDN; p95 policy eval − **30%**; cache hit > **90%** |
| B3 | **Reliability & Budgets v2** | Error‑budget automation w/ progressive throttling; MTTR for throttle rollback < **5m** |

---

## 2) Scope (In/Out)
**In**: Onboarding flow & API polish, marketplace staged public toggles, console PQL UI (read‑only), CDC pipeline (Kafka/Parquet), edge bundle distribution, budget automation v2, SLO/alerts, docs & Jira scaffolds.  
**Out**: Authoring UI for PQL; public marketplace wide open; new runner types.

---

## 3) Epics, Swimlanes & Stories

### 3.1 Self‑Serve Onboarding
- **MC‑ONB‑1701**: *Guided onboarding API & checklist*  
  **AC:** `POST /api/onboarding/sessions` returns steps; validates residency/quotas/keys; emits `onboarding.completed`.  
- **MC‑ONB‑1702**: *Quick‑start samples*  
  **AC:** 3 one‑click signed workflows per region; disclosure pack sample auto‑download.

### 3.2 Marketplace Staged Public
- **MC‑MKT‑1711**: *Partner allowlist & moderation*  
  **AC:** `partners` table + approval flow; packages require signatures + in‑toto; revoke path.  
- **MC‑MKT‑1712**: *Staged public toggle*  
  **AC:** Feature flag by tenant; read‑only browse for non‑partners.

### 3.3 Console PQL (Read‑only)
- **MC‑UI‑1721**: *Saved query list & run*  
  **AC:** `/pql/saved` displayed; run with parameters; guardrails warnings; result export CSV.  
- **MC‑UI‑1722**: *Safety guardrails in UI*  
  **AC:** Show SINCE limits, row caps, and join restrictions.

### 3.4 CDC Spine (Receipts→Warehouse)
- **MC‑CDC‑1731**: *Change Data Capture pipeline*  
  **AC:** Debezium/CDC → Kafka → Parquet in lake; lag < 2m; schema contracts versioned.  
- **MC‑CDC‑1732**: *Backfill tool*  
  **AC:** Range backfill with idempotency; attaches evidence.

### 3.5 Policy Delivery at Edge
- **MC‑EDGE‑1741**: *Bundle signer & CDN*  
  **AC:** OPA bundles signed & pushed to CDN; clients verify digest; cache hit > 90%.  
- **MC‑EDGE‑1742**: *PDP bootstrap & fallback*  
  **AC:** Local cache bootstrap; fail‑closed policy on stale; observability added.

### 3.6 Reliability & Budgets v2
- **MC‑REL‑1751**: *Progressive throttling*  
  **AC:** Throttle by tenant when burn > policy; step down automatically; audit events.  
- **MC‑REL‑1752**: *Auto‑rollback for budget breaches*  
  **AC:** Canary weight reduce + rollback macros; proven MTTR < 5m.

---

## 4) Milestones (America/Denver)
- **Kickoff**: Mon 2026‑03‑16 10:00  
- **Design/ADR Review**: Tue 03‑17 15:00  
- **Mid‑sprint Evidence Review**: Fri 03‑20 16:00  
- **GameDay (CDC + Budgets)**: Wed 03‑25 14:00  
- **Sprint Review & Release**: Fri 03‑27 15:00  
- **Retro**: Fri 03‑27 16:00

---

## 5) Artifacts & Scaffolds

### 5.1 OpenAPI (Onboarding, Marketplace, PQL UI helpers)
```yaml
paths:
  /api/onboarding/sessions:
    post: { summary: Start onboarding session; returns checklist }
  /api/market/partners:
    post: { summary: Approve partner org }
    delete: { summary: Revoke partner org }
  /api/pql/saved:
    get: { summary: List saved queries }
    post: { summary: Create/update saved query (signed) }
```

### 5.2 CDC Pipeline (spec)
`docs/data/CDC_PIPELINE.md`
```md
Source: receipts (DB) → Debezium → Kafka topic `mc.receipts` → Stream sink → Parquet in `s3://mc-lake/receipts/dt=YYYY-MM-DD/`  
Contracts: Avro/JSON schema pinned; breaking‑change detector in CI.
```

### 5.3 Edge OPA Bundle Manifest
`policy/bundles/manifest.json`
```json
{"bundle":"mc-policies","version":"2026.03.16","digests":{"residency":"sha256:...","pii":"sha256:..."}}
```

### 5.4 PDP Bootstrap (env)
`.env`
```
OPA_BUNDLE_URL=https://cdn.company/policies/mc-policies.tar.gz
OPA_BUNDLE_DIGEST=sha256:...
OPA_FAIL_CLOSED=true
```

### 5.5 Progressive Throttling (rego)
`policy/rego/budgets_v2.rego`
```rego
package mc.budgets

throttle[level] {
  input.tenant.burnRate > 1.0
  level := "mild"
}

throttle[level] {
  input.tenant.burnRate > 1.5
  level := "moderate"
}

throttle[level] {
  input.tenant.burnRate > 2.0
  level := "hard"
}
```

### 5.6 Kafka Topic Config (CDC)
`infra/kafka/topics.yaml`
```yaml
- name: mc.receipts
  partitions: 24
  retention: 7d
```

### 5.7 Console PQL (React excerpt)
`apps/mc-console/pages/pql.tsx`
```tsx
export default function PQL(){
  // list saved, run, export
  return <div className="p-6">
    <h1 className="text-2xl">PQL</h1>
    {/* Read-only run + results table + CSV export */}
  </div>
}
```

### 5.8 Onboarding Checklist Schema
`docs/onboarding/CHECKLIST.schema.json`
```json
{"type":"object","required":["tenant","region","quotas","budgets","keys"],"properties":{"tenant":{"type":"string"},"region":{"type":"string"},"quotas":{"type":"object"},"budgets":{"type":"object"},"keys":{"type":"object"}}}
```

---

## 6) Observability & SLOs (adds)
- Metrics: `mc_onboarding_ttv_minutes`, `mc_market_partner_pkgs_total`, `mc_pql_ui_p95_ms`, `mc_cdc_lag_seconds`, `mc_policy_edge_cache_hit`, `mc_throttle_events_total`.  
- Dashboards: Onboarding funnel; Marketplace beta; PQL UI latency; CDC lag; Edge PDP; Budgets v2.  
- Alerts: CDC lag > 120s; edge cache hit < 85%; throttle hard level sustained > 15m.

---

## 7) Security & Compliance
- Marketplace staged public still requires signatures + in‑toto; partner revocation blocks installs immediately.  
- Edge bundles signed; clients verify digest; fail‑closed on mismatch.  
- CDC data contracts versioned and verified; PII minimization on export.

---

## 8) GameDay & Drills
- **CDC stress**: 5× receipt rate; lag remains < 2m; backpressure OK.  
- **Budget burn**: induce tenant burn >2×; progressive throttle → rollback macro within 5m.  
- **Edge policy**: serve stale bundle; fail‑closed behavior observed; recovery on fresh bundle.

---

## 9) Release & Rollback
- Tag: `mc-1.2.0`.  
- Flags: `onboarding_selfserve`, `market_public_staged`, `console_pql_readonly`, `cdc_receipts`, `policy_edge_cdn`, `budgets_v2`.  
- Rollback: disable flags; revert PDP to central bundle; stop CDC sink (leave Kafka topic intact).

---

## 10) Jira Import (CSV)
```csv
Summary,Issue Type,Parent,Labels,Description
Onboarding session API,Story,EPIC-MC-ONB,mc;onboarding,Start session & checklist validation
Quick-start signed samples,Story,EPIC-MC-ONB,mc;onboarding,One-click workflows per region
Partner allowlist & moderation,Story,EPIC-MC-MKT,mc;marketplace,Approve/revoke partners
Staged public toggle,Story,EPIC-MC-MKT,mc;marketplace,Per-tenant staged public browse
Console PQL read-only,Story,EPIC-MC-UI,mc;console,List & run saved queries
CDC pipeline (receipts),Story,EPIC-MC-CDC,mc;data,Debezium→Kafka→Parquet with <2m lag
CDC backfill tool,Story,EPIC-MC-CDC,mc;data,Idempotent historical backfills
Edge OPA bundle distribution,Story,EPIC-MC-EDGE,mc;policy,CDN + signed bundles + cache
PDP bootstrap & fallback,Story,EPIC-MC-EDGE,mc;policy,Local cache & fail-closed
Progressive throttling v2,Story,EPIC-MC-REL,mc;reliability,Throttle levels & rollback macros
```

---

## 11) DoR / DoD (adds)
**Adds**: onboarding TTF metrics; marketplace moderation runbook; PQL UI perf test; CDC contract tests & lag evidence; edge bundle signature logs; throttle drill evidence.

---

## 12) Risks & Mitigations
| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Marketplace exposure risk | M | H | Staged public by tenant; strict moderation & signatures |
| Edge policy stale/mismatch | L | H | Digest verification + fail‑closed; rapid refresh pipeline |
| CDC lag spikes | M | M | Backpressure + scaling; alert at 60/120s; buffer expansion plan |

---

## 13) Evidence Links (populate during sprint)
- ADRs: `/docs/adr/ADR-10xx-*`  
- CDC stress test: `/docs/evidence/cdc-2026-03-25/*`  
- Edge policy drill: `/docs/evidence/edge-2026-03-26/*`  
- Release: `releases/mc-1.2.0`

---

> Enterprise flywheel: onboard in minutes, query with guardrails, stream evidence in near‑real‑time, and keep policy fast at the edge.
```

