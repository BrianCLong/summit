---
slug: mc-sprint-2026-02-16-v1
version: 1.0.0
date: 2026-02-16
status: Proposed
owner: Platform Eng • DevSecOps (MC)
confidentiality: Internal
---

# MC Sprint Plan — v28.3 Continuous Verification & Progressive Delivery Gates

> Theme: **Shift from point-in-time checks to continuous verification** across CI → CD → runtime. Wire MC into progressive delivery (canary/blue‑green), automate post‑deploy policy checks, and close the loop with rollbacks based on SLOs, drift, or new CVEs.

**Scope anchor:** `/orchestrations/mc`  
**Prereqs:** v28.2 auto‑containment + lineage revocation working; v28.1 ABAC & provenance graph live  
**Timebox:** 2 weeks (Feb 16–Feb 27, 2026, America/Denver)

---

## 0) Retro Snapshot (from 2026‑02‑02)

- ✅ Static secrets eradicated; rotation SLO in place.
- ✅ Auto‑containment drill hit ≤30m rollback; revocation marks descendants non‑promotable.
- ⚠️ Session‑bound deploy approvals piloted on two services (needs rollout).
- ❌ No continuous post‑deploy verification; promotions still one‑time checks.

---

## 1) Sprint Goals (Outcomes)

1. **Progressive gates**: MC integrates with canary/blue‑green and **halts/rolls back** on policy or SLO failures.
2. **Continuous CVE watch**: new high‑severity findings in dependencies **revoke promotable** status within 30 min and trigger mitigation runbooks.
3. **Runtime drift lock**: if runtime digest ≠ last verified digest, **automated traffic reduce → 0** with evidence.
4. **Session‑bound approvals: org‑wide** for prod deploys.
5. **Policy‑as‑data**: declare gates in `policy/data/*.yaml` and render to OPA bundles + Argo conditions.

---

## 2) Swimlanes

### A) Progressive Delivery Integration (Owner: Platform + SRE)

- Argo Rollouts/Flagger hooks to call MC verify endpoints during canary steps; auto‑promote/rollback.

### B) Continuous CVE Watch (Owner: DevSecOps)

- SBOM diff + advisory poller; map to running digests via provenance graph; revoke/promote flows.

### C) Runtime Drift Lock (Owner: SRE)

- Detect drift → scale to zero + quarantine label; alert + evidence pack.

### D) Session‑Bound Approvals Rollout (Owner: Release + SecOps)

- Enforce WebAuthn‑bound JWT at CD gate across all prod apps; audit exceptions.

### E) Policy‑as‑Data (Owner: DX + DevSecOps)

- YAML → bundle generator; tests; docs; PR bot to suggest data changes not code.

---

## 3) User Stories & Acceptance Criteria

> ID: `MC11-<lane>-<n>`

### Progressive Delivery

1. **MC11-PROG-1** — _Canary gates_
   - **AC:** Canary step waits for `mc verify` OK (SLO + policy + signatures). On fail → automatic rollback; evidence stored.
2. **MC11-PROG-2** — _Blue‑green switchback_
   - **AC:** On regression, traffic reverts to previous green within 5 min; dashboard shows event chain.

### Continuous CVE Watch

3. **MC11-CVE-1** — _CVE → revoke promotable_
   - **AC:** New HIGH/CRITICAL CVE impacting running image marks digest non‑promotable in ≤ 30 min; creates ticket + waiver option.

### Runtime Drift Lock

4. **MC11-DRIFT-1** — _Auto reduce traffic → 0_
   - **AC:** When digest drift detected, traffic ramps down 100%→0% within 10 min; quarantine applied; owners paged.

### Session‑Bound Approvals

5. **MC11-APP-1** — _Org‑wide enforcement_
   - **AC:** All prod deploys verify WebAuthn‑bound JWT (≤30m); exceptions listed with TTL ≤ 24h.

### Policy‑as‑Data

6. **MC11-PAD-1** — _Data‑driven gates_
   - **AC:** `policy/data/gates.yaml` compiles to OPA bundle; `conftest` tests pass; PR bot lints invalid entries.

---

## 4) Deliverables & Artifacts

- **CD hooks**: `argo/rollouts/hooks/mc-verify.yaml`, `argo/rollouts/hooks/rollback.yaml`.
- **Watchers**: `watch/cve-poller.ts`, `watch/drift-watcher.ts`.
- **Policy data**: `policy/data/gates.yaml` + generator `scripts/gates-build.ts`.
- **CLI**: `cmd/mc/verify` endpoint (HTTP) + `mc rollout-status`.
- **Dashboards**: `dashboards/mc-progressive.json`, `dashboards/mc-cve-watch.json`, `dashboards/mc-drift.json`.
- **Runbooks**: Canary rollback, CVE revoke triage, drift containment.

---

## 5) Scaffolds & Snippets

### A) Argo Rollouts Hook — call MC verify

```yaml
# file: argo/rollouts/hooks/mc-verify.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: mc-verify
  annotations:
    argoproj.io/hook: PrePromotion
    argoproj.io/hook-delete-policy: HookSucceeded
spec:
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: verifier
          image: cgr.dev/chainguard/curl
          args:
            - '-sSf'
            - '$(MC_VERIFY_URL)?digest=$(IMAGE_DIGEST)&env=$(ENV)'
```

### B) Drift Watcher (pseudo)

```ts
// file: watch/drift-watcher.ts
import { reduceTrafficToZero } from './traffic';
import { recordEvidence } from './evidence';
export async function onDrift(digest: string) {
  await reduceTrafficToZero(digest);
  await recordEvidence({ type: 'drift', digest });
}
```

### C) CVE Poller (maps SBOM → running digest)

```ts
// file: watch/cve-poller.ts
import { fetchAdvisories, affectedDigests } from './graph';
import { revoke } from './promote';
setInterval(
  async () => {
    const cves = await fetchAdvisories();
    const digests = await affectedDigests(cves);
    for (const d of digests) await revoke(d);
  },
  15 * 60 * 1000,
);
```

### D) Policy‑as‑Data (example)

```yaml
# file: policy/data/gates.yaml
profiles:
  dev:
    sbom: advisory
    signatures: advisory
    slo_burn_rate: 3.0
  prod:
    sbom: enforce
    signatures: enforce
    provenance: enforce
    slo_burn_rate: 2.0
```

```ts
// file: scripts/gates-build.ts
import yaml from 'js-yaml';
import fs from 'node:fs';
const gates = yaml.load(
  fs.readFileSync('policy/data/gates.yaml', 'utf8'),
) as any;
fs.writeFileSync('policy/bundles/v28.3/data.json', JSON.stringify(gates));
```

### E) Session‑Bound Approval (enforce in CD)

```yaml
# file: .github/workflows/release-verify.yml
- name: Verify session-bound approval
  run: node scripts/verify-approval.js "$APPROVAL_JWT"
```

```js
// file: scripts/verify-approval.js
const jwt = JSON.parse(Buffer.from(process.argv[2].split('.')[1], 'base64'));
if (jwt.exp * 1000 < Date.now() || !jwt.binds?.webauthn || !jwt.nonce)
  process.exit(1);
```

---

## 6) Observability & Dashboards

```json
// file: dashboards/mc-progressive.json
{
  "title": "MC Progressive Delivery",
  "panels": [
    {
      "type": "graph",
      "title": "Canary Success Rate",
      "targets": [
        {
          "expr": "rate(mc_canary_success_total[1d]) / rate(mc_canary_attempt_total[1d])"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Auto Rollbacks",
      "targets": [{ "expr": "increase(mc_auto_rollbacks_total[7d])" }]
    }
  ]
}
```

```json
// file: dashboards/mc-cve-watch.json
{
  "title": "MC CVE Watch",
  "panels": [
    {
      "type": "stat",
      "title": "Revoked Digests (last 24h)",
      "targets": [{ "expr": "increase(mc_revoked_digests_total[1d])" }]
    },
    {
      "type": "table",
      "title": "Top Affected Packages",
      "targets": [{ "expr": "mc_cve_top_packages" }]
    }
  ]
}
```

```json
// file: dashboards/mc-drift.json
{
  "title": "MC Runtime Drift",
  "panels": [
    {
      "type": "stat",
      "title": "Drift Events (prod)",
      "targets": [
        { "expr": "increase(mc_runtime_drift_total{env=\"prod\"}[7d])" }
      ]
    },
    {
      "type": "graph",
      "title": "Time to Zero Traffic",
      "targets": [
        {
          "expr": "histogram_quantile(0.5, sum(rate(mc_drift_reduce_to_zero_seconds_bucket[1d])) by (le))"
        }
      ]
    }
  ]
}
```

---

## 7) Risks & Mitigations

1. **Over‑sensitive gates cause rollbacks** — start with 10% canary; require two failing signals; manual override documented.
2. **CVE false positives** — waiver TTL with owner; evidence includes advisory source & affected version range.
3. **Drift detector flaps** — require 2 consecutive samples; cool‑down; evidence to aid triage.
4. **Approval friction** — batch approvals per release train; fallback advisory mode for the first 48h.

---

## 8) DOD, Gates & Rollback

**DOD**

- [ ] Canary/blue‑green wired to MC verify; auto‑rollback works with evidence.
- [ ] CVE poller revokes promotable status in ≤ 30 min; tickets created.
- [ ] Drift lock auto‑reduces traffic to zero; quarantine applied.
- [ ] Session‑bound approvals enforced org‑wide (exceptions tracked).
- [ ] Policy‑as‑data compiled; tests green.

**Rollback**

- Disable MC verify hook in Rollouts; pause CVE poller; set `DRIFT_ENFORCE=false`; revert approval gate to advisory.

---

## 9) Timeline & Capacity (2 weeks)

- **D1–D3:** Argo hooks + `mc verify`; drift watcher MVP.
- **D4–D6:** CVE poller + revoke path; session approvals rollout.
- **D7–D8:** Policy‑as‑data generator + tests; dashboards.
- **D9–D10:** Canary demo + rollback; docs & retro.

**Estimate:** 26–30 pts across Platform, Sec, CI, SRE, DX.

---

## 10) Ticket Seed (importable)

```yaml
# file: .project/tickets/mc-sprint-2026-02-16.yaml
sprint: mc-2026-02-16
board:
  columns: [Backlog, Ready, In Progress, Review, Blocked, Done]
issues:
  - id: MC11-PROG-1
    title: Wire MC verify into canary & blue-green
    labels: [mc, cd]
    assignees: [owner-platform, owner-sre]
    points: 6
  - id: MC11-CVE-1
    title: Continuous CVE poller → revoke promotable
    labels: [mc, supply-chain]
    assignees: [owner-sec]
    points: 5
  - id: MC11-DRIFT-1
    title: Runtime drift → auto reduce to zero
    labels: [mc, sre]
    assignees: [owner-sre]
    points: 5
  - id: MC11-APP-1
    title: Session-bound approvals org-wide
    labels: [mc, release, identity]
    assignees: [owner-release, owner-sec]
    points: 4
  - id: MC11-PAD-1
    title: Policy-as-data generator & tests
    labels: [mc, policy, dx]
    assignees: [owner-dx, owner-sec]
    points: 4
```

---

## 11) Evidence & Reporting

- KPIs: canary success rate, auto‑rollback count, revoked digests latency, drift MTTR, approval coverage %.
- Artifacts: rollout events, verify logs, revoke tickets, drift evidence packs, gates data bundle.
- Store under `docs/mc/evidence/2026-02-16/`.

---

## 12) Changelog

- **Added:** Progressive delivery gates; continuous CVE watch; drift auto‑lock; policy‑as‑data.
- **Changed:** Approvals now session‑bound org‑wide.
- **Fixed:** One‑time verification gap after deploy.
