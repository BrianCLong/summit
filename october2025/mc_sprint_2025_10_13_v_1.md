````md
# Maestro Conductor (MC) — Sprint Plan _(v1.0.0)_

**Slug:** `mc-sprint-2025-10-13-v1`  
**Date:** 2025-10-13 → 2025-10-24 (America/Denver)  
**Owner/DRI:** Architect‑General  
**Teams:** Orchestrator Platform, SRE, Security, Data, UX  
**Tracks:** A) Now‑value; B) Enduring moats  
**Pre-req:** Prior sprint artifacts merged and tagged `mc-0.1.x`

---

## 0) Context & Carry‑Forward

**Done last sprint**: Manifest v1 GA, signed receipts + exporter, OPA policy packs v1, canary+auto‑rollback, paved‑road templates, SLO dashboards & runbook.

**Carry‑forward** (partial / tech debt):

- Harden disclosure pack (streaming logs, large‑run chunking).
- Runner seccomp profiles finalized.
- CLI `status` richer output with live policy decisions.

---

## 1) Objectives & Key Results

| #   | Objective                    | KR (measurable)                                                                       |
| --- | ---------------------------- | ------------------------------------------------------------------------------------- |
| A1  | **Multi‑tenant Controls v1** | Per‑tenant quotas & budgets enforced; p95 authZ < **15ms**                            |
| A2  | **Cost Governor**            | 99% runs emit cost estimate pre‑execute; block if > policy; drift < **10%** vs actual |
| A3  | **Disclosure GA**            | Export packs deterministic; verify tool passes on 3× 1GB runs; export TAT < **60s**   |
| B1  | **Sandbox Hardening**        | Default seccomp/apparmor, read‑only FS; escape tests green                            |
| B2  | **Policy Catalog**           | Self‑serve registry of packs with docs + examples; signed OPA bundles                 |
| B3  | **Perf & Scale**             | 1k concurrent executions @ p95 publish→start < **3s**; DB p95 query < **50ms**        |

---

## 2) Scope (In/Out)

**In**: ABAC→Tenant RBAC bridge, quota/budget evaluators, cost estimator service, disclosure streaming, runner hardening, policy registry APIs, perf work, chaos & DR drills.  
**Out**: New task types/runners; UI beyond basic registry endpoints; multi‑region active/active (spiked only).

---

## 3) Epics, Swimlanes & Stories

### 3.1 Identity & Policy (Tenant Controls)

- **MC‑ID‑701**: _Tenant model & RBAC mapping_  
  **AC:** Tables: `tenants`, `members`, `roles`; JWT `tenant_id` required; OPA input enriched.
- **MC‑POL‑702**: _Quota evaluator_  
  **AC:** Per‑tenant concurrent exec caps; deny with explain.
- **MC‑POL‑703**: _Budget evaluator_  
  **AC:** Per‑tenant daily USD cap; soft warn at 80%, hard deny >100%.

### 3.2 Cost Governor

- **MC‑COST‑711**: _Estimator service_  
  **AC:** `POST /api/plan` returns `estimatedCostUSD` with 95% within ±10% of actual on benchmark suite.
- **MC‑COST‑712**: _Policy integration_  
  **AC:** Budget pack consumes estimator output server‑side; CLI displays rationale.

### 3.3 Disclosure GA

- **MC‑DISC‑721**: _Streaming logs into pack_  
  **AC:** `logs/*.ndjson` stream; chunked S3 uploads; memory use < 256MB.
- **MC‑DISC‑722**: _Deterministic pack_  
  **AC:** Sorted entries, fixed metadata; byte‑for‑byte reproducible.

### 3.4 Runner Hardening

- **MC‑RUN‑731**: _Seccomp/apparmor profiles_  
  **AC:** Default deny; allowlist syscalls; golden tests for escape attempts.
- **MC‑RUN‑732**: _Read‑only FS + tmp scratch_  
  **AC:** `/workspace` RO, `/tmp` size‑limited; writes audited.

### 3.5 Policy Catalog

- **MC‑CAT‑741**: _Registry API_  
  **AC:** `GET /api/policy-packs`, `GET /api/policy-packs/{id}`; signed bundle digests.
- **MC‑CAT‑742**: _Docs generator_  
  **AC:** Generate README per pack from annotations; examples auto‑tested.

### 3.6 Performance & Scale

- **MC‑PERF‑751**: _Queue tuning & batching_  
  **AC:** p95 publish→start < 3s @ 1k conc; CPU < 70%.
- **MC‑PERF‑752**: _DB indices & caching_  
  **AC:** Hot queries p95 < 50ms; cache hit > 85%.

### 3.7 SRE & Reliability

- **MC‑SRE‑761**: _Chaos‑lite scenarios_  
  **AC:** PDP latency spike, S3 throttling, DB failover; auto‑rollback triggers where applicable.
- **MC‑SRE‑762**: _DR tabletop + restore drill_  
  **AC:** Restore from last nightly; RTO < 30m, RPO < 15m.

### 3.8 CLI & UX

- **MC‑CLI‑771**: _`status` enrichment_  
  **AC:** Live policy decisions & budget context; `--explain` option.
- **MC‑CLI‑772**: _`maestro whoami`_  
  **AC:** Prints tenant, roles, quotas, budgets.

---

## 4) Milestones (America/Denver)

- **Kickoff**: Mon 2025‑10‑13 10:00
- **Design/ADR Review**: Tue 10‑14 15:00
- **Mid‑sprint Evidence Review**: Fri 10‑17 16:00
- **Chaos/DR Drill**: Wed 10‑22 14:00
- **Perf Target Demo**: Thu 10‑23 15:00
- **Sprint Review & Release**: Fri 10‑24 15:00
- **Retro**: Fri 10‑24 16:00

---

## 5) Required Artifacts per Story

- ADR (numbered), threat notes.
- Test plan & evidence (unit/component/e2e, coverage).
- Security: SBOM, vuln budget report, secret scan.
- Observability: metrics, dashboards, alerts.
- Release notes & rollback script.
- Provenance: signatures, attestations, disclosure evidence.

---

## 6) DB Changes (DDL)

```sql
-- tenants & budgets
create table tenants (
  id uuid primary key default gen_random_uuid(),
  name text unique not null,
  daily_budget_usd numeric(12,2) not null default 100.00,
  created_at timestamptz not null default now()
);

create table tenant_members (
  tenant_id uuid references tenants(id),
  subject text not null,
  role text not null check (role in ('admin','operator','composer','viewer')),
  primary key (tenant_id, subject)
);

alter table executions add column tenant_id uuid references tenants(id);
create index on executions (tenant_id, started_at);
```
````

---

## 7) APIs (OpenAPI Excerpts)

```yaml
paths:
  /api/tenants:
    post: { summary: Create tenant }
    get: { summary: List tenants }
  /api/tenants/{id}/members:
    put: { summary: Upsert member role }
  /api/plan:
    post:
      summary: Return execution plan & cost estimate
      responses: { '200': { description: OK } }
  /api/policy-packs:
    get: { summary: List available policy packs }
  /api/policy-packs/{id}:
    get: { summary: Fetch pack metadata & signed digest }
```

---

## 8) OPA Inputs (Contracts)

```json
{
  "actor": { "sub": "user@co", "roles": ["operator"], "tenant": "t_123" },
  "tenant": {
    "quota": { "maxConcurrent": 25 },
    "budget": { "dailyMaxUSD": 500 }
  },
  "request": { "resourceClass": "medium", "region": "US" },
  "plan": { "estimatedCostUSD": 3.27 }
}
```

---

## 9) Chaos & DR Scenarios

- **PDP latency spike**: inject 1s delay → expect fail‑closed, auto‑rollback if canary.
- **S3 throttling**: 429s on receipts/logs → retry + backoff; exporter resumes.
- **DB failover**: primary reboot → RTO < 2m; no data loss.

---

## 10) Observability Additions

- Metrics: `mc_cost_estimate_usd` (gauge), `mc_tenant_denies_total` (counter), `mc_policy_eval_ms` (histogram).
- Dashboards: Tenant overview; Cost governor; Disclosure throughput.
- Alerts: daily budget > 90%; policy eval p95 > 50ms; exporter TAT > 60s.

---

## 11) Security Gates (CI updates)

- SBOM + CVE budget (critical=0, high<=3 w/ justifications).
- Rego unit tests required; bundle signed with cosign and verified in CI.
- Secret scanning blocking on PR.

---

## 12) Release Plan & Rollback

- Release tag: `mc-0.2.0`.
- Canary 10%→50%→100% with error‑budget policy.
- Rollback: `helm rollback mc <rev>` + disable new endpoints via flag.
- Evidence: perf run @1k conc; chaos/DR drill reports attached.

---

## 13) Jira Import (CSV)

```csv
Summary,Issue Type,Parent,Labels,Description
Tenant model & RBAC mapping,Story,EPIC-MC-ID,mc;tenant,Tables and JWT→OPA enrichment
Quota evaluator,Story,EPIC-MC-POL,mc;quota,Per-tenant concurrency caps
Budget evaluator,Story,EPIC-MC-POL,mc;budget,Daily USD caps with warn/deny
Estimator service,Story,EPIC-MC-COST,mc;cost,Cost plan within 10% of actual
Policy integration for cost,Story,EPIC-MC-COST,mc;policy,Server-side gates consume estimates
Disclosure streaming logs,Story,EPIC-MC-DISC,mc;disclosure,Chunked uploads and pack assembly
Deterministic disclosure packs,Story,EPIC-MC-DISC,mc;repro,Byte-stable exports
Seccomp/apparmor profiles,Story,EPIC-MC-RUN,mc;hardening,Default deny with tests
Read-only FS with scratch,Story,EPIC-MC-RUN,mc;fs,RO workspace and tmp quota
Policy catalog API,Story,EPIC-MC-CAT,mc;catalog,List/fetch signed packs
Docs generator for packs,Story,EPIC-MC-CAT,mc;docs,Generate README from annotations
Queue tuning & batching,Story,EPIC-MC-PERF,mc;perf,1k conc <3s p95 publish→start
DB indices & caching,Story,EPIC-MC-PERF,mc;db,Hot query p95 < 50ms
Chaos-lite scenarios,Story,EPIC-MC-SRE,mc;chaos,PDP, S3, DB drills
DR tabletop + restore drill,Story,EPIC-MC-SRE,mc;dr,Restore RTO<30m RPO<15m
CLI status enrichment,Story,EPIC-MC-CLI,mc;cli,Live decisions & budgets
CLI whoami,Story,EPIC-MC-CLI,mc;cli,Expose tenant/roles/quotas/budgets
```

---

## 14) DoR / DoD (unchanged from prior, with adds)

**Additions**: perf test plan; chaos/DR playbooks attached; multi‑tenant threat notes; CVE budget justification template.

---

## 15) Templates & Snippets

### 15.1 Policy Pack Annotation (for docs generator)

```rego
# annotations:
# title: Residency
# summary: Enforces data residency alignment between workflow and request.
# examples:
# - input: {"workflow":{"region":"US"},"request":{"region":"EU"}}
#   deny: true
```

### 15.2 CLI `whoami` output (example)

```json
{
  "subject": "alice@company",
  "tenant": "acme",
  "roles": ["operator"],
  "quotas": { "maxConcurrent": 25, "inUse": 3 },
  "budget": { "dailyMaxUSD": 500, "spentUSD": 120.43 }
}
```

### 15.3 Estimator pseudocode

```ts
function estimate(manifest: Manifest): number {
  let total = 0;
  for (const t of manifest.tasks) total += basePrice(t.uses) * timeGuess(t);
  return Number(total.toFixed(2));
}
```

---

## 16) Risks & Mitigations

| Risk                        | Likelihood | Impact | Mitigation                                         |
| --------------------------- | ---------- | ------ | -------------------------------------------------- |
| Estimator drift >10%        | M          | M      | Retrain with receipts data; alert on drift         |
| Seccomp breakage            | L          | H      | Canary on runners; escape tests in CI              |
| Tenant migration complexity | M          | M      | Feature‑flagged DDL; backfill job; rollback script |

---

## 17) Evidence Links (populate during sprint)

- ADRs: `/docs/adr/ADR-00xx-*`
- Perf runs: `/docs/evidence/perf-1k/*`
- Chaos/DR: `/docs/evidence/chaos-dr/*`
- Release: `releases/mc-0.2.0`

---

> Move the bottleneck; compound the moat. Finish what we started, then scale it.

```

```
