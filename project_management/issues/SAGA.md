# SAGA: Workflow Orchestration Platform

Branch: `feat/saga`
Labels: feature:SAGA_ENABLED, area:platform, env:preview

## Mission
Deliver a saga orchestration layer that coordinates cross-service workflows with typed commands/events, compensating actions, and zero shared databases.

## Deliverables
- Typed saga definitions with compensations and invariants documented.
- Contract-first APIs/events for orchestration callbacks and DLQ handling.
- Observability overlays (traces/metrics/logs) with correlation IDs per step.
- Preview environment rollout with rollback hooks for failed invariants.

## Constraints
- All saga entrypoints gated by `feature:SAGA_ENABLED`, default-off outside preview.
- Workflows must be idempotent and replayable with deterministic seeds.
- No shared databases; use per-service state stores and message passing.

## Definition of Done / CI Gates
- Lint + typecheck: `pnpm lint`, `pnpm typecheck`.
- Tests: unit + contract suites for saga handlers; Playwright/API smoke for critical paths.
- Feature-flag enforcement: `node scripts/ci/feature-flag-gate.js SAGA_ENABLED`.
- Preview environment with auto-rollback hook wired (see `.github/workflows/feature-branch-flags.yml`).
- Links: issue template `.github/ISSUE_TEMPLATE`, PR template `.github/PULL_REQUEST_TEMPLATE.md`.

## Acceptance Checklist
- [ ] Autogenerated coverage â‰¥90% for orchestration libraries; deterministic fixtures checked in.
- [ ] Compensation logic verified in contract tests and replayed in CI.
- [ ] PII/secret redaction confirmed for saga payload logs and traces.
- [ ] Preview env deploy + rollback executed in CI prior to merge.
- [ ] DLQ/backoff policies documented and tested.

## Tuning Questions
- Which workflows require strict ordering vs parallelism?
- What compensations are allowed to run partially vs fully rollback?
- How should DLQ retention and alerting be configured per environment?
- Which latency/error budgets gate roll-forward vs rollback?

## Kickoff Meta-Prompt
```
Team SAGA: enforce typed commands/events and explicit compensations. No shared databases; communicate via contracts and idempotent handlers. Align owners for event schemas, DLQs, observability signals, and rollback triggers. Feature flag `feature:SAGA_ENABLED` gates all surfaces; preview env is the only integration surface until green. Capture deterministic seeds for replay.
```
