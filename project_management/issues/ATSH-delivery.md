# ATSH: Adaptive Triage Safety Harness

Branch: feat/atsh
Path: /qa/atsh
Labels: track:qa, feature:ATSH_ENABLED, ci:lint, ci:unit, ci:contract, ci:playwright, preview-env, auto-rollback

## Mission
- Stand up an ATSH quality-assurance lane that enforces anti-tamper safety harnesses for automated test scaffolds and live guardrail rehearsals.
- Provide deterministic harnesses for safety regression packs, with feature-flagged activation to protect core traffic.

## Deliverables
- Typed ATSH service contract covering ingress events, harness orchestration, and telemetry fan-out with no shared databases.
- Initial `/qa/atsh` scaffold with env toggles, data redaction policy, and pipeline hooks for lint, unit, contract, and Playwright.
- Preview environment hooks plus rollback validation tied to the CI workflow for ATSH branches.

## Constraints
- No shared databases; communicate via typed events and stable API schemas only.
- Enforce PII redaction on logs/artifacts; disable recordings that are not redacted.
- All runs must be deterministic (seeded fixtures) and reproducible in CI.

## Definition of Done / CI Gates
- [ ] Lint: `pnpm run lint` under feature flag `FEATURE_ATSH_ENABLED=true`.
- [ ] Unit: `pnpm run test:unit` with deterministic seeds and autogen coverage thresholds.
- [ ] Contract: `pnpm run test:policy` to validate schema and contract integrity.
- [ ] Playwright: `pnpm run e2e` with ATSH user flows gated by the feature flag.
- [ ] Preview env smoke: `bash scripts/preview-local.sh help` runs and advertises preview namespace.
- [ ] Auto-rollback hook: `bash scripts/validate-rollback.sh --help` surfaces rollback validation entry points.

## Acceptance Checklist
- [ ] Autogenerated coverage reports stored as artifacts; thresholds enforced for changed code.
- [ ] Deterministic fixtures (seeded) for all ATSH tests; flaky tests eliminated or quarantined with owner.
- [ ] PII/SPI redaction verified for logs, screenshots, and telemetry payloads.
- [ ] Typed API/event boundaries documented; no shared DB access or implicit coupling.
- [ ] Preview environments enabled for the branch; teardown and rollback plan documented in PR.
- [ ] PR uses `.github/PULL_REQUEST_TEMPLATE.md` and references the feature flag toggle diff.

## Kickoff Meta-Prompt
> Align on typed API contracts, event boundaries, and isolation (no shared DBs). Identify dependencies (QA harness, feature flag service, telemetry sink). Confirm determinism requirements, redaction/PII posture, and CI gates (lint, unit, contract, Playwright, preview smoke, rollback validation). Plan rollout via `feat/atsh` with preview env + auto-rollback hooks; maintain feature flag default OFF until acceptance is met.
