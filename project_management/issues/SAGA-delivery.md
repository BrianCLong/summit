# SAGA: Orchestrated Platform Resilience

Branch: feat/saga
Path: /platform/saga
Labels: track:platform, feature:SAGA_ENABLED, ci:lint, ci:unit, ci:contract, ci:playwright, preview-env, auto-rollback

## Mission
- Introduce saga-style orchestration patterns for platform workflows with explicit compensating actions and typed boundaries.
- Guarantee resilient, idempotent flows with feature-flagged rollout and previewable staging environments.

## Deliverables
- `/platform/saga` scaffold containing typed workflow specs, compensating action registry, and contract tests for orchestrations.
- CI gating for lint, unit, contract, and Playwright scenarios with saga toggles enforced per branch.
- Preview environment automation plus rollback validation baked into the feature workflow.

## Constraints
- No shared database state between services; all coordination via events/commands with schemas under version control.
- Deterministic replay support for saga state (seeded fixtures and reproducible timelines).
- PII must be redacted in logs, traces, and artifacts; telemetry uses approved sinks only.

## Definition of Done / CI Gates
- [ ] Lint: `pnpm run lint` with `FEATURE_SAGA_ENABLED=true`.
- [ ] Unit: `pnpm run test:unit` covering compensating and forward paths.
- [ ] Contract: `pnpm run test:policy` for API/event schema validation.
- [ ] Playwright: `pnpm run e2e` for saga-driven UX flows behind the flag.
- [ ] Preview env smoke: `bash scripts/preview-local.sh help` exposes preview namespace readiness.
- [ ] Auto-rollback hook: `bash scripts/validate-rollback.sh --help` confirms rollback validation flow.

## Acceptance Checklist
- [ ] Autogenerated coverage with thresholds enforced per change set.
- [ ] Deterministic saga replays with seeded events and strict ordering rules.
- [ ] PII/SPI redaction validated across logs, traces, and screenshots.
- [ ] Typed API/event boundaries; no shared DBs or implicit coupling.
- [ ] Preview env + auto-rollback plan referenced in branch PR using `.github/PULL_REQUEST_TEMPLATE.md`.
- [ ] Feature flag default OFF until validations pass; rollout documented.

## Kickoff Meta-Prompt
> Establish typed saga contracts and compensating action catalog. Map dependencies (workflow runtime, event bus, telemetry, feature flag service). Confirm determinism and redaction posture. Align CI gates (lint, unit, contract, Playwright, preview smoke, rollback validation). Deliver via `feat/saga` with preview + rollback hooks and zero shared DB assumptions.
