# v24.1 Backlog (Epics → Stories → Acceptance Criteria)

## E1 — Ingest Completion & Idempotency

- **S1.1 HTTP Push GA**: finalize schema validation, provenance attach, 429/backoff.
  - **AC**: 1k RPS sustained, p95 pre‑storage ≤ 100 ms; 0 data loss across restart.
- **S1.2 Kafka Consumer GA**: at‑least‑once with dedupe key `(tenant,source,signal_id,ts)`.
  - **AC**: Replay test shows ≤ 0.1% duplicates; lag auto‑recovers < 5 min after 10 min outage.
- **S1.3 Dedupe Telemetry**: export `ingest_dedupe_rate` & `ingest_backlog`.
  - **AC**: Grafana panels & alerts (warn ≥ 10% dupes, crit ≥ 20%).

## E2 — Cost & Cache Optimization

- **S2.1 Redis Caching Policy**: cache `tenantCoherence` with per‑tenant TTL/jitter.
  - **AC**: ≥ 70% cache hit rate at 200 RPS; p95 improved ≥ 20% vs baseline.
- **S2.2 RPS Limiter Tuning**: adaptive limiter by tenant weight.
  - **AC**: No 5xx from throttling under synthetic burst; proper 429 + Retry‑After.
- **S2.3 Cost Dashboard**: GH Actions + Grafana finance panel; alerts at 80/95% budget.
  - **AC**: Monthly spend projections visible; alert fires on simulated spike.

## E3 — Multi‑Region Read Path (Feature‑flagged)

- **S3.1 Read Replicas**: add region tags & router hints.
  - **AC**: Median read latency improves ≥ 25% for EU‑tagged tenants in EU region.
- **S3.2 Residency Guard**: enforce data access by `residency` tag.
  - **AC**: Cross‑region query attempts blocked by policy simulation + runtime.

## E4 — Policy & Privacy Expansion

- **S4.1 Fine‑grained Scopes**: `coherence:read:self`, `coherence:write:self`.
  - **AC**: OPA tests cover allow/deny matrix; ≥ 90% policy test coverage.
- **S4.2 Retention Jobs**: parameterize TTL per dataset; add dry‑run mode.
  - **AC**: Dry‑run report enumerates candidates; live job deletes only eligible rows/nodes.

## E5 — Observability & SLO Upgrades

- **S5.1 Subscription Metrics**: add `subscription_fanout_latency_ms` histogram.
  - **AC**: Dashboards show p95/99; alerts configured.
- **S5.2 Trace Sampling**: 10–20% with baggage `tenant_id` end‑to‑end.
  - **AC**: Traces link API → Neo4j → Postgres; 95th percentile trace count ≥ target.

## E6 — Resilience & Chaos

- **S6.1 Kill‑Switch Drill**: exercise `v24.coherence=false` + Helm rollback.
  - **AC**: MTTR ≤ 10 min; doc updated with actual timings.
- **S6.2 Dependency Faults**: inject Redis/Neo4j transient faults.
  - **AC**: No data loss; graceful degradation; alerts fire.

## E7 — DX & Guardrails

- **S7.1 Persisted Query CLI**: dev tool to add/update PQ with hash + schema check.
  - **AC**: CI gate rejects PRs with non‑persisted ops.
- **S7.2 Golden Datasets**: fixtures for 10 tenants × 10k signals/day.
  - **AC**: Reproducible perf runs within ±5% variance.

---

# 30‑Day Hardening Plan (Calendar)

**Week 1**: E1, E5.1, SLO alert tuning; enable synthetic monitor secrets.  
**Week 2**: E2 (cache + limiter); cost dashboard; kill‑switch drill (E6.1).  
**Week 3**: E4 (scopes + retention); trace sampling (E5.2).  
**Week 4**: E3 prototype behind flag; chaos tests (E6.2); freeze v24.1 scope.

---

# Acceptance & Verification Pack (per story)

- **Tests**: unit, integration, policy (OPA), e2e (Playwright), load (k6).
- **Metrics**: add/verify counter & histogram per new path.
- **Evidence**: attach junit, coverage, k6 summary, OPA report, dashboard JSON, alert diffs.

---

# RACI & Estimates (high‑level)

- **A**: Eng Lead v24
- **R**: API Eng (E2,E5), Graph Eng (E1,E3), SRE (E6), Security (E4)
- **C**: Platform Arch, FinOps

T‑shirt sizes: E1 L, E2 M, E3 L, E4 M, E5 S, E6 M, E7 S

---

# Risks & Mitigations

- **Burst ingest** → backpressure & dedupe churn → _adaptive limiter, queue depth alerts_.
- **Policy drift** → unexpected denials → _policy simulation in CI + golden cases_.
- **Cross‑region latency** → UX regressions → _flagged rollout, rollback plan defined_.

---

# Definition of Done (v24.1)

- All ACs met; CI gates green; SLO reports attached; evidence bundle updated; release notes + runbooks amended.
