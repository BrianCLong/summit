#!/bin/bash
set -euo pipefail

PR_NUMBER=${1:-}

if [ -z "$PR_NUMBER" ]; then
  echo "‚ùå Error: PR number required"
    exit 1
    fi

    PREVIEW_URL="https://pr-${PR_NUMBER}.preview.example.com"

    echo "üí¨ Posting preview URL comment on PR #$PR_NUMBER..."

    COMMENT_BODY="## üöÄ Preview Environment Ready

    Your preview environment has been deployed and is ready for testing!

    **Preview URL:** [$PREVIEW_URL]($PREVIEW_URL)

    ### Environment Details
    - **Namespace:** \`preview-pr-${PR_NUMBER}\`
    - **Image Tag:** \`${IMAGE_TAG:-latest}\`
    - **Deployment Status:** ‚úÖ Active

    This preview will be automatically cleaned up when the PR is closed.

    ---
    *Generated by Summit Preview Pipeline*"

    # Post comment to PR
    curl -X POST \
      -H "Accept: application/vnd.github.v3+json" \
        -H "Authorization: token $GITHUB_TOKEN" \
          "https://api.github.com/repos/$GITHUB_REPOSITORY/issues/$PR_NUMBER/comments" \
            -d "{\"body\":\"$COMMENT_BODY\"}"

            echo "‚úÖ Comment posted successfully"
            
