#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ”’ Running pre-commit checks..."

# Run gitleaks to detect secrets
echo "ğŸ” Scanning for secrets..."
if command -v gitleaks &> /dev/null; then
  gitleaks protect --staged --verbose || {
    echo "âŒ Secret detected! Please remove sensitive data before committing."
    exit 1
  }
else
  echo "âš ï¸  Gitleaks not installed. Install with: brew install gitleaks (macOS) or see https://github.com/gitleaks/gitleaks"
fi

# Run lint-staged to check only staged files (fast!)
echo "ğŸ” Running lint-staged..."
pnpm exec lint-staged || {
  echo "âŒ Lint-staged checks failed. Please fix the issues before committing."
  exit 1
}

echo "âœ… All pre-commit checks passed!"
