# Runbook: Golden Path E2E Testing

## Overview

The Golden Path E2E suite verifies the critical user journey: **Dashboard -> Investigations -> Graph**.
It runs on GitHub Actions (nightly) and PRs (optional/gated).

## Location

*   Test code: `e2e/golden-path/`
*   CI Workflow: `.github/workflows/golden-path-e2e.yml`
*   Evidence: `artifacts/evidence/goldenpath-frontend/`

## How to Run Locally

1.  **Prerequisites**:
    *   Node.js 18+
    *   `npm` or `pnpm`

2.  **Start Frontend**:
    ```bash
    ./scripts/ci/start_consolidated_frontend.sh
    ```
    This starts client (port 3000) and server (port 4000).

3.  **Run Tests**:
    ```bash
    cd e2e/golden-path
    GOLDEN_PATH_E2E_ENABLED=1 npx playwright test
    ```

    To run the full journey (requires backend):
    ```bash
    GOLDEN_PATH_JOURNEY=full GOLDEN_PATH_E2E_ENABLED=1 npx playwright test
    ```

## Debugging

*   **View Traces**: `npx playwright show-trace artifacts/e2e/playwright-output/trace.zip`
*   **Logs**: Check `client_start.log` and `server_start.log` generated by the start script.

## Policy Gates

*   **Redaction Gate:** Scans `artifacts/evidence` for `SECRET=`, `TOKEN=`, etc.
*   **Evidence**: Every run must produce `evidence/index.json`.
*   **Failure:** If CI fails on "Policy Gate Failed", check generated artifacts for leaked environment variables or tokens.

## Maintenance

*   **Selectors**: Defined in `e2e/golden-path/pages/*.ts`. Prefer `data-testid` or text selectors.
*   **Flakiness**: If tests flake, inspect traces. Add `await expect(...).toBeVisible()` wait guards.

## Quarantining Tests

To skip a flaky test without removing code:
```ts
test.fixme('reason', async ({ page }) => { ... });
```
