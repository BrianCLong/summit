apiVersion: batch/v1
kind: CronJob
metadata: { name: neo4j-backup-verify, namespace: prod }
spec:
  schedule: '30 0 * * *' # nightly
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: Never
          containers:
            - name: verify
              image: amazon/aws-cli:2
              envFrom: [{ secretRef: { name: neo4j-backup } }]
              command: ['/bin/sh', '-c']
              args:
                [
                  'test $(aws s3 ls $S3_BUCKET/ --recursive | tail -1 | wc -l) -gt 0',
                ]
