name: rotate-secrets
on:
  schedule: [{ cron: '0 7 1 * *' }]
jobs:
  rotate:
    runs-on: ubuntu-latest
    permissions: { id-token: write, contents: read }
    steps:
      - uses: actions/checkout@v4
      - name: Rotate DB password
        run: node scripts/rotate_secret.js db/password
      - name: Restart rollouts
        env: { KUBECONFIG: ${{ secrets.PROD_KUBECONFIG }} }
        run: |
          argo rollouts restart app -n prod