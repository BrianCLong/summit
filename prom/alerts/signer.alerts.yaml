groups:
  - name: signer-slo
    interval: 30s
    rules:
      - alert: SignerAttestationFailureRate
        expr: (increase(signer_attestation_failures_total[5m]) / increase(signer_attestation_requests_total[5m])) > 0.01
        for: 10m
        labels:
          severity: page
          service: signer-service
          slo: attestation-success
        annotations:
          summary: "Signer attestation failure rate above 1%"
          description: |
            Failure rate is {{ $value | printf "%.2f" }} over the last 10m. Check signer pods,
            JWKS propagation, and upstream digest producers.
          runbook_url: https://git.example.com/intelgraph/docs/runbooks/signer-service.md
          dashboard_url: https://grafana.example.com/d/signer-service

      - alert: SignerKeyExpiryWindow
        expr: min_over_time(signer_active_key_ttl_seconds[5m]) < 86400
        for: 15m
        labels:
          severity: warn
          service: signer-service
          slo: key-rotation
        annotations:
          summary: "Signer active key expires in less than 24h"
          description: |
            Active signer key TTL is {{ $value | printf "%.0f" }} seconds. Prepare rotation and
            ensure downstream verifiers have the new JWKS.
          runbook_url: https://git.example.com/intelgraph/docs/runbooks/signer-service.md#key-rotation
          dashboard_url: https://grafana.example.com/d/signer-service
