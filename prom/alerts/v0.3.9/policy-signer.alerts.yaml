groups:
  - name: policy-signer
    interval: 30s
    rules:
      - alert: PolicySimulationLatencyHigh
        expr: histogram_quantile(0.95, sum(rate(policy_simulation_latency_seconds_bucket[5m])) by (le)) > 1
        for: 5m
        labels:
          severity: page
          service: policy-signer
        annotations:
          summary: "Policy simulation latency p95 is above 1s"
          description: "Policy simulations are slow for the last 5 minutes (p95 > 1s)."
      - alert: AttestationFailureRate
        expr: rate(policy_attestation_failures_total[5m]) > 0
        for: 10m
        labels:
          severity: critical
          service: policy-signer
        annotations:
          summary: "Attestation failures detected"
          description: "Attestations are failing consistently in the last 10 minutes."
      - alert: BundleDriftDetected
        expr: max_over_time(policy_bundle_digest_drift[10m]) == 1
        for: 10m
        labels:
          severity: warning
          service: policy-signer
        annotations:
          summary: "Policy bundle digest drift detected"
          description: "Promoted policy bundle digest does not match the distributed bundle."
