apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  name: intelgraph-api
  namespace: companyos
spec:
  strategy:
    canary:
      steps:
        - setWeight: 10
        - pause: { duration: 120 }
        - analysis:
            templates:
              - templateName: companyos-latency-error-slo
            args:
              - name: job
                value: intelgraph-api
              - name: p95_threshold
                value: "0.8"
              - name: err_threshold
                value: "0.02"
        - setWeight: 25
        - pause: { duration: 300 }
        - analysis:
            templates:
              - templateName: companyos-availability
            args:
              - name: job
                value: intelgraph-api
              - name: availability_threshold
                value: "0.995"
        - setWeight: 50
        - pause: { duration: 300 }
        - analysis:
            templates:
              - templateName: companyos-latency-error-slo
            args:
              - name: job
                value: intelgraph-api
              - name: p95_threshold
                value: "0.8"
              - name: err_threshold
                value: "0.02"
        - setWeight: 100
