<VirtualHost *:443>
  ServerName intelgraph.dev.topicality.co

  SSLEngine on
  SSLCertificateFile /etc/ssl/cloudflare/topicality-origin.pem
  SSLCertificateKeyFile /etc/ssl/cloudflare/topicality-origin.key

  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
  RequestHeader set X-Forwarded-Proto "https"
  RequestHeader set X-Forwarded-Host "intelgraph.dev.topicality.co"

  DocumentRoot /var/www/intelgraph
  <Directory /var/www/intelgraph>
    Options -Indexes +FollowSymLinks
    AllowOverride All
    Require all granted
    FallbackResource /index.html
  </Directory>

  ProxyPass        /api/ http://127.0.0.1:5001/api/ retry=0
  ProxyPassReverse /api/ http://127.0.0.1:5001/api/

  ProxyPass        /graphql http://127.0.0.1:5001/graphql retry=0
  ProxyPassReverse /graphql http://127.0.0.1:5001/graphql

  ErrorLog ${APACHE_LOG_DIR}/intelgraph_error.log
  CustomLog ${APACHE_LOG_DIR}/intelgraph_access.log combined
</VirtualHost>

