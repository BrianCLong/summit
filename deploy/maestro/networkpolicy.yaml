apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: maestro-default-deny
  namespace: maestro-system
spec:
  podSelector: {}
  policyTypes: ['Ingress', 'Egress']
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: maestro-allow
  namespace: maestro-system
spec:
  podSelector:
    matchLabels: { app: maestro-server }
  ingress:
    - from:
        - namespaceSelector: { matchLabels: { kubernetes.io/metadata.name: ingress-nginx } }
  egress:
    - to: # Neo4j/Postgres/Redis in-cluster
        - namespaceSelector: { matchLabels: { kubernetes.io/metadata.name: data } }
      ports:
        [
          { protocol: TCP, port: 5432 },
          { protocol: TCP, port: 6379 },
          { protocol: TCP, port: 7687 },
        ]
    - to: # LLM egress (optional)
        - ipBlock: { cidr: 0.0.0.0/0 } # replace with provider IP/CIDR or egress gateway
      ports: [{ protocol: TCP, port: 443 }]
