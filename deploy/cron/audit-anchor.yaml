apiVersion: batch/v1
kind: CronJob
metadata: { name: audit-anchor, namespace: intelgraph }
spec:
  schedule: '5 0 * * *'
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          containers:
            - name: anchor
              image: python:3.12-slim
              env:
                - name: DATABASE_URL
                  valueFrom:
                    { secretKeyRef: { name: app-secrets, key: DATABASE_URL } }
                - name: AUDIT_ANCHOR_PRIVATE_KEY_PEM
                  valueFrom:
                    {
                      secretKeyRef:
                        {
                          name: app-secrets,
                          key: AUDIT_ANCHOR_PRIVATE_KEY_PEM,
                        },
                    }
              command: ['python', '/app/services/audit/anchor_daily.py']
              volumeMounts: [{ name: repo, mountPath: /app }]
          volumes: [{ name: repo, emptyDir: {} }]
