version: '3.8'
services:
  runtime:
    build:
      context: ../..
      dockerfile: packages/liquid-nano/deploy/Dockerfile
    environment:
      - LIQUID_NANO_CONFIG_PATH=/opt/liquid-nano/config/liquid-nano.config.example.json
      - PORT=8080
    ports:
      - '8080:8080'
    depends_on:
      - otel
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://localhost:8080/health']
      interval: 30s
      timeout: 5s
      retries: 3
  otel:
    image: otel/opentelemetry-collector:0.103.1
    command: ['--config=/etc/otel-config.yaml']
    volumes:
      - ../config/otel-collector-config.yaml:/etc/otel-config.yaml:ro
    ports:
      - '4318:4318'
      - '9464:9464'
  grafana:
    image: grafana/grafana:11.2.0
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - ../monitoring/grafana-dashboard.json:/etc/grafana/provisioning/dashboards/liquid-nano.json:ro
    ports:
      - '3000:3000'
