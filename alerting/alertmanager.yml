route:
  receiver: 'slack_and_pd'
receivers:
  - name: 'slack_and_pd'
    slack_configs:
      - api_url: ${SLACK_WEBHOOK_URL}
        channel: '#symphony-alerts'
        title: '[SLO] {{ .CommonLabels.alertname }} {{ .CommonLabels.severity }}'
        text: |-
          *Firing:* {{ .CommonAnnotations.summary }}
          *Model:* {{ index .CommonLabels "model" | default "n/a" }}
          *p95:* {{ index .CommonLabels "quantile" | default "0.95" }}
          *Budget:* {{ with $v := .Alerts.Firing }}{{ (index $v 0).Annotations.budget }}{{ end }}
          *Audit:* {{ with $v := .Alerts.Firing }}{{ (index $v 0).Annotations.audit_id }}{{ end }}
    pagerduty_configs:
      - routing_key: ${PAGERDUTY_ROUTING_KEY}
        severity: '{{ .CommonLabels.severity | default "warning" }}'
        description: '{{ .CommonAnnotations.summary }}'
