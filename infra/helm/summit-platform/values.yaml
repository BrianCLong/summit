global:
  namespace: summit
  imagePullSecrets: []
  mesh:
    enabled: true
    sidecarInjection: true
    peerAuthentication:
      enabled: true
      mtlsMode: STRICT
  ingress:
    enabled: true
    className: istio
    tls:
      enabled: true
      secretName: summit-tls
      issuerRef:
        kind: ClusterIssuer
        name: letsencrypt-prod
    hosts:
      - host: summit.example.com
        paths:
          - path: /
            serviceName: web
            servicePort: 80
  blueGreen:
    enabled: true
    activeColor: blue
    inactiveColor: green
    serviceLabelKey: rollout.summit.dev/color
    services:
      - name: web
        port: 80
        selector:
          app.kubernetes.io/name: web
      - name: gateway
        port: 80
        selector:
          app.kubernetes.io/name: gateway
      - name: intelgraph-api
        port: 80
        selector:
          app.kubernetes.io/name: intelgraph-api
  resourceQuota:
    enabled: true
    name: summit-quota
    hard:
      requests.cpu: "16"
      requests.memory: 64Gi
      limits.cpu: "32"
      limits.memory: 128Gi
      pods: "200"
      persistentvolumeclaims: "40"
  limitRange:
    enabled: true
    name: summit-limits
    default:
      cpu: 500m
      memory: 1Gi
    defaultRequest:
      cpu: 250m
      memory: 512Mi
    max:
      cpu: "2"
      memory: 4Gi
    min:
      cpu: 100m
      memory: 256Mi
  networkPolicies:
    enabled: true
    ingress:
      - name: allow-mesh-ingress
        podSelector: {}
        namespaceSelector:
          matchLabels:
            istio-injection: enabled
        ports:
          - port: 80
            protocol: TCP
          - port: 443
            protocol: TCP
      - name: allow-metrics
        podSelector:
          matchLabels:
            app.kubernetes.io/component: telemetry
        namespaceSelector:
          matchLabels:
            name: observability
        ports:
          - port: 9090
            protocol: TCP
    egress:
      - name: restrict-egress
        podSelector: {}
        policyTypes: [Egress]
        egress:
          - to:
              - namespaceSelector:
                  matchLabels:
                    istio-injection: enabled
            ports:
              - port: 443
                protocol: TCP
              - port: 5432
                protocol: TCP
  externalSecrets:
    enabled: true
    secretStoreRef:
      kind: ClusterSecretStore
      name: summit-vault
    refreshInterval: 1h
    secrets:
      - name: summit-database
        remoteRef:
          key: summit/database
          property: connection
      - name: summit-oidc
        remoteRef:
          key: summit/oidc
    creationPolicy: Owner
  hpa:
    enabled: true
    defaults:
      minReplicas: 2
      maxReplicas: 10
      cpu:
        averageUtilization: 70
      memory:
        averageUtilization: 75
    workloads:
      - name: intelgraph-api
        targetRef:
          apiVersion: apps/v1
          kind: Deployment
          name: intelgraph-api
        metrics:
          - type: Resource
            resource:
              name: cpu
              target:
                type: Utilization
                averageUtilization: 60
          - type: Resource
            resource:
              name: memory
              target:
                type: Utilization
                averageUtilization: 70
      - name: gateway
        targetRef:
          apiVersion: apps/v1
          kind: Deployment
          name: gateway
        metrics:
          - type: Resource
            resource:
              name: cpu
              target:
                type: Utilization
                averageUtilization: 65
      - name: web
        targetRef:
          apiVersion: apps/v1
          kind: Deployment
          name: web
        metrics:
          - type: Resource
            resource:
              name: cpu
              target:
                type: Utilization
                averageUtilization: 50
