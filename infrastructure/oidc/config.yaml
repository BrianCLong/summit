# IntelGraph OIDC Configuration
# MIT License - Copyright (c) 2025 IntelGraph

# OIDC Provider Configuration
provider:
  issuer: '${OIDC_ISSUER:-https://auth.intelgraph.com}'
  authorization_endpoint: '${OIDC_AUTH_ENDPOINT:-https://auth.intelgraph.com/oauth/authorize}'
  token_endpoint: '${OIDC_TOKEN_ENDPOINT:-https://auth.intelgraph.com/oauth/token}'
  userinfo_endpoint: '${OIDC_USERINFO_ENDPOINT:-https://auth.intelgraph.com/userinfo}'
  jwks_uri: '${OIDC_JWKS_URI:-https://auth.intelgraph.com/.well-known/jwks.json}'
  end_session_endpoint: '${OIDC_LOGOUT_ENDPOINT:-https://auth.intelgraph.com/logout}'

# Client Configuration
client:
  id: '${OIDC_CLIENT_ID}'
  secret: '${OIDC_CLIENT_SECRET}'
  redirect_uri: '${OIDC_REDIRECT_URI:-https://app.intelgraph.com/auth/callback}'
  post_logout_redirect_uri: '${OIDC_POST_LOGOUT_URI:-https://app.intelgraph.com}'

# Scopes
scopes:
  - openid
  - profile
  - email
  - roles
  - tenant
  - assurance
  - purpose

# Token Configuration
tokens:
  access_token_lifetime: '${ACCESS_TOKEN_LIFETIME:-3600}' # 1 hour
  refresh_token_lifetime: '${REFRESH_TOKEN_LIFETIME:-604800}' # 1 week
  id_token_lifetime: '${ID_TOKEN_LIFETIME:-3600}' # 1 hour

# Claims Mapping
claims_mapping:
  user_id: 'sub'
  email: 'email'
  name: 'name'
  tenant_id: 'tenant_id'
  role: 'role'
  permissions: 'permissions'
  assurance: 'assurance'
  purpose_tags: 'purpose_tags'

# Security Settings
security:
  require_https: true
  enforce_pkce: true
  require_state: true
  require_nonce: true
  max_age: 86400 # 24 hours
  webauthn_step_up_acr: 'loa3'

# Session Configuration
session:
  cookie_name: 'intelgraph_session'
  secure: true
  http_only: true
  same_site: 'strict'
  max_age: 3600 # 1 hour

# SCIM configuration
scim:
  base_url: '${SCIM_BASE_URL:-https://auth.intelgraph.com/scim/v2}'
  provisioning_token: '${SCIM_BEARER_TOKEN}'
  tenant_extension: 'urn:ietf:params:scim:schemas:extension:intelgraph:1.0:tenant'
  required_purpose_tags:
    - investigation
    - fraud
    - audit

# WebAuthn settings for MFA step-up
webauthn:
  relying_party_id: '${WEBAUTHN_RP_ID:-intelgraph.com}'
  relying_party_name: 'IntelGraph Summit Platform'
  origins:
    - 'https://app.intelgraph.com'
    - 'https://*.tenant.intelgraph.com'
  attestation: 'direct'
  timeout_ms: 60000
  challenge_ttl_ms: 300000
