<!doctype html>
<html>
  <head>
    <title>IntelGraph GraphQL Playground</title>
    <script src="https://unpkg.com/graphiql/graphiql.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/graphiql/graphiql.min.css" />
    <style>
      body {
        margin: 0;
        height: 100vh;
        overflow: hidden;
      }
      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 20px;
        font-family: Arial, sans-serif;
      }
      .header h1 {
        margin: 0;
        font-size: 24px;
      }
      .header p {
        margin: 5px 0 0 0;
        opacity: 0.9;
      }
      .playground-container {
        height: calc(100vh - 80px);
      }
      .sample-queries {
        position: absolute;
        top: 90px;
        right: 20px;
        width: 300px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 15px;
        font-family: Arial, sans-serif;
        z-index: 1000;
        max-height: 400px;
        overflow-y: auto;
      }
      .sample-queries h3 {
        margin: 0 0 10px 0;
        color: #333;
      }
      .sample-query {
        margin: 8px 0;
        padding: 8px;
        background: #f5f5f5;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }
      .sample-query:hover {
        background: #e0e0e0;
      }
      .sample-query code {
        display: block;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>ðŸš€ IntelGraph GraphQL Playground</h1>
      <p>
        Interactive exploration of the IntelGraph intelligence analysis platform
        API
      </p>
    </div>

    <div class="sample-queries">
      <h3>Sample Queries</h3>

      <div class="sample-query" onclick="loadQuery(healthQuery)">
        <strong>Health Check</strong>
        <code>query HealthCheck</code>
      </div>

      <div class="sample-query" onclick="loadQuery(investigationsQuery)">
        <strong>List Investigations</strong>
        <code>query GetInvestigations</code>
      </div>

      <div class="sample-query" onclick="loadQuery(entitiesQuery)">
        <strong>Search Entities</strong>
        <code>query SearchEntities</code>
      </div>

      <div class="sample-query" onclick="loadQuery(relationshipsQuery)">
        <strong>Find Relationships</strong>
        <code>query FindRelationships</code>
      </div>

      <div
        class="sample-query"
        onclick="loadQuery(createInvestigationMutation)"
      >
        <strong>Create Investigation</strong>
        <code>mutation CreateInvestigation</code>
      </div>

      <div class="sample-query" onclick="loadQuery(copilotQuery)">
        <strong>Copilot Analysis</strong>
        <code>query CopilotRuns</code>
      </div>

      <div class="sample-query" onclick="loadQuery(graphAnalyticsQuery)">
        <strong>Graph Analytics</strong>
        <code>query GraphMetrics</code>
      </div>

      <div class="sample-query" onclick="loadQuery(complexAnalysisQuery)">
        <strong>Complex Analysis</strong>
        <code>query EntityNetwork</code>
      </div>
    </div>

    <div id="graphiql" class="playground-container"></div>

    <script>
      // Sample queries demonstrating IntelGraph capabilities
      const healthQuery = `# Health Check - Verify system status
query HealthCheck {
  __type(name: "Query") {
    name
    fields {
      name
      type {
        name
      }
    }
  }
}`;

      const investigationsQuery = `# List all investigations with metadata
query GetInvestigations {
  investigations {
    id
    title
    description
    status
    created_at
    updated_at
    metadata
    entities {
      id
      name
      type
      properties
    }
  }
}`;

      const entitiesQuery = `# Search entities by type and properties
query SearchEntities($type: String, $search: String) {
  entities(type: $type, search: $search) {
    id
    name
    type
    properties
    confidence
    source
    investigation_id
    relationships {
      id
      type
      target_entity {
        id
        name
        type
      }
      strength
    }
  }
}

# Variables:
# {
#   "type": "PERSON",
#   "search": "analyst"
# }`;

      const relationshipsQuery = `# Find relationships between entities
query FindRelationships($entity_id: ID!) {
  relationships(entity_id: $entity_id) {
    id
    type
    source_entity {
      id
      name
      type
    }
    target_entity {
      id
      name
      type
    }
    strength
    confidence
    properties
    created_at
  }
}

# Variables:
# {
#   "entity_id": "your-entity-id-here"
# }`;

      const createInvestigationMutation = `# Create a new investigation
mutation CreateInvestigation($input: CreateInvestigationInput!) {
  createInvestigation(input: $input) {
    id
    title
    description
    status
    created_at
    metadata
  }
}

# Variables:
# {
#   "input": {
#     "title": "New Intelligence Investigation",
#     "description": "Investigating suspicious network activity",
#     "metadata": {
#       "priority": "high",
#       "analyst": "system-demo"
#     }
#   }
# }`;

      const copilotQuery = `# Query Copilot analysis runs
query CopilotRuns($investigation_id: ID) {
  copilotRuns(investigation_id: $investigation_id) {
    id
    goal_text
    status
    plan
    created_at
    started_at
    finished_at
    tasks {
      id
      task_type
      status
      input_params
      output_data
    }
    events {
      id
      event_level
      message
      payload
      created_at
    }
  }
}

# Variables:
# {
#   "investigation_id": "your-investigation-id"
# }`;

      const graphAnalyticsQuery = `# Graph analytics and metrics
query GraphMetrics {
  graphStats {
    total_entities
    total_relationships
    entity_types {
      type
      count
    }
    relationship_types {
      type
      count
    }
  }
  
  centralityAnalysis {
    top_entities {
      entity {
        id
        name
        type
      }
      centrality_score
    }
  }
}`;

      const complexAnalysisQuery = `# Complex entity network analysis
query EntityNetwork($center_entity: ID!, $depth: Int = 2) {
  entityNetwork(center_entity: $center_entity, depth: $depth) {
    entities {
      id
      name
      type
      properties
      centrality_score
      community_id
    }
    relationships {
      id
      source_id
      target_id
      type
      strength
      weight
    }
    communities {
      id
      size
      modularity
      entities
    }
    metrics {
      total_nodes
      total_edges
      density
      clustering_coefficient
      diameter
    }
  }
}

# Variables:
# {
#   "center_entity": "your-entity-id",
#   "depth": 3
# }`;

      // Initialize GraphiQL
      function loadQuery(query) {
        if (window.graphiqlInstance) {
          window.graphiqlInstance.setState({ query });
        }
      }

      const graphiqlContainer = document.getElementById('graphiql');

      // Create GraphiQL instance
      const fetcher = GraphiQL.createFetcher({
        url: '/graphql', // Adjust this to your GraphQL endpoint
      });

      const root = ReactDOM.createRoot(graphiqlContainer);

      const graphiqlElement = React.createElement(GraphiQL, {
        fetcher,
        query: healthQuery,
        variables: '{}',
        headers: '{"Authorization": "Bearer your-jwt-token"}',
        onEditQuery: (query) => {
          // Store reference to update query programmatically
        },
      });

      root.render(graphiqlElement);

      // Store reference for query loading
      window.graphiqlInstance = {
        setState: (newState) => {
          // This would need to be properly implemented with React state management
          console.log('Loading query:', newState.query);
        },
      };

      // Add welcome message
      setTimeout(() => {
        console.log(`
ðŸš€ Welcome to IntelGraph GraphQL Playground!

Features available:
âœ… Interactive schema exploration
âœ… Query autocomplete and validation  
âœ… Real-time query execution
âœ… Sample queries for common operations
âœ… Variables and headers support

Try the sample queries on the right to explore:
- Health checks and system status
- Investigation management
- Entity search and analysis
- Relationship discovery
- Copilot AI-powered analysis
- Graph analytics and metrics

Happy querying! ðŸŽ¯
            `);
      }, 1000);
    </script>

    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
  </body>
</html>
