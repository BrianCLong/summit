<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Copy/Paste Detector Report</title><link href="styles/tailwind.css" rel="stylesheet"><link href="styles/prism.css" rel="stylesheet"></head><body class="bg-gray-100"><header class="bg-white shadow py-4"><div class="container mx-auto px-4"><h1 class="text-3xl font-semibold text-gray-800">jscpd - copy/paste report</h1></div></header><main class="container mx-auto my-8 p-4 bg-white shadow rounded"><section class="mb-8" id="dashboard"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Dashboard</h2><div class="grid grid-cols-4 gap-4"><div class="bg-blue-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-blue-800 mb-2">Total Files</h3><span class="text-4xl font-bold text-blue-800">2185</span></div><div class="bg-green-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-green-800 mb-2">Total Lines of Code</h3><span class="text-4xl font-bold text-green-800">482063</span></div><div class="bg-yellow-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-yellow-800 mb-2">Number of Clones</h3><span class="text-4xl font-bold text-yellow-800">518</span></div><div class="bg-red-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-red-800 mb-2">Duplicated Lines</h3><span class="text-4xl font-bold text-red-800">9594 (1.99%)</span></div></div></section><section class="mb-8" id="formats"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Formats with Duplications</h2><table class="w-full table-auto"><thead><tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal"><th class="py-3 px-6 text-left">Format</th><th class="py-3 px-6 text-left">Files</th><th class="py-3 px-6 text-left">Lines</th><th class="py-3 px-6 text-left">Clones</th><th class="py-3 px-6 text-left">Duplicated Lines</th><th class="py-3 px-6 text-left">Duplicated Tokens</th></tr></thead><tbody><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#javascript-clones">javascript</a></td><td class="py-3 px-6">683</td><td class="py-3 px-6">114554</td><td class="py-3 px-6">177</td><td class="py-3 px-6">4240</td><td class="py-3 px-6">35138</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#tsx-clones">tsx</a></td><td class="py-3 px-6">258</td><td class="py-3 px-6">50993</td><td class="py-3 px-6">37</td><td class="py-3 px-6">588</td><td class="py-3 px-6">5360</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#typescript-clones">typescript</a></td><td class="py-3 px-6">1014</td><td class="py-3 px-6">264992</td><td class="py-3 px-6">268</td><td class="py-3 px-6">4194</td><td class="py-3 px-6">34409</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#json-clones">json</a></td><td class="py-3 px-6">7</td><td class="py-3 px-6">1013</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#jsx-clones">jsx</a></td><td class="py-3 px-6">136</td><td class="py-3 px-6">33502</td><td class="py-3 px-6">34</td><td class="py-3 px-6">549</td><td class="py-3 px-6">4798</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#graphql-clones">graphql</a></td><td class="py-3 px-6">27</td><td class="py-3 px-6">2503</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#css-clones">css</a></td><td class="py-3 px-6">4</td><td class="py-3 px-6">1087</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#sql-clones">sql</a></td><td class="py-3 px-6">27</td><td class="py-3 px-6">6178</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#markdown-clones">markdown</a></td><td class="py-3 px-6">14</td><td class="py-3 px-6">4312</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#python-clones">python</a></td><td class="py-3 px-6">15</td><td class="py-3 px-6">2929</td><td class="py-3 px-6">2</td><td class="py-3 px-6">23</td><td class="py-3 px-6">223</td></tr></tbody></table></section><section class="mb-8" id="txt-clones"><a name="javascript-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">javascript</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">client/src/pages/Search/components/FacetPanel.tsx (Line 297:2 - Line 321:2), client/src/pages/Search/components/FacetPanel.tsx (Line 257:2 - Line 278:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup0"><code class="language-javascript text-sm text-gray-800">}
                    /&gt;
                  &lt;/ListItemButton&gt;
                &lt;/ListItem&gt;
              ))}
            &lt;/List&gt;
          &lt;/AccordionDetails&gt;
        &lt;/Accordion&gt;

        {/* Date Range */}
        &lt;Accordion
          expanded={expandedSections.has('dateRange')}
          onChange={() =&gt; toggleSection('dateRange')}
          sx={{ boxShadow: 'none', '&amp;:before': { display: 'none' } }}
        &gt;
          &lt;AccordionSummary
            expandIcon={&lt;ExpandMore /&gt;}
            sx={{ px: 0, minHeight: 40 }}
          &gt;
            &lt;Typography variant=&quot;subtitle2&quot; sx={{ fontWeight: 'bold' }}&gt;
              Date Range
            &lt;/Typography&gt;
          &lt;/AccordionSummary&gt;
          &lt;AccordionDetails sx={{ px: 0, pt: 0 }}&gt;
            &lt;Stack spacing={2</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/pages/Search/components/FacetPanel.tsx (Line 348:2 - Line 395:2), client/src/pages/Search/components/FacetPanel.tsx (Line 297:2 - Line 278:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup1"><code class="language-javascript text-sm text-gray-800">1}&gt;
                &lt;Chip
                  label=&quot;Last 7 days&quot;
                  size=&quot;small&quot;
                  variant=&quot;outlined&quot;
                  onClick={() =&gt; {
                    const end = new Date().toISOString().split('T')[0];
                    const start = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)
                      .toISOString()
                      .split('T')[0];
                    updateFilters('dateRange', { start, end });
                  }}
                /&gt;
                &lt;Chip
                  label=&quot;Last 30 days&quot;
                  size=&quot;small&quot;
                  variant=&quot;outlined&quot;
                  onClick={() =&gt; {
                    const end = new Date().toISOString().split('T')[0];
                    const start = new Date(
                      Date.now() - 30 * 24 * 60 * 60 * 1000,
                    )
                      .toISOString()
                      .split('T')[0];
                    updateFilters('dateRange', { start, end });
                  }}
                /&gt;
              &lt;/Stack&gt;
            &lt;/Stack&gt;
          &lt;/AccordionDetails&gt;
        &lt;/Accordion&gt;

        {/* Risk Score */}
        &lt;Accordion
          expanded={expandedSections.has('riskScore')}
          onChange={() =&gt; toggleSection('riskScore')}
          sx={{ boxShadow: 'none', '&amp;:before': { display: 'none' } }}
        &gt;
          &lt;AccordionSummary
            expandIcon={&lt;ExpandMore /&gt;}
            sx={{ px: 0, minHeight: 40 }}
          &gt;
            &lt;Typography variant=&quot;subtitle2&quot; sx={{ fontWeight: 'bold' }}&gt;
              Risk Score ({filters.riskScore[0]}% - {filters.riskScore[1]}%)
            &lt;/Typography&gt;
          &lt;/AccordionSummary&gt;
          &lt;AccordionDetails sx={{ px: 0, pt: 0 }}&gt;
            &lt;Box sx={{</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/pages/Search/components/FacetPanel.tsx (Line 412:2 - Line 437:15), client/src/pages/Search/components/FacetPanel.tsx (Line 257:2 - Line 278:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup2"><code class="language-javascript text-sm text-gray-800">}
              /&gt;
            &lt;/Box&gt;
          &lt;/AccordionDetails&gt;
        &lt;/Accordion&gt;

        {/* Classification Level */}
        &lt;Accordion
          expanded={expandedSections.has('classifications')}
          onChange={() =&gt; toggleSection('classifications')}
          sx={{ boxShadow: 'none', '&amp;:before': { display: 'none' } }}
        &gt;
          &lt;AccordionSummary
            expandIcon={&lt;ExpandMore /&gt;}
            sx={{ px: 0, minHeight: 40 }}
          &gt;
            &lt;Typography variant=&quot;subtitle2&quot; sx={{ fontWeight: 'bold' }}&gt;
              Classification{' '}
              {filters.classifications.length &gt; 0 &amp;&amp;
                `(${filters.classifications.length})`}
            &lt;/Typography&gt;
          &lt;/AccordionSummary&gt;
          &lt;AccordionDetails sx={{ px: 0, pt: 0 }}&gt;
            &lt;List dense&gt;
              {classifications.map((classification) =&gt; (
                &lt;ListItem key={classification</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/pages/Search/components/FacetPanel.tsx (Line 466:23 - Line 494:7), client/src/pages/Search/components/FacetPanel.tsx (Line 296:6 - Line 278:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup3"><code class="language-javascript text-sm text-gray-800">)}
                      tabIndex={-1}
                    /&gt;
                  &lt;/ListItemButton&gt;
                &lt;/ListItem&gt;
              ))}
            &lt;/List&gt;
          &lt;/AccordionDetails&gt;
        &lt;/Accordion&gt;

        {/* Intelligence Sources */}
        &lt;Accordion
          expanded={expandedSections.has('sources')}
          onChange={() =&gt; toggleSection('sources')}
          sx={{ boxShadow: 'none', '&amp;:before': { display: 'none' } }}
        &gt;
          &lt;AccordionSummary
            expandIcon={&lt;ExpandMore /&gt;}
            sx={{ px: 0, minHeight: 40 }}
          &gt;
            &lt;Typography variant=&quot;subtitle2&quot; sx={{ fontWeight: 'bold' }}&gt;
              Intelligence Sources{' '}
              {filters.sources.length &gt; 0 &amp;&amp; `(${filters.sources.length})`}
            &lt;/Typography&gt;
          &lt;/AccordionSummary&gt;
          &lt;AccordionDetails sx={{ px: 0, pt: 0 }}&gt;
            &lt;List dense&gt;
              {sources.map((source) =&gt; (
                &lt;ListItem key={source</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/pages/Search/components/FacetPanel.tsx (Line 505:7 - Line 531:2), client/src/pages/Search/components/FacetPanel.tsx (Line 296:5 - Line 278:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup4"><code class="language-javascript text-sm text-gray-800">.value)}
                      tabIndex={-1}
                    /&gt;
                  &lt;/ListItemButton&gt;
                &lt;/ListItem&gt;
              ))}
            &lt;/List&gt;
          &lt;/AccordionDetails&gt;
        &lt;/Accordion&gt;

        {/* Popular Tags */}
        &lt;Accordion
          expanded={expandedSections.has('tags')}
          onChange={() =&gt; toggleSection('tags')}
          sx={{ boxShadow: 'none', '&amp;:before': { display: 'none' } }}
        &gt;
          &lt;AccordionSummary
            expandIcon={&lt;ExpandMore /&gt;}
            sx={{ px: 0, minHeight: 40 }}
          &gt;
            &lt;Typography variant=&quot;subtitle2&quot; sx={{ fontWeight: 'bold' }}&gt;
              Popular Tags{' '}
              {filters.tags.length &gt; 0 &amp;&amp; `(${filters.tags.length})`}
            &lt;/Typography&gt;
          &lt;/AccordionSummary&gt;
          &lt;AccordionDetails sx={{ px: 0, pt: 0 }}&gt;
            &lt;Stack direction=&quot;row&quot; flexWrap=&quot;wrap&quot; spacing={1</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/graph-advanced/__tests__/AdvancedGraphInteractions.test.tsx (Line 81:10 - Line 206:15), client/src/components/graph-advanced/__tests__/AdvancedGraphInteractions.test.tsx (Line 20:6 - Line 163:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup6"><code class="language-javascript text-sm text-gray-800">} /&gt;,
    );

    expect(screen.getByText('Advanced Graph Analysis')).toBeInTheDocument();
    expect(screen.getByText('3 nodes, 2 edges')).toBeInTheDocument();
  });

  it('displays control buttons in header', () =&gt; {
    renderWithTheme(
      &lt;AdvancedGraphInteractions nodes={mockNodes} edges={mockEdges} /&gt;,
    );

    // Check for control buttons
    expect(
      screen.getByRole('button', { name: /zoom in/i }),
    ).toBeInTheDocument();
    expect(
      screen.getByRole('button', { name: /zoom out/i }),
    ).toBeInTheDocument();
    expect(
      screen.getByRole('button', { name: /center view/i }),
    ).toBeInTheDocument();
    expect(
      screen.getByRole('button', { name: /refresh/i }),
    ).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /export/i })).toBeInTheDocument();
  });

  it('renders all navigation tabs', () =&gt; {
    renderWithTheme(
      &lt;AdvancedGraphInteractions nodes={mockNodes} edges={mockEdges} /&gt;,
    );

    expect(screen.getByText('Metrics')).toBeInTheDocument();
    expect(screen.getByText('Filters')).toBeInTheDocument();
    expect(screen.getByText('Communities')).toBeInTheDocument();
    expect(screen.getByText('Pathfinding')).toBeInTheDocument();
  });

  it('displays network analysis metrics by default', () =&gt; {
    renderWithTheme(
      &lt;AdvancedGraphInteractions nodes={mockNodes} edges={mockEdges} /&gt;,
    );

    expect(screen.getByText('Network Analysis')).toBeInTheDocument();
    expect(screen.getByText('Network Density')).toBeInTheDocument();
    expect(screen.getByText('Clustering Coefficient')).toBeInTheDocument();
    expect(screen.getByText('Average Path Length')).toBeInTheDocument();
    expect(screen.getByText('Betweenness Centrality')).toBeInTheDocument();
    expect(screen.getByText('PageRank Score')).toBeInTheDocument();
  });

  it('switches to filters tab when clicked', () =&gt; {
    renderWithTheme(
      &lt;AdvancedGraphInteractions nodes={mockNodes} edges={mockEdges} /&gt;,
    );

    fireEvent.click(screen.getByText('Filters'));

    expect(screen.getByText('Filters &amp; View')).toBeInTheDocument();
    expect(screen.getAllByText('Layout Algorithm')[0]).toBeInTheDocument();
    expect(screen.getByText(/Centrality Threshold:/)).toBeInTheDocument();
    expect(screen.getByText('Node Types')).toBeInTheDocument();
  });

  it('switches to communities tab when clicked', () =&gt; {
    renderWithTheme(
      &lt;AdvancedGraphInteractions nodes={mockNodes} edges={mockEdges} /&gt;,
    );

    fireEvent.click(screen.getByText('Communities'));

    expect(screen.getByText('Community Analysis')).toBeInTheDocument();
    expect(
      screen.getByText(
        'Run community detection analysis to identify node clusters and relationships.',
      ),
    ).toBeInTheDocument();
  });

  it('switches to pathfinding tab when clicked', () =&gt; {
    renderWithTheme(
      &lt;AdvancedGraphInteractions nodes={mockNodes} edges={mockEdges} /&gt;,
    );

    fireEvent.click(screen.getByText('Pathfinding'));

    expect(screen.getByText('Path Analysis')).toBeInTheDocument();
    expect(
      screen.getByText(
        'Path analysis and shortest path algorithms coming soon...',
      ),
    ).toBeInTheDocument();
  });

  it('displays community detection button and handles click', async () =&gt; {
    renderWithTheme(
      &lt;AdvancedGraphInteractions nodes={mockNodes} edges={mockEdges} /&gt;,
    );

    const communityButton = screen.getByText('Run Community Detection');
    expect(communityButton).toBeInTheDocument();

    fireEvent.click(communityButton);

    // Should show analyzing state
    expect(screen.getByText('Analyzing...')).toBeInTheDocument();

    // Fast-forward time to complete analysis
    act(() =&gt; {
      jest.advanceTimersByTime(2000);
    });

    await waitFor(() =&gt; {
      expect(screen.getByText('Run Community Detection')).toBeInTheDocument(); // Button text restored
    });
  });

  it('handles layout algorithm selection', async () =&gt; {
    const onLayoutChange = jest.fn();

    renderWithTheme(
      &lt;AdvancedGraphInteractions
        nodes={mockNodes}
        edges={mockEdges}
        onLayoutChange={onLayoutChange</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.js (Line 122:7 - Line 132:23), client/src/store/slices/graphSlice.js (Line 109:8 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn19" onclick="toggleCodeBlock('cloneGroup19', 'expandBtn19', 'collapseBtn19')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn19" onclick="toggleCodeBlock('cloneGroup19', 'expandBtn19', 'collapseBtn19')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup19"><code class="language-javascript text-sm text-gray-800">);
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    toggleClusterExpansion</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.js (Line 160:2 - Line 170:8), client/src/store/slices/graphSlice.js (Line 109:2 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn20" onclick="toggleCodeBlock('cloneGroup20', 'expandBtn20', 'collapseBtn20')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn20" onclick="toggleCodeBlock('cloneGroup20', 'expandBtn20', 'collapseBtn20')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup20"><code class="language-javascript text-sm text-gray-800">;
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    addEdge</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.js (Line 171:6 - Line 187:11), client/src/store/slices/graphSlice.js (Line 154:6 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn21" onclick="toggleCodeBlock('cloneGroup21', 'expandBtn21', 'collapseBtn21')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn21" onclick="toggleCodeBlock('cloneGroup21', 'expandBtn21', 'collapseBtn21')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup21"><code class="language-javascript text-sm text-gray-800">.push(action.payload);
      // Update graph stats
      const numNodes = state.nodes.length;
      const numEdges = state.edges.length;
      const density =
        numNodes &gt; 1 ? (2 * numEdges) / (numNodes * (numNodes - 1)) : 0;
      state.graphStats = { numNodes, numEdges, density: density.toFixed(2) };
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    updateNode</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.js (Line 192:2 - Line 203:11), client/src/store/slices/graphSlice.js (Line 135:11 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn22" onclick="toggleCodeBlock('cloneGroup22', 'expandBtn22', 'collapseBtn22')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn22" onclick="toggleCodeBlock('cloneGroup22', 'expandBtn22', 'collapseBtn22')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup22"><code class="language-javascript text-sm text-gray-800">;
      }
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    deleteNode</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.js (Line 213:5 - Line 230:11), client/src/store/slices/graphSlice.js (Line 98:2 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn23" onclick="toggleCodeBlock('cloneGroup23', 'expandBtn23', 'collapseBtn23')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn23" onclick="toggleCodeBlock('cloneGroup23', 'expandBtn23', 'collapseBtn23')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup23"><code class="language-javascript text-sm text-gray-800">;
      }
      // Update graph stats
      const numNodes = state.nodes.length;
      const numEdges = state.edges.length;
      const density =
        numNodes &gt; 1 ? (2 * numEdges) / (numNodes * (numNodes - 1)) : 0;
      state.graphStats = { numNodes, numEdges, density: density.toFixed(2) };
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    deleteEdge</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.js (Line 236:2 - Line 253:17), client/src/store/slices/graphSlice.js (Line 213:2 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn24" onclick="toggleCodeBlock('cloneGroup24', 'expandBtn24', 'collapseBtn24')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn24" onclick="toggleCodeBlock('cloneGroup24', 'expandBtn24', 'collapseBtn24')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup24"><code class="language-javascript text-sm text-gray-800">= null;
      }
      // Update graph stats
      const numNodes = state.nodes.length;
      const numEdges = state.edges.length;
      const density =
        numNodes &gt; 1 ? (2 * numEdges) / (numNodes * (numNodes - 1)) : 0;
      state.graphStats = { numNodes, numEdges, density: density.toFixed(2) };
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    setSelectedNodes</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.js (Line 312:7 - Line 328:11), client/src/store/slices/graphSlice.js (Line 154:8 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn25" onclick="toggleCodeBlock('cloneGroup25', 'expandBtn25', 'collapseBtn25')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn25" onclick="toggleCodeBlock('cloneGroup25', 'expandBtn25', 'collapseBtn25')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup25"><code class="language-javascript text-sm text-gray-800">);
      // Update graph stats
      const numNodes = state.nodes.length;
      const numEdges = state.edges.length;
      const density =
        numNodes &gt; 1 ? (2 * numEdges) / (numNodes * (numNodes - 1)) : 0;
      state.graphStats = { numNodes, numEdges, density: density.toFixed(2) };
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    removeEdge</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.js (Line 329:2 - Line 345:18), client/src/store/slices/graphSlice.js (Line 154:2 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn26" onclick="toggleCodeBlock('cloneGroup26', 'expandBtn26', 'collapseBtn26')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn26" onclick="toggleCodeBlock('cloneGroup26', 'expandBtn26', 'collapseBtn26')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup26"><code class="language-javascript text-sm text-gray-800">action.payload);
      // Update graph stats
      const numNodes = state.nodes.length;
      const numEdges = state.edges.length;
      const density =
        numNodes &gt; 1 ? (2 * numEdges) / (numNodes * (numNodes - 1)) : 0;
      state.graphStats = { numNodes, numEdges, density: density.toFixed(2) };
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    setPathSourceNode</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/pages/IOC/IOCList.tsx (Line 407:2 - Line 468:14), client/src/pages/IOC/IOCList.tsx (Line 404:2 - Line 450:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn27" onclick="toggleCodeBlock('cloneGroup27', 'expandBtn27', 'collapseBtn27')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn27" onclick="toggleCodeBlock('cloneGroup27', 'expandBtn27', 'collapseBtn27')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup27"><code class="language-javascript text-sm text-gray-800">}&gt;
              &lt;Security color=&quot;error&quot; /&gt;
              &lt;Box&gt;
                &lt;Typography variant=&quot;subtitle2&quot; color=&quot;text.secondary&quot;&gt;
                  Active IOCs
                &lt;/Typography&gt;
                &lt;Typography variant=&quot;h4&quot; color=&quot;error.main&quot;&gt;
                  {activeIOCs}
                &lt;/Typography&gt;
              &lt;/Box&gt;
            &lt;/Stack&gt;
          &lt;/CardContent&gt;
        &lt;/Card&gt;
        &lt;Card sx={{ flex: 1, borderRadius: 3 }}&gt;
          &lt;CardContent&gt;
            &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
              &lt;Warning color=&quot;warning&quot; /&gt;
              &lt;Box&gt;
                &lt;Typography variant=&quot;subtitle2&quot; color=&quot;text.secondary&quot;&gt;
                  High Risk
                &lt;/Typography&gt;
                &lt;Typography variant=&quot;h4&quot; color=&quot;warning.main&quot;&gt;
                  {highRiskIOCs}
                &lt;/Typography&gt;
              &lt;/Box&gt;
            &lt;/Stack&gt;
          &lt;/CardContent&gt;
        &lt;/Card&gt;
        &lt;Card sx={{ flex: 1, borderRadius: 3 }}&gt;
          &lt;CardContent&gt;
            &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
              &lt;Timeline color=&quot;info&quot; /&gt;
              &lt;Box&gt;
                &lt;Typography variant=&quot;subtitle2&quot; color=&quot;text.secondary&quot;&gt;
                  Total Hits
                &lt;/Typography&gt;
                &lt;Typography variant=&quot;h4&quot; color=&quot;info.main&quot;&gt;
                  {totalHits}
                &lt;/Typography&gt;
              &lt;/Box&gt;
            &lt;/Stack&gt;
          &lt;/CardContent&gt;
        &lt;/Card&gt;
        &lt;Card sx={{ flex: 1, borderRadius: 3 }}&gt;
          &lt;CardContent&gt;
            &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
              &lt;Search color=&quot;primary&quot; /&gt;
              &lt;Box&gt;
                &lt;Typography variant=&quot;subtitle2&quot; color=&quot;text.secondary&quot;&gt;
                  Investigating
                &lt;/Typography&gt;
                &lt;Typography variant=&quot;h4&quot; color=&quot;primary.main&quot;&gt;
                  {investigatingIOCs}
                &lt;/Typography&gt;
              &lt;/Box&gt;
            &lt;/Stack&gt;
          &lt;/CardContent&gt;
        &lt;/Card&gt;
      &lt;/Stack&gt;

      {/* Main IOC List */}
      &lt;Card sx={{ borderRadius</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/pages/Hunting/HuntList.tsx (Line 288:13 - Line 432:4), client/src/pages/IOC/IOCList.tsx (Line 371:2 - Line 511:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn28" onclick="toggleCodeBlock('cloneGroup28', 'expandBtn28', 'collapseBtn28')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn28" onclick="toggleCodeBlock('cloneGroup28', 'expandBtn28', 'collapseBtn28')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup28"><code class="language-javascript text-sm text-gray-800">}
          &gt;
            &lt;IconButton size=&quot;small&quot;&gt;
              {params.row.status === 'RUNNING' ? &lt;Stop /&gt; : &lt;PlayArrow /&gt;}
            &lt;/IconButton&gt;
          &lt;/Tooltip&gt;
          &lt;Tooltip title=&quot;View Timeline&quot;&gt;
            &lt;IconButton size=&quot;small&quot;&gt;
              &lt;Timeline /&gt;
            &lt;/IconButton&gt;
          &lt;/Tooltip&gt;
        &lt;/Stack&gt;
      ),
    },
  ];

  const filteredHunts =
    hunts?.filter((hunt) =&gt; {
      if (selectedTab === 1 &amp;&amp; hunt.status !== 'RUNNING') return false;
      if (selectedTab === 2 &amp;&amp; hunt.status !== 'SCHEDULED') return false;
      if (selectedTab === 3 &amp;&amp; hunt.findings === 0) return false;
      return true;
    }) || [];

  const runningHunts = hunts?.filter((h) =&gt; h.status === 'RUNNING').length || 0;
  const totalFindings =
    hunts?.reduce((sum, hunt) =&gt; sum + hunt.findings, 0) || 0;
  const criticalHunts =
    hunts?.filter((h) =&gt; h.severity === 'CRITICAL').length || 0;
  const failedHunts = hunts?.filter((h) =&gt; h.status === 'FAILED').length || 0;

  return (
    &lt;Box sx={{ m: 2 }}&gt;
      {/* Stats Overview */}
      &lt;Stack direction=&quot;row&quot; spacing={2} sx={{ mb: 2 }}&gt;
        &lt;Card sx={{ flex: 1, borderRadius: 3 }}&gt;
          &lt;CardContent&gt;
            &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
              &lt;PlayArrow color=&quot;primary&quot; /&gt;
              &lt;Box&gt;
                &lt;Typography variant=&quot;subtitle2&quot; color=&quot;text.secondary&quot;&gt;
                  Active Hunts
                &lt;/Typography&gt;
                &lt;Typography variant=&quot;h4&quot; color=&quot;primary&quot;&gt;
                  {runningHunts}
                &lt;/Typography&gt;
              &lt;/Box&gt;
            &lt;/Stack&gt;
          &lt;/CardContent&gt;
        &lt;/Card&gt;
        &lt;Card sx={{ flex: 1, borderRadius: 3 }}&gt;
          &lt;CardContent&gt;
            &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
              &lt;Assessment color=&quot;warning&quot; /&gt;
              &lt;Box&gt;
                &lt;Typography variant=&quot;subtitle2&quot; color=&quot;text.secondary&quot;&gt;
                  Total Findings
                &lt;/Typography&gt;
                &lt;Typography variant=&quot;h4&quot; color=&quot;warning.main&quot;&gt;
                  {totalFindings}
                &lt;/Typography&gt;
              &lt;/Box&gt;
            &lt;/Stack&gt;
          &lt;/CardContent&gt;
        &lt;/Card&gt;
        &lt;Card sx={{ flex: 1, borderRadius: 3 }}&gt;
          &lt;CardContent&gt;
            &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
              &lt;Security color=&quot;error&quot; /&gt;
              &lt;Box&gt;
                &lt;Typography variant=&quot;subtitle2&quot; color=&quot;text.secondary&quot;&gt;
                  Critical Hunts
                &lt;/Typography&gt;
                &lt;Typography variant=&quot;h4&quot; color=&quot;error.main&quot;&gt;
                  {criticalHunts}
                &lt;/Typography&gt;
              &lt;/Box&gt;
            &lt;/Stack&gt;
          &lt;/CardContent&gt;
        &lt;/Card&gt;
        &lt;Card sx={{ flex: 1, borderRadius: 3 }}&gt;
          &lt;CardContent&gt;
            &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
              &lt;Error color=&quot;error&quot; /&gt;
              &lt;Box&gt;
                &lt;Typography variant=&quot;subtitle2&quot; color=&quot;text.secondary&quot;&gt;
                  Failed Hunts
                &lt;/Typography&gt;
                &lt;Typography variant=&quot;h4&quot; color=&quot;error.main&quot;&gt;
                  {failedHunts}
                &lt;/Typography&gt;
              &lt;/Box&gt;
            &lt;/Stack&gt;
          &lt;/CardContent&gt;
        &lt;/Card&gt;
      &lt;/Stack&gt;

      {/* Main Hunt List */}
      &lt;Card sx={{ borderRadius: 3 }}&gt;
        &lt;CardContent&gt;
          &lt;Stack
            direction=&quot;row&quot;
            justifyContent=&quot;space-between&quot;
            alignItems=&quot;center&quot;
            sx={{ mb: 2 }}
          &gt;
            &lt;Typography variant=&quot;h6&quot;&gt;Threat Hunting Operations&lt;/Typography&gt;
            &lt;Stack direction=&quot;row&quot; spacing={2}&gt;
              &lt;FormControl size=&quot;small&quot; sx={{ minWidth: 120 }}&gt;
                &lt;InputLabel&gt;Hunt Type&lt;/InputLabel&gt;
                &lt;Select
                  value={filterType}
                  label=&quot;Hunt Type&quot;
                  onChange={(e) =&gt; setFilterType(e.target.value)}
                &gt;
                  &lt;MenuItem value=&quot;ALL&quot;&gt;All Types&lt;/MenuItem&gt;
                  &lt;MenuItem value=&quot;IOC&quot;&gt;IOC Hunt&lt;/MenuItem&gt;
                  &lt;MenuItem value=&quot;BEHAVIORAL&quot;&gt;Behavioral&lt;/MenuItem&gt;
                  &lt;MenuItem value=&quot;NETWORK&quot;&gt;Network&lt;/MenuItem&gt;
                  &lt;MenuItem value=&quot;FINANCIAL&quot;&gt;Financial&lt;/MenuItem&gt;
                  &lt;MenuItem value=&quot;MITRE_ATT&amp;CK&quot;&gt;MITRE ATT&amp;CK&lt;/MenuItem&gt;
                &lt;/Select&gt;
              &lt;/FormControl&gt;
              &lt;FormControl size=&quot;small&quot; sx={{ minWidth: 120 }}&gt;
                &lt;InputLabel&gt;Status&lt;/InputLabel&gt;
                &lt;Select
                  value={filterStatus}
                  label=&quot;Status&quot;
                  onChange={(e) =&gt; setFilterStatus(e.target.value)}
                &gt;
                  &lt;MenuItem value=&quot;ALL&quot;&gt;All Status&lt;/MenuItem&gt;
                  &lt;MenuItem value=&quot;RUNNING&quot;&gt;Running&lt;/MenuItem&gt;
                  &lt;MenuItem value=&quot;SCHEDULED&quot;&gt;Scheduled&lt;/MenuItem&gt;
                  &lt;MenuItem value=&quot;COMPLETED&quot;&gt;Completed&lt;/MenuItem&gt;
                  &lt;MenuItem value=&quot;FAILED&quot;&gt;Failed&lt;/MenuItem&gt;
                &lt;/Select&gt;
              &lt;/FormControl&gt;
              &lt;Tooltip title=&quot;Refresh Hunt Status&quot;&gt;
                &lt;IconButton&gt;
                  &lt;Refresh /&gt;
                &lt;/IconButton&gt;
              &lt;/Tooltip&gt;
              &lt;Button
                variant=&quot;contained&quot;
                startIcon={&lt;Add</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/timeline/TimelineView.js (Line 195:2 - Line 205:8), client/src/features/timeline/TimelineView.js (Line 171:2 - Line 181:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn31" onclick="toggleCodeBlock('cloneGroup31', 'expandBtn31', 'collapseBtn31')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn31" onclick="toggleCodeBlock('cloneGroup31', 'expandBtn31', 'collapseBtn31')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup31"><code class="language-javascript text-sm text-gray-800">/&gt;}
            renderValue={(selected) =&gt; (
              &lt;Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5 }}&gt;
                {selected.map((value) =&gt; (
                  &lt;Chip key={value} label={value} /&gt;
                ))}
              &lt;/Box&gt;
            )}
            MenuProps={MenuProps}
          &gt;
            {allTags</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/explorer/MapPane.js (Line 13:6 - Line 33:6), client/src/features/explorer/TimelinePane.js (Line 13:11 - Line 33:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn33" onclick="toggleCodeBlock('cloneGroup33', 'expandBtn33', 'collapseBtn33')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn33" onclick="toggleCodeBlock('cloneGroup33', 'expandBtn33', 'collapseBtn33')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup33"><code class="language-javascript text-sm text-gray-800">) return;
    const handler = (e) =&gt; {
      if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
        e.preventDefault();
        if (!visible.length) return;
        const idx = visible.findIndex((v) =&gt; v.id === selected);
        const nextIdx =
          e.key === 'ArrowDown'
            ? (idx + 1) % visible.length
            : (idx - 1 + visible.length) % visible.length;
        dispatch({ type: 'select', id: visible[nextIdx].id });
      }
    };
    window.addEventListener('keydown', handler);
    return () =&gt; window.removeEventListener('keydown', handler);
  }, [activePane, visible, selected, dispatch]);

  return (
    &lt;div
      role=&quot;region&quot;
      aria-label=&quot;Map&quot;</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/compliance/DsarReviewer.tsx (Line 112:11 - Line 133:8), client/src/features/compliance/DsarReviewer.tsx (Line 109:11 - Line 119:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn36" onclick="toggleCodeBlock('cloneGroup36', 'expandBtn36', 'collapseBtn36')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn36" onclick="toggleCodeBlock('cloneGroup36', 'expandBtn36', 'collapseBtn36')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup36"><code class="language-javascript text-sm text-gray-800"> }}&gt;
                Subject
              &lt;/th&gt;
              &lt;th style={{ textAlign: 'left', padding: '8px 12px' }}&gt;Tenant&lt;/th&gt;
              &lt;th style={{ textAlign: 'left', padding: '8px 12px' }}&gt;
                Operation
              &lt;/th&gt;
              &lt;th style={{ textAlign: 'left', padding: '8px 12px' }}&gt;Status&lt;/th&gt;
              &lt;th style={{ textAlign: 'left', padding: '8px 12px' }}&gt;
                Submitted
              &lt;/th&gt;
              &lt;th style={{ textAlign: 'left', padding: '8px 12px' }}&gt;
                Actions
              &lt;/th&gt;
            &lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody&gt;
            {sortedRequests.map((request) =&gt; {
              const isActive = activeId === request.id;
              return (
                &lt;tr
                  key={request</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/admin/OverridesPanel.tsx (Line 236:19 - Line 258:15), client/src/features/admin/OverridesPanel.tsx (Line 215:7 - Line 231:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn37" onclick="toggleCodeBlock('cloneGroup37', 'expandBtn37', 'collapseBtn37')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn37" onclick="toggleCodeBlock('cloneGroup37', 'expandBtn37', 'collapseBtn37')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup37"><code class="language-javascript text-sm text-gray-800">})
                }
                style={{
                  padding: '8px',
                  border: '1px solid #ccc',
                  borderRadius: '4px',
                }}
              &gt;
                &lt;option value=&quot;budget_increase&quot;&gt;Budget Increase&lt;/option&gt;
                &lt;option value=&quot;approval_bypass&quot;&gt;Approval Bypass&lt;/option&gt;
                &lt;option value=&quot;pq_bypass&quot;&gt;Persisted Query Bypass&lt;/option&gt;
              &lt;/select&gt;
            &lt;/label&gt;

            &lt;label style={{ display: 'flex', flexDirection: 'column' }}&gt;
              &lt;span style={{ fontWeight: 600, marginBottom: 4 }}&gt;
                Duration (hours)
              &lt;/span&gt;
              &lt;input
                type=&quot;number&quot;
                min=&quot;1&quot;
                max=&quot;24&quot;
                value={newOverride.duration_hours</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/admin/OverridesPanel.tsx (Line 262:2 - Line 278:2), client/src/features/admin/OverridesPanel.tsx (Line 235:4 - Line 231:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn38" onclick="toggleCodeBlock('cloneGroup38', 'expandBtn38', 'collapseBtn38')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn38" onclick="toggleCodeBlock('cloneGroup38', 'expandBtn38', 'collapseBtn38')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup38"><code class="language-javascript text-sm text-gray-800">,
                  })
                }
                style={{
                  padding: '8px',
                  border: '1px solid #ccc',
                  borderRadius: '4px',
                }}
              /&gt;
            &lt;/label&gt;

            &lt;label style={{ display: 'flex', flexDirection: 'column' }}&gt;
              &lt;span style={{ fontWeight: 600, marginBottom: 4 }}&gt;
                Dual Approval
              &lt;/span&gt;
              &lt;label
                style={{</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/admin/OverridesPanel.tsx (Line 403:17 - Line 476:2), client/src/features/admin/OverridesPanel.tsx (Line 397:2 - Line 426:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn39" onclick="toggleCodeBlock('cloneGroup39', 'expandBtn39', 'collapseBtn39')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn39" onclick="toggleCodeBlock('cloneGroup39', 'expandBtn39', 'collapseBtn39')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup39"><code class="language-javascript text-sm text-gray-800">}}
              &gt;
                Status
              &lt;/th&gt;
              &lt;th
                style={{
                  padding: '12px',
                  textAlign: 'left',
                  borderBottom: '1px solid #dee2e6',
                }}
              &gt;
                Tenant
              &lt;/th&gt;
              &lt;th
                style={{
                  padding: '12px',
                  textAlign: 'left',
                  borderBottom: '1px solid #dee2e6',
                }}
              &gt;
                Type
              &lt;/th&gt;
              &lt;th
                style={{
                  padding: '12px',
                  textAlign: 'left',
                  borderBottom: '1px solid #dee2e6',
                }}
              &gt;
                Duration
              &lt;/th&gt;
              &lt;th
                style={{
                  padding: '12px',
                  textAlign: 'left',
                  borderBottom: '1px solid #dee2e6',
                }}
              &gt;
                Reason
              &lt;/th&gt;
              &lt;th
                style={{
                  padding: '12px',
                  textAlign: 'left',
                  borderBottom: '1px solid #dee2e6',
                }}
              &gt;
                Created By
              &lt;/th&gt;
              &lt;th
                style={{
                  padding: '12px',
                  textAlign: 'left',
                  borderBottom: '1px solid #dee2e6',
                }}
              &gt;
                Expires
              &lt;/th&gt;
              &lt;th
                style={{
                  padding: '12px',
                  textAlign: 'left',
                  borderBottom: '1px solid #dee2e6',
                }}
              &gt;
                Actions
              &lt;/th&gt;
            &lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody&gt;
            {overrides.length === 0 ? (
              &lt;tr&gt;
                &lt;td
                  colSpan={8</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/admin/CostExplorer.tsx (Line 181:10 - Line 208:14), client/src/features/admin/OverridesPanel.tsx (Line 162:10 - Line 192:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn40" onclick="toggleCodeBlock('cloneGroup40', 'expandBtn40', 'collapseBtn40')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn40" onclick="toggleCodeBlock('cloneGroup40', 'expandBtn40', 'collapseBtn40')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup40"><code class="language-javascript text-sm text-gray-800">,
            color: 'white',
            border: 'none',
            padding: '8px 16px',
            borderRadius: '4px',
            cursor: 'pointer',
          }}
        &gt;
          Export CSV
        &lt;/button&gt;
      &lt;/div&gt;

      {error &amp;&amp; (
        &lt;div
          style={{
            background: '#f8d7da',
            border: '1px solid #f5c6cb',
            color: '#721c24',
            padding: '12px',
            borderRadius: '4px',
            marginBottom: 16,
          }}
        &gt;
          {error}
        &lt;/div&gt;
      )}

      &lt;div style={{ marginBottom</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/admin/CostExplorer.tsx (Line 225:19 - Line 298:2), client/src/features/admin/CostExplorer.tsx (Line 219:2 - Line 248:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn41" onclick="toggleCodeBlock('cloneGroup41', 'expandBtn41', 'collapseBtn41')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn41" onclick="toggleCodeBlock('cloneGroup41', 'expandBtn41', 'collapseBtn41')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup41"><code class="language-javascript text-sm text-gray-800">}}
                &gt;
                  Tenant
                &lt;/th&gt;
                &lt;th
                  style={{
                    padding: '12px',
                    textAlign: 'left',
                    borderBottom: '1px solid #dee2e6',
                  }}
                &gt;
                  Daily Spent
                &lt;/th&gt;
                &lt;th
                  style={{
                    padding: '12px',
                    textAlign: 'left',
                    borderBottom: '1px solid #dee2e6',
                  }}
                &gt;
                  Daily Limit
                &lt;/th&gt;
                &lt;th
                  style={{
                    padding: '12px',
                    textAlign: 'left',
                    borderBottom: '1px solid #dee2e6',
                  }}
                &gt;
                  Daily Utilization
                &lt;/th&gt;
                &lt;th
                  style={{
                    padding: '12px',
                    textAlign: 'left',
                    borderBottom: '1px solid #dee2e6',
                  }}
                &gt;
                  Monthly Spent
                &lt;/th&gt;
                &lt;th
                  style={{
                    padding: '12px',
                    textAlign: 'left',
                    borderBottom: '1px solid #dee2e6',
                  }}
                &gt;
                  Monthly Limit
                &lt;/th&gt;
                &lt;th
                  style={{
                    padding: '12px',
                    textAlign: 'left',
                    borderBottom: '1px solid #dee2e6',
                  }}
                &gt;
                  Status
                &lt;/th&gt;
                &lt;th
                  style={{
                    padding: '12px',
                    textAlign: 'left',
                    borderBottom: '1px solid #dee2e6',
                  }}
                &gt;
                  Actions
                &lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              {budgets.length === 0 ? (
                &lt;tr&gt;
                  &lt;td
                    colSpan={8</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/admin/CostExplorer.tsx (Line 472:19 - Line 536:2), client/src/features/admin/CostExplorer.tsx (Line 466:2 - Line 495:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn42" onclick="toggleCodeBlock('cloneGroup42', 'expandBtn42', 'collapseBtn42')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn42" onclick="toggleCodeBlock('cloneGroup42', 'expandBtn42', 'collapseBtn42')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup42"><code class="language-javascript text-sm text-gray-800">}}
                &gt;
                  Timestamp
                &lt;/th&gt;
                &lt;th
                  style={{
                    padding: '8px',
                    textAlign: 'left',
                    borderBottom: '1px solid #dee2e6',
                  }}
                &gt;
                  Tenant
                &lt;/th&gt;
                &lt;th
                  style={{
                    padding: '8px',
                    textAlign: 'left',
                    borderBottom: '1px solid #dee2e6',
                  }}
                &gt;
                  Operation
                &lt;/th&gt;
                &lt;th
                  style={{
                    padding: '8px',
                    textAlign: 'left',
                    borderBottom: '1px solid #dee2e6',
                  }}
                &gt;
                  Estimated
                &lt;/th&gt;
                &lt;th
                  style={{
                    padding: '8px',
                    textAlign: 'left',
                    borderBottom: '1px solid #dee2e6',
                  }}
                &gt;
                  Actual
                &lt;/th&gt;
                &lt;th
                  style={{
                    padding: '8px',
                    textAlign: 'left',
                    borderBottom: '1px solid #dee2e6',
                  }}
                &gt;
                  Variance
                &lt;/th&gt;
                &lt;th
                  style={{
                    padding: '8px',
                    textAlign: 'left',
                    borderBottom: '1px solid #dee2e6',
                  }}
                &gt;
                  Status
                &lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              {ledgerEntries.length === 0 ? (
                &lt;tr&gt;
                  &lt;td
                    colSpan={7</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/admin/AdminStudio.tsx (Line 754:4 - Line 768:4), client/src/features/admin/AdminStudio.tsx (Line 727:10 - Line 751:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn43" onclick="toggleCodeBlock('cloneGroup43', 'expandBtn43', 'collapseBtn43')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn43" onclick="toggleCodeBlock('cloneGroup43', 'expandBtn43', 'collapseBtn43')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup43"><code class="language-javascript text-sm text-gray-800"> }}&gt;Allowed Flows&lt;/div&gt;
          &lt;div&gt;Count: {bundleStatus?.allowedFlowsCount ?? ''}&lt;/div&gt;
          &lt;div style={{ fontSize: 12, color: '#555' }}&gt;
            Sample: {(bundleStatus?.sample || []).slice(0, 3).join(', ') || ''}
          &lt;/div&gt;
          &lt;div style={{ fontSize: 12, color: '#555' }}&gt;
            Last updated: {new Date().toLocaleTimeString()}
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div
          style={{
            border: '1px solid #ddd',
            borderRadius: 8,
            padding: 12,
            minWidth: 280</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/versioning/VersionComparison.jsx (Line 391:2 - Line 438:2), client/src/components/versioning/VersionComparison.jsx (Line 387:2 - Line 412:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn45" onclick="toggleCodeBlock('cloneGroup45', 'expandBtn45', 'collapseBtn45')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn45" onclick="toggleCodeBlock('cloneGroup45', 'expandBtn45', 'collapseBtn45')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup45"><code class="language-javascript text-sm text-gray-800"> }} /&gt;
                  &lt;Typography variant=&quot;h4&quot; color=&quot;success.main&quot;&gt;
                    {comparisonData.summary.nodesAdded +
                      comparisonData.summary.edgesAdded}
                  &lt;/Typography&gt;
                  &lt;Typography variant=&quot;caption&quot;&gt;Added&lt;/Typography&gt;
                &lt;/CardContent&gt;
              &lt;/Card&gt;
            &lt;/Grid&gt;
            &lt;Grid item xs={6} md={3}&gt;
              &lt;Card&gt;
                &lt;CardContent sx={{ textAlign: 'center' }}&gt;
                  &lt;Remove color=&quot;error&quot; sx={{ fontSize: 40, mb: 1 }} /&gt;
                  &lt;Typography variant=&quot;h4&quot; color=&quot;error.main&quot;&gt;
                    {comparisonData.summary.nodesRemoved +
                      comparisonData.summary.edgesRemoved}
                  &lt;/Typography&gt;
                  &lt;Typography variant=&quot;caption&quot;&gt;Removed&lt;/Typography&gt;
                &lt;/CardContent&gt;
              &lt;/Card&gt;
            &lt;/Grid&gt;
            &lt;Grid item xs={6} md={3}&gt;
              &lt;Card&gt;
                &lt;CardContent sx={{ textAlign: 'center' }}&gt;
                  &lt;Edit color=&quot;warning&quot; sx={{ fontSize: 40, mb: 1 }} /&gt;
                  &lt;Typography variant=&quot;h4&quot; color=&quot;warning.main&quot;&gt;
                    {comparisonData.summary.nodesModified +
                      comparisonData.summary.edgesModified}
                  &lt;/Typography&gt;
                  &lt;Typography variant=&quot;caption&quot;&gt;Modified&lt;/Typography&gt;
                &lt;/CardContent&gt;
              &lt;/Card&gt;
            &lt;/Grid&gt;
            &lt;Grid item xs={6} md={3}&gt;
              &lt;Card&gt;
                &lt;CardContent sx={{ textAlign: 'center' }}&gt;
                  &lt;Compare sx={{ fontSize: 40, mb: 1 }} /&gt;
                  &lt;Typography variant=&quot;h4&quot;&gt;
                    {comparisonData.summary.totalChanges}
                  &lt;/Typography&gt;
                  &lt;Typography variant=&quot;caption&quot;&gt;Total Changes&lt;/Typography&gt;
                &lt;/CardContent&gt;
              &lt;/Card&gt;
            &lt;/Grid&gt;
          &lt;/Grid&gt;

          {comparisonData.conflicts.length &gt; 0 &amp;&amp; (
            &lt;Alert severity=&quot;warning&quot; sx={{</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/timeline/InvestigationTimeline.jsx (Line 574:10 - Line 647:2), client/src/components/timeline/InvestigationTimeline.jsx (Line 551:7 - Line 618:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn47" onclick="toggleCodeBlock('cloneGroup47', 'expandBtn47', 'collapseBtn47')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn47" onclick="toggleCodeBlock('cloneGroup47', 'expandBtn47', 'collapseBtn47')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup47"><code class="language-javascript text-sm text-gray-800"> }}
                            &gt;
                              {pattern.description}
                            &lt;/Typography&gt;
                          }
                          secondary={`Confidence: ${(pattern.confidence * 100).toFixed(0)}%`}
                        /&gt;
                      &lt;/ListItem&gt;
                    ))}
                  &lt;/List&gt;
                &lt;/AccordionDetails&gt;
              &lt;/Accordion&gt;

              &lt;Accordion&gt;
                &lt;AccordionSummary expandIcon={&lt;ExpandMoreIcon /&gt;}&gt;
                  &lt;Typography variant=&quot;subtitle2&quot;&gt;
                     Anomalies ({anomalies.length})
                  &lt;/Typography&gt;
                &lt;/AccordionSummary&gt;
                &lt;AccordionDetails&gt;
                  &lt;List dense&gt;
                    {anomalies.map((anomaly, index) =&gt; (
                      &lt;ListItem key={index} sx={{ px: 0 }}&gt;
                        &lt;ListItemIcon&gt;
                          &lt;WarningIcon color=&quot;warning&quot; /&gt;
                        &lt;/ListItemIcon&gt;
                        &lt;ListItemText
                          primary={
                            &lt;Typography
                              variant=&quot;body2&quot;
                              sx={{ fontSize: '0.85rem' }}
                            &gt;
                              {anomaly.description}
                            &lt;/Typography&gt;
                          }
                          secondary={anomaly.recommendation}
                        /&gt;
                      &lt;/ListItem&gt;
                    ))}
                  &lt;/List&gt;
                &lt;/AccordionDetails&gt;
              &lt;/Accordion&gt;

              &lt;Accordion&gt;
                &lt;AccordionSummary expandIcon={&lt;ExpandMoreIcon /&gt;}&gt;
                  &lt;Typography variant=&quot;subtitle2&quot;&gt;
                     Predictions ({predictions.length})
                  &lt;/Typography&gt;
                &lt;/AccordionSummary&gt;
                &lt;AccordionDetails&gt;
                  &lt;List dense&gt;
                    {predictions.map((prediction, index) =&gt; (
                      &lt;ListItem key={index} sx={{ px: 0 }}&gt;
                        &lt;ListItemIcon&gt;
                          &lt;ScheduleIcon color=&quot;info&quot; /&gt;
                        &lt;/ListItemIcon&gt;
                        &lt;ListItemText
                          primary={
                            &lt;Typography
                              variant=&quot;body2&quot;
                              sx={{ fontSize: '0.85rem' }}
                            &gt;
                              {prediction.description}
                            &lt;/Typography&gt;
                          }
                          secondary={`${(prediction.probability * 100).toFixed(0)}% confidence | ${prediction.timeframe}`}
                        /&gt;
                      &lt;/ListItem&gt;
                    ))}
                  &lt;/List&gt;
                &lt;/AccordionDetails&gt;
              &lt;/Accordion&gt;

              &lt;Box sx={{</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/threat/ThreatAssessmentEngine.jsx (Line 502:3 - Line 514:16), client/src/components/timeline/InvestigationTimeline.jsx (Line 363:3 - Line 382:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn48" onclick="toggleCodeBlock('cloneGroup48', 'expandBtn48', 'collapseBtn48')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn48" onclick="toggleCodeBlock('cloneGroup48', 'expandBtn48', 'collapseBtn48')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup48"><code class="language-javascript text-sm text-gray-800">={{ height: '100%', display: 'flex', flexDirection: 'column' }}&gt;
      {/* Header */}
      &lt;Card sx={{ mb: 2 }}&gt;
        &lt;CardContent&gt;
          &lt;Box
            sx={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
            }}
          &gt;
            &lt;Box&gt;
              &lt;Badge badgeContent={totalIndicators</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/threat/ThreatAssessmentEngine.jsx (Line 752:2 - Line 840:2), client/src/components/timeline/InvestigationTimeline.jsx (Line 532:2 - Line 647:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn49" onclick="toggleCodeBlock('cloneGroup49', 'expandBtn49', 'collapseBtn49')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn49" onclick="toggleCodeBlock('cloneGroup49', 'expandBtn49', 'collapseBtn49')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup49"><code class="language-javascript text-sm text-gray-800">}
                            size=&quot;small&quot;
                          /&gt;
                        &lt;/TableCell&gt;
                        &lt;TableCell align=&quot;center&quot;&gt;
                          &lt;Tooltip title=&quot;View Details&quot;&gt;
                            &lt;IconButton size=&quot;small&quot;&gt;
                              &lt;VisibilityIcon /&gt;
                            &lt;/IconButton&gt;
                          &lt;/Tooltip&gt;
                        &lt;/TableCell&gt;
                      &lt;/TableRow&gt;
                    ))}
                  &lt;/TableBody&gt;
                &lt;/Table&gt;
              &lt;/TableContainer&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        {/* Network Threats &amp; Analysis */}
        &lt;Grid item xs={12} lg={3}&gt;
          &lt;Card sx={{ height: '100%' }}&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h6&quot; gutterBottom&gt;
                 Network Threats
              &lt;/Typography&gt;

              &lt;Accordion defaultExpanded&gt;
                &lt;AccordionSummary expandIcon={&lt;ExpandMoreIcon /&gt;}&gt;
                  &lt;Typography variant=&quot;subtitle2&quot;&gt;
                     Active Threats ({networkThreats.length})
                  &lt;/Typography&gt;
                &lt;/AccordionSummary&gt;
                &lt;AccordionDetails&gt;
                  &lt;List dense&gt;
                    {networkThreats.map((threat, index) =&gt; (
                      &lt;ListItem key={index} sx={{ px: 0 }}&gt;
                        &lt;ListItemIcon&gt;
                          &lt;WarningIcon color=&quot;warning&quot; /&gt;
                        &lt;/ListItemIcon&gt;
                        &lt;ListItemText
                          primary={
                            &lt;Typography
                              variant=&quot;body2&quot;
                              sx={{ fontSize: '0.85rem' }}
                            &gt;
                              {threat.description}
                            &lt;/Typography&gt;
                          }
                          secondary={threat.mitigation}
                        /&gt;
                      &lt;/ListItem&gt;
                    ))}
                  &lt;/List&gt;
                &lt;/AccordionDetails&gt;
              &lt;/Accordion&gt;

              &lt;Accordion&gt;
                &lt;AccordionSummary expandIcon={&lt;ExpandMoreIcon /&gt;}&gt;
                  &lt;Typography variant=&quot;subtitle2&quot;&gt;
                     Threat Trends ({threatTrends.length})
                  &lt;/Typography&gt;
                &lt;/AccordionSummary&gt;
                &lt;AccordionDetails&gt;
                  &lt;List dense&gt;
                    {threatTrends.map((trend, index) =&gt; (
                      &lt;ListItem key={index} sx={{ px: 0 }}&gt;
                        &lt;ListItemIcon&gt;
                          &lt;TrendingUpIcon color=&quot;info&quot; /&gt;
                        &lt;/ListItemIcon&gt;
                        &lt;ListItemText
                          primary={
                            &lt;Typography
                              variant=&quot;body2&quot;
                              sx={{ fontSize: '0.85rem' }}
                            &gt;
                              {trend.description}
                            &lt;/Typography&gt;
                          }
                          secondary={`${trend.magnitude}% ${trend.direction} (${trend.timeframe})`}
                        /&gt;
                      &lt;/ListItem&gt;
                    ))}
                  &lt;/List&gt;
                &lt;/AccordionDetails&gt;
              &lt;/Accordion&gt;

              &lt;Box sx={{ mt: 2, p: 2, bgcolor: 'grey.50', borderRadius: 1 }}</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/threat/ThreatAssessmentEngine.js (Line 499:2 - Line 514:6), client/src/components/timeline/InvestigationTimeline.js (Line 360:2 - Line 375:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn50" onclick="toggleCodeBlock('cloneGroup50', 'expandBtn50', 'collapseBtn50')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn50" onclick="toggleCodeBlock('cloneGroup50', 'expandBtn50', 'collapseBtn50')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup50"><code class="language-javascript text-sm text-gray-800">;

  return (
    &lt;Box sx={{ height: '100%', display: 'flex', flexDirection: 'column' }}&gt;
      {/* Header */}
      &lt;Card sx={{ mb: 2 }}&gt;
        &lt;CardContent&gt;
          &lt;Box
            sx={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
            }}
          &gt;
            &lt;Box&gt;
              &lt;Badge</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/threat/ThreatAssessmentEngine.js (Line 788:7 - Line 799:7), client/src/components/timeline/InvestigationTimeline.js (Line 595:8 - Line 606:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn51" onclick="toggleCodeBlock('cloneGroup51', 'expandBtn51', 'collapseBtn51')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn51" onclick="toggleCodeBlock('cloneGroup51', 'expandBtn51', 'collapseBtn51')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup51"><code class="language-javascript text-sm text-gray-800">, index) =&gt; (
                      &lt;ListItem key={index} sx={{ px: 0 }}&gt;
                        &lt;ListItemIcon&gt;
                          &lt;WarningIcon color=&quot;warning&quot; /&gt;
                        &lt;/ListItemIcon&gt;
                        &lt;ListItemText
                          primary={
                            &lt;Typography
                              variant=&quot;body2&quot;
                              sx={{ fontSize: '0.85rem' }}
                            &gt;
                              {threat</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/threat/ThreatAssessmentEngine.js (Line 832:3 - Line 842:3), client/src/components/timeline/InvestigationTimeline.js (Line 639:2 - Line 649:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn52" onclick="toggleCodeBlock('cloneGroup52', 'expandBtn52', 'collapseBtn52')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn52" onclick="toggleCodeBlock('cloneGroup52', 'expandBtn52', 'collapseBtn52')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup52"><code class="language-javascript text-sm text-gray-800">}
                        /&gt;
                      &lt;/ListItem&gt;
                    ))}
                  &lt;/List&gt;
                &lt;/AccordionDetails&gt;
              &lt;/Accordion&gt;

              &lt;Box sx={{ mt: 2, p: 2, bgcolor: 'grey.50', borderRadius: 1 }}&gt;
                &lt;Typography variant=&quot;caption&quot; color=&quot;text.secondary&quot;&gt;
                  </code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/system/ConnectionStatus.jsx (Line 220:27 - Line 259:25), client/src/components/system/ConnectionStatus.jsx (Line 201:2 - Line 235:29)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn53" onclick="toggleCodeBlock('cloneGroup53', 'expandBtn53', 'collapseBtn53')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn53" onclick="toggleCodeBlock('cloneGroup53', 'expandBtn53', 'collapseBtn53')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup53"><code class="language-javascript text-sm text-gray-800">}}
                        &gt;
                          {getDatabaseStatusIcon(
                            statsData.serverStats.databaseStatus.redis,
                          )}
                          &lt;Typography variant=&quot;caption&quot;&gt;
                            {statsData.serverStats.databaseStatus.redis}
                          &lt;/Typography&gt;
                        &lt;/Box&gt;
                      &lt;/Box&gt;
                      &lt;Box
                        sx={{
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'center',
                          mb: 0.5,
                        }}
                      &gt;
                        &lt;Typography variant=&quot;body2&quot;&gt;PostgreSQL:&lt;/Typography&gt;
                        &lt;Box
                          sx={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: 0.5,
                          }}
                        &gt;
                          {getDatabaseStatusIcon(
                            statsData.serverStats.databaseStatus.postgres,
                          )}
                          &lt;Typography variant=&quot;caption&quot;&gt;
                            {statsData.serverStats.databaseStatus.postgres}
                          &lt;/Typography&gt;
                        &lt;/Box&gt;
                      &lt;/Box&gt;
                      &lt;Box
                        sx={{
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'center',
                        </code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/system/ConnectionStatus.jsx (Line 292:2 - Line 318:2), client/src/components/system/ConnectionStatus.jsx (Line 290:2 - Line 310:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn54" onclick="toggleCodeBlock('cloneGroup54', 'expandBtn54', 'collapseBtn54')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn54" onclick="toggleCodeBlock('cloneGroup54', 'expandBtn54', 'collapseBtn54')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup54"><code class="language-javascript text-sm text-gray-800">}&gt;
                        &lt;Typography variant=&quot;h4&quot; color=&quot;primary&quot;&gt;
                          {statsData.serverStats?.totalInvestigations || 0}
                        &lt;/Typography&gt;
                        &lt;Typography variant=&quot;caption&quot;&gt;
                          Investigations
                        &lt;/Typography&gt;
                      &lt;/Box&gt;
                    &lt;/Grid&gt;
                    &lt;Grid item xs={6} sm={3}&gt;
                      &lt;Box sx={{ textAlign: 'center' }}&gt;
                        &lt;Typography variant=&quot;h4&quot; color=&quot;secondary&quot;&gt;
                          {statsData.serverStats?.totalEntities || 0}
                        &lt;/Typography&gt;
                        &lt;Typography variant=&quot;caption&quot;&gt;Entities&lt;/Typography&gt;
                      &lt;/Box&gt;
                    &lt;/Grid&gt;
                    &lt;Grid item xs={6} sm={3}&gt;
                      &lt;Box sx={{ textAlign: 'center' }}&gt;
                        &lt;Typography variant=&quot;h4&quot; color=&quot;info.main&quot;&gt;
                          {statsData.serverStats?.totalRelationships || 0}
                        &lt;/Typography&gt;
                        &lt;Typography variant=&quot;caption&quot;&gt;Relationships&lt;/Typography&gt;
                      &lt;/Box&gt;
                    &lt;/Grid&gt;
                    &lt;Grid item xs={6} sm={3}&gt;
                      &lt;Box sx={{ textAlign: 'center' }}</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/psyops/PsyOpsDashboard.tsx (Line 710:2 - Line 778:17), client/src/components/psyops/PsyOpsDashboard.tsx (Line 699:2 - Line 717:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn56" onclick="toggleCodeBlock('cloneGroup56', 'expandBtn56', 'collapseBtn56')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn56" onclick="toggleCodeBlock('cloneGroup56', 'expandBtn56', 'collapseBtn56')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup56"><code class="language-javascript text-sm text-gray-800">} /&gt;
                        &lt;Typography variant=&quot;h6&quot;&gt;Signal Strength&lt;/Typography&gt;
                        &lt;Typography variant=&quot;h4&quot; color=&quot;primary&quot;&gt;
                          87%
                        &lt;/Typography&gt;
                      &lt;/Box&gt;
                    &lt;/Grid&gt;
                    &lt;Grid item xs={12} md={3}&gt;
                      &lt;Box
                        sx={{
                          textAlign: 'center',
                          p: 2,
                          border: '1px solid',
                          borderColor: 'divider',
                          borderRadius: 1,
                        }}
                      &gt;
                        &lt;Speed color=&quot;warning&quot; sx={{ fontSize: 40 }} /&gt;
                        &lt;Typography variant=&quot;h6&quot;&gt;Processing Rate&lt;/Typography&gt;
                        &lt;Typography variant=&quot;h4&quot; color=&quot;warning.main&quot;&gt;
                          1.2k/min
                        &lt;/Typography&gt;
                      &lt;/Box&gt;
                    &lt;/Grid&gt;
                    &lt;Grid item xs={12} md={3}&gt;
                      &lt;Box
                        sx={{
                          textAlign: 'center',
                          p: 2,
                          border: '1px solid',
                          borderColor: 'divider',
                          borderRadius: 1,
                        }}
                      &gt;
                        &lt;Analytics color=&quot;success&quot; sx={{ fontSize: 40 }} /&gt;
                        &lt;Typography variant=&quot;h6&quot;&gt;Detection Rate&lt;/Typography&gt;
                        &lt;Typography variant=&quot;h4&quot; color=&quot;success.main&quot;&gt;
                          94%
                        &lt;/Typography&gt;
                      &lt;/Box&gt;
                    &lt;/Grid&gt;
                    &lt;Grid item xs={12} md={3}&gt;
                      &lt;Box
                        sx={{
                          textAlign: 'center',
                          p: 2,
                          border: '1px solid',
                          borderColor: 'divider',
                          borderRadius: 1,
                        }}
                      &gt;
                        &lt;Warning color=&quot;error&quot; sx={{ fontSize: 40 }} /&gt;
                        &lt;Typography variant=&quot;h6&quot;&gt;Active Alerts&lt;/Typography&gt;
                        &lt;Typography variant=&quot;h4&quot; color=&quot;error.main&quot;&gt;
                          3
                        &lt;/Typography&gt;
                      &lt;/Box&gt;
                    &lt;/Grid&gt;
                  &lt;/Grid&gt;
                &lt;/CardContent&gt;
              &lt;/Card&gt;
            &lt;/Grid&gt;
          &lt;/Grid&gt;
        &lt;/TabPanel&gt;
      &lt;/Card&gt;

      {/* Adversary Simulation Dialog */}
      &lt;Dialog
        open={simulationDialog</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/psyops/EnhancedPsyOpsMonitor.tsx (Line 290:9 - Line 331:2), client/src/components/psyops/EnhancedPsyOpsMonitor.tsx (Line 287:2 - Line 318:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn62" onclick="toggleCodeBlock('cloneGroup62', 'expandBtn62', 'collapseBtn62')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn62" onclick="toggleCodeBlock('cloneGroup62', 'expandBtn62', 'collapseBtn62')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup62"><code class="language-javascript text-sm text-gray-800"> }}&gt;
              &lt;Typography variant=&quot;h4&quot; color=&quot;primary&quot;&gt;
                {metrics.totalAnalyzed}
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;body2&quot;&gt;Total Analyzed&lt;/Typography&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;
        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent sx={{ textAlign: 'center' }}&gt;
              &lt;Typography variant=&quot;h4&quot; color=&quot;error&quot;&gt;
                {metrics.threatsDetected}
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;body2&quot;&gt;Threats Detected&lt;/Typography&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;
        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent sx={{ textAlign: 'center' }}&gt;
              &lt;Typography variant=&quot;h4&quot; color=&quot;warning.main&quot;&gt;
                {(metrics.averageScore * 100).toFixed(1)}%
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;body2&quot;&gt;Avg Risk Score&lt;/Typography&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;
        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent sx={{ textAlign: 'center' }}&gt;
              &lt;Typography variant=&quot;h4&quot; color=&quot;success.main&quot;&gt;
                {isMonitoring ? 'Active' : 'Inactive'}
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;body2&quot;&gt;Monitor Status&lt;/Typography&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;
      &lt;/Grid&gt;

      {/* Manual Analysis Input */}
      &lt;Card sx={{</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/layout/ResponsiveLayout.jsx (Line 341:2 - Line 358:9), client/src/components/layout/ResponsiveLayout.jsx (Line 290:7 - Line 322:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn63" onclick="toggleCodeBlock('cloneGroup63', 'expandBtn63', 'collapseBtn63')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn63" onclick="toggleCodeBlock('cloneGroup63', 'expandBtn63', 'collapseBtn63')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup63"><code class="language-javascript text-sm text-gray-800"> }} /&gt;

        &lt;List
          subheader={
            (!miniDrawer || variant === 'temporary') &amp;&amp; (
              &lt;Typography
                variant=&quot;overline&quot;
                sx={{ px: 2, py: 1, color: 'text.secondary' }}
              &gt;
                Tools
              &lt;/Typography&gt;
            )
          }
        &gt;
          {toolsItems.map((item) =&gt; (
            &lt;ListItem key={item.id} disablePadding&gt;
              &lt;ListItemButton
                selected={location</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/layout/ResponsiveLayout.js (Line 368:6 - Line 382:2), client/src/components/layout/ResponsiveLayout.js (Line 326:25 - Line 341:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn64" onclick="toggleCodeBlock('cloneGroup64', 'expandBtn64', 'collapseBtn64')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn64" onclick="toggleCodeBlock('cloneGroup64', 'expandBtn64', 'collapseBtn64')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup64"><code class="language-javascript text-sm text-gray-800">: 'text.secondary',
                    minWidth:
                      miniDrawer &amp;&amp; variant !== 'temporary' ? 'auto' : 56,
                  }}
                &gt;
                  {item.icon}
                &lt;/ListItemIcon&gt;
                {(!miniDrawer || variant === 'temporary') &amp;&amp; (
                  &lt;ListItemText primary={item.label} /&gt;
                )}
              &lt;/ListItemButton&gt;
            &lt;/ListItem&gt;
          ))}
        &lt;/List&gt;
      &lt;/</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/intelligence/ThreatIntelligenceHub.tsx (Line 802:7 - Line 839:6), client/src/components/intelligence/ThreatIntelligenceHub.tsx (Line 711:7 - Line 754:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn65" onclick="toggleCodeBlock('cloneGroup65', 'expandBtn65', 'collapseBtn65')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn65" onclick="toggleCodeBlock('cloneGroup65', 'expandBtn65', 'collapseBtn65')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup65"><code class="language-javascript text-sm text-gray-800">, color: '#666' }}&gt;
                  &lt;div&gt;
                    &lt;strong&gt;Actors:&lt;/strong&gt; {campaign.actors.join(', ')}
                  &lt;/div&gt;
                  &lt;div&gt;
                    &lt;strong&gt;Status:&lt;/strong&gt; {campaign.status}
                  &lt;/div&gt;
                  &lt;div&gt;
                    &lt;strong&gt;Last Activity:&lt;/strong&gt;{' '}
                    {campaign.lastActivity.toLocaleDateString()}
                  &lt;/div&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            ))}
          &lt;/div&gt;
        )}

        {activeView === 'actors' &amp;&amp; (
          &lt;div
            style={{
              padding: '16px',
              border: '1px solid var(--hairline)',
              borderRadius: '8px',
            }}
          &gt;
            &lt;h4
              style={{
                fontSize: '16px',
                fontWeight: '600',
                marginBottom: '16px',
              }}
            &gt;
              Threat Actors
            &lt;/h4&gt;

            {mockActors.map((actor) =&gt; (
              &lt;div
                key={actor</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/intelligence/ThreatIntelligenceHub.tsx (Line 847:6 - Line 867:10), client/src/components/intelligence/ThreatIntelligenceHub.tsx (Line 762:9 - Line 782:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn66" onclick="toggleCodeBlock('cloneGroup66', 'expandBtn66', 'collapseBtn66')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn66" onclick="toggleCodeBlock('cloneGroup66', 'expandBtn66', 'collapseBtn66')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup66"><code class="language-javascript text-sm text-gray-800">)}
              &gt;
                &lt;div
                  style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'flex-start',
                    marginBottom: '8px',
                  }}
                &gt;
                  &lt;h5
                    style={{ fontSize: '14px', fontWeight: '600', margin: 0 }}
                  &gt;
                    {actor.name}
                  &lt;/h5&gt;
                  &lt;span
                    style={{
                      fontSize: '11px',
                      padding: '2px 6px',
                      borderRadius: '12px',
                      backgroundColor: '#6c757d'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/intelligence/ThreatIntelligenceHub.tsx (Line 875:2 - Line 918:2), client/src/components/intelligence/ThreatIntelligenceHub.tsx (Line 797:19 - Line 754:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn67" onclick="toggleCodeBlock('cloneGroup67', 'expandBtn67', 'collapseBtn67')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn67" onclick="toggleCodeBlock('cloneGroup67', 'expandBtn67', 'collapseBtn67')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup67"><code class="language-javascript text-sm text-gray-800">}}&gt;
                  &lt;strong&gt;Aliases:&lt;/strong&gt; {actor.aliases.join(', ')}
                &lt;/div&gt;

                &lt;div style={{ fontSize: '12px', color: '#666' }}&gt;
                  &lt;div&gt;
                    &lt;strong&gt;Sophistication:&lt;/strong&gt; {actor.sophistication}
                  &lt;/div&gt;
                  &lt;div&gt;
                    &lt;strong&gt;Geography:&lt;/strong&gt; {actor.geography.join(', ')}
                  &lt;/div&gt;
                  &lt;div&gt;
                    &lt;strong&gt;Status:&lt;/strong&gt;{' '}
                    {actor.isActive ? ' Active' : ' Inactive'}
                  &lt;/div&gt;
                  &lt;div&gt;
                    &lt;strong&gt;Last Activity:&lt;/strong&gt;{' '}
                    {actor.lastActivity.toLocaleDateString()}
                  &lt;/div&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            ))}
          &lt;/div&gt;
        )}

        {activeView === 'feeds' &amp;&amp; (
          &lt;div
            style={{
              padding: '16px',
              border: '1px solid var(--hairline)',
              borderRadius: '8px',
            }}
          &gt;
            &lt;h4
              style={{
                fontSize: '16px',
                fontWeight: '600',
                marginBottom: '16px',
              }}
            &gt;
              Intelligence Feeds
            &lt;/h4&gt;

            &lt;div style={{</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/graph/InteractiveGraphExplorer.jsx (Line 460:3 - Line 483:2), client/src/components/timeline/InvestigationTimeline.jsx (Line 363:3 - Line 385:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn68" onclick="toggleCodeBlock('cloneGroup68', 'expandBtn68', 'collapseBtn68')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn68" onclick="toggleCodeBlock('cloneGroup68', 'expandBtn68', 'collapseBtn68')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup68"><code class="language-javascript text-sm text-gray-800">={{ height: '100%', display: 'flex', flexDirection: 'column' }}&gt;
      {/* Header */}
      &lt;Card sx={{ mb: 2 }}&gt;
        &lt;CardContent&gt;
          &lt;Box
            sx={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
            }}
          &gt;
            &lt;Box&gt;
              &lt;Typography variant=&quot;h4&quot; gutterBottom&gt;
                 Interactive Graph Explorer
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;body1&quot; color=&quot;text.secondary&quot;&gt;
                Visualize and analyze complex relationships in your intelligence
                data
              &lt;/Typography&gt;
            &lt;/Box&gt;
            &lt;Box sx={{ display: 'flex', gap: 1 }}&gt;
              &lt;Button
                variant=&quot;outlined&quot;
                startIcon={&lt;</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/graph/IntelGraphCanvas.js (Line 113:15 - Line 139:3), client/src/components/graph/IntelGraphCanvas.js (Line 35:15 - Line 61:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn70" onclick="toggleCodeBlock('cloneGroup70', 'expandBtn70', 'collapseBtn70')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn70" onclick="toggleCodeBlock('cloneGroup70', 'expandBtn70', 'collapseBtn70')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup70"><code class="language-javascript text-sm text-gray-800">label: 'data(label)',
              color: '#FFFFFF',
              'text-valign': 'center',
              'text-halign': 'center',
              width: '60px',
              height: '60px',
              'font-size': '12px',
            },
          },
          {
            selector: 'edge',
            style: {
              width: 3,
              'line-color': '#ccc',
              'target-arrow-color': '#ccc',
              'target-arrow-shape': 'triangle',
              'curve-style': 'bezier',
            },
          },
        ],
        layout: {
          name: 'grid',
          rows: 1,
        },
      });

      cy</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/graph/GraphPopover.jsx (Line 18:2 - Line 43:2), client/src/components/graph/GraphPopover.jsx (Line 15:4 - Line 27:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn71" onclick="toggleCodeBlock('cloneGroup71', 'expandBtn71', 'collapseBtn71')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn71" onclick="toggleCodeBlock('cloneGroup71', 'expandBtn71', 'collapseBtn71')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup71"><code class="language-javascript text-sm text-gray-800">}&gt;
            {key}:
          &lt;/Typography&gt;
          &lt;Typography variant=&quot;caption&quot;&gt;{String(value)}&lt;/Typography&gt;
        &lt;/Box&gt;
      ))}
      {/* Display other relevant data fields */}
      {data.type &amp;&amp; (
        &lt;Box sx={{ display: 'flex', justifyContent: 'space-between', gap: 1 }}&gt;
          &lt;Typography variant=&quot;caption&quot; sx={{ fontWeight: 'bold' }}&gt;
            Type:
          &lt;/Typography&gt;
          &lt;Typography variant=&quot;caption&quot;&gt;{data.type}&lt;/Typography&gt;
        &lt;/Box&gt;
      )}
      {data.importance &amp;&amp; (
        &lt;Box sx={{ display: 'flex', justifyContent: 'space-between', gap: 1 }}&gt;
          &lt;Typography variant=&quot;caption&quot; sx={{ fontWeight: 'bold' }}&gt;
            Importance:
          &lt;/Typography&gt;
          &lt;Typography variant=&quot;caption&quot;&gt;{data.importance}&lt;/Typography&gt;
        &lt;/Box&gt;
      )}
      {data.weight &amp;&amp; (
        &lt;Box sx={{ display: 'flex', justifyContent: 'space-between', gap: 1 }}&gt;
          &lt;Typography variant=&quot;caption&quot; sx={{ fontWeight: 'bold' }}</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/graph/GraphExplorer.js (Line 145:9 - Line 155:10), client/src/components/graph/GraphExplorer.js (Line 121:7 - Line 131:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn73" onclick="toggleCodeBlock('cloneGroup73', 'expandBtn73', 'collapseBtn73')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn73" onclick="toggleCodeBlock('cloneGroup73', 'expandBtn73', 'collapseBtn73')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup73"><code class="language-javascript text-sm text-gray-800">);

        if (sourceNode &amp;&amp; targetNode) {
          ctx.beginPath();
          ctx.moveTo(sourceNode.x, sourceNode.y);
          ctx.lineTo(targetNode.x, targetNode.y);
          ctx.stroke();

          const midX = (sourceNode.x + targetNode.x) / 2;
          const midY = (sourceNode.y + targetNode.y) / 2;
          ctx.fillStyle = '#FF00FF'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/graph/AdvancedGraphView.js (Line 92:8 - Line 114:17), client/src/components/graph/SubgraphExplorerDialog.js (Line 19:9 - Line 41:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn77" onclick="toggleCodeBlock('cloneGroup77', 'expandBtn77', 'collapseBtn77')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn77" onclick="toggleCodeBlock('cloneGroup77', 'expandBtn77', 'collapseBtn77')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup77"><code class="language-javascript text-sm text-gray-800">,
      style: [
        {
          selector: 'node',
          style: {
            'background-color': '#888',
            label: 'data(label)',
            'font-size': 10,
          },
        },
        {
          selector: 'edge',
          style: {
            width: 1,
            'line-color': '#bbb',
            'target-arrow-shape': 'triangle',
            'target-arrow-color': '#bbb',
            label: 'data(label)',
            'font-size': 8,
          },
        },
      ],
      wheelSensitivity</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/graph/AdvancedGraphView.js (Line 321:9 - Line 331:2), client/src/components/graph/AdvancedGraphView.js (Line 208:7 - Line 217:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn78" onclick="toggleCodeBlock('cloneGroup78', 'expandBtn78', 'collapseBtn78')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn78" onclick="toggleCodeBlock('cloneGroup78', 'expandBtn78', 'collapseBtn78')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup78"><code class="language-javascript text-sm text-gray-800">setEdgeDetail({
          id: e.id(),
          type: e.data('type'),
          label: e.data('label'),
          properties: e.data('properties'),
          source: e.source().data(),
          target: e.target().data(),
        });
        setEdgeInspectorOpen(true);
      }
    }</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/graph/AdvancedGraphView.js (Line 532:2 - Line 544:2), client/src/components/graph/AdvancedGraphView.js (Line 137:2 - Line 144:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn79" onclick="toggleCodeBlock('cloneGroup79', 'expandBtn79', 'collapseBtn79')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn79" onclick="toggleCodeBlock('cloneGroup79', 'expandBtn79', 'collapseBtn79')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup79"><code class="language-javascript text-sm text-gray-800">{
              const seedNodes = [
                { id: 'n1', label: 'Alice', type: 'PERSON' },
                { id: 'n2', label: 'Bob', type: 'PERSON' },
                { id: 'n3', label: 'Acme Corp', type: 'ORGANIZATION' },
              ];
              const seedEdges = [
                {
                  id: 'e1',
                  source: 'n1',
                  target: 'n2',
                  type: 'KNOWS',
                  label: 'KNOWS',</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/MTTTTrendWidget.tsx (Line 328:7 - Line 356:4), client/src/components/dashboard/MTTTTrendWidget.tsx (Line 284:7 - Line 309:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn81" onclick="toggleCodeBlock('cloneGroup81', 'expandBtn81', 'collapseBtn81')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn81" onclick="toggleCodeBlock('cloneGroup81', 'expandBtn81', 'collapseBtn81')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup81"><code class="language-javascript text-sm text-gray-800">={250}&gt;
            &lt;BarChart data={timeSeriesData}&gt;
              &lt;CartesianGrid strokeDasharray=&quot;3 3&quot; /&gt;
              &lt;XAxis
                dataKey=&quot;timestamp&quot;
                fontSize={12}
                tick={{ fill: '#666' }}
              /&gt;
              &lt;YAxis
                fontSize={12}
                tick={{ fill: '#666' }}
                tickFormatter={(value: number) =&gt; formatTime(value)}
              /&gt;
              &lt;ReferenceLine
                y={targetMTTT}
                stroke=&quot;#f44336&quot;
                strokeDasharray=&quot;5 5&quot;
                label=&quot;Target&quot;
              /&gt;
              &lt;Bar dataKey=&quot;p50&quot; fill=&quot;#2196f3&quot; name=&quot;P50 MTTT&quot; /&gt;
              &lt;Bar dataKey=&quot;p90&quot; fill=&quot;#ff9800&quot; name=&quot;P90 MTTT&quot; /&gt;
              &lt;Legend /&gt;
            &lt;/BarChart&gt;
          &lt;/ResponsiveContainer&gt;
        );

      default:
        return (
          &lt;ResponsiveContainer width=&quot;100%&quot; height={250</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/MTTTTrendWidget.tsx (Line 342:11 - Line 379:2), client/src/components/dashboard/MTTTTrendWidget.tsx (Line 318:4 - Line 309:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn82" onclick="toggleCodeBlock('cloneGroup82', 'expandBtn82', 'collapseBtn82')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn82" onclick="toggleCodeBlock('cloneGroup82', 'expandBtn82', 'collapseBtn82')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup82"><code class="language-javascript text-sm text-gray-800">}
                stroke=&quot;#f44336&quot;
                strokeDasharray=&quot;5 5&quot;
                label=&quot;Target&quot;
              /&gt;
              &lt;Bar dataKey=&quot;p50&quot; fill=&quot;#2196f3&quot; name=&quot;P50 MTTT&quot; /&gt;
              &lt;Bar dataKey=&quot;p90&quot; fill=&quot;#ff9800&quot; name=&quot;P90 MTTT&quot; /&gt;
              &lt;Legend /&gt;
            &lt;/BarChart&gt;
          &lt;/ResponsiveContainer&gt;
        );

      default:
        return (
          &lt;ResponsiveContainer width=&quot;100%&quot; height={250}&gt;
            &lt;LineChart data={timeSeriesData}&gt;
              &lt;CartesianGrid strokeDasharray=&quot;3 3&quot; /&gt;
              &lt;XAxis
                dataKey=&quot;timestamp&quot;
                fontSize={12}
                tick={{ fill: '#666' }}
              /&gt;
              &lt;YAxis
                fontSize={12}
                tick={{ fill: '#666' }}
                tickFormatter={(value: number) =&gt; formatTime(value)}
              /&gt;
              &lt;ReferenceLine
                y={targetMTTT}
                stroke=&quot;#f44336&quot;
                strokeDasharray=&quot;5 5&quot;
                label=&quot;Target MTTT&quot;
              /&gt;
              &lt;Line
                type=&quot;monotone&quot;
                dataKey=&quot;p50&quot;
                stroke=&quot;#2196f3&quot;
                strokeWidth={2</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/AttackHeatmapWidget.tsx (Line 688:31 - Line 700:9), client/src/components/dashboard/AttackHeatmapWidget.tsx (Line 660:30 - Line 672:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn85" onclick="toggleCodeBlock('cloneGroup85', 'expandBtn85', 'collapseBtn85')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn85" onclick="toggleCodeBlock('cloneGroup85', 'expandBtn85', 'collapseBtn85')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup85"><code class="language-javascript text-sm text-gray-800">: e.target.value as string[],
                    })
                  }
                  renderValue={(selected) =&gt; (
                    &lt;Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5 }}&gt;
                      {(selected as string[]).map((value) =&gt; (
                        &lt;Chip key={value} label={value} size=&quot;small&quot; /&gt;
                      ))}
                    &lt;/Box&gt;
                  )}
                &gt;
                  {['low', 'medium', 'high', 'critical'].map((severity) =&gt; (
                    &lt;MenuItem key={severity</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/AnalyticsDashboard.jsx (Line 322:2 - Line 333:2), client/src/components/versioning/GraphVersionHistory.jsx (Line 288:2 - Line 306:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn89" onclick="toggleCodeBlock('cloneGroup89', 'expandBtn89', 'collapseBtn89')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn89" onclick="toggleCodeBlock('cloneGroup89', 'expandBtn89', 'collapseBtn89')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup89"><code class="language-javascript text-sm text-gray-800">,
          }}
        &gt;
          &lt;Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}&gt;
            &lt;Psychology color=&quot;primary&quot; /&gt;
            &lt;Typography variant=&quot;h6&quot; sx={{ fontWeight: 'bold' }}&gt;
              {insight.title}
            &lt;/Typography&gt;
          &lt;/Box&gt;
          &lt;Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}&gt;
            &lt;Chip
              label={`</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/AnalyticsDashboard.jsx (Line 360:9 - Line 386:2), client/src/components/versioning/GraphVersionHistory.jsx (Line 434:2 - Line 458:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn90" onclick="toggleCodeBlock('cloneGroup90', 'expandBtn90', 'collapseBtn90')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn90" onclick="toggleCodeBlock('cloneGroup90', 'expandBtn90', 'collapseBtn90')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup90"><code class="language-javascript text-sm text-gray-800">} size=&quot;small&quot; variant=&quot;outlined&quot; /&gt;
          {insight.actionable &amp;&amp; (
            &lt;Button size=&quot;small&quot; variant=&quot;outlined&quot;&gt;
              Take Action
            &lt;/Button&gt;
          )}
        &lt;/Box&gt;
      &lt;/CardContent&gt;
    &lt;/Card&gt;
  );

  return (
    &lt;Box&gt;
      {/* Header */}
      &lt;Box
        sx={{
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center',
          mb: 3,
        }}
      &gt;
        &lt;Typography variant=&quot;h4&quot; component=&quot;h1&quot; sx={{ fontWeight: 'bold' }}&gt;
          Analytics Dashboard
        &lt;/Typography&gt;
        &lt;Box sx={{ display: 'flex', gap: 1 }}&gt;
          &lt;FormControl size=&quot;small&quot; sx={{</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/AnalyticsDashboard.jsx (Line 492:2 - Line 547:2), client/src/components/dashboard/AnalyticsDashboard.jsx (Line 486:2 - Line 515:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn91" onclick="toggleCodeBlock('cloneGroup91', 'expandBtn91', 'collapseBtn91')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn91" onclick="toggleCodeBlock('cloneGroup91', 'expandBtn91', 'collapseBtn91')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup91"><code class="language-javascript text-sm text-gray-800">}
                        &gt;
                          {mockMetrics.network.totalEdges.toLocaleString()}
                        &lt;/Typography&gt;
                        &lt;Typography variant=&quot;body2&quot; color=&quot;text.secondary&quot;&gt;
                          Total Connections
                        &lt;/Typography&gt;
                      &lt;/Box&gt;
                    &lt;/Grid&gt;
                    &lt;Grid item xs={6}&gt;
                      &lt;Box sx={{ textAlign: 'center', p: 2 }}&gt;
                        &lt;Typography
                          variant=&quot;h3&quot;
                          color=&quot;secondary.main&quot;
                          sx={{ fontWeight: 'bold' }}
                        &gt;
                          {mockMetrics.network.density.toFixed(2)}
                        &lt;/Typography&gt;
                        &lt;Typography variant=&quot;body2&quot; color=&quot;text.secondary&quot;&gt;
                          Network Density
                        &lt;/Typography&gt;
                      &lt;/Box&gt;
                    &lt;/Grid&gt;
                    &lt;Grid item xs={6}&gt;
                      &lt;Box sx={{ textAlign: 'center', p: 2 }}&gt;
                        &lt;Typography
                          variant=&quot;h3&quot;
                          color=&quot;success.main&quot;
                          sx={{ fontWeight: 'bold' }}
                        &gt;
                          {mockMetrics.network.avgDegree.toFixed(1)}
                        &lt;/Typography&gt;
                        &lt;Typography variant=&quot;body2&quot; color=&quot;text.secondary&quot;&gt;
                          Avg. Degree
                        &lt;/Typography&gt;
                      &lt;/Box&gt;
                    &lt;/Grid&gt;
                    &lt;Grid item xs={6}&gt;
                      &lt;Box sx={{ textAlign: 'center', p: 2 }}&gt;
                        &lt;Typography
                          variant=&quot;h3&quot;
                          color=&quot;warning.main&quot;
                          sx={{ fontWeight: 'bold' }}
                        &gt;
                          {mockMetrics.network.clusters}
                        &lt;/Typography&gt;
                        &lt;Typography variant=&quot;body2&quot; color=&quot;text.secondary&quot;&gt;
                          Clusters Found
                        &lt;/Typography&gt;
                      &lt;/Box&gt;
                    &lt;/Grid&gt;
                  &lt;/Grid&gt;
                )}

                {activeTab === 1 &amp;&amp; (
                  &lt;Box sx={{</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/AnalyticsDashboard.jsx (Line 682:9 - Line 707:2), client/src/components/dashboard/AnalyticsDashboard.jsx (Line 653:2 - Line 675:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn92" onclick="toggleCodeBlock('cloneGroup92', 'expandBtn92', 'collapseBtn92')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn92" onclick="toggleCodeBlock('cloneGroup92', 'expandBtn92', 'collapseBtn92')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup92"><code class="language-javascript text-sm text-gray-800">} /&gt;
                ))}
              &lt;/List&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        {/* AI Insights */}
        &lt;Grid item xs={12} lg={6}&gt;
          &lt;Card sx={{ height: 500 }}&gt;
            &lt;CardContent&gt;
              &lt;Box
                sx={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  mb: 2,
                }}
              &gt;
                &lt;Typography variant=&quot;h6&quot; sx={{ fontWeight: 'bold' }}&gt;
                  AI Insights
                &lt;/Typography&gt;
                &lt;Chip label=&quot;Live&quot; color=&quot;success&quot; size=&quot;small&quot; /&gt;
              &lt;/Box&gt;

              &lt;Box sx={{</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/AnalyticsDashboard.js (Line 689:18 - Line 702:3), client/src/components/dashboard/AnalyticsDashboard.js (Line 660:22 - Line 673:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn93" onclick="toggleCodeBlock('cloneGroup93', 'expandBtn93', 'collapseBtn93')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn93" onclick="toggleCodeBlock('cloneGroup93', 'expandBtn93', 'collapseBtn93')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup93"><code class="language-javascript text-sm text-gray-800">}
        &lt;Grid item xs={12} lg={6}&gt;
          &lt;Card sx={{ height: 500 }}&gt;
            &lt;CardContent&gt;
              &lt;Box
                sx={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  mb: 2,
                }}
              &gt;
                &lt;Typography variant=&quot;h6&quot; sx={{ fontWeight: 'bold' }}&gt;
                  AI</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/collaboration/UserPresence.jsx (Line 501:6 - Line 514:19), client/src/components/collaboration/UserPresence.jsx (Line 299:5 - Line 320:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn94" onclick="toggleCodeBlock('cloneGroup94', 'expandBtn94', 'collapseBtn94')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn94" onclick="toggleCodeBlock('cloneGroup94', 'expandBtn94', 'collapseBtn94')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup94"><code class="language-javascript text-sm text-gray-800">)}&gt;Close&lt;/Button&gt;
        &lt;/DialogActions&gt;
      &lt;/Dialog&gt;

      {/* Hidden State Toggle */}
      {!isVisible &amp;&amp; (
        &lt;IconButton
          sx={{
            position: 'fixed',
            top: position.includes('top') ? 16 : 'auto',
            bottom: position.includes('bottom') ? 16 : 'auto',
            right: position.includes('right') ? 16 : 'auto',
            left: position.includes('left') ? 16 : 'auto',
            zIndex</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/collaboration/PresenceIndicator.js (Line 391:5 - Line 401:10), client/src/components/graph/AdvancedCollaborativeGraph.js (Line 518:7 - Line 528:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn95" onclick="toggleCodeBlock('cloneGroup95', 'expandBtn95', 'collapseBtn95')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn95" onclick="toggleCodeBlock('cloneGroup95', 'expandBtn95', 'collapseBtn95')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup95"><code class="language-javascript text-sm text-gray-800">,
        }}
      &gt;
        {Array.from(userCursors.entries()).map(([userId, cursor]) =&gt; (
          &lt;Box
            key={userId}
            sx={{
              position: 'absolute',
              left: cursor.position.x,
              top: cursor.position.y,
              transform</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/collaboration/LiveCollaborationPanel.jsx (Line 196:2 - Line 207:13), client/src/components/system/ConnectionStatus.jsx (Line 103:2 - Line 119:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn96" onclick="toggleCodeBlock('cloneGroup96', 'expandBtn96', 'collapseBtn96')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn96" onclick="toggleCodeBlock('cloneGroup96', 'expandBtn96', 'collapseBtn96')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup96"><code class="language-javascript text-sm text-gray-800"> }}&gt;
        &lt;Box
          sx={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            mb: 2,
          }}
        &gt;
          &lt;Typography variant=&quot;h6&quot;&gt; Live Collaboration&lt;/Typography&gt;
          &lt;Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}&gt;
            &lt;Badge color={isConnected </code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/collaboration/CollaborationPanel.jsx (Line 449:9 - Line 486:2), client/src/components/collaboration/CollaborationPanel.jsx (Line 447:2 - Line 464:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn97" onclick="toggleCodeBlock('cloneGroup97', 'expandBtn97', 'collapseBtn97')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn97" onclick="toggleCodeBlock('cloneGroup97', 'expandBtn97', 'collapseBtn97')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup97"><code class="language-javascript text-sm text-gray-800"> }}&gt;
                  &lt;Typography variant=&quot;caption&quot;&gt;Active Users&lt;/Typography&gt;
                  &lt;Typography variant=&quot;h6&quot; color=&quot;primary&quot;&gt;
                    {statsData.getCollaborationStats.activeUsers}
                  &lt;/Typography&gt;
                &lt;/Paper&gt;
              &lt;/Grid&gt;
              &lt;Grid item xs={6} sm={3}&gt;
                &lt;Paper sx={{ p: 1, textAlign: 'center' }}&gt;
                  &lt;Typography variant=&quot;caption&quot;&gt;Pending Edits&lt;/Typography&gt;
                  &lt;Typography variant=&quot;h6&quot; color=&quot;warning.main&quot;&gt;
                    {statsData.getCollaborationStats.pendingEdits}
                  &lt;/Typography&gt;
                &lt;/Paper&gt;
              &lt;/Grid&gt;
              &lt;Grid item xs={6} sm={3}&gt;
                &lt;Paper sx={{ p: 1, textAlign: 'center' }}&gt;
                  &lt;Typography variant=&quot;caption&quot;&gt;Comments&lt;/Typography&gt;
                  &lt;Typography variant=&quot;h6&quot; color=&quot;info.main&quot;&gt;
                    {statsData.getCollaborationStats.totalComments}
                  &lt;/Typography&gt;
                &lt;/Paper&gt;
              &lt;/Grid&gt;
              &lt;Grid item xs={6} sm={3}&gt;
                &lt;Paper sx={{ p: 1, textAlign: 'center' }}&gt;
                  &lt;Typography variant=&quot;caption&quot;&gt;Notifications&lt;/Typography&gt;
                  &lt;Typography variant=&quot;h6&quot; color=&quot;secondary.main&quot;&gt;
                    {statsData.getCollaborationStats.recentNotifications}
                  &lt;/Typography&gt;
                &lt;/Paper&gt;
              &lt;/Grid&gt;
            &lt;/Grid&gt;
          )}
        &lt;/CardContent&gt;
      &lt;/Card&gt;

      &lt;Card&gt;
        &lt;Box sx={{</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/PerformanceMonitoringPanel.js (Line 352:2 - Line 364:13), client/src/components/analytics/PerformanceMonitoringPanel.js (Line 283:25 - Line 297:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn100" onclick="toggleCodeBlock('cloneGroup100', 'expandBtn100', 'collapseBtn100')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn100" onclick="toggleCodeBlock('cloneGroup100', 'expandBtn100', 'collapseBtn100')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup100"><code class="language-javascript text-sm text-gray-800">? 'warning' : 'success'}
                  size=&quot;small&quot;
                /&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot; mb={1}&gt;
                &lt;NetworkCheck</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/AdvancedAnalyticsDashboard.jsx (Line 359:2 - Line 434:2), client/src/components/analytics/AdvancedAnalyticsDashboard.jsx (Line 353:2 - Line 409:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn101" onclick="toggleCodeBlock('cloneGroup101', 'expandBtn101', 'collapseBtn101')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn101" onclick="toggleCodeBlock('cloneGroup101', 'expandBtn101', 'collapseBtn101')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup101"><code class="language-javascript text-sm text-gray-800">} /&gt;
                &lt;Box&gt;
                  &lt;Typography variant=&quot;h4&quot; color=&quot;primary&quot;&gt;
                    {threatMetrics.totalIOCs.toLocaleString()}
                  &lt;/Typography&gt;
                  &lt;Typography variant=&quot;caption&quot; color=&quot;text.secondary&quot;&gt;
                    Total IOCs
                  &lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot;&gt;
                &lt;Warning color=&quot;warning&quot; sx={{ mr: 1 }} /&gt;
                &lt;Box&gt;
                  &lt;Typography variant=&quot;h4&quot; color=&quot;warning.main&quot;&gt;
                    {threatMetrics.activeThreats.toLocaleString()}
                  &lt;/Typography&gt;
                  &lt;Typography variant=&quot;caption&quot; color=&quot;text.secondary&quot;&gt;
                    Active Threats
                  &lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot;&gt;
                &lt;CheckCircle color=&quot;success&quot; sx={{ mr: 1 }} /&gt;
                &lt;Box&gt;
                  &lt;Typography variant=&quot;h4&quot; color=&quot;success.main&quot;&gt;
                    {threatMetrics.resolvedThreats.toLocaleString()}
                  &lt;/Typography&gt;
                  &lt;Typography variant=&quot;caption&quot; color=&quot;text.secondary&quot;&gt;
                    Resolved Threats
                  &lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot;&gt;
                &lt;Assessment color=&quot;info&quot; sx={{ mr: 1 }} /&gt;
                &lt;Box&gt;
                  &lt;Typography variant=&quot;h4&quot; color=&quot;info.main&quot;&gt;
                    {Math.round(
                      (threatMetrics.resolvedThreats /
                        (threatMetrics.activeThreats +
                          threatMetrics.resolvedThreats)) *
                        100,
                    )}
                    %
                  &lt;/Typography&gt;
                  &lt;Typography variant=&quot;caption&quot; color=&quot;text.secondary&quot;&gt;
                    Resolution Rate
                  &lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        {/* Threat Severity Distribution */}
        &lt;Grid item xs={12} md={6</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/AdvancedAnalyticsDashboard.jsx (Line 661:8 - Line 750:5), client/src/components/analytics/AdvancedAnalyticsDashboard.jsx (Line 353:8 - Line 409:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn102" onclick="toggleCodeBlock('cloneGroup102', 'expandBtn102', 'collapseBtn102')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn102" onclick="toggleCodeBlock('cloneGroup102', 'expandBtn102', 'collapseBtn102')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup102"><code class="language-javascript text-sm text-gray-800">={2}&gt;
        {/* System Health Metrics */}
        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot;&gt;
                &lt;Speed color=&quot;primary&quot; sx={{ mr: 1 }} /&gt;
                &lt;Box&gt;
                  &lt;Typography variant=&quot;h4&quot; color=&quot;primary&quot;&gt;
                    {Math.round(performanceData.metrics.avgResponseTime)}ms
                  &lt;/Typography&gt;
                  &lt;Typography variant=&quot;caption&quot;&gt;Avg Response Time&lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot;&gt;
                &lt;Memory color=&quot;info&quot; sx={{ mr: 1 }} /&gt;
                &lt;Box&gt;
                  &lt;Typography variant=&quot;h4&quot; color=&quot;info.main&quot;&gt;
                    {Math.round(
                      (performanceData.systemHealth.memoryUsage.heapUsed /
                        performanceData.systemHealth.memoryUsage.heapTotal) *
                        100,
                    )}
                    %
                  &lt;/Typography&gt;
                  &lt;Typography variant=&quot;caption&quot;&gt;Memory Usage&lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot;&gt;
                &lt;Storage color=&quot;success&quot; sx={{ mr: 1 }} /&gt;
                &lt;Box&gt;
                  &lt;Typography variant=&quot;h4&quot; color=&quot;success.main&quot;&gt;
                    {Math.round(performanceData.metrics.cacheHitRate)}%
                  &lt;/Typography&gt;
                  &lt;Typography variant=&quot;caption&quot;&gt;Cache Hit Rate&lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot;&gt;
                &lt;NetworkCheck color=&quot;warning&quot; sx={{ mr: 1 }} /&gt;
                &lt;Box&gt;
                  &lt;Typography variant=&quot;h4&quot; color=&quot;warning.main&quot;&gt;
                    {performanceData.metrics.concurrentUsers}
                  &lt;/Typography&gt;
                  &lt;Typography variant=&quot;caption&quot;&gt;Active Users&lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        {/* Connection Pool Status */}
        &lt;Grid item xs={12}&gt;
          &lt;Card&gt;
            &lt;CardHeader title=&quot;Database Connection Pools&quot; /&gt;
            &lt;CardContent&gt;
              &lt;Table&gt;
                &lt;TableHead&gt;
                  &lt;TableRow&gt;
                    &lt;TableCell&gt;Database&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;right&quot;&gt;Active&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;right&quot;&gt;Max&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;right&quot;&gt;Avg Response (ms)&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;right&quot;&gt;Error Rate&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;right&quot;&gt;Status&lt;/TableCell&gt;
                  &lt;/TableRow&gt;
                &lt;/TableHead&gt;
                &lt;TableBody&gt;
                  {performanceData.connectionPools.map((pool) =&gt; (
                    &lt;TableRow key={pool</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/AdvancedAnalyticsDashboard.jsx (Line 765:10 - Line 818:6), client/src/components/analytics/PerformanceMonitoringPanel.jsx (Line 672:2 - Line 731:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn103" onclick="toggleCodeBlock('cloneGroup103', 'expandBtn103', 'collapseBtn103')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn103" onclick="toggleCodeBlock('cloneGroup103', 'expandBtn103', 'collapseBtn103')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup103"><code class="language-javascript text-sm text-gray-800">}
                          size=&quot;small&quot;
                        /&gt;
                      &lt;/TableCell&gt;
                    &lt;/TableRow&gt;
                  ))}
                &lt;/TableBody&gt;
              &lt;/Table&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        {/* Cache Strategies */}
        &lt;Grid item xs={12}&gt;
          &lt;Card&gt;
            &lt;CardHeader title=&quot;Cache Strategies&quot; /&gt;
            &lt;CardContent&gt;
              &lt;Table&gt;
                &lt;TableHead&gt;
                  &lt;TableRow&gt;
                    &lt;TableCell&gt;Strategy&lt;/TableCell&gt;
                    &lt;TableCell&gt;Pattern&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;right&quot;&gt;TTL (s)&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;center&quot;&gt;Priority&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;center&quot;&gt;Compression&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;center&quot;&gt;Prefetch&lt;/TableCell&gt;
                  &lt;/TableRow&gt;
                &lt;/TableHead&gt;
                &lt;TableBody&gt;
                  {performanceData.cacheStrategies.map((strategy) =&gt; (
                    &lt;TableRow key={strategy.id}&gt;
                      &lt;TableCell&gt;{strategy.name}&lt;/TableCell&gt;
                      &lt;TableCell&gt;
                        &lt;Typography variant=&quot;body2&quot; fontFamily=&quot;monospace&quot;&gt;
                          {strategy.pattern}
                        &lt;/Typography&gt;
                      &lt;/TableCell&gt;
                      &lt;TableCell align=&quot;right&quot;&gt;{strategy.ttl}&lt;/TableCell&gt;
                      &lt;TableCell align=&quot;center&quot;&gt;
                        &lt;Chip
                          label={strategy.priority.toUpperCase()}
                          color={
                            strategy.priority === 'high'
                              ? 'error'
                              : strategy.priority === 'medium'
                                ? 'warning'
                                : 'default'
                          }
                          size=&quot;small&quot;
                        /&gt;
                      &lt;/TableCell&gt;
                      &lt;TableCell align=&quot;center&quot;&gt;
                        &lt;Chip
                          label={strategy.compressionEnabled ? 'Yes'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/AdvancedAnalyticsDashboard.js (Line 384:19 - Line 395:12), client/src/components/analytics/AdvancedAnalyticsDashboard.js (Line 366:19 - Line 377:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn107" onclick="toggleCodeBlock('cloneGroup107', 'expandBtn107', 'collapseBtn107')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn107" onclick="toggleCodeBlock('cloneGroup107', 'expandBtn107', 'collapseBtn107')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup107"><code class="language-javascript text-sm text-gray-800">&lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot;&gt;
                &lt;CheckCircle</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/AdvancedAnalyticsDashboard.js (Line 401:2 - Line 413:11), client/src/components/analytics/AdvancedAnalyticsDashboard.js (Line 383:2 - Line 377:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn108" onclick="toggleCodeBlock('cloneGroup108', 'expandBtn108', 'collapseBtn108')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn108" onclick="toggleCodeBlock('cloneGroup108', 'expandBtn108', 'collapseBtn108')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup108"><code class="language-javascript text-sm text-gray-800">Threats
                  &lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot;&gt;
                &lt;Assessment</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/AdvancedAnalyticsDashboard.js (Line 672:5 - Line 683:7), client/src/components/analytics/AdvancedAnalyticsDashboard.js (Line 366:19 - Line 377:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn109" onclick="toggleCodeBlock('cloneGroup109', 'expandBtn109', 'collapseBtn109')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn109" onclick="toggleCodeBlock('cloneGroup109', 'expandBtn109', 'collapseBtn109')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup109"><code class="language-javascript text-sm text-gray-800">&lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot;&gt;
                &lt;Memory</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/AdvancedAnalyticsDashboard.js (Line 693:6 - Line 704:8), client/src/components/analytics/AdvancedAnalyticsDashboard.js (Line 366:19 - Line 377:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn110" onclick="toggleCodeBlock('cloneGroup110', 'expandBtn110', 'collapseBtn110')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn110" onclick="toggleCodeBlock('cloneGroup110', 'expandBtn110', 'collapseBtn110')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup110"><code class="language-javascript text-sm text-gray-800">&lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot;&gt;
                &lt;Storage</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/AdvancedAnalyticsDashboard.js (Line 709:5 - Line 720:13), client/src/components/analytics/AdvancedAnalyticsDashboard.js (Line 366:19 - Line 377:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn111" onclick="toggleCodeBlock('cloneGroup111', 'expandBtn111', 'collapseBtn111')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn111" onclick="toggleCodeBlock('cloneGroup111', 'expandBtn111', 'collapseBtn111')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup111"><code class="language-javascript text-sm text-gray-800">&lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot;&gt;
                &lt;NetworkCheck</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/AdvancedAnalyticsDashboard.js (Line 733:9 - Line 743:4), client/src/components/analytics/PerformanceMonitoringPanel.js (Line 578:9 - Line 588:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn112" onclick="toggleCodeBlock('cloneGroup112', 'expandBtn112', 'collapseBtn112')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn112" onclick="toggleCodeBlock('cloneGroup112', 'expandBtn112', 'collapseBtn112')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup112"><code class="language-javascript text-sm text-gray-800">&lt;Grid item xs={12}&gt;
          &lt;Card&gt;
            &lt;CardHeader title=&quot;Database Connection Pools&quot; /&gt;
            &lt;CardContent&gt;
              &lt;Table&gt;
                &lt;TableHead&gt;
                  &lt;TableRow&gt;
                    &lt;TableCell&gt;Database&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;right&quot;&gt;Active&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;right&quot;&gt;Max&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;right&quot;&gt;Avg</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/AdvancedAnalyticsDashboard.js (Line 802:4 - Line 818:6), client/src/components/analytics/PerformanceMonitoringPanel.js (Line 714:3 - Line 731:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn113" onclick="toggleCodeBlock('cloneGroup113', 'expandBtn113', 'collapseBtn113')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn113" onclick="toggleCodeBlock('cloneGroup113', 'expandBtn113', 'collapseBtn113')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup113"><code class="language-javascript text-sm text-gray-800">}&lt;/TableCell&gt;
                      &lt;TableCell align=&quot;center&quot;&gt;
                        &lt;Chip
                          label={strategy.priority.toUpperCase()}
                          color={
                            strategy.priority === 'high'
                              ? 'error'
                              : strategy.priority === 'medium'
                                ? 'warning'
                                : 'default'
                          }
                          size=&quot;small&quot;
                        /&gt;
                      &lt;/TableCell&gt;
                      &lt;TableCell align=&quot;center&quot;&gt;
                        &lt;Chip
                          label={strategy.compressionEnabled ? 'Yes'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai-enhanced/EnhancedAIAssistant.tsx (Line 576:2 - Line 598:15), client/src/components/ai-enhanced/EnhancedAIAssistant.tsx (Line 564:8 - Line 585:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn114" onclick="toggleCodeBlock('cloneGroup114', 'expandBtn114', 'collapseBtn114')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn114" onclick="toggleCodeBlock('cloneGroup114', 'expandBtn114', 'collapseBtn114')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup114"><code class="language-javascript text-sm text-gray-800">}
              &gt;
                &lt;Typography variant=&quot;body2&quot;&gt;{streamBuf}&lt;/Typography&gt;
              &lt;/Paper&gt;
            &lt;/Box&gt;
          &lt;/div&gt;
        )}

        {isTyping &amp;&amp; (
          &lt;Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 2 }}&gt;
            &lt;Avatar sx={{ width: 32, height: 32, bgcolor: 'secondary.main' }}&gt;
              &lt;SmartToy fontSize=&quot;small&quot; /&gt;
            &lt;/Avatar&gt;
            &lt;Paper
              elevation={1}
              sx={{ p: 2, borderRadius: '16px 16px 16px 4px' }}
            &gt;
              &lt;Typography variant=&quot;body2&quot;&gt;Typing...&lt;/Typography&gt;
            &lt;/Paper&gt;
          &lt;/Box&gt;
        )}

        &lt;div ref={messagesEndRef</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai/MLAnalysisPanel.jsx (Line 431:2 - Line 486:17), client/src/components/ai/MLAnalysisPanel.jsx (Line 428:2 - Line 455:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn115" onclick="toggleCodeBlock('cloneGroup115', 'expandBtn115', 'collapseBtn115')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn115" onclick="toggleCodeBlock('cloneGroup115', 'expandBtn115', 'collapseBtn115')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup115"><code class="language-javascript text-sm text-gray-800">}&gt;
                    &lt;Typography variant=&quot;caption&quot;&gt;
                      Clustering Coefficient
                    &lt;/Typography&gt;
                    &lt;Typography variant=&quot;h5&quot; color=&quot;primary&quot;&gt;
                      {formatScore(
                        graphData.analyzeGraphMetrics.clustering_coefficient,
                      )}
                    &lt;/Typography&gt;
                  &lt;/Paper&gt;
                &lt;/Tooltip&gt;
              &lt;/Grid&gt;
              &lt;Grid item xs={12} sm={6} md={3}&gt;
                &lt;Tooltip title=&quot;Average steps between any two nodes&quot;&gt;
                  &lt;Paper sx={{ p: 2, textAlign: 'center' }}&gt;
                    &lt;Typography variant=&quot;caption&quot;&gt;Avg Path Length&lt;/Typography&gt;
                    &lt;Typography variant=&quot;h5&quot; color=&quot;secondary&quot;&gt;
                      {formatScore(
                        graphData.analyzeGraphMetrics.average_path_length,
                      )}
                    &lt;/Typography&gt;
                  &lt;/Paper&gt;
                &lt;/Tooltip&gt;
              &lt;/Grid&gt;
              &lt;Grid item xs={12} sm={6} md={3}&gt;
                &lt;Tooltip title=&quot;Ratio of edges to possible edges&quot;&gt;
                  &lt;Paper sx={{ p: 2, textAlign: 'center' }}&gt;
                    &lt;Typography variant=&quot;caption&quot;&gt;Network Density&lt;/Typography&gt;
                    &lt;Typography variant=&quot;h5&quot; color=&quot;info.main&quot;&gt;
                      {formatScore(
                        graphData.analyzeGraphMetrics.network_density,
                      )}
                    &lt;/Typography&gt;
                  &lt;/Paper&gt;
                &lt;/Tooltip&gt;
              &lt;/Grid&gt;
              &lt;Grid item xs={12} sm={6} md={3}&gt;
                &lt;Tooltip title=&quot;Community structure strength&quot;&gt;
                  &lt;Paper sx={{ p: 2, textAlign: 'center' }}&gt;
                    &lt;Typography variant=&quot;caption&quot;&gt;Modularity&lt;/Typography&gt;
                    &lt;Typography variant=&quot;h5&quot; color=&quot;success.main&quot;&gt;
                      {formatScore(
                        graphData.analyzeGraphMetrics.community_modularity,
                      )}
                    &lt;/Typography&gt;
                  &lt;/Paper&gt;
                &lt;/Tooltip&gt;
              &lt;/Grid&gt;
            &lt;/Grid&gt;
          )}
        &lt;/AccordionDetails&gt;
      &lt;/Accordion&gt;

      {/* Anomaly Detection Section */}
      &lt;Accordion
        expanded={expandedSection </code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai/MLAnalysisPanel.js (Line 172:8 - Line 184:12), client/src/components/collaboration/CollaborationPanel.js (Line 427:7 - Line 439:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn116" onclick="toggleCodeBlock('cloneGroup116', 'expandBtn116', 'collapseBtn116')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn116" onclick="toggleCodeBlock('cloneGroup116', 'expandBtn116', 'collapseBtn116')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup116"><code class="language-javascript text-sm text-gray-800">;
  };

  return (
    &lt;Box sx={{ p: 2 }}&gt;
      &lt;Card sx={{ mb: 2 }}&gt;
        &lt;CardContent&gt;
          &lt;Typography
            variant=&quot;h5&quot;
            gutterBottom
            sx={{ display: 'flex', alignItems: 'center', gap: 1 }}
          &gt;
            &lt;AutoAwesome</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai/IntelligentCopilot.jsx (Line 189:2 - Line 332:6), client/src/components/graph/InteractiveGraphExplorer.jsx (Line 421:3 - Line 382:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn117" onclick="toggleCodeBlock('cloneGroup117', 'expandBtn117', 'collapseBtn117')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn117" onclick="toggleCodeBlock('cloneGroup117', 'expandBtn117', 'collapseBtn117')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup117"><code class="language-javascript text-sm text-gray-800">} /&gt;
              &lt;/Box&gt;
            ) : (
              &lt;Typography
                variant=&quot;body1&quot;
                sx={{
                  whiteSpace: 'pre-line',
                  '&amp; strong': { fontWeight: 'bold' },
                  '&amp; em': { fontStyle: 'italic' },
                }}
                dangerouslySetInnerHTML={{
                  __html: DOMPurify.sanitize(
                    message.replace(/\*\*(.*?)\*\*/g, '&lt;strong&gt;$1&lt;/strong&gt;'),
                  ),
                }}
              /&gt;
            )}
          &lt;/Paper&gt;
        }
      /&gt;
    &lt;/ListItem&gt;
  );
}

export default function IntelligentCopilot() {
  const { t, locale } = useI18n();

  const getWelcomeMessage = () =&gt; ({
    id: 1,
    text: &quot; &quot; + (locale === 'es-ES'
      ? &quot;Hola! Soy tu Analista de Inteligencia con IA. Puedo ayudarte a analizar redes, evaluar amenazas, predecir patrones y generar perspectivas de tus datos de investigacin. Qu te gustara explorar?&quot;
      : &quot;Hello! I'm your AI Intelligence Analyst. I can help you analyze networks, assess threats, predict patterns, and generate insights from your investigation data. What would you like to explore?&quot;),
    isUser: false,
    timestamp: new Date(),
  });

  const [messages, setMessages] = useState([getWelcomeMessage()]);
  const [inputValue, setInputValue] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [notes, setNotes] = useState('');
  const [generated, setGenerated] = useState({
    entities: [],
    relationships: [],
  });
  const [generateEntities, { loading: generating }] = useMutation(
    GENERATE_ENTITIES_FROM_TEXT,
  );
  const messagesEndRef = useRef(null);

  const scrollToBottom = () =&gt; {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  useEffect(() =&gt; {
    scrollToBottom();
  }, [messages]);

  const handleSendMessage = async (text = inputValue) =&gt; {
    if (!text.trim() || isLoading) return;

    const userMessage = {
      id: Date.now(),
      text: text.trim(),
      isUser: true,
      timestamp: new Date(),
    };

    setMessages((prev) =&gt; [...prev, userMessage]);
    setInputValue('');
    setIsLoading(true);

    // Simulate AI processing delay
    setTimeout(
      () =&gt; {
        const query = text.toLowerCase();
        const intelligentResponses = getLocalizedResponses(t);
        let aiResponse =
          (locale === 'es-ES'
            ? 'Entiendo que quieres saber sobre: ' + text + '\n\nAn estoy aprendiendo sobre este tema. Intenta preguntar sobre anlisis de redes, evaluacin de amenazas, prediccin de patrones o resmenes de investigacin para obtener informacin ms detallada.'
            : 'I understand you want to know about: ' + text + &quot;\n\nI'm still learning about this topic. Try asking about network analysis, threat assessment, pattern prediction, or investigation summaries for more detailed insights.&quot;);

        // Find matching response
        for (const [key, response] of Object.entries(intelligentResponses)) {
          if (query.includes(key)) {
            aiResponse = response.join('\n');
            break;
          }
        }

        const aiMessage = {
          id: Date.now() + 1,
          text: aiResponse,
          isUser: false,
          timestamp: new Date(),
        };

        setMessages((prev) =&gt; [...prev, aiMessage]);
        setIsLoading(false);
      },
      2000 + Math.random() * 1000,
    ); // Random delay 2-3 seconds
  };

  const handleQuickAction = (query) =&gt; {
    handleSendMessage(query);
  };

  const handleGenerate = async () =&gt; {
    if (!notes.trim()) return;
    const { data } = await generateEntities({
      variables: { investigationId: 'demo', text: notes },
    });
    setGenerated(data.generateEntitiesFromText);
  };

  const clearChat = () =&gt; {
    setMessages([
      {
        id: 1,
        text: &quot; &quot; + (locale === 'es-ES'
          ? &quot;Chat limpiado! Estoy listo para ayudar con tu anlisis de inteligencia. Qu te gustara explorar?&quot;
          : &quot;Chat cleared! I'm ready to help with your intelligence analysis. What would you like to explore?&quot;),
        isUser: false,
        timestamp: new Date(),
      },
    ]);
  };

  const quickActions = getQuickActions(t);
  const aiInsights = getAiInsights(t);

  return (
    &lt;Box sx={{ height: '100%', display: 'flex', flexDirection: 'column' }}&gt;
      {/* Header */}
      &lt;Card sx={{ mb: 2 }}&gt;
        &lt;CardContent&gt;
          &lt;Box
            sx={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
            }}
          &gt;
            &lt;Box sx={{ flex</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai/IntelligentCopilot.js (Line 300:3 - Line 316:3), client/src/components/timeline/InvestigationTimeline.js (Line 360:3 - Line 376:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn118" onclick="toggleCodeBlock('cloneGroup118', 'expandBtn118', 'collapseBtn118')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn118" onclick="toggleCodeBlock('cloneGroup118', 'expandBtn118', 'collapseBtn118')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup118"><code class="language-javascript text-sm text-gray-800">};

  return (
    &lt;Box sx={{ height: '100%', display: 'flex', flexDirection: 'column' }}&gt;
      {/* Header */}
      &lt;Card sx={{ mb: 2 }}&gt;
        &lt;CardContent&gt;
          &lt;Box
            sx={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
            }}
          &gt;
            &lt;Box&gt;
              &lt;Typography variant=&quot;h4&quot; gutterBottom&gt;
                </code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai/AdvancedPatternDetection.jsx (Line 315:3 - Line 329:19), client/src/components/graph/DynamicEntityClustering.jsx (Line 298:3 - Line 312:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn119" onclick="toggleCodeBlock('cloneGroup119', 'expandBtn119', 'collapseBtn119')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn119" onclick="toggleCodeBlock('cloneGroup119', 'expandBtn119', 'collapseBtn119')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup119"><code class="language-javascript text-sm text-gray-800">={{ height: '100%' }}&gt;
      &lt;CardContent&gt;
        &lt;Box
          sx={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            mb: 2,
          }}
        &gt;
          &lt;Typography variant=&quot;h6&quot;&gt; Advanced Pattern Detection&lt;/Typography&gt;
          &lt;Box sx={{ display: 'flex', gap: 1 }}&gt;
            &lt;Tooltip title=&quot;Run Analysis&quot;&gt;
              &lt;IconButton
                onClick={runPatternAnalysis</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai/AdvancedPatternDetection.js (Line 63:56 - Line 74:8), client/src/components/timeline/InvestigationTimeline.js (Line 85:9 - Line 96:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn121" onclick="toggleCodeBlock('cloneGroup121', 'expandBtn121', 'collapseBtn121')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn121" onclick="toggleCodeBlock('cloneGroup121', 'expandBtn121', 'collapseBtn121')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup121"><code class="language-javascript text-sm text-gray-800">,
      });
    }

    // Burst detection
    const hourlyActivity = {};
    events.forEach((event) =&gt; {
      const hour = new Date(event.timestamp).getHours();
      hourlyActivity[hour] = (hourlyActivity[hour] || 0) + 1;
    });

    const maxHour</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai/AISuggestionsPanel.js (Line 52:7 - Line 64:2), client/src/components/simulation/SimulationPanel.js (Line 49:7 - Line 61:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn123" onclick="toggleCodeBlock('cloneGroup123', 'expandBtn123', 'collapseBtn123')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn123" onclick="toggleCodeBlock('cloneGroup123', 'expandBtn123', 'collapseBtn123')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup123"><code class="language-javascript text-sm text-gray-800">&lt;/Typography&gt;
      &lt;Card sx={{ mb: 2 }}&gt;
        &lt;CardContent&gt;
          &lt;Grid container spacing={2}&gt;
            &lt;Grid item xs={12} md={4}&gt;
              &lt;TextField
                label=&quot;Investigation ID&quot;
                fullWidth
                value={investigationId}
                onChange={(e) =&gt; setInvestigationId(e.target.value)}
              /&gt;
            &lt;/Grid&gt;
            &lt;Grid item xs={12} md={2</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai/AIAnalysisPanel.jsx (Line 412:3 - Line 429:9), client/src/components/graph/GraphCollaborationDemo.jsx (Line 171:3 - Line 188:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn124" onclick="toggleCodeBlock('cloneGroup124', 'expandBtn124', 'collapseBtn124')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn124" onclick="toggleCodeBlock('cloneGroup124', 'expandBtn124', 'collapseBtn124')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup124"><code class="language-javascript text-sm text-gray-800">={{ height: '100%', display: 'flex', flexDirection: 'column' }}&gt;
      {/* Header */}
      &lt;Paper elevation={1} sx={{ p: 2, mb: 2 }}&gt;
        &lt;Grid container alignItems=&quot;center&quot; spacing={2}&gt;
          &lt;Grid item&gt;
            &lt;AIIcon color=&quot;primary&quot; sx={{ fontSize: 32 }} /&gt;
          &lt;/Grid&gt;
          &lt;Grid item xs&gt;
            &lt;Typography variant=&quot;h5&quot; component=&quot;h1&quot;&gt;
              IntelGraph AI Analysis Platform
            &lt;/Typography&gt;
            &lt;Typography variant=&quot;subtitle1&quot; color=&quot;text.secondary&quot;&gt;
              Real-time ML-powered entity extraction, link prediction, and
              community detection
            &lt;/Typography&gt;
          &lt;/Grid&gt;
          &lt;Grid item&gt;
            &lt;Badge badgeContent={insights</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai/AIAnalysisPanel.js (Line 584:19 - Line 594:3), client/src/components/ai/AIAnalysisPanel.js (Line 489:19 - Line 499:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn125" onclick="toggleCodeBlock('cloneGroup125', 'expandBtn125', 'collapseBtn125')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn125" onclick="toggleCodeBlock('cloneGroup125', 'expandBtn125', 'collapseBtn125')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup125"><code class="language-javascript text-sm text-gray-800">&lt;/Button&gt;
                  {loading &amp;&amp; &lt;LinearProgress sx={{ mt: 1 }} /&gt;}
                &lt;/CardContent&gt;
              &lt;/Card&gt;
            &lt;/Grid&gt;

            &lt;Grid item xs={12} md={6}&gt;
              &lt;Card&gt;
                &lt;CardContent&gt;
                  &lt;Typography variant=&quot;h6&quot; gutterBottom&gt;
                    </code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai/AIAnalysisPanel.js (Line 751:19 - Line 761:3), client/src/components/ai/AIAnalysisPanel.js (Line 658:19 - Line 668:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn126" onclick="toggleCodeBlock('cloneGroup126', 'expandBtn126', 'collapseBtn126')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn126" onclick="toggleCodeBlock('cloneGroup126', 'expandBtn126', 'collapseBtn126')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup126"><code class="language-javascript text-sm text-gray-800">&lt;/Button&gt;
                  {loading &amp;&amp; &lt;LinearProgress sx={{ mt: 1 }} /&gt;}
                &lt;/CardContent&gt;
              &lt;/Card&gt;
            &lt;/Grid&gt;

            &lt;Grid item xs={12} md={8}&gt;
              &lt;Card&gt;
                &lt;CardContent&gt;
                  &lt;Typography variant=&quot;h6&quot; gutterBottom&gt;
                    </code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/Map/GeospatialDashboard.tsx (Line 128:2 - Line 189:2), client/src/components/Map/GeospatialDashboard.tsx (Line 124:2 - Line 170:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn127" onclick="toggleCodeBlock('cloneGroup127', 'expandBtn127', 'collapseBtn127')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn127" onclick="toggleCodeBlock('cloneGroup127', 'expandBtn127', 'collapseBtn127')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup127"><code class="language-javascript text-sm text-gray-800">}&gt;
                  &lt;Place color=&quot;primary&quot; /&gt;
                  &lt;Box&gt;
                    &lt;Typography variant=&quot;h6&quot;&gt;{stats.totalIncidents}&lt;/Typography&gt;
                    &lt;Typography variant=&quot;caption&quot; color=&quot;text.secondary&quot;&gt;
                      Total Incidents
                    &lt;/Typography&gt;
                  &lt;/Box&gt;
                &lt;/Stack&gt;
              &lt;/CardContent&gt;
            &lt;/Card&gt;
          &lt;/Grid&gt;
          &lt;Grid item xs={12} sm={6} md={3}&gt;
            &lt;Card variant=&quot;outlined&quot;&gt;
              &lt;CardContent sx={{ p: 1.5, '&amp;:last-child': { pb: 1.5 } }}&gt;
                &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
                  &lt;TrendingUp color=&quot;error&quot; /&gt;
                  &lt;Box&gt;
                    &lt;Typography variant=&quot;h6&quot;&gt;{stats.criticalIncidents}&lt;/Typography&gt;
                    &lt;Typography variant=&quot;caption&quot; color=&quot;text.secondary&quot;&gt;
                      Critical Events
                    &lt;/Typography&gt;
                  &lt;/Box&gt;
                &lt;/Stack&gt;
              &lt;/CardContent&gt;
            &lt;/Card&gt;
          &lt;/Grid&gt;
          &lt;Grid item xs={12} sm={6} md={3}&gt;
            &lt;Card variant=&quot;outlined&quot;&gt;
              &lt;CardContent sx={{ p: 1.5, '&amp;:last-child': { pb: 1.5 } }}&gt;
                &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
                  &lt;MyLocation color=&quot;success&quot; /&gt;
                  &lt;Box&gt;
                    &lt;Typography variant=&quot;h6&quot;&gt;{stats.totalEntities}&lt;/Typography&gt;
                    &lt;Typography variant=&quot;caption&quot; color=&quot;text.secondary&quot;&gt;
                      Tracked Entities
                    &lt;/Typography&gt;
                  &lt;/Box&gt;
                &lt;/Stack&gt;
              &lt;/CardContent&gt;
            &lt;/Card&gt;
          &lt;/Grid&gt;
          &lt;Grid item xs={12} sm={6} md={3}&gt;
            &lt;Card variant=&quot;outlined&quot;&gt;
              &lt;CardContent sx={{ p: 1.5, '&amp;:last-child': { pb: 1.5 } }}&gt;
                &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
                  &lt;Timeline color=&quot;warning&quot; /&gt;
                  &lt;Box&gt;
                    &lt;Typography variant=&quot;h6&quot;&gt;{stats.activeGeofences}&lt;/Typography&gt;
                    &lt;Typography variant=&quot;caption&quot; color=&quot;text.secondary&quot;&gt;
                      Active Geofences
                    &lt;/Typography&gt;
                  &lt;/Box&gt;
                &lt;/Stack&gt;
              &lt;/CardContent&gt;
            &lt;/Card&gt;
          &lt;/Grid&gt;
        &lt;/Grid&gt;
      &lt;/Paper&gt;

      {/* View Mode Selector */}
      &lt;Paper sx={{</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/MaestroUI/TaskMonitor.tsx (Line 506:11 - Line 535:11), client/src/components/MaestroUI/TaskMonitor.tsx (Line 491:2 - Line 519:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn130" onclick="toggleCodeBlock('cloneGroup130', 'expandBtn130', 'collapseBtn130')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn130" onclick="toggleCodeBlock('cloneGroup130', 'expandBtn130', 'collapseBtn130')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup130"><code class="language-javascript text-sm text-gray-800"> }}&gt;
                      {JSON.stringify(selectedTask.inputData, null, 2)}
                    &lt;/pre&gt;
                  &lt;/Paper&gt;
                &lt;/AccordionDetails&gt;
              &lt;/Accordion&gt;

              {selectedTask.outputData &amp;&amp; (
                &lt;Accordion&gt;
                  &lt;AccordionSummary expandIcon={&lt;ExpandMore /&gt;}&gt;
                    &lt;Typography variant=&quot;subtitle2&quot;&gt;Output Data&lt;/Typography&gt;
                  &lt;/AccordionSummary&gt;
                  &lt;AccordionDetails&gt;
                    &lt;Paper sx={{ p: 2, backgroundColor: 'grey.50' }}&gt;
                      &lt;pre style={{ margin: 0, fontSize: '0.875rem' }}&gt;
                        {JSON.stringify(selectedTask.outputData, null, 2)}
                      &lt;/pre&gt;
                    &lt;/Paper&gt;
                  &lt;/AccordionDetails&gt;
                &lt;/Accordion&gt;
              )}

              {/* Logs */}
              {selectedTask.logs &amp;&amp; selectedTask.logs.length &gt; 0 &amp;&amp; (
                &lt;Accordion&gt;
                  &lt;AccordionSummary expandIcon={&lt;ExpandMore /&gt;}&gt;
                    &lt;Typography variant=&quot;subtitle2&quot;&gt;Execution Logs&lt;/Typography&gt;
                  &lt;/AccordionSummary&gt;
                  &lt;AccordionDetails&gt;
                    &lt;Paper sx={{ p: 2, backgroundColor: 'grey.900'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/routes/IncidentDetailsRoute.tsx (Line 65:11 - Line 170:2), client/src/routes/InvestigationDetailsRoute.tsx (Line 68:16 - Line 182:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn133" onclick="toggleCodeBlock('cloneGroup133', 'expandBtn133', 'collapseBtn133')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn133" onclick="toggleCodeBlock('cloneGroup133', 'expandBtn133', 'collapseBtn133')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup133"><code class="language-javascript text-sm text-gray-800">} /&gt;
      &lt;/div&gt;
      &lt;ProvenanceFilterPanel
        onApply={(f) =&gt; {
          setFilter(f);
          refetch({ ...variables, filter: f });
        }}
        initial={filter}
        scope=&quot;incident&quot;
        id={incidentId}
      /&gt;
      &lt;div className=&quot;flex items-center gap-2 text-sm&quot;&gt;
        &lt;label className=&quot;opacity-70&quot;&gt;Group by:&lt;/label&gt;
        &lt;select
          className=&quot;border p-1&quot;
          value={groupBy}
          onChange={(e) =&gt; setGroupBy(e.target.value as any)}
        &gt;
          &lt;option value=&quot;none&quot;&gt;None&lt;/option&gt;
          &lt;option value=&quot;minute&quot;&gt;Minute&lt;/option&gt;
          &lt;option value=&quot;hour&quot;&gt;Hour&lt;/option&gt;
        &lt;/select&gt;
      &lt;/div&gt;
      {loading &amp;&amp; &lt;div&gt;Loading provenance&lt;/div&gt;}
      {error &amp;&amp; &lt;div className=&quot;text-red-600&quot;&gt;Error loading provenance&lt;/div&gt;}
      {!loading &amp;&amp; !error &amp;&amp; (
        &lt;div&gt;
          &lt;div className=&quot;text-sm opacity-70 mb-2&quot;&gt;
            {events.length} event(s)
          &lt;/div&gt;
          {groupBy === 'none' ? (
            &lt;table className=&quot;w-full text-sm&quot;&gt;
              &lt;thead&gt;
                &lt;tr className=&quot;text-left border-b&quot;&gt;
                  &lt;th className=&quot;p-2&quot;&gt;Time&lt;/th&gt;
                  &lt;th className=&quot;p-2&quot;&gt;Kind&lt;/th&gt;
                  &lt;th className=&quot;p-2&quot;&gt;ReasonCode&lt;/th&gt;
                  &lt;th className=&quot;p-2&quot;&gt;Metadata&lt;/th&gt;
                &lt;/tr&gt;
              &lt;/thead&gt;
              &lt;tbody&gt;
                {events.map((e: any) =&gt; (
                  &lt;tr key={e.id} className=&quot;border-b&quot;&gt;
                    &lt;td className=&quot;p-2&quot;&gt;
                      {new Date(e.createdAt).toLocaleString()}
                    &lt;/td&gt;
                    &lt;td className=&quot;p-2&quot;&gt;{e.kind}&lt;/td&gt;
                    &lt;td className=&quot;p-2&quot;&gt;{e.metadata?.reasonCode || '-'}&lt;/td&gt;
                    &lt;td className=&quot;p-2&quot;&gt;
                      &lt;MetadataPreview metadata={e.metadata} /&gt;
                    &lt;/td&gt;
                  &lt;/tr&gt;
                ))}
              &lt;/tbody&gt;
            &lt;/table&gt;
          ) : (
            &lt;div className=&quot;space-y-4&quot;&gt;
              {groups!.map(([bucket, items]) =&gt; (
                &lt;div key={bucket} className=&quot;border rounded&quot;&gt;
                  &lt;div className=&quot;px-3 py-2 text-xs bg-gray-50 border-b&quot;&gt;
                    {bucket.replace('T', ' ')} ({items.length})
                  &lt;/div&gt;
                  &lt;table className=&quot;w-full text-sm&quot;&gt;
                    &lt;thead&gt;
                      &lt;tr className=&quot;text-left border-b&quot;&gt;
                        &lt;th className=&quot;p-2&quot;&gt;Time&lt;/th&gt;
                        &lt;th className=&quot;p-2&quot;&gt;Kind&lt;/th&gt;
                        &lt;th className=&quot;p-2&quot;&gt;ReasonCode&lt;/th&gt;
                        &lt;th className=&quot;p-2&quot;&gt;Metadata&lt;/th&gt;
                      &lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody&gt;
                      {items.map((e: any) =&gt; (
                        &lt;tr key={e.id} className=&quot;border-b&quot;&gt;
                          &lt;td className=&quot;p-2&quot;&gt;
                            {new Date(e.createdAt).toLocaleTimeString()}
                          &lt;/td&gt;
                          &lt;td className=&quot;p-2&quot;&gt;{e.kind}&lt;/td&gt;
                          &lt;td className=&quot;p-2&quot;&gt;
                            {e.metadata?.reasonCode || '-'}
                          &lt;/td&gt;
                          &lt;td className=&quot;p-2&quot;&gt;
                            &lt;MetadataPreview metadata={e.metadata} /&gt;
                          &lt;/td&gt;
                        &lt;/tr&gt;
                      ))}
                    &lt;/tbody&gt;
                  &lt;/table&gt;
                &lt;/div&gt;
              ))}
            &lt;/div&gt;
          )}
        &lt;/div&gt;
      )}
    &lt;/div&gt;
  );
}

function MetadataPreview({ metadata }: { metadata: any }) {
  const [open, setOpen] = useState(false);
  if (!metadata) return &lt;span className=&quot;opacity-50&quot;&gt;-&lt;/span&gt;;
  return (
    &lt;span className=&quot;relative inline-block&quot;&gt;
      &lt;button
        className=&quot;text-blue-600 underline&quot;
        onClick={() =&gt; setOpen((v) =&gt; !v)}</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/Navigation.tsx (Line 103:9 - Line 130:4), client/src/components/Navigation.tsx (Line 90:20 - Line 116:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn144" onclick="toggleCodeBlock('cloneGroup144', 'expandBtn144', 'collapseBtn144')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn144" onclick="toggleCodeBlock('cloneGroup144', 'expandBtn144', 'collapseBtn144')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup144"><code class="language-javascript text-sm text-gray-800">)}
          style={{
            padding: '6px 10px',
            border: '1px solid var(--hairline)',
            borderRadius: 6,
            background: '#f6f7f9',
            cursor: 'pointer',
          }}
        &gt;
           OSINT
        &lt;/button&gt;
        &lt;button
          title=&quot;OSINT Studio&quot;
          onClick={() =&gt; navigate('/osint')}
          style={{
            padding: '6px 10px',
            border: '1px solid var(--hairline)',
            borderRadius: 6,
            background: '#f6f7f9',
            cursor: 'pointer',
          }}
        &gt;
           OSINT
        &lt;/button&gt;

        {!isHome &amp;&amp; (
          &lt;button
            onClick={() =&gt; navigate('/'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/InvestigationManager.tsx (Line 575:10 - Line 606:11), client/src/components/InvestigationManager.tsx (Line 543:8 - Line 573:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn147" onclick="toggleCodeBlock('cloneGroup147', 'expandBtn147', 'collapseBtn147')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn147" onclick="toggleCodeBlock('cloneGroup147', 'expandBtn147', 'collapseBtn147')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup147"><code class="language-javascript text-sm text-gray-800">: e.target.value }))
              }
              style={{
                width: '100%',
                padding: '6px 8px',
                border: '1px solid var(--hairline)',
                borderRadius: '4px',
                fontSize: '14px',
              }}
            &gt;
              &lt;option value=&quot;&quot;&gt;All Priorities&lt;/option&gt;
              &lt;option value=&quot;critical&quot;&gt;Critical&lt;/option&gt;
              &lt;option value=&quot;high&quot;&gt;High&lt;/option&gt;
              &lt;option value=&quot;medium&quot;&gt;Medium&lt;/option&gt;
              &lt;option value=&quot;low&quot;&gt;Low&lt;/option&gt;
            &lt;/select&gt;
          &lt;/div&gt;

          &lt;div&gt;
            &lt;label
              style={{
                fontSize: '12px',
                fontWeight: '600',
                marginBottom: '4px',
                display: 'block',
              }}
            &gt;
              Assigned To
            &lt;/label&gt;
            &lt;input
              type=&quot;text&quot;
              value={filter.assignedTo</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/main.progressive.js (Line 6:44 - Line 23:45), client/src/main.router.js (Line 6:39 - Line 23:55)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn150" onclick="toggleCodeBlock('cloneGroup150', 'expandBtn150', 'collapseBtn150')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn150" onclick="toggleCodeBlock('cloneGroup150', 'expandBtn150', 'collapseBtn150')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup150"><code class="language-javascript text-sm text-gray-800">);

// Global error handlers
window.addEventListener('error', (event) =&gt; {
  console.error(' GLOBAL ERROR:', event.error);
});

window.addEventListener('unhandledrejection', (event) =&gt; {
  console.error(' UNHANDLED PROMISE REJECTION:', event.reason);
});

const root = document.getElementById('root');

if (!root) {
  console.error(' CRITICAL: Root element not found!');
} else {
  try {
    console.log(' Creating React root with Redux + MUI...'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/main.js (Line 7:44 - Line 24:44), client/src/main.router.js (Line 6:39 - Line 23:55)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn152" onclick="toggleCodeBlock('cloneGroup152', 'expandBtn152', 'collapseBtn152')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn152" onclick="toggleCodeBlock('cloneGroup152', 'expandBtn152', 'collapseBtn152')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup152"><code class="language-javascript text-sm text-gray-800">);

// Global error handlers
window.addEventListener('error', (event) =&gt; {
  console.error(' GLOBAL ERROR:', event.error);
});

window.addEventListener('unhandledrejection', (event) =&gt; {
  console.error(' UNHANDLED PROMISE REJECTION:', event.reason);
});

const root = document.getElementById('root');

if (!root) {
  console.error(' CRITICAL: Root element not found!');
} else {
  try {
    console.log(' Creating React root with full stack...'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/main.apollo.js (Line 6:39 - Line 23:54), client/src/main.router.js (Line 6:39 - Line 23:55)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn154" onclick="toggleCodeBlock('cloneGroup154', 'expandBtn154', 'collapseBtn154')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn154" onclick="toggleCodeBlock('cloneGroup154', 'expandBtn154', 'collapseBtn154')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup154"><code class="language-javascript text-sm text-gray-800">);

// Global error handlers
window.addEventListener('error', (event) =&gt; {
  console.error(' GLOBAL ERROR:', event.error);
});

window.addEventListener('unhandledrejection', (event) =&gt; {
  console.error(' UNHANDLED PROMISE REJECTION:', event.reason);
});

const root = document.getElementById('root');

if (!root) {
  console.error(' CRITICAL: Root element not found!');
} else {
  try {
    console.log(' Creating React root with Redux + MUI + Apollo...'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.router.jsx (Line 287:52 - Line 307:52), client/src/App.router.jsx (Line 267:52 - Line 287:52)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn155" onclick="toggleCodeBlock('cloneGroup155', 'expandBtn155', 'collapseBtn155')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn155" onclick="toggleCodeBlock('cloneGroup155', 'expandBtn155', 'collapseBtn155')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup155"><code class="language-javascript text-sm text-gray-800">,
              color: 'white',
            }}
          &gt;
            &lt;CardContent sx={{ textAlign: 'center' }}&gt;
              &lt;Typography variant=&quot;h3&quot; sx={{ fontWeight: 'bold' }}&gt;
                {metrics.graphNodes.toLocaleString()}
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;h6&quot;&gt;Graph Entities&lt;/Typography&gt;
              &lt;Typography variant=&quot;body2&quot; sx={{ opacity: 0.8, mt: 1 }}&gt;
                 Live updating
              &lt;/Typography&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} sm={6} md={3}&gt;
          &lt;Card
            sx={{
              height: '100%',
              background: 'linear-gradient(135deg, #9c27b0 0%, #ba68c8 100%)'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.router.jsx (Line 307:52 - Line 327:52), client/src/App.router.jsx (Line 267:52 - Line 287:52)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn156" onclick="toggleCodeBlock('cloneGroup156', 'expandBtn156', 'collapseBtn156')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn156" onclick="toggleCodeBlock('cloneGroup156', 'expandBtn156', 'collapseBtn156')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup156"><code class="language-javascript text-sm text-gray-800">,
              color: 'white',
            }}
          &gt;
            &lt;CardContent sx={{ textAlign: 'center' }}&gt;
              &lt;Typography variant=&quot;h3&quot; sx={{ fontWeight: 'bold' }}&gt;
                {metrics.reportsGenerated}
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;h6&quot;&gt;Reports Generated&lt;/Typography&gt;
              &lt;Typography variant=&quot;body2&quot; sx={{ opacity: 0.8, mt: 1 }}&gt;
                 Last 30 days
              &lt;/Typography&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} sm={6} md={3}&gt;
          &lt;Card
            sx={{
              height: '100%',
              background: 'linear-gradient(135deg, #f44336 0%, #ef5350 100%)'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.router.jsx (Line 327:52 - Line 345:2), client/src/App.router.jsx (Line 267:52 - Line 283:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn157" onclick="toggleCodeBlock('cloneGroup157', 'expandBtn157', 'collapseBtn157')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn157" onclick="toggleCodeBlock('cloneGroup157', 'expandBtn157', 'collapseBtn157')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup157"><code class="language-javascript text-sm text-gray-800">,
              color: 'white',
            }}
          &gt;
            &lt;CardContent sx={{ textAlign: 'center' }}&gt;
              &lt;Typography variant=&quot;h3&quot; sx={{ fontWeight: 'bold' }}&gt;
                {metrics.alertsCount}
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;h6&quot;&gt;Active Alerts&lt;/Typography&gt;
              &lt;Typography variant=&quot;body2&quot; sx={{ opacity: 0.8, mt: 1 }}&gt;
                 Requires attention
              &lt;/Typography&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        {/* System Status */}
        &lt;Grid item xs={12} md={6}&gt;
          &lt;Card sx={{</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.router.jsx (Line 493:2 - Line 530:2), client/src/App.router.jsx (Line 491:2 - Line 504:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn158" onclick="toggleCodeBlock('cloneGroup158', 'expandBtn158', 'collapseBtn158')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn158" onclick="toggleCodeBlock('cloneGroup158', 'expandBtn158', 'collapseBtn158')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup158"><code class="language-javascript text-sm text-gray-800">}&gt;
                    &lt;Typography variant=&quot;h4&quot;&gt;&lt;/Typography&gt;
                    &lt;Typography variant=&quot;body2&quot;&gt;React Router&lt;/Typography&gt;
                  &lt;/Box&gt;
                &lt;/Grid&gt;
                &lt;Grid item xs={6} sm={4} md={2}&gt;
                  &lt;Box sx={{ textAlign: 'center', p: 1 }}&gt;
                    &lt;Typography variant=&quot;h4&quot;&gt;&lt;/Typography&gt;
                    &lt;Typography variant=&quot;body2&quot;&gt;Material-UI&lt;/Typography&gt;
                  &lt;/Box&gt;
                &lt;/Grid&gt;
                &lt;Grid item xs={6} sm={4} md={2}&gt;
                  &lt;Box sx={{ textAlign: 'center', p: 1 }}&gt;
                    &lt;Typography variant=&quot;h4&quot;&gt;&lt;/Typography&gt;
                    &lt;Typography variant=&quot;body2&quot;&gt;Apollo GraphQL&lt;/Typography&gt;
                  &lt;/Box&gt;
                &lt;/Grid&gt;
                &lt;Grid item xs={6} sm={4} md={2}&gt;
                  &lt;Box sx={{ textAlign: 'center', p: 1 }}&gt;
                    &lt;Typography variant=&quot;h4&quot;&gt;&lt;/Typography&gt;
                    &lt;Typography variant=&quot;body2&quot;&gt;Redux Store&lt;/Typography&gt;
                  &lt;/Box&gt;
                &lt;/Grid&gt;
                &lt;Grid item xs={6} sm={4} md={2}&gt;
                  &lt;Box sx={{ textAlign: 'center', p: 1 }}&gt;
                    &lt;Typography variant=&quot;h4&quot;&gt;&lt;/Typography&gt;
                    &lt;Typography variant=&quot;body2&quot;&gt;Graph Engine&lt;/Typography&gt;
                  &lt;/Box&gt;
                &lt;/Grid&gt;
                &lt;Grid item xs={6} sm={4} md={2}&gt;
                  &lt;Box sx={{ textAlign: 'center', p: 1 }}&gt;
                    &lt;Typography variant=&quot;h4&quot;&gt;&lt;/Typography&gt;
                    &lt;Typography variant=&quot;body2&quot;&gt;AI Copilot&lt;/Typography&gt;
                  &lt;/Box&gt;
                &lt;/Grid&gt;
              &lt;/Grid&gt;

              &lt;Alert severity=&quot;success&quot; sx={{</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.router.jsx (Line 545:4 - Line 577:4), client/src/App.router.jsx (Line 530:4 - Line 569:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn159" onclick="toggleCodeBlock('cloneGroup159', 'expandBtn159', 'collapseBtn159')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn159" onclick="toggleCodeBlock('cloneGroup159', 'expandBtn159', 'collapseBtn159')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup159"><code class="language-javascript text-sm text-gray-800">: 2 }}&gt;
      &lt;InvestigationTimeline /&gt;
    &lt;/Container&gt;
  );
}

function GraphExplorerPage() {
  return (
    &lt;Container maxWidth=&quot;xl&quot; sx={{ height: '100vh', py: 2 }}&gt;
      &lt;InteractiveGraphExplorer /&gt;
    &lt;/Container&gt;
  );
}

function CopilotPage() {
  return (
    &lt;Container maxWidth=&quot;xl&quot; sx={{ height: '100vh', py: 2 }}&gt;
      &lt;IntelligentCopilot /&gt;
    &lt;/Container&gt;
  );
}

function ThreatsPage() {
  return (
    &lt;Container maxWidth=&quot;xl&quot; sx={{ height: '100vh', py: 2 }}&gt;
      &lt;ThreatAssessmentEngine /&gt;
    &lt;/Container&gt;
  );
}

function OrchestratorPage() {
  return (
    &lt;Container maxWidth=&quot;xl&quot; sx={{ py</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.jsx (Line 76:3 - Line 147:2), client/src/App.progressive.jsx (Line 21:3 - Line 103:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn160" onclick="toggleCodeBlock('cloneGroup160', 'expandBtn160', 'collapseBtn160')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn160" onclick="toggleCodeBlock('cloneGroup160', 'expandBtn160', 'collapseBtn160')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup160"><code class="language-javascript text-sm text-gray-800">={{ mt: 4, mb: 4 }}&gt;
      &lt;ConnectionStatus /&gt;

      &lt;Grid container spacing={3}&gt;
        &lt;Grid item xs={12}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h3&quot; component=&quot;h1&quot; gutterBottom&gt;
                 IntelGraph Platform
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;h6&quot; color=&quot;text.secondary&quot; gutterBottom&gt;
                AI-Augmented Intelligence Analysis Platform
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;body1&quot; sx={{ mt: 2 }}&gt;
                 React + Material-UI + Redux + Apollo GraphQL working!
              &lt;/Typography&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={6}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h5&quot; component=&quot;h2&quot; gutterBottom&gt;
                 System Status
              &lt;/Typography&gt;
              &lt;Box component=&quot;ul&quot; sx={{ pl: 2 }}&gt;
                &lt;li&gt; React 18 application&lt;/li&gt;
                &lt;li&gt; Material-UI components&lt;/li&gt;
                &lt;li&gt; Redux state management&lt;/li&gt;
                &lt;li&gt; Custom theming&lt;/li&gt;
                &lt;li&gt; Apollo GraphQL client&lt;/li&gt;
                &lt;li&gt; React Router (next step)&lt;/li&gt;
                &lt;li&gt; Dashboard components (next step)&lt;/li&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={6}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h5&quot; component=&quot;h2&quot; gutterBottom&gt;
                 Platform Features
              &lt;/Typography&gt;
              &lt;Box
                sx={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 1 }}
              &gt;
                &lt;div&gt; Graph Analytics&lt;/div&gt;
                &lt;div&gt; AI Copilot&lt;/div&gt;
                &lt;div&gt; Real-time Collaboration&lt;/div&gt;
                &lt;div&gt; Advanced Visualization&lt;/div&gt;
                &lt;div&gt; Sentiment Analysis&lt;/div&gt;
                &lt;div&gt; GeoInt Mapping&lt;/div&gt;
                &lt;div&gt; Report Generation&lt;/div&gt;
                &lt;div&gt; Data Federation&lt;/div&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h5&quot; component=&quot;h2&quot; gutterBottom&gt;
                 Quick Actions
              &lt;/Typography&gt;
              &lt;Box sx={{ display: 'flex', gap: 2, flexWrap: 'wrap' }}&gt;
                &lt;Button
                  variant=&quot;contained&quot;
                  color=&quot;primary&quot;
                  onClick={(</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.js (Line 19:14 - Line 32:2), client/src/App.router.js (Line 88:2 - Line 100:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn169" onclick="toggleCodeBlock('cloneGroup169', 'expandBtn169', 'collapseBtn169')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn169" onclick="toggleCodeBlock('cloneGroup169', 'expandBtn169', 'collapseBtn169')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup169"><code class="language-javascript text-sm text-gray-800">;

// Connection Status Component
function ConnectionStatus() {
  const [backendStatus, setBackendStatus] = React.useState('checking');

  React.useEffect(() =&gt; {
    const checkBackend = async () =&gt; {
      try {
        const response = await fetch('http://localhost:4000/graphql', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            query: '{ __typename }',</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.js (Line 49:5 - Line 73:37), client/src/App.router.js (Line 110:5 - Line 133:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn170" onclick="toggleCodeBlock('cloneGroup170', 'expandBtn170', 'collapseBtn170')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn170" onclick="toggleCodeBlock('cloneGroup170', 'expandBtn170', 'collapseBtn170')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup170"><code class="language-javascript text-sm text-gray-800">return () =&gt; clearInterval(interval);
  }, []);

  const statusConfig = {
    checking: { color: 'info', message: ' Checking backend connection...' },
    connected: {
      color: 'success',
      message: ' Backend connected successfully!',
    },
    error: {
      color: 'error',
      message: ' Backend connection failed. Check if server is running.',
    },
  };

  const { color, message } = statusConfig[backendStatus];

  return (
    &lt;Alert severity={color} sx={{ mb: 2 }}&gt;
      {message}
    &lt;/Alert&gt;
  );
}

// Dashboard with Apollo integration</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.js (Line 77:2 - Line 90:2), client/src/App.progressive.js (Line 21:2 - Line 33:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn171" onclick="toggleCodeBlock('cloneGroup171', 'expandBtn171', 'collapseBtn171')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn171" onclick="toggleCodeBlock('cloneGroup171', 'expandBtn171', 'collapseBtn171')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup171"><code class="language-javascript text-sm text-gray-800">&gt;

      &lt;Grid container spacing={3}&gt;
        &lt;Grid item xs={12}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h3&quot; component=&quot;h1&quot; gutterBottom&gt;
                 IntelGraph Platform
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;h6&quot; color=&quot;text.secondary&quot; gutterBottom&gt;
                AI-Augmented Intelligence Analysis Platform
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;body1&quot; sx={{ mt: 2 }}&gt;
                 React + Material-UI + Redux +</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.js (Line 90:8 - Line 107:2), client/src/App.progressive.js (Line 33:13 - Line 50:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn172" onclick="toggleCodeBlock('cloneGroup172', 'expandBtn172', 'collapseBtn172')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn172" onclick="toggleCodeBlock('cloneGroup172', 'expandBtn172', 'collapseBtn172')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup172"><code class="language-javascript text-sm text-gray-800">!
              &lt;/Typography&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={6}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h5&quot; component=&quot;h2&quot; gutterBottom&gt;
                 System Status
              &lt;/Typography&gt;
              &lt;Box component=&quot;ul&quot; sx={{ pl: 2 }}&gt;
                &lt;li&gt; React 18 application&lt;/li&gt;
                &lt;li&gt; Material-UI components&lt;/li&gt;
                &lt;li&gt; Redux state management&lt;/li&gt;
                &lt;li&gt; Custom theming&lt;/li&gt;
                &lt;li&gt;</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.js (Line 109:2 - Line 126:5), client/src/App.progressive.js (Line 51:2 - Line 68:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn173" onclick="toggleCodeBlock('cloneGroup173', 'expandBtn173', 'collapseBtn173')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn173" onclick="toggleCodeBlock('cloneGroup173', 'expandBtn173', 'collapseBtn173')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup173"><code class="language-javascript text-sm text-gray-800">(next step)&lt;/li&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={6}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h5&quot; component=&quot;h2&quot; gutterBottom&gt;
                 Platform Features
              &lt;/Typography&gt;
              &lt;Box
                sx={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 1 }}
              &gt;
                &lt;div&gt; Graph Analytics&lt;/div&gt;
                &lt;div&gt; AI Copilot&lt;/div&gt;
                &lt;div&gt; Real</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.js (Line 122:2 - Line 132:4), client/src/App.basic.js (Line 120:13 - Line 130:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn174" onclick="toggleCodeBlock('cloneGroup174', 'expandBtn174', 'collapseBtn174')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn174" onclick="toggleCodeBlock('cloneGroup174', 'expandBtn174', 'collapseBtn174')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup174"><code class="language-javascript text-sm text-gray-800">}}
              &gt;
                &lt;div&gt; Graph Analytics&lt;/div&gt;
                &lt;div&gt; AI Copilot&lt;/div&gt;
                &lt;div&gt; Real-time Collaboration&lt;/div&gt;
                &lt;div&gt; Advanced Visualization&lt;/div&gt;
                &lt;div&gt; Sentiment Analysis&lt;/div&gt;
                &lt;div&gt; GeoInt Mapping&lt;/div&gt;
                &lt;div&gt; Report Generation&lt;/div&gt;
                &lt;div&gt; Data Federation&lt;/div&gt;
              &lt;/Box</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.js (Line 127:2 - Line 147:8), client/src/App.progressive.js (Line 69:2 - Line 86:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn175" onclick="toggleCodeBlock('cloneGroup175', 'expandBtn175', 'collapseBtn175')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn175" onclick="toggleCodeBlock('cloneGroup175', 'expandBtn175', 'collapseBtn175')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup175"><code class="language-javascript text-sm text-gray-800">Visualization&lt;/div&gt;
                &lt;div&gt; Sentiment Analysis&lt;/div&gt;
                &lt;div&gt; GeoInt Mapping&lt;/div&gt;
                &lt;div&gt; Report Generation&lt;/div&gt;
                &lt;div&gt; Data Federation&lt;/div&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h5&quot; component=&quot;h2&quot; gutterBottom&gt;
                 Quick Actions
              &lt;/Typography&gt;
              &lt;Box sx={{ display: 'flex', gap: 2, flexWrap: 'wrap' }}&gt;
                &lt;Button
                  variant=&quot;contained&quot;
                  color=&quot;primary&quot;
                  onClick</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.js (Line 169:17 - Line 188:7), client/src/App.progressive.js (Line 95:10 - Line 114:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn176" onclick="toggleCodeBlock('cloneGroup176', 'expandBtn176', 'collapseBtn176')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn176" onclick="toggleCodeBlock('cloneGroup176', 'expandBtn176', 'collapseBtn176')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup176"><code class="language-javascript text-sm text-gray-800">&gt;
                  AI Copilot
                &lt;/Button&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h6&quot; gutterBottom&gt;
                 Debug Information
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;body2&quot; color=&quot;text.secondary&quot;&gt;
                Started: {new Date().toLocaleString()}
                &lt;br /&gt;
                URL: {window.location.href}
                &lt;br /&gt;
                Apollo</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.js (Line 191:15 - Line 217:39), client/src/App.progressive.js (Line 115:15 - Line 141:44)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn177" onclick="toggleCodeBlock('cloneGroup177', 'expandBtn177', 'collapseBtn177')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn177" onclick="toggleCodeBlock('cloneGroup177', 'expandBtn177', 'collapseBtn177')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup177"><code class="language-javascript text-sm text-gray-800">&lt;/Typography&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;
      &lt;/Grid&gt;
    &lt;/Container&gt;
  );
}

// Themed App Shell
function ThemedAppShell({ children }) {
  const mode = useSelector((state) =&gt; state.ui?.theme || 'light');
  const theme = useMemo(() =&gt; getIntelGraphTheme(mode), [mode]);

  return (
    &lt;ThemeProvider theme={theme}&gt;
      &lt;CssBaseline /&gt;
      &lt;Box sx={{ bgcolor: 'background.default', minHeight: '100vh' }}&gt;
        {children}
      &lt;/Box&gt;
    &lt;/ThemeProvider&gt;
  );
}

function App() {
  useEffect(() =&gt; {
    console.log(' Apollo IntelGraph App mounting...'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/migrations/neo4j/001_initial_entity_model.js (Line 210:51 - Line 222:20), server/src/db/migrations/neo4j/002_entity_type_specialization.js (Line 196:46 - Line 208:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn190" onclick="toggleCodeBlock('cloneGroup190', 'expandBtn190', 'collapseBtn190')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn190" onclick="toggleCodeBlock('cloneGroup190', 'expandBtn190', 'collapseBtn190')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup190"><code class="language-javascript text-sm text-gray-800">,
    ];

    for (const dropIndex of indexesToDrop) {
      try {
        await session.run(dropIndex);
        console.log(` Dropped index: ${dropIndex.split(' ')[2]}`);
      } catch (error) {
        console.warn(`  Failed to drop index: ${error.message}`);
      }
    }

    // Drop constraints</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/migrations/neo4j/001_initial_entity_model.js (Line 228:51 - Line 240:36), server/src/db/migrations/neo4j/002_entity_type_specialization.js (Line 211:45 - Line 223:50)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn191" onclick="toggleCodeBlock('cloneGroup191', 'expandBtn191', 'collapseBtn191')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn191" onclick="toggleCodeBlock('cloneGroup191', 'expandBtn191', 'collapseBtn191')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup191"><code class="language-javascript text-sm text-gray-800">,
    ];

    for (const dropConstraint of constraintsToDrop) {
      try {
        await session.run(dropConstraint);
        console.log(` Dropped constraint: ${dropConstraint.split(' ')[2]}`);
      } catch (error) {
        console.warn(`  Failed to drop constraint: ${error.message}`);
      }
    }

    console.log(' Entity model rollback completed'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/gnnResolvers.js (Line 168:25 - Line 181:32), server/src/graphql/resolvers/gnnResolvers.js (Line 100:26 - Line 113:36)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn261" onclick="toggleCodeBlock('cloneGroup261', 'expandBtn261', 'collapseBtn261')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn261" onclick="toggleCodeBlock('cloneGroup261', 'expandBtn261', 'collapseBtn261')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup261"><code class="language-javascript text-sm text-gray-800">,
              modelConfig: modelConfig ? JSON.parse(modelConfig) : {},
              taskMode: taskMode || 'predict',
              options: {
                ...options,
                token: req.headers.authorization?.replace('Bearer ', ''),
              },
            });

            if (!result.success) {
              throw new Error(result.error);
            }

            logger.info('GNN link prediction initiated'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/gnnResolvers.js (Line 186:2 - Line 199:29), server/src/graphql/resolvers/gnnResolvers.js (Line 117:10 - Line 130:33)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn262" onclick="toggleCodeBlock('cloneGroup262', 'expandBtn262', 'collapseBtn262')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn262" onclick="toggleCodeBlock('cloneGroup262', 'expandBtn262', 'collapseBtn262')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup262"><code class="language-javascript text-sm text-gray-800">,
              userId: user?.id,
            });

            return {
              success: true,
              jobId: result.jobId,
              taskId: result.taskId,
              message: result.message,
              modelName: result.modelName,
              taskMode: result.taskMode,
            };
          } catch (error) {
            logger.error('GNN link prediction failed'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/gnnResolvers.js (Line 238:27 - Line 251:37), server/src/graphql/resolvers/gnnResolvers.js (Line 100:26 - Line 113:36)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn263" onclick="toggleCodeBlock('cloneGroup263', 'expandBtn263', 'collapseBtn263')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn263" onclick="toggleCodeBlock('cloneGroup263', 'expandBtn263', 'collapseBtn263')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup263"><code class="language-javascript text-sm text-gray-800">,
              modelConfig: modelConfig ? JSON.parse(modelConfig) : {},
              taskMode: taskMode || 'predict',
              options: {
                ...options,
                token: req.headers.authorization?.replace('Bearer ', ''),
              },
            });

            if (!result.success) {
              throw new Error(result.error);
            }

            logger.info('GNN graph classification initiated'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/gnnResolvers.js (Line 256:7 - Line 269:34), server/src/graphql/resolvers/gnnResolvers.js (Line 117:10 - Line 130:33)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn264" onclick="toggleCodeBlock('cloneGroup264', 'expandBtn264', 'collapseBtn264')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn264" onclick="toggleCodeBlock('cloneGroup264', 'expandBtn264', 'collapseBtn264')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup264"><code class="language-javascript text-sm text-gray-800">,
              userId: user?.id,
            });

            return {
              success: true,
              jobId: result.jobId,
              taskId: result.taskId,
              message: result.message,
              modelName: result.modelName,
              taskMode: result.taskMode,
            };
          } catch (error) {
            logger.error('GNN graph classification failed'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/gnnResolvers.js (Line 311:4 - Line 322:34), server/src/graphql/resolvers/gnnResolvers.js (Line 102:10 - Line 113:36)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn265" onclick="toggleCodeBlock('cloneGroup265', 'expandBtn265', 'collapseBtn265')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn265" onclick="toggleCodeBlock('cloneGroup265', 'expandBtn265', 'collapseBtn265')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup265"><code class="language-javascript text-sm text-gray-800">,
              options: {
                ...options,
                token: req.headers.authorization?.replace('Bearer ', ''),
              },
            });

            if (!result.success) {
              throw new Error(result.error);
            }

            logger.info('GNN anomaly detection initiated'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/gnnResolvers.js (Line 327:4 - Line 340:31), server/src/graphql/resolvers/gnnResolvers.js (Line 117:10 - Line 130:33)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn266" onclick="toggleCodeBlock('cloneGroup266', 'expandBtn266', 'collapseBtn266')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn266" onclick="toggleCodeBlock('cloneGroup266', 'expandBtn266', 'collapseBtn266')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup266"><code class="language-javascript text-sm text-gray-800">,
              userId: user?.id,
            });

            return {
              success: true,
              jobId: result.jobId,
              taskId: result.taskId,
              message: result.message,
              modelName: result.modelName,
              taskMode: result.taskMode,
            };
          } catch (error) {
            logger.error('GNN anomaly detection failed'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/gnnResolvers.js (Line 376:4 - Line 387:37), server/src/graphql/resolvers/gnnResolvers.js (Line 102:10 - Line 113:36)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn267" onclick="toggleCodeBlock('cloneGroup267', 'expandBtn267', 'collapseBtn267')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn267" onclick="toggleCodeBlock('cloneGroup267', 'expandBtn267', 'collapseBtn267')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup267"><code class="language-javascript text-sm text-gray-800">,
              options: {
                ...options,
                token: req.headers.authorization?.replace('Bearer ', ''),
              },
            });

            if (!result.success) {
              throw new Error(result.error);
            }

            logger.info('GNN embedding generation initiated'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/warRoomSync.test.js (Line 173:7 - Line 185:6), server/src/tests/warRoomSync.test.js (Line 50:7 - Line 62:26)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn322" onclick="toggleCodeBlock('cloneGroup322', 'expandBtn322', 'collapseBtn322')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn322" onclick="toggleCodeBlock('cloneGroup322', 'expandBtn322', 'collapseBtn322')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup322"><code class="language-javascript text-sm text-gray-800">const mockSocket1 = {
        id: 'socket1',
        emit: jest.fn(),
        to: jest.fn(() =&gt; ({ emit: jest.fn() })),
      };

      const mockSocket2 = {
        id: 'socket2',
        emit: jest.fn(),
        to: jest.fn(() =&gt; ({ emit: jest.fn() })),
      };

      await</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/warRoomSync.test.js (Line 289:18 - Line 302:10), server/src/tests/warRoomSync.test.js (Line 112:2 - Line 125:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn323" onclick="toggleCodeBlock('cloneGroup323', 'expandBtn323', 'collapseBtn323')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn323" onclick="toggleCodeBlock('cloneGroup323', 'expandBtn323', 'collapseBtn323')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup323"><code class="language-javascript text-sm text-gray-800">;

      const mockSocket = {
        id: 'socket1',
        emit: jest.fn(),
        to: jest.fn(() =&gt; ({ emit: jest.fn() })),
      };

      await warRoomSync.joinWarRoom(mockSocket, roomId, 'user1', {
        name: 'User 1',
        role: 'admin',
      });

      const operation</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/warRoomSync.test.js (Line 339:19 - Line 353:45), server/src/tests/warRoomSync.test.js (Line 111:23 - Line 125:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn324" onclick="toggleCodeBlock('cloneGroup324', 'expandBtn324', 'collapseBtn324')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn324" onclick="toggleCodeBlock('cloneGroup324', 'expandBtn324', 'collapseBtn324')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup324"><code class="language-javascript text-sm text-gray-800">;
      await warRoomSync.initializeWarRoom(roomId);

      const mockSocket = {
        id: 'socket1',
        emit: jest.fn(),
        to: jest.fn(() =&gt; ({ emit: jest.fn() })),
      };

      await warRoomSync.joinWarRoom(mockSocket, roomId, 'user1', {
        name: 'User 1',
        role: 'admin',
      });

      // Invalid operation - missing required data</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/reportingService.test.js (Line 12:24 - Line 26:25), server/src/tests/visualizationService.test.js (Line 11:22 - Line 25:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn325" onclick="toggleCodeBlock('cloneGroup325', 'expandBtn325', 'collapseBtn325')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn325" onclick="toggleCodeBlock('cloneGroup325', 'expandBtn325', 'collapseBtn325')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup325"><code class="language-javascript text-sm text-gray-800">;
  let mockLogger;
  let mockSession;

  beforeEach(() =&gt; {
    mockSession = {
      run: jest.fn(),
      close: jest.fn(),
    };

    mockNeo4jDriver = {
      session: jest.fn(() =&gt; mockSession),
    };

    mockVisualizationService</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/pluginService.test.js (Line 289:36 - Line 303:6), server/src/tests/pluginService.test.js (Line 267:39 - Line 281:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn326" onclick="toggleCodeBlock('cloneGroup326', 'expandBtn326', 'collapseBtn326')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn326" onclick="toggleCodeBlock('cloneGroup326', 'expandBtn326', 'collapseBtn326')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup326"><code class="language-javascript text-sm text-gray-800">, async () =&gt; {
      const plugin = await pluginService.registerPlugin({
        name: 'Test Plugin',
        version: '1.0.0',
        main: 'index.js',
      });

      pluginService.loadPluginCode = jest.fn().mockResolvedValue({
        initialize: jest.fn(),
        activate: jest.fn(),
        deactivate: jest.fn(),
      });

      await pluginService.loadPlugin(plugin.id);
      await</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/enterpriseSecurity.test.js (Line 323:15 - Line 337:18), server/src/tests/enterpriseSecurity.test.js (Line 296:11 - Line 310:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn327" onclick="toggleCodeBlock('cloneGroup327', 'expandBtn327', 'collapseBtn327')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn327" onclick="toggleCodeBlock('cloneGroup327', 'expandBtn327', 'collapseBtn327')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup327"><code class="language-javascript text-sm text-gray-800">],
        expiresAt: new Date(Date.now() + 60000),
        lastActivity: new Date(),
        ipAddress: '192.168.1.100',
      };

      mockRedisClient.get.mockResolvedValue(JSON.stringify(mockSession));
      const token = securityService.generateSessionToken(
        'session123',
        'user123',
      );

      const result = await securityService.checkPermission(
        token,
        'USER_MANAGEMENT'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/enterpriseSecurity.test.js (Line 348:14 - Line 364:13), server/src/tests/enterpriseSecurity.test.js (Line 295:21 - Line 311:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn328" onclick="toggleCodeBlock('cloneGroup328', 'expandBtn328', 'collapseBtn328')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn328" onclick="toggleCodeBlock('cloneGroup328', 'expandBtn328', 'collapseBtn328')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup328"><code class="language-javascript text-sm text-gray-800">],
        dataClassifications: ['UNCLASSIFIED', 'INTERNAL'],
        expiresAt: new Date(Date.now() + 60000),
        lastActivity: new Date(),
        ipAddress: '192.168.1.100',
      };

      mockRedisClient.get.mockResolvedValue(JSON.stringify(mockSession));
      const token = securityService.generateSessionToken(
        'session123',
        'user123',
      );

      const result = await securityService.checkPermission(
        token,
        'ENTITY_READ',
        { id: 'entity123', dataClassification: 'TOP_SECRET'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/copilotOrchestration.test.js (Line 12:27 - Line 26:24), server/src/tests/visualizationService.test.js (Line 11:22 - Line 25:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn333" onclick="toggleCodeBlock('cloneGroup333', 'expandBtn333', 'collapseBtn333')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn333" onclick="toggleCodeBlock('cloneGroup333', 'expandBtn333', 'collapseBtn333')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup333"><code class="language-javascript text-sm text-gray-800">;
  let mockLogger;
  let mockSession;

  beforeEach(() =&gt; {
    mockSession = {
      run: jest.fn(),
      close: jest.fn(),
    };

    mockNeo4jDriver = {
      session: jest.fn(() =&gt; mockSession),
    };

    mockAIExtractionService</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/copilot.persistence.test.js (Line 505:5 - Line 515:2), server/src/tests/copilot.persistence.test.js (Line 350:16 - Line 360:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn334" onclick="toggleCodeBlock('cloneGroup334', 'expandBtn334', 'collapseBtn334')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn334" onclick="toggleCodeBlock('cloneGroup334', 'expandBtn334', 'collapseBtn334')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup334"><code class="language-javascript text-sm text-gray-800">,
            status: 'failed',
            plan: '{&quot;steps&quot;:[]}',
            metadata: '{}',
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString(),
            started_at: new Date().toISOString(),
            finished_at: new Date().toISOString(),
          },
        ],
      })</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/copilot.persistence.test.js (Line 540:7 - Line 557:11), server/src/tests/copilot.persistence.test.js (Line 436:7 - Line 453:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn335" onclick="toggleCodeBlock('cloneGroup335', 'expandBtn335', 'collapseBtn335')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn335" onclick="toggleCodeBlock('cloneGroup335', 'expandBtn335', 'collapseBtn335')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup335"><code class="language-javascript text-sm text-gray-800">mockPg.mockQuery(
        'insert into copilot_events ( run_id, task_id, event_level, message, payload, created_at ) values ($1, $2, $3, $4, $5, $6) returning *',
        (params) =&gt; ({
          rows: [
            {
              id: Date.now(),
              run_id: params[0],
              task_id: params[1],
              event_level: params[2],
              message: params[3],
              payload: params[4],
              created_at: params[5],
            },
          ],
        }),
      );

      const resumedRun</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/aiExtraction.test.js (Line 169:26 - Line 179:14), server/src/tests/aiExtraction.test.js (Line 126:17 - Line 136:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn336" onclick="toggleCodeBlock('cloneGroup336', 'expandBtn336', 'collapseBtn336')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn336" onclick="toggleCodeBlock('cloneGroup336', 'expandBtn336', 'collapseBtn336')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup336"><code class="language-javascript text-sm text-gray-800">(
        mediaSource,
        {},
      );

      expect(results.entities).toBeDefined();
      expect(results.entities.length).toBeGreaterThan(0);

      const personEntity = results.entities.find((e) =&gt; e.type === 'PERSON');
      expect(personEntity).toBeDefined();
      expect(personEntity.boundingBoxes</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/advancedAnalytics.test.js (Line 12:22 - Line 27:23), server/src/tests/visualizationService.test.js (Line 11:22 - Line 26:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn339" onclick="toggleCodeBlock('cloneGroup339', 'expandBtn339', 'collapseBtn339')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn339" onclick="toggleCodeBlock('cloneGroup339', 'expandBtn339', 'collapseBtn339')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup339"><code class="language-javascript text-sm text-gray-800">;
  let mockLogger;
  let mockSession;

  beforeEach(() =&gt; {
    mockSession = {
      run: jest.fn(),
      close: jest.fn(),
    };

    mockNeo4jDriver = {
      session: jest.fn(() =&gt; mockSession),
    };

    mockMultimodalService = {
      createMultimodalEntity</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/providerRouter.js (Line 124:19 - Line 141:9), server/src/services/providerRouter.js (Line 96:13 - Line 113:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn352" onclick="toggleCodeBlock('cloneGroup352', 'expandBtn352', 'collapseBtn352')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn352" onclick="toggleCodeBlock('cloneGroup352', 'expandBtn352', 'collapseBtn352')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup352"><code class="language-javascript text-sm text-gray-800">}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(payload),
        },
      );
      const data = await response.json();
      return {
        ok: response.ok,
        text: data.choices?.[0]?.message?.content,
        usage: data.usage,
        model: data.model,
        error: data.error?.message,
      };
    },
  },
  {
    name: 'openai'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/providerRouter.js (Line 152:15 - Line 169:12), server/src/services/providerRouter.js (Line 96:13 - Line 113:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn353" onclick="toggleCodeBlock('cloneGroup353', 'expandBtn353', 'collapseBtn353')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn353" onclick="toggleCodeBlock('cloneGroup353', 'expandBtn353', 'collapseBtn353')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup353"><code class="language-javascript text-sm text-gray-800">}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(payload),
        },
      );
      const data = await response.json();
      return {
        ok: response.ok,
        text: data.choices?.[0]?.message?.content,
        usage: data.usage,
        model: data.model,
        error: data.error?.message,
      };
    },
  },
  {
    name: 'anthropic'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/WarRoomSyncService.js (Line 800:20 - Line 811:2), server/src/services/WarRoomSyncService.js (Line 695:17 - Line 704:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn355" onclick="toggleCodeBlock('cloneGroup355', 'expandBtn355', 'collapseBtn355')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn355" onclick="toggleCodeBlock('cloneGroup355', 'expandBtn355', 'collapseBtn355')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup355"><code class="language-javascript text-sm text-gray-800">(operation) {
    switch (operation.type) {
      case 'add_node':
      case 'update_node':
      case 'delete_node':
        return [operation.data.nodeId];
      case 'add_edge':
      case 'update_edge':
      case 'delete_edge':
        return [
          operation.data.source,
          operation.data.target,</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/STIXImportService.js (Line 95:9 - Line 114:18), server/src/services/STIXImportService.js (Line 52:6 - Line 71:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn360" onclick="toggleCodeBlock('cloneGroup360', 'expandBtn360', 'collapseBtn360')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn360" onclick="toggleCodeBlock('cloneGroup360', 'expandBtn360', 'collapseBtn360')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup360"><code class="language-javascript text-sm text-gray-800">,
      stats: {
        totalObjects: 0,
        processedObjects: 0,
        createdNodes: 0,
        updatedNodes: 0,
        createdRelationships: 0,
        errors: 0,
        skippedObjects: 0,
      },
      errors: [],
      createdAt: new Date().toISOString(),
      startedAt: null,
      finishedAt: null,
    };

    await this.saveJob(job);
    this.activeJobs.set(jobId, job);

    setImmediate(() =&gt; this.processStixBundle</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/STIXImportService.js (Line 189:8 - Line 200:15), server/src/services/STIXImportService.js (Line 145:4 - Line 156:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn361" onclick="toggleCodeBlock('cloneGroup361', 'expandBtn361', 'collapseBtn361')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn361" onclick="toggleCodeBlock('cloneGroup361', 'expandBtn361', 'collapseBtn361')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup361"><code class="language-javascript text-sm text-gray-800">);
      }

      job.status = 'completed';
      job.finishedAt = new Date().toISOString();
      await this.updateJob(job);
      await this.emitProgress(job);
    } catch (error) {
      job.status = 'failed';
      job.finishedAt = new Date().toISOString();
      job.errors.push({
        type: 'BUNDLE_ERROR'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/STIXImportService.js (Line 200:15 - Line 214:6), server/src/services/STIXImportService.js (Line 156:14 - Line 170:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn362" onclick="toggleCodeBlock('cloneGroup362', 'expandBtn362', 'collapseBtn362')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn362" onclick="toggleCodeBlock('cloneGroup362', 'expandBtn362', 'collapseBtn362')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup362"><code class="language-javascript text-sm text-gray-800">,
        message: error.message,
        timestamp: new Date().toISOString(),
      });
      await this.updateJob(job);
      await this.emitProgress(job);
    } finally {
      await session.close();
      this.activeJobs.delete(job.id);
    }
  }

  /**
   * Create TAXII client with authentication
   */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/STIXImportService.js (Line 705:2 - Line 721:2), server/src/services/STIXImportService.js (Line 674:2 - Line 690:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn363" onclick="toggleCodeBlock('cloneGroup363', 'expandBtn363', 'collapseBtn363')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn363" onclick="toggleCodeBlock('cloneGroup363', 'expandBtn363', 'collapseBtn363')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup363"><code class="language-javascript text-sm text-gray-800">{
      id: row.id,
      type: row.type,
      investigationId: row.investigation_id,
      userId: row.user_id,
      tenantId: row.tenant_id,
      status: row.status,
      taxiiUrl: row.taxii_url,
      collectionId: row.collection_id,
      bundlePath: row.bundle_path,
      cursor: row.cursor,
      stats: JSON.parse(row.stats || '{}'),
      errors: JSON.parse(row.errors || '[]'),
      createdAt: row.created_at,
      startedAt: row.started_at,
      finishedAt: row.finished_at,
    })</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/ReportService.js (Line 87:23 - Line 99:7), server/src/services/ReportService.js (Line 18:19 - Line 29:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn364" onclick="toggleCodeBlock('cloneGroup364', 'expandBtn364', 'collapseBtn364')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn364" onclick="toggleCodeBlock('cloneGroup364', 'expandBtn364', 'collapseBtn364')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup364"><code class="language-javascript text-sm text-gray-800">({
    investigationId,
    title,
    findings,
    evidence,
    metadata,
  }) {
    const now = new Date();
    const safeTitle = (
      title || `investigation-${investigationId || 'general'}`
    ).replace(/[^a-z0-9-_]+/gi, '-');
    const filename = `${safeTitle}-${now
      </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/LLMService.js (Line 235:8 - Line 251:2), server/src/services/LLMService.js (Line 193:2 - Line 209:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn366" onclick="toggleCodeBlock('cloneGroup366', 'expandBtn366', 'collapseBtn366')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn366" onclick="toggleCodeBlock('cloneGroup366', 'expandBtn366', 'collapseBtn366')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup366"><code class="language-javascript text-sm text-gray-800">;

    const response = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        Authorization: `Bearer ${this.config.apiKey}`,
        'Content-Type': 'application/json',
        ...(otelService.getCurrentTraceContext()
          ? { traceparent: otelService.getCurrentTraceContext() }
          : {}),
      },
      body: JSON.stringify({
        model: model,
        messages: messages,
        max_tokens: maxTokens,
        temperature: temperature,
      }</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/GeointService.js (Line 299:3 - Line 309:6), server/src/services/SentimentService.js (Line 285:3 - Line 295:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn367" onclick="toggleCodeBlock('cloneGroup367', 'expandBtn367', 'collapseBtn367')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn367" onclick="toggleCodeBlock('cloneGroup367', 'expandBtn367', 'collapseBtn367')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup367"><code class="language-javascript text-sm text-gray-800">calculateVariance(values) {
    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;
    const variance =
      values.reduce((acc, val) =&gt; acc + Math.pow(val - mean, 2), 0) /
      values.length;
    return variance;
  }

  /**
   * Geocode address to coordinates (placeholder for external service integration)
   */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/GNNService.js (Line 154:22 - Line 168:30), server/src/services/GNNService.js (Line 57:26 - Line 71:34)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn368" onclick="toggleCodeBlock('cloneGroup368', 'expandBtn368', 'collapseBtn368')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn368" onclick="toggleCodeBlock('cloneGroup368', 'expandBtn368', 'collapseBtn368')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup368"><code class="language-javascript text-sm text-gray-800">,
            {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                Authorization: `Bearer ${options.token || ''}`,
              },
              body: JSON.stringify(payload),
              timeout: this.defaultTimeout,
            },
          );

          if (!response.ok) {
            throw new Error(
              `GNN link prediction failed: </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/GNNService.js (Line 248:27 - Line 262:35), server/src/services/GNNService.js (Line 57:26 - Line 71:34)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn369" onclick="toggleCodeBlock('cloneGroup369', 'expandBtn369', 'collapseBtn369')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn369" onclick="toggleCodeBlock('cloneGroup369', 'expandBtn369', 'collapseBtn369')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup369"><code class="language-javascript text-sm text-gray-800">,
            {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                Authorization: `Bearer ${options.token || ''}`,
              },
              body: JSON.stringify(payload),
              timeout: this.defaultTimeout,
            },
          );

          if (!response.ok) {
            throw new Error(
              `GNN graph classification failed: </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/GNNService.js (Line 346:24 - Line 360:32), server/src/services/GNNService.js (Line 57:26 - Line 71:34)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn370" onclick="toggleCodeBlock('cloneGroup370', 'expandBtn370', 'collapseBtn370')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn370" onclick="toggleCodeBlock('cloneGroup370', 'expandBtn370', 'collapseBtn370')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup370"><code class="language-javascript text-sm text-gray-800">,
            {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                Authorization: `Bearer ${options.token || ''}`,
              },
              body: JSON.stringify(payload),
              timeout: this.defaultTimeout,
            },
          );

          if (!response.ok) {
            throw new Error(
              `GNN anomaly detection failed: </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/GNNService.js (Line 430:26 - Line 444:35), server/src/services/GNNService.js (Line 57:26 - Line 71:34)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn371" onclick="toggleCodeBlock('cloneGroup371', 'expandBtn371', 'collapseBtn371')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn371" onclick="toggleCodeBlock('cloneGroup371', 'expandBtn371', 'collapseBtn371')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup371"><code class="language-javascript text-sm text-gray-800">,
            {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                Authorization: `Bearer ${options.token || ''}`,
              },
              body: JSON.stringify(payload),
              timeout: this.defaultTimeout,
            },
          );

          if (!response.ok) {
            throw new Error(
              `GNN embedding generation failed: </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/GNNService.js (Line 584:9 - Line 599:26), server/src/services/GNNService.js (Line 532:6 - Line 547:28)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn372" onclick="toggleCodeBlock('cloneGroup372', 'expandBtn372', 'collapseBtn372')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn372" onclick="toggleCodeBlock('cloneGroup372', 'expandBtn372', 'collapseBtn372')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup372"><code class="language-javascript text-sm text-gray-800">,
          headers: {
            Authorization: `Bearer ${options.token || ''}`,
          },
          timeout: this.defaultTimeout,
        },
      );

      if (!response.ok) {
        if (response.status === 404) {
          return {
            success: false,
            error: 'Model not found',
          };
        }
        throw new Error(`Failed to delete model: </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/EmbeddingService.js (Line 164:8 - Line 176:5), server/src/services/LLMService.js (Line 209:6 - Line 221:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn373" onclick="toggleCodeBlock('cloneGroup373', 'expandBtn373', 'collapseBtn373')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn373" onclick="toggleCodeBlock('cloneGroup373', 'expandBtn373', 'collapseBtn373')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup373"><code class="language-javascript text-sm text-gray-800">,
      }),
      signal: AbortSignal.timeout(this.config.timeout),
    });

    if (!response.ok) {
      const errorData = await response.text();
      throw new Error(`OpenAI API error: ${response.status} - ${errorData}`);
    }

    const data = await response.json();

    if (!data.data</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/EmbeddingService.js (Line 204:6 - Line 214:26), server/src/services/EmbeddingService.js (Line 162:5 - Line 171:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn374" onclick="toggleCodeBlock('cloneGroup374', 'expandBtn374', 'collapseBtn374')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn374" onclick="toggleCodeBlock('cloneGroup374', 'expandBtn374', 'collapseBtn374')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup374"><code class="language-javascript text-sm text-gray-800">,
        model: model,
        encoding_format: 'float',
      }),
      signal: AbortSignal.timeout(this.config.timeout),
    });

    if (!response.ok) {
      const errorData = await response.text();
      throw new Error(
        `OpenAI Batch API error: </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/CSVImportService.js (Line 99:2 - Line 110:14), server/src/services/STIXImportService.js (Line 189:2 - Line 156:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn380" onclick="toggleCodeBlock('cloneGroup380', 'expandBtn380', 'collapseBtn380')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn380" onclick="toggleCodeBlock('cloneGroup380', 'expandBtn380', 'collapseBtn380')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup380"><code class="language-javascript text-sm text-gray-800">job, session);
      }

      job.status = 'completed';
      job.finishedAt = new Date().toISOString();
      await this.updateJob(job);
      await this.emitProgress(job);
    } catch (error) {
      job.status = 'failed';
      job.finishedAt = new Date().toISOString();
      job.errors.push({
        type: 'FATAL_ERROR'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/CSVImportService.js (Line 110:14 - Line 122:6), server/src/services/STIXImportService.js (Line 156:14 - Line 170:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn381" onclick="toggleCodeBlock('cloneGroup381', 'expandBtn381', 'collapseBtn381')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn381" onclick="toggleCodeBlock('cloneGroup381', 'expandBtn381', 'collapseBtn381')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup381"><code class="language-javascript text-sm text-gray-800">,
        message: error.message,
        timestamp: new Date().toISOString(),
      });
      await this.updateJob(job);
      await this.emitProgress(job);
    } finally {
      await session.close();
      this.activeJobs.delete(job.id);
    }
  }

  async</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/CSVImportService.js (Line 242:7 - Line 261:2), server/src/services/CSVImportService.js (Line 179:4 - Line 199:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn382" onclick="toggleCodeBlock('cloneGroup382', 'expandBtn382', 'collapseBtn382')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn382" onclick="toggleCodeBlock('cloneGroup382', 'expandBtn382', 'collapseBtn382')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup382"><code class="language-javascript text-sm text-gray-800">,
          job,
          rowIndex,
        );
        if (processedRow) {
          batch.push(processedRow);
        } else {
          job.stats.skippedRows++;
        }

        rowIndex++;
        job.stats.processedRows = rowIndex;

        if (batch.length &gt;= batchSize) {
          await this.processBatch(batch, job, session);
          batch = [];
          await this.updateJob(job);
          await this.emitProgress(job);
        }
      }</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/CSVImportService.js (Line 478:2 - Line 503:7), server/src/services/STIXImportService.js (Line 622:5 - Line 647:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn383" onclick="toggleCodeBlock('cloneGroup383', 'expandBtn383', 'collapseBtn383')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn383" onclick="toggleCodeBlock('cloneGroup383', 'expandBtn383', 'collapseBtn383')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup383"><code class="language-javascript text-sm text-gray-800">,
      JSON.stringify(job.stats),
      JSON.stringify(job.errors),
      job.createdAt,
      job.startedAt,
      job.finishedAt,
    ];

    await this.pg.query(query, values);
  }

  /**
   * Update job in database
   */
  async updateJob(job) {
    await this.saveJob(job);
  }

  /**
   * Emit progress via Socket.IO
   */
  async emitProgress(job) {
    if (this.io) {
      const progress = {
        jobId: job.id,
        status</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/CSVImportService.js (Line 510:7 - Line 525:6), server/src/services/STIXImportService.js (Line 655:7 - Line 668:47)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn384" onclick="toggleCodeBlock('cloneGroup384', 'expandBtn384', 'collapseBtn384')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn384" onclick="toggleCodeBlock('cloneGroup384', 'expandBtn384', 'collapseBtn384')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup384"><code class="language-javascript text-sm text-gray-800">};

      this.io.to(`import:job:${job.id}`).emit('import:progress', progress);
      this.io
        .to(`investigation:${job.investigationId}`)
        .emit('import:progress', progress);
    }
  }

  /**
   * Get job status
   */
  async getJob(jobId) {
    const query = `
      SELECT * FROM csv_import_jobs WHERE id = $1
    `</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/CSVImportService.js (Line 559:2 - Line 572:2), server/src/services/CSVImportService.js (Line 531:2 - Line 544:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn385" onclick="toggleCodeBlock('cloneGroup385', 'expandBtn385', 'collapseBtn385')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn385" onclick="toggleCodeBlock('cloneGroup385', 'expandBtn385', 'collapseBtn385')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup385"><code class="language-javascript text-sm text-gray-800">{
      id: row.id,
      investigationId: row.investigation_id,
      userId: row.user_id,
      tenantId: row.tenant_id,
      status: row.status,
      filePath: row.file_path,
      mapping: JSON.parse(row.mapping || '{}'),
      stats: JSON.parse(row.stats || '{}'),
      errors: JSON.parse(row.errors || '[]'),
      createdAt: row.created_at,
      startedAt: row.started_at,
      finishedAt: row.finished_at,
    })</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/CSVImportService.js (Line 566:2 - Line 577:6), server/src/services/STIXImportService.js (Line 715:7 - Line 726:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn386" onclick="toggleCodeBlock('cloneGroup386', 'expandBtn386', 'collapseBtn386')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn386" onclick="toggleCodeBlock('cloneGroup386', 'expandBtn386', 'collapseBtn386')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup386"><code class="language-javascript text-sm text-gray-800">,
      stats: JSON.parse(row.stats || '{}'),
      errors: JSON.parse(row.errors || '[]'),
      createdAt: row.created_at,
      startedAt: row.started_at,
      finishedAt: row.finished_at,
    }));
  }

  /**
   * Resume a failed or paused import job
   */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/tracingRoutes.js (Line 125:29 - Line 162:4), server/src/routes/tracingRoutes.js (Line 91:23 - Line 114:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn389" onclick="toggleCodeBlock('cloneGroup389', 'expandBtn389', 'collapseBtn389')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn389" onclick="toggleCodeBlock('cloneGroup389', 'expandBtn389', 'collapseBtn389')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup389"><code class="language-javascript text-sm text-gray-800">, {
      userId: req.user?.id,
      error: error.message,
    });

    res.status(500).json({
      error: error.message,
      timestamp: new Date().toISOString(),
    });
  }
});

/**
 * @swagger
 * /api/tracing/export:
 *   get:
 *     summary: Export traces in various formats
 *     tags: [Tracing]
 *     security:
 *       - BearerAuth: []
 *     parameters:
 *       - name: format
 *         in: query
 *         schema:
 *           type: string
 *           enum: [json, jaeger]
 *           default: json
 *       - name: limit
 *         in: query
 *         schema:
 *           type: integer
 *           minimum: 1
 *           maximum: 1000
 *           default: 100
 *     responses:
 *       200:
 *         description: Exported traces
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/tracingRoutes.js (Line 191:26 - Line 218:4), server/src/routes/tracingRoutes.js (Line 91:23 - Line 114:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn390" onclick="toggleCodeBlock('cloneGroup390', 'expandBtn390', 'collapseBtn390')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn390" onclick="toggleCodeBlock('cloneGroup390', 'expandBtn390', 'collapseBtn390')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup390"><code class="language-javascript text-sm text-gray-800">, {
      userId: req.user?.id,
      error: error.message,
    });

    res.status(500).json({
      error: error.message,
      timestamp: new Date().toISOString(),
    });
  }
});

/**
 * @swagger
 * /api/tracing/metrics:
 *   get:
 *     summary: Get tracing metrics in Prometheus format
 *     tags: [Tracing]
 *     security:
 *       - BearerAuth: []
 *     responses:
 *       200:
 *         description: Prometheus metrics
 *         content:
 *           text/plain:
 *             schema:
 *               type: string
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/tracingRoutes.js (Line 279:31 - Line 302:4), server/src/routes/tracingRoutes.js (Line 91:23 - Line 114:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn391" onclick="toggleCodeBlock('cloneGroup391', 'expandBtn391', 'collapseBtn391')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn391" onclick="toggleCodeBlock('cloneGroup391', 'expandBtn391', 'collapseBtn391')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup391"><code class="language-javascript text-sm text-gray-800">, {
      userId: req.user?.id,
      error: error.message,
    });

    res.status(500).json({
      error: error.message,
      timestamp: new Date().toISOString(),
    });
  }
});

/**
 * @swagger
 * /api/tracing/cleanup:
 *   post:
 *     summary: Trigger manual cleanup of stale spans
 *     tags: [Tracing]
 *     security:
 *       - BearerAuth: []
 *     responses:
 *       200:
 *         description: Cleanup completed
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/resilience.js (Line 206:31 - Line 218:10), server/src/routes/resilience.js (Line 171:32 - Line 183:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn395" onclick="toggleCodeBlock('cloneGroup395', 'expandBtn395', 'collapseBtn395')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn395" onclick="toggleCodeBlock('cloneGroup395', 'expandBtn395', 'collapseBtn395')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup395"><code class="language-javascript text-sm text-gray-800">, (req, res) =&gt; {
  try {
    const { name } = req.params;
    const circuitBreaker = resilienceManager.circuitBreakers.get(name);

    if (!circuitBreaker) {
      return res.status(404).json({
        error: 'Circuit breaker not found',
        name,
      });
    }

    circuitBreaker.forceOpen</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/import.js (Line 398:18 - Line 412:4), server/src/routes/import.js (Line 265:17 - Line 279:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn402" onclick="toggleCodeBlock('cloneGroup402', 'expandBtn402', 'collapseBtn402')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn402" onclick="toggleCodeBlock('cloneGroup402', 'expandBtn402', 'collapseBtn402')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup402"><code class="language-javascript text-sm text-gray-800">.getJob(req.params.jobId);

    if (!job) {
      return res.status(404).json({ error: 'Job not found' });
    }

    res.json(job);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

/**
 * Resume STIX TAXII import
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/graphragRoutes.js (Line 16:2 - Line 39:56), server/src/graphql/resolvers/graphragResolvers.js (Line 11:27 - Line 34:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn403" onclick="toggleCodeBlock('cloneGroup403', 'expandBtn403', 'collapseBtn403')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn403" onclick="toggleCodeBlock('cloneGroup403', 'expandBtn403', 'collapseBtn403')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup403"><code class="language-javascript text-sm text-gray-800">);

// Initialize services
let graphRAGService;
let embeddingService;
let llmService;

function initializeServices() {
  if (!graphRAGService) {
    const neo4jDriver = getNeo4jDriver();
    const redisClient = getRedisClient();

    embeddingService = new EmbeddingService();
    llmService = new LLMService();
    graphRAGService = new GraphRAGService(
      neo4jDriver,
      embeddingService,
      llmService,
      redisClient,
    );
  }
}

// Apply authentication and rate limiting to all routes</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/graphragRoutes.js (Line 213:2 - Line 224:4), server/src/graphql/resolvers/graphragResolvers.js (Line 237:2 - Line 248:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn404" onclick="toggleCodeBlock('cloneGroup404', 'expandBtn404', 'collapseBtn404')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn404" onclick="toggleCodeBlock('cloneGroup404', 'expandBtn404', 'collapseBtn404')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup404"><code class="language-javascript text-sm text-gray-800">;
        }

        const entities = entitiesResult.records.map((record) =&gt; ({
          id: record.get('id'),
          text: `${record.get('label')} ${record.get('description')} ${JSON.stringify(record.get('properties'))}`,
        }));

        // Generate embeddings
        const embeddings = await embeddingService.generateEmbeddings(
          entities.map((e) =&gt; e.text),
          req</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/federationRoutes.js (Line 84:4 - Line 105:2), server/src/routes/federationRoutes.js (Line 43:9 - Line 64:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn406" onclick="toggleCodeBlock('cloneGroup406', 'expandBtn406', 'collapseBtn406')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn406" onclick="toggleCodeBlock('cloneGroup406', 'expandBtn406', 'collapseBtn406')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup406"><code class="language-javascript text-sm text-gray-800">,
  },
  capabilities: {
    type: 'array',
    items: {
      type: 'string',
      enum: [
        'geo_search',
        'temporal_analysis',
        'sentiment_analysis',
        'graph_analytics',
        'multimodal_search',
        'nlp_processing',
        'threat_intelligence',
        'social_analysis',
      ],
    },
  },
  accessLevel: {
    type: 'string',
    enum: ['public', 'restricted', 'private'],
  }</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/export.js (Line 165:4 - Line 175:7), server/src/routes/export.js (Line 107:2 - Line 117:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn407" onclick="toggleCodeBlock('cloneGroup407', 'expandBtn407', 'collapseBtn407')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn407" onclick="toggleCodeBlock('cloneGroup407', 'expandBtn407', 'collapseBtn407')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup407"><code class="language-javascript text-sm text-gray-800">.get('b');
        const originalEdge = {
          id: r.properties?.id || r.identity?.toString?.() || undefined,
          uuid: r.properties?.uuid,
          type: r.type || r.properties?.type,
          label: r.properties?.label,
          source: a.properties?.uuid,
          target: b.properties?.uuid,
          properties: r.properties || {},
        };
        return</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/connectorRoutes.js (Line 48:2 - Line 61:8), server/src/routes/connectorRoutes.js (Line 27:2 - Line 40:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn415" onclick="toggleCodeBlock('cloneGroup415', 'expandBtn415', 'collapseBtn415')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn415" onclick="toggleCodeBlock('cloneGroup415', 'expandBtn415', 'collapseBtn415')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup415"><code class="language-javascript text-sm text-gray-800">},
  auth: {
    type: 'object',
    properties: {
      type: { type: 'string', enum: ['bearer', 'basic', 'apikey', 'oauth2'] },
      token: { type: 'string' },
      username: { type: 'string' },
      password: { type: 'string' },
      key: { type: 'string' },
      header: { type: 'string' },
      accessToken: { type: 'string' },
    },
  },
  headers</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/connectorRoutes.js (Line 69:2 - Line 82:2), server/src/routes/connectorRoutes.js (Line 27:2 - Line 40:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn416" onclick="toggleCodeBlock('cloneGroup416', 'expandBtn416', 'collapseBtn416')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn416" onclick="toggleCodeBlock('cloneGroup416', 'expandBtn416', 'collapseBtn416')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup416"><code class="language-javascript text-sm text-gray-800">},
  auth: {
    type: 'object',
    properties: {
      type: { type: 'string', enum: ['bearer', 'basic', 'apikey', 'oauth2'] },
      token: { type: 'string' },
      username: { type: 'string' },
      password: { type: 'string' },
      key: { type: 'string' },
      header: { type: 'string' },
      accessToken: { type: 'string' },
    },
  },
}</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/activity.js (Line 79:44 - Line 93:7), server/src/routes/activity.js (Line 38:50 - Line 52:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn438" onclick="toggleCodeBlock('cloneGroup438', 'expandBtn438', 'collapseBtn438')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn438" onclick="toggleCodeBlock('cloneGroup438', 'expandBtn438', 'collapseBtn438')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup438"><code class="language-javascript text-sm text-gray-800">${whereSql}`;
    const listRes = await pool.query(listSql, [...params, limit, offset]);
    const countRes = await pool.query(countSql, params);
    res.json({
      items: listRes.rows,
      total: countRes.rows[0].c,
      page,
      pageSize: limit,
    });
  } catch (e) {
    res.status(500).json({ error: e.message });
  }
});

module</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/monitoring/tracing.js (Line 223:2 - Line 237:6), server/src/monitoring/tracing.js (Line 204:2 - Line 218:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn455" onclick="toggleCodeBlock('cloneGroup455', 'expandBtn455', 'collapseBtn455')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn455" onclick="toggleCodeBlock('cloneGroup455', 'expandBtn455', 'collapseBtn455')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup455"><code class="language-javascript text-sm text-gray-800">fn(span);
      span.setStatus({ code: 1 }); // OK
      return result;
    } catch (error) {
      span.recordException(error);
      span.setStatus({ code: 2, message: error.message }); // ERROR
      throw error;
    } finally {
      span.end();
    }
  }

  /**
   * Express middleware for request tracing
   */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/monitoring/telemetry.js (Line 226:2 - Line 244:6), server/src/monitoring/telemetry.js (Line 201:7 - Line 219:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn456" onclick="toggleCodeBlock('cloneGroup456', 'expandBtn456', 'collapseBtn456')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn456" onclick="toggleCodeBlock('cloneGroup456', 'expandBtn456', 'collapseBtn456')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup456"><code class="language-javascript text-sm text-gray-800">);

      span.setStatus({ code: SpanStatusCode.OK });
      return result;
    } catch (error) {
      span.recordException(error);
      span.setStatus({
        code: SpanStatusCode.ERROR,
        message: error.message,
      });
      throw error;
    } finally {
      span.end();
    }
  }

  /**
   * Express middleware for tracing HTTP requests
   */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/monitoring/telemetry.js (Line 298:12 - Line 312:2), server/src/monitoring/tracing.js (Line 288:8 - Line 304:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn457" onclick="toggleCodeBlock('cloneGroup457', 'expandBtn457', 'collapseBtn457')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn457" onclick="toggleCodeBlock('cloneGroup457', 'expandBtn457', 'collapseBtn457')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup457"><code class="language-javascript text-sm text-gray-800">) {
          return originalResolver(parent, args, context, info);
        }

        const operationType = info.operation.operation;
        const fieldName = info.fieldName;
        const spanName = `GraphQL ${operationType}: ${fieldName}`;

        return this.traceAsync(spanName, async (span) =&gt; {
          span.setAttributes({
            'graphql.operation.type': operationType,
            'graphql.field.name': fieldName,
            'graphql.operation.name': info.operation.name?.value,
            'user.id': context.user?.id,
          }</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/monitoring/telemetry.js (Line 408:4 - Line 421:20), server/src/monitoring/telemetry.js (Line 392:5 - Line 405:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn458" onclick="toggleCodeBlock('cloneGroup458', 'expandBtn458', 'collapseBtn458')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn458" onclick="toggleCodeBlock('cloneGroup458', 'expandBtn458', 'collapseBtn458')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup458"><code class="language-javascript text-sm text-gray-800">) {
    if (!this.initialized) {
      return {
        record: () =&gt; {},
        bind: () =&gt; ({ record: () =&gt; {} }),
      };
    }

    const { metrics } = require('@opentelemetry/api');
    const meter = metrics.getMeter(
      this.config.serviceName,
      this.config.serviceVersion,
    );
    return meter.createUpDownCounter</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/monitoring/health.js (Line 58:2 - Line 68:6), server/src/monitoring/neo4jMetrics.js (Line 8:5 - Line 17:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn461" onclick="toggleCodeBlock('cloneGroup461', 'expandBtn461', 'collapseBtn461')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn461" onclick="toggleCodeBlock('cloneGroup461', 'expandBtn461', 'collapseBtn461')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup461"><code class="language-javascript text-sm text-gray-800">driver = neo4j.driver(
      process.env.NEO4J_URI || 'bolt://localhost:7687',
      neo4j.auth.basic(
        process.env.NEO4J_USER || 'neo4j',
        process.env.NEO4J_PASSWORD || 'password',
      ),
      { connectionTimeout: 5000 },
    );

    session = driver.session();
    await</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/middleware/correlationId.js (Line 107:2 - Line 122:13), server/src/middleware/correlationId.js (Line 87:2 - Line 102:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn468" onclick="toggleCodeBlock('cloneGroup468', 'expandBtn468', 'collapseBtn468')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn468" onclick="toggleCodeBlock('cloneGroup468', 'expandBtn468', 'collapseBtn468')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup468"><code class="language-javascript text-sm text-gray-800">= function (data) {
          const statusCode = res.statusCode;
          const isError = statusCode &gt;= 400;

          logger[isError ? 'error' : 'info']('Request completed', {
            correlationId,
            traceId,
            spanId,
            method: req.method,
            url: req.url,
            statusCode,
            responseTime: Date.now() - new Date(context.timestamp).getTime(),
            userId,
          });

          return originalSend</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers.graphops.js (Line 293:10 - Line 305:10), server/src/graphql/resolvers.graphops.js (Line 249:10 - Line 261:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn471" onclick="toggleCodeBlock('cloneGroup471', 'expandBtn471', 'collapseBtn471')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn471" onclick="toggleCodeBlock('cloneGroup471', 'expandBtn471', 'collapseBtn471')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup471"><code class="language-javascript text-sm text-gray-800">: async (_, args, { user, logger }) =&gt; {
      const tId = traceId();
      const { value, error } = tagSchema.validate(args);
      if (error) {
        const err = new Error(`Invalid input: ${error.message}`);
        err.code = 'BAD_USER_INPUT';
        err.traceId = tId;
        throw err;
      }
      ensureRole(user, ['ANALYST', 'ADMIN']);

      try {
        const entity = await TagService.deleteTag</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers.graphops.js (Line 308:2 - Line 326:18), server/src/graphql/resolvers.graphops.js (Line 266:9 - Line 284:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn472" onclick="toggleCodeBlock('cloneGroup472', 'expandBtn472', 'collapseBtn472')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn472" onclick="toggleCodeBlock('cloneGroup472', 'expandBtn472', 'collapseBtn472')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup472"><code class="language-javascript text-sm text-gray-800">);

        // Cache bust for relevant expand keys for this entity across roles
        const redis = getRedisClient();
        const roles = ['VIEWER', 'ANALYST', 'ADMIN'];
        await Promise.all(
          roles
            .map((r) =&gt; redis.keys(`expand:${value.entityId}:*:${r}`))
            .map(async (p) =&gt; {
              const keys = await p;
              if (keys &amp;&amp; keys.length) {
                await redis.del(keys);
              } /* Intentionally empty */
            }),
        );

        return entity;
      } catch (e) {
        logger.error('deleteTag error'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers.annotations.js (Line 8:1 - Line 19:6), server/src/graphql/resolvers.graphops.js (Line 43:1 - Line 54:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn475" onclick="toggleCodeBlock('cloneGroup475', 'expandBtn475', 'collapseBtn475')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn475" onclick="toggleCodeBlock('cloneGroup475', 'expandBtn475', 'collapseBtn475')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup475"><code class="language-javascript text-sm text-gray-800">function ensureRole(user, allowedRoles = []) {
  if (!user) throw new Error('Not authenticated');
  if (allowedRoles.length === 0) return true;
  const role = (user.role || '').toUpperCase();
  if (!allowedRoles.map((r) =&gt; r.toUpperCase()).includes(role)) {
    const err = new Error('Forbidden');
    err.code = 'FORBIDDEN';
    throw err;
  }
}

const</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers.annotations.js (Line 73:7 - Line 94:38), server/src/graphql/resolvers.annotations.js (Line 31:9 - Line 52:40)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn476" onclick="toggleCodeBlock('cloneGroup476', 'expandBtn476', 'collapseBtn476')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn476" onclick="toggleCodeBlock('cloneGroup476', 'expandBtn476', 'collapseBtn476')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup476"><code class="language-javascript text-sm text-gray-800">: parent.id });
        const annotations = result.records.map((record) =&gt;
          record.get('annotation'),
        );

        // Filter annotations based on OPA policy
        const filteredAnnotations = [];
        for (const annotation of annotations) {
          const isAllowed = await evaluateOPA(
            'read',
            user,
            { enclave: annotation.enclave },
            {},
          );
          if (isAllowed) {
            filteredAnnotations.push(annotation);
          }
        }
        return filteredAnnotations;
      } catch (e) {
        logger.error(
          `Error fetching annotations for edge </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers.annotations.js (Line 187:7 - Line 207:67), server/src/graphql/resolvers.annotations.js (Line 111:7 - Line 131:45)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn477" onclick="toggleCodeBlock('cloneGroup477', 'expandBtn477', 'collapseBtn477')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn477" onclick="toggleCodeBlock('cloneGroup477', 'expandBtn477', 'collapseBtn477')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup477"><code class="language-javascript text-sm text-gray-800">// OPA check for create permission
      const isAllowed = await evaluateOPA(
        'create',
        user,
        { enclave: input.enclave },
        {},
      );
      if (!isAllowed) {
        throw new Error(
          'Forbidden: Not allowed to create annotation with this enclave',
        );
      }

      const neo = getNeo4jDriver();
      const pg = getPostgresPool();
      const session = neo.session();
      try {
        const annotationId = uuid();
        const now = new Date().toISOString();

        // Create Annotation node and link to Edge (Relationship in Neo4j)</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers.annotations.js (Line 350:2 - Line 369:35), server/src/graphql/resolvers.annotations.js (Line 260:2 - Line 279:46)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn478" onclick="toggleCodeBlock('cloneGroup478', 'expandBtn478', 'collapseBtn478')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn478" onclick="toggleCodeBlock('cloneGroup478', 'expandBtn478', 'collapseBtn478')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup478"><code class="language-javascript text-sm text-gray-800">}, { user, logger }) =&gt; {
      ensureRole(user, ['ANALYST', 'ADMIN']);

      const neo = getNeo4jDriver();
      const pg = getPostgresPool();
      const session = neo.session();
      try {
        // First, fetch the existing annotation to get its current enclave
        const fetchCypher = `
          MATCH (a:Annotation {id: $id})
          RETURN a.enclave AS currentEnclave, a.createdBy AS createdBy
        `;
        const fetchResult = await session.run(fetchCypher, { id });
        if (!fetchResult.records.length) {
          throw new Error('Annotation not found');
        }
        const currentEnclave = fetchResult.records[0].get('currentEnclave');
        const createdBy = fetchResult.records[0].get('createdBy');

        // OPA check for delete permission</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers.ai.js (Line 237:9 - Line 250:6), server/src/graphql/resolvers.ai.js (Line 190:9 - Line 205:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn479" onclick="toggleCodeBlock('cloneGroup479', 'expandBtn479', 'collapseBtn479')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn479" onclick="toggleCodeBlock('cloneGroup479', 'expandBtn479', 'collapseBtn479')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup479"><code class="language-javascript text-sm text-gray-800">const clauses = [];
        const params = { q, limit: Math.max(1, Math.min(100, limit)) };
        if (filters.type) {
          clauses.push('node.type = $type');
          params.type = filters.type;
        }
        if (filters.investigationId) {
          clauses.push(
            'exists( (node)-[:BELONGS_TO]-&gt;(:Investigation {id: $investigationId}) )',
          );
          params.investigationId = filters.investigationId;
        }
        const where = clauses.length ? `WHERE ${clauses.join(' AND ')}` : '';
        const ftRes</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/controllers/WarRoomController.js (Line 460:7 - Line 474:4), server/src/controllers/WarRoomController.js (Line 405:7 - Line 419:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn500" onclick="toggleCodeBlock('cloneGroup500', 'expandBtn500', 'collapseBtn500')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn500" onclick="toggleCodeBlock('cloneGroup500', 'expandBtn500', 'collapseBtn500')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup500"><code class="language-javascript text-sm text-gray-800">const hasAccess = await this.auth.canAccessWarRoom(userId, id);
      if (!hasAccess) {
        return res.status(403).json({
          error: 'Access denied to this war room',
        });
      }

      const room = this.warRoomSync.warRooms.get(id);
      if (!room) {
        return res.status(404).json({
          error: 'War room not found or not active',
        });
      }

      res</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="tsx-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">tsx</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">client/src/components/timeline/__tests__/TemporalAnalysis.test.tsx (Line 13:2 - Line 25:57), client/src/components/visualization/__tests__/InteractiveGraphCanvas.test.tsx (Line 39:2 - Line 50:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup5"><code class="language-tsx text-sm text-gray-800">;

// Mock ResizeObserver
global.ResizeObserver = jest.fn().mockImplementation(() =&gt; ({
  observe: jest.fn(),
  unobserve: jest.fn(),
  disconnect: jest.fn(),
}));

// Mock requestAnimationFrame
global.requestAnimationFrame = jest.fn((cb) =&gt; setTimeout(cb, 16));

// Minimal mock events to satisfy component requirements</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/__tests__/EnhancedAnalyticsDashboard.test.tsx (Line 34:5 - Line 53:51), client/src/components/graph-advanced/__tests__/AdvancedGraphInteractions.test.tsx (Line 60:2 - Line 79:53)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup7"><code class="language-tsx text-sm text-gray-800">});
  });

  afterEach(() =&gt; {
    // Only run pending timers if we're using fake timers
    try {
      act(() =&gt; {
        jest.runOnlyPendingTimers();
      });
    } catch (e) {
      // Ignore errors if fake timers aren't active
    }
    jest.useRealTimers();
    jest.clearAllMocks();
    if (consoleSpy) {
      consoleSpy.mockRestore();
    }
  });

  it('renders dashboard header with title and controls'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai-enhanced/__tests__/EnhancedAIAssistant.test.tsx (Line 115:5 - Line 129:42), client/src/components/ai-enhanced/__tests__/EnhancedAIAssistant.test.tsx (Line 81:5 - Line 95:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup8"><code class="language-tsx text-sm text-gray-800">const clock = makeFakeClock();

    renderWithTheme(
      &lt;EnhancedAIAssistant
        {...defaultProps}
        transport={transport}
        clock={clock}
        typingDelayMs={0}
        debounceMs={0}
      /&gt;,
    );

    const input = screen.getByRole('textbox', { name: /assistant-input/i });
    await withUser(async (u) =&gt; {
      await u.type(input, 'Find all connections to John Doe{enter}'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai-enhanced/__tests__/EnhancedAIAssistant.test.tsx (Line 415:7 - Line 430:29), client/src/components/ai-enhanced/__tests__/EnhancedAIAssistant.test.tsx (Line 80:7 - Line 95:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup9"><code class="language-tsx text-sm text-gray-800">);
    const clock = makeFakeClock();

    renderWithTheme(
      &lt;EnhancedAIAssistant
        {...defaultProps}
        transport={transport}
        clock={clock}
        typingDelayMs={1}
        debounceMs={1}
      /&gt;,
    );

    const input = screen.getByRole('textbox', { name: /assistant-input/i });
    await withUser(async (u) =&gt; {
      await u.type(input, 'Test RAG strictness{enter}'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/Map/layers/GeoJSONLayer.tsx (Line 103:9 - Line 115:2), client/src/components/Map/layers/GeoJSONLayer.tsx (Line 58:9 - Line 71:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn10" onclick="toggleCodeBlock('cloneGroup10', 'expandBtn10', 'collapseBtn10')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn10" onclick="toggleCodeBlock('cloneGroup10', 'expandBtn10', 'collapseBtn10')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup10"><code class="language-tsx text-sm text-gray-800">if (feature.properties) {
          const popupContent = Object.entries(feature.properties)
            .map(([key, value]) =&gt; `&lt;strong&gt;${key}:&lt;/strong&gt; ${value}`)
            .join('&lt;br&gt;');
          layer.bindPopup(popupContent);
        }
      },
      pointToLayer,
      filter,
    }).addTo(map);

    layerRef.current = geoJsonLayer;
  }</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/pages/Hunting/HuntList.tsx (Line 408:3 - Line 419:8), client/src/pages/IOC/IOCList.tsx (Line 493:9 - Line 504:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn29" onclick="toggleCodeBlock('cloneGroup29', 'expandBtn29', 'collapseBtn29')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn29" onclick="toggleCodeBlock('cloneGroup29', 'expandBtn29', 'collapseBtn29')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup29"><code class="language-tsx text-sm text-gray-800">&lt;/MenuItem&gt;
                &lt;/Select&gt;
              &lt;/FormControl&gt;
              &lt;FormControl size=&quot;small&quot; sx={{ minWidth: 120 }}&gt;
                &lt;InputLabel&gt;Status&lt;/InputLabel&gt;
                &lt;Select
                  value={filterStatus}
                  label=&quot;Status&quot;
                  onChange={(e) =&gt; setFilterStatus(e.target.value)}
                &gt;
                  &lt;MenuItem value=&quot;ALL&quot;&gt;All Status&lt;/MenuItem&gt;
                  &lt;MenuItem value=&quot;RUNNING</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/conductor/RetractionQueue.tsx (Line 23:2 - Line 45:12), client/src/features/conductor/SLOBoard.tsx (Line 17:2 - Line 39:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn34" onclick="toggleCodeBlock('cloneGroup34', 'expandBtn34', 'collapseBtn34')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn34" onclick="toggleCodeBlock('cloneGroup34', 'expandBtn34', 'collapseBtn34')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup34"><code class="language-tsx text-sm text-gray-800">);
    } catch (err: any) {
      if (err.name !== 'AbortError') {
        console.error('Fetch error:', err);
      }
    }
  }
  useEffect(() =&gt; {
    const controller = new AbortController();
    load(controller);
    const t = setInterval(() =&gt; {
      if (!controller.signal.aborted) {
        load(controller);
      }
    }, 5000);
    return () =&gt; {
      controller.abort();
      clearInterval(t);
    };
  }, []);
  return (
    &lt;div className=&quot;p-4 rounded-2xl shadow&quot;&gt;
      &lt;h3 className=&quot;text-lg font-semibold&quot;&gt;Retractions</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/conductor/ConductorStudio.tsx (Line 113:9 - Line 129:10), client/src/features/wargame/ExecutiveDashboard.tsx (Line 56:15 - Line 72:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn35" onclick="toggleCodeBlock('cloneGroup35', 'expandBtn35', 'collapseBtn35')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn35" onclick="toggleCodeBlock('cloneGroup35', 'expandBtn35', 'collapseBtn35')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup35"><code class="language-tsx text-sm text-gray-800">(props: TabPanelProps) {
  const { children, value, index, ...other } = props;

  return (
    &lt;div
      role=&quot;tabpanel&quot;
      hidden={value !== index}
      id={`conductor-tabpanel-${index}`}
      aria-labelledby={`conductor-tab-${index}`}
      {...other}
    &gt;
      {value === index &amp;&amp; &lt;Box sx={{ p: 3 }}&gt;{children}&lt;/Box&gt;}
    &lt;/div&gt;
  );
}

interface</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/admin/AdminStudio.tsx (Line 485:2 - Line 498:11), client/src/features/admin/AdminStudio.tsx (Line 471:2 - Line 485:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn44" onclick="toggleCodeBlock('cloneGroup44', 'expandBtn44', 'collapseBtn44')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn44" onclick="toggleCodeBlock('cloneGroup44', 'expandBtn44', 'collapseBtn44')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup44"><code class="language-tsx text-sm text-gray-800">(0.0-1.0)&lt;/span&gt;
                    &lt;input
                      type=&quot;number&quot;
                      step=&quot;0.1&quot;
                      min=&quot;0&quot;
                      max=&quot;1&quot;
                      value={cfg.TOP_P ?? 1.0}
                      onChange={(e) =&gt;
                        setCfg({ ...cfg, TOP_P: Number(e.target.value) })
                      }
                    /&gt;
                  &lt;/label&gt;
                  &lt;label style={{ display: 'flex', flexDirection: 'column' }}&gt;
                    &lt;span style={{ fontWeight: 600 }}&gt;MAX_TOKENS</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/timeline/TemporalAnalysis.tsx (Line 193:9 - Line 204:2), client/src/components/timeline/TemporalAnalysis.tsx (Line 173:2 - Line 184:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn46" onclick="toggleCodeBlock('cloneGroup46', 'expandBtn46', 'collapseBtn46')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn46" onclick="toggleCodeBlock('cloneGroup46', 'expandBtn46', 'collapseBtn46')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup46"><code class="language-tsx text-sm text-gray-800">currentCluster.length &gt;= minEventsForCluster
      ) {
        clusters.push({
          id: `cluster-${clusters.length}`,
          startTime: clusterStart,
          endTime: currentCluster[currentCluster.length - 1].timestamp,
          events: [...currentCluster],
          intensity: currentCluster.length,
          anomaly: currentCluster.some((e) =&gt; e.severity === 'critical'),
        });
      }
    }</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/psyops/PsyOpsDashboard.tsx (Line 147:1 - Line 168:6), client/src/features/conductor/ConductorStudio.tsx (Line 107:1 - Line 72:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn57" onclick="toggleCodeBlock('cloneGroup57', 'expandBtn57', 'collapseBtn57')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn57" onclick="toggleCodeBlock('cloneGroup57', 'expandBtn57', 'collapseBtn57')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup57"><code class="language-tsx text-sm text-gray-800">interface TabPanelProps {
  children?: React.ReactNode;
  index: number;
  value: number;
}

function TabPanel(props: TabPanelProps) {
  const { children, value, index, ...other } = props;
  return (
    &lt;div
      role=&quot;tabpanel&quot;
      hidden={value !== index}
      id={`psyops-tabpanel-${index}`}
      aria-labelledby={`psyops-tab-${index}`}
      {...other}
    &gt;
      {value === index &amp;&amp; &lt;Box sx={{ p: 3 }}&gt;{children}&lt;/Box&gt;}
    &lt;/div&gt;
  );
}

const</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/psyops/PsyOpsDashboard.tsx (Line 298:11 - Line 320:11), client/src/components/psyops/PsyOpsDashboard.tsx (Line 270:9 - Line 292:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn58" onclick="toggleCodeBlock('cloneGroup58', 'expandBtn58', 'collapseBtn58')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn58" onclick="toggleCodeBlock('cloneGroup58', 'expandBtn58', 'collapseBtn58')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup58"><code class="language-tsx text-sm text-gray-800">&lt;/Typography&gt;
              &lt;LinearProgress
                variant=&quot;determinate&quot;
                value={85}
                sx={{ mt: 1, backgroundColor: 'rgba(255,255,255,0.3)' }}
              /&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={4}&gt;
          &lt;Card
            sx={{
              height: '100%',
              background: 'linear-gradient(135deg, #9c27b0 0%, #ba68c8 100%)',
              color: 'white',
            }}
          &gt;
            &lt;CardContent&gt;
              &lt;Box
                sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 2 }}
              &gt;
                &lt;Psychology</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/psyops/PsyOpsDashboard.tsx (Line 521:2 - Line 533:9), client/src/components/psyops/PsyOpsDashboard.tsx (Line 414:23 - Line 426:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn59" onclick="toggleCodeBlock('cloneGroup59', 'expandBtn59', 'collapseBtn59')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn59" onclick="toggleCodeBlock('cloneGroup59', 'expandBtn59', 'collapseBtn59')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup59"><code class="language-tsx text-sm text-gray-800">/&gt;
                      &lt;Chip label=&quot;Active&quot; color=&quot;success&quot; size=&quot;small&quot; /&gt;
                    &lt;/ListItem&gt;
                  &lt;/List&gt;
                &lt;/CardContent&gt;
              &lt;/Card&gt;
            &lt;/Grid&gt;

            &lt;Grid item xs={12}&gt;
              &lt;Card&gt;
                &lt;CardContent&gt;
                  &lt;Typography variant=&quot;h6&quot; gutterBottom&gt;
                    Detected</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/psyops/PsyOpsDashboard.tsx (Line 569:8 - Line 580:6), client/src/components/psyops/PsyOpsDashboard.tsx (Line 551:6 - Line 562:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn60" onclick="toggleCodeBlock('cloneGroup60', 'expandBtn60', 'collapseBtn60')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn60" onclick="toggleCodeBlock('cloneGroup60', 'expandBtn60', 'collapseBtn60')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup60"><code class="language-tsx text-sm text-gray-800">&quot;
                            size=&quot;small&quot;
                            sx={{ mt: 1 }}
                          /&gt;
                        &lt;/CardContent&gt;
                      &lt;/Card&gt;
                    &lt;/Grid&gt;
                    &lt;Grid item xs={12} md={4}&gt;
                      &lt;Card variant=&quot;outlined&quot;&gt;
                        &lt;CardContent&gt;
                          &lt;Typography variant=&quot;subtitle1&quot;&gt;
                            Campaign Gamma</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/psyops/PsyOpsDashboard.tsx (Line 646:10 - Line 657:12), client/src/components/psyops/PsyOpsDashboard.tsx (Line 415:7 - Line 426:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn61" onclick="toggleCodeBlock('cloneGroup61', 'expandBtn61', 'collapseBtn61')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn61" onclick="toggleCodeBlock('cloneGroup61', 'expandBtn61', 'collapseBtn61')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup61"><code class="language-tsx text-sm text-gray-800">&quot; color=&quot;success&quot; size=&quot;small&quot; /&gt;
                    &lt;/ListItem&gt;
                  &lt;/List&gt;
                &lt;/CardContent&gt;
              &lt;/Card&gt;
            &lt;/Grid&gt;

            &lt;Grid item xs={12}&gt;
              &lt;Card&gt;
                &lt;CardContent&gt;
                  &lt;Typography variant=&quot;h6&quot; gutterBottom&gt;
                    Recent Simulations</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/MTTTTrendWidget.tsx (Line 329:9 - Line 345:7), client/src/components/dashboard/MTTTTrendWidget.tsx (Line 285:10 - Line 301:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn83" onclick="toggleCodeBlock('cloneGroup83', 'expandBtn83', 'collapseBtn83')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn83" onclick="toggleCodeBlock('cloneGroup83', 'expandBtn83', 'collapseBtn83')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup83"><code class="language-tsx text-sm text-gray-800"> data={timeSeriesData}&gt;
              &lt;CartesianGrid strokeDasharray=&quot;3 3&quot; /&gt;
              &lt;XAxis
                dataKey=&quot;timestamp&quot;
                fontSize={12}
                tick={{ fill: '#666' }}
              /&gt;
              &lt;YAxis
                fontSize={12}
                tick={{ fill: '#666' }}
                tickFormatter={(value: number) =&gt; formatTime(value)}
              /&gt;
              &lt;ReferenceLine
                y={targetMTTT}
                stroke=&quot;#f44336&quot;
                strokeDasharray=&quot;5 5&quot;
                label=&quot;Target</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/MTTTTrendWidget.tsx (Line 357:10 - Line 375:5), client/src/components/dashboard/MTTTTrendWidget.tsx (Line 285:10 - Line 303:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn84" onclick="toggleCodeBlock('cloneGroup84', 'expandBtn84', 'collapseBtn84')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn84" onclick="toggleCodeBlock('cloneGroup84', 'expandBtn84', 'collapseBtn84')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup84"><code class="language-tsx text-sm text-gray-800"> data={timeSeriesData}&gt;
              &lt;CartesianGrid strokeDasharray=&quot;3 3&quot; /&gt;
              &lt;XAxis
                dataKey=&quot;timestamp&quot;
                fontSize={12}
                tick={{ fill: '#666' }}
              /&gt;
              &lt;YAxis
                fontSize={12}
                tick={{ fill: '#666' }}
                tickFormatter={(value: number) =&gt; formatTime(value)}
              /&gt;
              &lt;ReferenceLine
                y={targetMTTT}
                stroke=&quot;#f44336&quot;
                strokeDasharray=&quot;5 5&quot;
                label=&quot;Target MTTT&quot;
              /&gt;
              &lt;Line</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/AttackHeatmapWidget.tsx (Line 141:16 - Line 154:13), client/src/components/dashboard/MTTTTrendWidget.tsx (Line 191:2 - Line 204:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn86" onclick="toggleCodeBlock('cloneGroup86', 'expandBtn86', 'collapseBtn86')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn86" onclick="toggleCodeBlock('cloneGroup86', 'expandBtn86', 'collapseBtn86')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup86"><code class="language-tsx text-sm text-gray-800">,
    },
    pollInterval: 300000, // Refresh every 5 minutes
  });

  const handleMenuClick = (event: React.MouseEvent&lt;HTMLElement&gt;) =&gt; {
    setAnchorEl(event.currentTarget);
  };

  const handleMenuClose = () =&gt; {
    setAnchorEl(null);
  };

  const handleExport</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/AttackHeatmapWidget.tsx (Line 374:11 - Line 395:4), client/src/components/dashboard/MTTTTrendWidget.tsx (Line 412:11 - Line 433:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn87" onclick="toggleCodeBlock('cloneGroup87', 'expandBtn87', 'collapseBtn87')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn87" onclick="toggleCodeBlock('cloneGroup87', 'expandBtn87', 'collapseBtn87')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup87"><code class="language-tsx text-sm text-gray-800">&lt;/Typography&gt;
          &lt;Box
            sx={{
              display: 'flex',
              justifyContent: 'center',
              alignItems: 'center',
              height: '50%',
            }}
          &gt;
            &lt;LinearProgress sx={{ width: '50%' }} /&gt;
          &lt;/Box&gt;
        &lt;/CardContent&gt;
      &lt;/Card&gt;
    );
  }

  if (error) {
    return (
      &lt;Card sx={{ height }}&gt;
        &lt;CardContent&gt;
          &lt;Typography variant=&quot;h6&quot; color=&quot;error&quot;&gt;
            Error Loading ATT</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/AttackHeatmapWidget.tsx (Line 681:9 - Line 699:2), client/src/components/dashboard/AttackHeatmapWidget.tsx (Line 653:8 - Line 671:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn88" onclick="toggleCodeBlock('cloneGroup88', 'expandBtn88', 'collapseBtn88')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn88" onclick="toggleCodeBlock('cloneGroup88', 'expandBtn88', 'collapseBtn88')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup88"><code class="language-tsx text-sm text-gray-800">&lt;/InputLabel&gt;
                &lt;Select
                  multiple
                  value={selectedFilters.severity}
                  onChange={(e) =&gt;
                    setSelectedFilters({
                      ...selectedFilters,
                      severity: e.target.value as string[],
                    })
                  }
                  renderValue={(selected) =&gt; (
                    &lt;Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5 }}&gt;
                      {(selected as string[]).map((value) =&gt; (
                        &lt;Chip key={value} label={value} size=&quot;small&quot; /&gt;
                      ))}
                    &lt;/Box&gt;
                  )}
                &gt;
                  {[</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/Map/GeospatialDashboard.tsx (Line 149:21 - Line 159:11), client/src/components/Map/GeospatialDashboard.tsx (Line 134:21 - Line 129:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn128" onclick="toggleCodeBlock('cloneGroup128', 'expandBtn128', 'collapseBtn128')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn128" onclick="toggleCodeBlock('cloneGroup128', 'expandBtn128', 'collapseBtn128')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup128"><code class="language-tsx text-sm text-gray-800">&lt;/Typography&gt;
                  &lt;/Box&gt;
                &lt;/Stack&gt;
              &lt;/CardContent&gt;
            &lt;/Card&gt;
          &lt;/Grid&gt;
          &lt;Grid item xs={12} sm={6} md={3}&gt;
            &lt;Card variant=&quot;outlined&quot;&gt;
              &lt;CardContent sx={{ p: 1.5, '&amp;:last-child': { pb: 1.5 } }}&gt;
                &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
                  &lt;MyLocation</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/Map/GeospatialDashboard.tsx (Line 164:21 - Line 174:9), client/src/components/Map/GeospatialDashboard.tsx (Line 134:21 - Line 129:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn129" onclick="toggleCodeBlock('cloneGroup129', 'expandBtn129', 'collapseBtn129')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn129" onclick="toggleCodeBlock('cloneGroup129', 'expandBtn129', 'collapseBtn129')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup129"><code class="language-tsx text-sm text-gray-800">&lt;/Typography&gt;
                  &lt;/Box&gt;
                &lt;/Stack&gt;
              &lt;/CardContent&gt;
            &lt;/Card&gt;
          &lt;/Grid&gt;
          &lt;Grid item xs={12} sm={6} md={3}&gt;
            &lt;Card variant=&quot;outlined&quot;&gt;
              &lt;CardContent sx={{ p: 1.5, '&amp;:last-child': { pb: 1.5 } }}&gt;
                &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
                  &lt;Timeline</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/routes/InvestigationDetailsRoute.tsx (Line 131:19 - Line 141:6), client/src/routes/InvestigationDetailsRoute.tsx (Line 100:13 - Line 110:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn131" onclick="toggleCodeBlock('cloneGroup131', 'expandBtn131', 'collapseBtn131')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn131" onclick="toggleCodeBlock('cloneGroup131', 'expandBtn131', 'collapseBtn131')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup131"><code class="language-tsx text-sm text-gray-800">&lt;table className=&quot;w-full text-sm&quot;&gt;
                    &lt;thead&gt;
                      &lt;tr className=&quot;text-left border-b&quot;&gt;
                        &lt;th className=&quot;p-2&quot;&gt;Time&lt;/th&gt;
                        &lt;th className=&quot;p-2&quot;&gt;Kind&lt;/th&gt;
                        &lt;th className=&quot;p-2&quot;&gt;ReasonCode&lt;/th&gt;
                        &lt;th className=&quot;p-2&quot;&gt;Metadata&lt;/th&gt;
                      &lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody&gt;
                      {items</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/routes/InvestigationDetailsRoute.tsx (Line 144:19 - Line 157:3), client/src/routes/InvestigationDetailsRoute.tsx (Line 113:15 - Line 124:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn132" onclick="toggleCodeBlock('cloneGroup132', 'expandBtn132', 'collapseBtn132')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn132" onclick="toggleCodeBlock('cloneGroup132', 'expandBtn132', 'collapseBtn132')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup132"><code class="language-tsx text-sm text-gray-800">()}
                          &lt;/td&gt;
                          &lt;td className=&quot;p-2&quot;&gt;{e.kind}&lt;/td&gt;
                          &lt;td className=&quot;p-2&quot;&gt;
                            {e.metadata?.reasonCode || '-'}
                          &lt;/td&gt;
                          &lt;td className=&quot;p-2&quot;&gt;
                            &lt;MetadataPreview metadata={e.metadata} /&gt;
                          &lt;/td&gt;
                        &lt;/tr&gt;
                      ))}
                    &lt;/tbody&gt;
                  &lt;/table&gt;
                &lt;/</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/routes/IncidentDetailsRoute.tsx (Line 51:5 - Line 64:9), client/src/routes/InvestigationDetailsRoute.tsx (Line 51:5 - Line 65:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn134" onclick="toggleCodeBlock('cloneGroup134', 'expandBtn134', 'collapseBtn134')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn134" onclick="toggleCodeBlock('cloneGroup134', 'expandBtn134', 'collapseBtn134')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup134"><code class="language-tsx text-sm text-gray-800">};
    const m = new Map&lt;string, any[]&gt;();
    for (const e of events) {
      const k = fmt(e.createdAt || e.created_at);
      if (!m.has(k)) m.set(k, []);
      m.get(k)!.push(e);
    }
    return Array.from(m.entries()).sort(([a], [b]) =&gt; (a &lt; b ? 1 : -1));
  }, [events, groupBy]);

  return (
    &lt;div className=&quot;space-y-4&quot;&gt;
      &lt;div className=&quot;flex items-center gap-3&quot;&gt;
        &lt;h2 className=&quot;text-lg font-semibold&quot;&gt;Incident</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/routes/IncidentDetailsRoute.tsx (Line 74:11 - Line 166:7), client/src/routes/InvestigationDetailsRoute.tsx (Line 78:16 - Line 170:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn135" onclick="toggleCodeBlock('cloneGroup135', 'expandBtn135', 'collapseBtn135')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn135" onclick="toggleCodeBlock('cloneGroup135', 'expandBtn135', 'collapseBtn135')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup135"><code class="language-tsx text-sm text-gray-800">}
      /&gt;
      &lt;div className=&quot;flex items-center gap-2 text-sm&quot;&gt;
        &lt;label className=&quot;opacity-70&quot;&gt;Group by:&lt;/label&gt;
        &lt;select
          className=&quot;border p-1&quot;
          value={groupBy}
          onChange={(e) =&gt; setGroupBy(e.target.value as any)}
        &gt;
          &lt;option value=&quot;none&quot;&gt;None&lt;/option&gt;
          &lt;option value=&quot;minute&quot;&gt;Minute&lt;/option&gt;
          &lt;option value=&quot;hour&quot;&gt;Hour&lt;/option&gt;
        &lt;/select&gt;
      &lt;/div&gt;
      {loading &amp;&amp; &lt;div&gt;Loading provenance&lt;/div&gt;}
      {error &amp;&amp; &lt;div className=&quot;text-red-600&quot;&gt;Error loading provenance&lt;/div&gt;}
      {!loading &amp;&amp; !error &amp;&amp; (
        &lt;div&gt;
          &lt;div className=&quot;text-sm opacity-70 mb-2&quot;&gt;
            {events.length} event(s)
          &lt;/div&gt;
          {groupBy === 'none' ? (
            &lt;table className=&quot;w-full text-sm&quot;&gt;
              &lt;thead&gt;
                &lt;tr className=&quot;text-left border-b&quot;&gt;
                  &lt;th className=&quot;p-2&quot;&gt;Time&lt;/th&gt;
                  &lt;th className=&quot;p-2&quot;&gt;Kind&lt;/th&gt;
                  &lt;th className=&quot;p-2&quot;&gt;ReasonCode&lt;/th&gt;
                  &lt;th className=&quot;p-2&quot;&gt;Metadata&lt;/th&gt;
                &lt;/tr&gt;
              &lt;/thead&gt;
              &lt;tbody&gt;
                {events.map((e: any) =&gt; (
                  &lt;tr key={e.id} className=&quot;border-b&quot;&gt;
                    &lt;td className=&quot;p-2&quot;&gt;
                      {new Date(e.createdAt).toLocaleString()}
                    &lt;/td&gt;
                    &lt;td className=&quot;p-2&quot;&gt;{e.kind}&lt;/td&gt;
                    &lt;td className=&quot;p-2&quot;&gt;{e.metadata?.reasonCode || '-'}&lt;/td&gt;
                    &lt;td className=&quot;p-2&quot;&gt;
                      &lt;MetadataPreview metadata={e.metadata} /&gt;
                    &lt;/td&gt;
                  &lt;/tr&gt;
                ))}
              &lt;/tbody&gt;
            &lt;/table&gt;
          ) : (
            &lt;div className=&quot;space-y-4&quot;&gt;
              {groups!.map(([bucket, items]) =&gt; (
                &lt;div key={bucket} className=&quot;border rounded&quot;&gt;
                  &lt;div className=&quot;px-3 py-2 text-xs bg-gray-50 border-b&quot;&gt;
                    {bucket.replace('T', ' ')} ({items.length})
                  &lt;/div&gt;
                  &lt;table className=&quot;w-full text-sm&quot;&gt;
                    &lt;thead&gt;
                      &lt;tr className=&quot;text-left border-b&quot;&gt;
                        &lt;th className=&quot;p-2&quot;&gt;Time&lt;/th&gt;
                        &lt;th className=&quot;p-2&quot;&gt;Kind&lt;/th&gt;
                        &lt;th className=&quot;p-2&quot;&gt;ReasonCode&lt;/th&gt;
                        &lt;th className=&quot;p-2&quot;&gt;Metadata&lt;/th&gt;
                      &lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody&gt;
                      {items.map((e: any) =&gt; (
                        &lt;tr key={e.id} className=&quot;border-b&quot;&gt;
                          &lt;td className=&quot;p-2&quot;&gt;
                            {new Date(e.createdAt).toLocaleTimeString()}
                          &lt;/td&gt;
                          &lt;td className=&quot;p-2&quot;&gt;{e.kind}&lt;/td&gt;
                          &lt;td className=&quot;p-2&quot;&gt;
                            {e.metadata?.reasonCode || '-'}
                          &lt;/td&gt;
                          &lt;td className=&quot;p-2&quot;&gt;
                            &lt;MetadataPreview metadata={e.metadata} /&gt;
                          &lt;/td&gt;
                        &lt;/tr&gt;
                      ))}
                    &lt;/tbody&gt;
                  &lt;/table&gt;
                &lt;/div&gt;
              ))}
            &lt;/div&gt;
          )}
        &lt;/div&gt;
      )}
    &lt;/div&gt;
  );
}

function MetadataPreview({ metadata }: { metadata: any }) {
  const [open, setOpen] = useState(false);
  if (!metadata) return &lt;span className=&quot;opacity-50&quot;&gt;-&lt;/span&gt;;
  return</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/routes/IncidentDetailsRoute.tsx (Line 165:2 - Line 184:2), client/src/routes/InvestigationDetailsRoute.tsx (Line 177:2 - Line 196:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn136" onclick="toggleCodeBlock('cloneGroup136', 'expandBtn136', 'collapseBtn136')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn136" onclick="toggleCodeBlock('cloneGroup136', 'expandBtn136', 'collapseBtn136')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup136"><code class="language-tsx text-sm text-gray-800">;
  return (
    &lt;span className=&quot;relative inline-block&quot;&gt;
      &lt;button
        className=&quot;text-blue-600 underline&quot;
        onClick={() =&gt; setOpen((v) =&gt; !v)}
        title=&quot;Preview metadata&quot;
      &gt;
        View
      &lt;/button&gt;
      {open &amp;&amp; (
        &lt;div className=&quot;absolute z-10 mt-1 w-[320px] max-h-[240px] overflow-auto border rounded bg-white shadow p-2 text-xs&quot;&gt;
          &lt;pre className=&quot;whitespace-pre-wrap break-words&quot;&gt;
            {JSON.stringify(metadata, null, 2)}
          &lt;/pre&gt;
        &lt;/div&gt;
      )}
    &lt;/span&gt;
  );
}</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ToastContainer.tsx (Line 123:5 - Line 135:2), client/src/components/ToastContainer.tsx (Line 89:5 - Line 99:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn137" onclick="toggleCodeBlock('cloneGroup137', 'expandBtn137', 'collapseBtn137')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn137" onclick="toggleCodeBlock('cloneGroup137', 'expandBtn137', 'collapseBtn137')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup137"><code class="language-tsx text-sm text-gray-800">success: (title: string, message?: string) =&gt;
      addToast({ type: 'success', title, message }),

    error: (title: string, message?: string) =&gt;
      addToast({ type: 'error', title, message }),

    warning: (title: string, message?: string) =&gt;
      addToast({ type: 'warning', title, message }),

    info: (title: string, message?: string) =&gt;
      addToast({ type: 'info', title, message }),
  };
}</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/SentimentVolatility.tsx (Line 39:2 - Line 52:7), client/src/components/WargameOptimizer.tsx (Line 48:2 - Line 61:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn138" onclick="toggleCodeBlock('cloneGroup138', 'expandBtn138', 'collapseBtn138')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn138" onclick="toggleCodeBlock('cloneGroup138', 'expandBtn138', 'collapseBtn138')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup138"><code class="language-tsx text-sm text-gray-800">;

      const width = 300;
      const height = 200;
      d3.select(chartRef.current).selectAll('*').remove();
      const svg = d3
        .select(chartRef.current)
        .append('svg')
        .attr('width', width)
        .attr('height', height);

      const x = d3
        .scaleBand()
        .domain(points</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/SentimentVolatility.tsx (Line 57:2 - Line 68:7), client/src/components/WargameOptimizer.tsx (Line 66:2 - Line 77:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn139" onclick="toggleCodeBlock('cloneGroup139', 'expandBtn139', 'collapseBtn139')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn139" onclick="toggleCodeBlock('cloneGroup139', 'expandBtn139', 'collapseBtn139')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup139"><code class="language-tsx text-sm text-gray-800">.value) || 1])
        .range([height, 0]);

      svg
        .append('g')
        .attr('transform', `translate(0,${height})`)
        .call(d3.axisBottom(x));
      svg.append('g').call(d3.axisLeft(y));

      svg
        .selectAll('rect')
        .data(points</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/RegionsBoard.tsx (Line 23:8 - Line 34:7), client/src/components/SitesDashboard.tsx (Line 27:9 - Line 38:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn140" onclick="toggleCodeBlock('cloneGroup140', 'expandBtn140', 'collapseBtn140')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn140" onclick="toggleCodeBlock('cloneGroup140', 'expandBtn140', 'collapseBtn140')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup140"><code class="language-tsx text-sm text-gray-800">(JSON.parse(e.data));
    return () =&gt; {
      s.close();
      eventSourceRef.current = null;
    };
  }, []);

  useEffect(() =&gt; {
    if (!handlerBoundRef.current) {
      handlerBoundRef.current = true;
      const h = function (this: HTMLInputElement) {
        const v = Number</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ProvenanceFilterPanel.tsx (Line 254:6 - Line 264:6), client/src/components/ProvenanceFilterPanel.tsx (Line 224:7 - Line 234:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn141" onclick="toggleCodeBlock('cloneGroup141', 'expandBtn141', 'collapseBtn141')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn141" onclick="toggleCodeBlock('cloneGroup141', 'expandBtn141', 'collapseBtn141')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup141"><code class="language-tsx text-sm text-gray-800">);
                try {
                  const filter: any = {};
                  if (codes.length) filter.reasonCodeIn = codes;
                  if (kinds.length) filter.kindIn = kinds;
                  if (sources.length) filter.sourceIn = sources;
                  if (from) filter.from = from;
                  if (to) filter.to = to;
                  if (contains &amp;&amp; contains.trim().length)
                    filter.contains = contains.trim();
                  const variables: any = { format: 'csv'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ProvenanceFilterPanel.tsx (Line 264:2 - Line 275:36), client/src/components/ProvenanceFilterPanel.tsx (Line 234:2 - Line 245:37)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn142" onclick="toggleCodeBlock('cloneGroup142', 'expandBtn142', 'collapseBtn142')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn142" onclick="toggleCodeBlock('cloneGroup142', 'expandBtn142', 'collapseBtn142')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup142"><code class="language-tsx text-sm text-gray-800">};
                  if (scope === 'incident') variables.incidentId = id;
                  else variables.investigationId = id;
                  if (Object.keys(filter).length) variables.filter = filter;
                  const res = await exportProv({ variables });
                  const url = res.data?.exportProvenance?.url;
                  if (url) window.open(url, '_blank', 'noopener');
                } finally {
                  setExporting(null);
                }
              }}
              title=&quot;Export filtered provenance as CSV&quot;</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/PortfolioOKR.tsx (Line 9:8 - Line 19:4), client/src/components/ReleasePlan.tsx (Line 8:2 - Line 18:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn143" onclick="toggleCodeBlock('cloneGroup143', 'expandBtn143', 'collapseBtn143')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn143" onclick="toggleCodeBlock('cloneGroup143', 'expandBtn143', 'collapseBtn143')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup143"><code class="language-tsx text-sm text-gray-800">)
      .catch((err) =&gt; {
        if (err.name !== 'AbortError') {
          console.error('Fetch error:', err);
        }
      });
    return () =&gt; controller.abort();
  }, []);
  return (
    &lt;div className=&quot;p-4 rounded-2xl shadow&quot;&gt;
      &lt;h3 className=&quot;text-lg font-semibold mb-2&quot;&gt;OKR</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/KeyboardShortcuts.tsx (Line 89:7 - Line 101:6), client/src/components/KeyboardShortcuts.tsx (Line 24:7 - Line 36:26)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn145" onclick="toggleCodeBlock('cloneGroup145', 'expandBtn145', 'collapseBtn145')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn145" onclick="toggleCodeBlock('cloneGroup145', 'expandBtn145', 'collapseBtn145')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup145"><code class="language-tsx text-sm text-gray-800">const pressedKeys = [];
      if (event.ctrlKey || event.metaKey) pressedKeys.push('ctrl');
      if (event.shiftKey) pressedKeys.push('shift');
      if (event.altKey) pressedKeys.push('alt');

      const key = event.key.toLowerCase();
      if (!['control', 'shift', 'alt', 'meta'].includes(key)) {
        pressedKeys.push(key);
      }

      const pressedKeyString = pressedKeys.join('+');

      const</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/KeyboardShortcuts.tsx (Line 115:9 - Line 128:2), client/src/components/KeyboardShortcuts.tsx (Line 53:9 - Line 66:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn146" onclick="toggleCodeBlock('cloneGroup146', 'expandBtn146', 'collapseBtn146')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn146" onclick="toggleCodeBlock('cloneGroup146', 'expandBtn146', 'collapseBtn146')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup146"><code class="language-tsx text-sm text-gray-800">const alwaysAllowed = ['escape', 'ctrl+k', 'ctrl+/'];
        const shouldExecute =
          !isInputElement ||
          alwaysAllowed.some((allowed) =&gt;
            matchingShortcut.keys.some((key) =&gt; key.toLowerCase() === allowed),
          );

        if (shouldExecute) {
          event.preventDefault();
          event.stopPropagation();
          matchingShortcut.action();
        }
      }
    };</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ContractsPanel.tsx (Line 9:5 - Line 19:7), client/src/components/ReleasePlan.tsx (Line 8:2 - Line 18:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn148" onclick="toggleCodeBlock('cloneGroup148', 'expandBtn148', 'collapseBtn148')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn148" onclick="toggleCodeBlock('cloneGroup148', 'expandBtn148', 'collapseBtn148')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup148"><code class="language-tsx text-sm text-gray-800">)
      .catch((err) =&gt; {
        if (err.name !== 'AbortError') {
          console.error('Fetch error:', err);
        }
      });
    return () =&gt; controller.abort();
  }, []);
  return (
    &lt;div className=&quot;p-4 rounded-2xl shadow&quot;&gt;
      &lt;h3 className=&quot;text-lg font-semibold mb-2&quot;&gt;Change</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="typescript-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">typescript</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">client/src/lib/assistant/transport.test.ts (Line 29:2 - Line 43:6), client/src/components/ai-enhanced/test-utils/fetch.ts (Line 13:2 - Line 27:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn30" onclick="toggleCodeBlock('cloneGroup30', 'expandBtn30', 'collapseBtn30')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn30" onclick="toggleCodeBlock('cloneGroup30', 'expandBtn30', 'collapseBtn30')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup30"><code class="language-typescript text-sm text-gray-800">;
        return {
          read: () =&gt;
            Promise.resolve(
              i &lt; chunks.length
                ? { value: encoder.encode(chunks[i++]), done: false }
                : { value: undefined, done: true },
            ),
          releaseLock() {},
        };
      },
    },
  });

  const</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/unit/reporting/validators/TemplateValidator.test.ts (Line 43:2 - Line 55:13), server/src/tests/unit/reporting/validators/TemplateValidator.test.ts (Line 25:3 - Line 37:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn178" onclick="toggleCodeBlock('cloneGroup178', 'expandBtn178', 'collapseBtn178')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn178" onclick="toggleCodeBlock('cloneGroup178', 'expandBtn178', 'collapseBtn178')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup178"><code class="language-typescript text-sm text-gray-800">,
        sections: ['header'],
      };

      expect(() =&gt; {
        TemplateValidator.validateCustomTemplate(template);
      }).toThrow(ValidationError);

      try {
        TemplateValidator.validateCustomTemplate(template);
      } catch (error) {
        expect((error as ValidationError).field).toBe('name');
        expect((error as ValidationError).code).toBe('MAX_LENGTH'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/unit/reporting/validators/TemplateValidator.test.ts (Line 62:2 - Line 72:11), server/src/tests/unit/reporting/validators/TemplateValidator.test.ts (Line 26:9 - Line 36:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn179" onclick="toggleCodeBlock('cloneGroup179', 'expandBtn179', 'collapseBtn179')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn179" onclick="toggleCodeBlock('cloneGroup179', 'expandBtn179', 'collapseBtn179')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup179"><code class="language-typescript text-sm text-gray-800">],
      };

      expect(() =&gt; {
        TemplateValidator.validateCustomTemplate(template);
      }).toThrow(ValidationError);

      try {
        TemplateValidator.validateCustomTemplate(template);
      } catch (error) {
        expect((error as ValidationError).field).toBe('sections'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/unit/reporting/validators/TemplateValidator.test.ts (Line 91:3 - Line 102:17), server/src/tests/unit/reporting/validators/TemplateValidator.test.ts (Line 26:9 - Line 73:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn180" onclick="toggleCodeBlock('cloneGroup180', 'expandBtn180', 'collapseBtn180')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn180" onclick="toggleCodeBlock('cloneGroup180', 'expandBtn180', 'collapseBtn180')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup180"><code class="language-typescript text-sm text-gray-800">],
      };

      expect(() =&gt; {
        TemplateValidator.validateCustomTemplate(template);
      }).toThrow(ValidationError);

      try {
        TemplateValidator.validateCustomTemplate(template);
      } catch (error) {
        expect((error as ValidationError).field).toBe('sections');
        expect((error as ValidationError).code).toBe('INVALID_FORMAT'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/unit/reporting/validators/TemplateValidator.test.ts (Line 110:17 - Line 120:16), server/src/tests/unit/reporting/validators/TemplateValidator.test.ts (Line 26:9 - Line 36:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn181" onclick="toggleCodeBlock('cloneGroup181', 'expandBtn181', 'collapseBtn181')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn181" onclick="toggleCodeBlock('cloneGroup181', 'expandBtn181', 'collapseBtn181')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup181"><code class="language-typescript text-sm text-gray-800">],
      };

      expect(() =&gt; {
        TemplateValidator.validateCustomTemplate(template);
      }).toThrow(ValidationError);

      try {
        TemplateValidator.validateCustomTemplate(template);
      } catch (error) {
        expect((error as ValidationError).field).toBe('exportFormats'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/unit/reporting/validators/TemplateValidator.test.ts (Line 145:5 - Line 156:14), server/src/tests/unit/reporting/validators/TemplateValidator.test.ts (Line 43:4 - Line 36:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn182" onclick="toggleCodeBlock('cloneGroup182', 'expandBtn182', 'collapseBtn182')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn182" onclick="toggleCodeBlock('cloneGroup182', 'expandBtn182', 'collapseBtn182')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup182"><code class="language-typescript text-sm text-gray-800">),
        sections: ['header'],
      };

      expect(() =&gt; {
        TemplateValidator.validateCustomTemplate(template);
      }).toThrow(ValidationError);

      try {
        TemplateValidator.validateCustomTemplate(template);
      } catch (error) {
        expect((error as ValidationError).field).toBe('description'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/unit/reporting/validators/ReportRequestValidator.test.ts (Line 91:9 - Line 101:5), server/src/tests/unit/reporting/validators/ReportRequestValidator.test.ts (Line 72:9 - Line 62:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn183" onclick="toggleCodeBlock('cloneGroup183', 'expandBtn183', 'collapseBtn183')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn183" onclick="toggleCodeBlock('cloneGroup183', 'expandBtn183', 'collapseBtn183')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup183"><code class="language-typescript text-sm text-gray-800">},
      });

      expect(() =&gt; {
        ReportRequestValidator.validate(request, mockInvestigationSummaryTemplate);
      }).toThrow(ValidationError);

      try {
        ReportRequestValidator.validate(request, mockInvestigationSummaryTemplate);
      } catch (error) {
        expect((error as ValidationError).code</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/unit/reporting/validators/ReportRequestValidator.test.ts (Line 107:4 - Line 117:9), server/src/tests/unit/reporting/validators/ReportRequestValidator.test.ts (Line 72:2 - Line 62:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn184" onclick="toggleCodeBlock('cloneGroup184', 'expandBtn184', 'collapseBtn184')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn184" onclick="toggleCodeBlock('cloneGroup184', 'expandBtn184', 'collapseBtn184')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup184"><code class="language-typescript text-sm text-gray-800">,
      });

      expect(() =&gt; {
        ReportRequestValidator.validate(request, mockInvestigationSummaryTemplate);
      }).toThrow(ValidationError);

      try {
        ReportRequestValidator.validate(request, mockInvestigationSummaryTemplate);
      } catch (error) {
        expect((error as ValidationError).field).toBe('format'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/xai-overlay/__tests__/XAIOverlayService.test.ts (Line 520:22 - Line 530:24), server/src/services/xai-overlay/__tests__/XAIOverlayService.test.ts (Line 495:19 - Line 505:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn185" onclick="toggleCodeBlock('cloneGroup185', 'expandBtn185', 'collapseBtn185')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn185" onclick="toggleCodeBlock('cloneGroup185', 'expandBtn185', 'collapseBtn185')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup185"><code class="language-typescript text-sm text-gray-800">: 0.5,
      };

      const computeFunction = async (features: FeatureVector): Promise&lt;number&gt; =&gt; {
        const trace = await xaiService.computeRiskWithExplanation(features, '24h');
        return (trace.modelOutput as any).score;
      };

      const sweepResult = await externalVerifier.performParameterSweep(
        baseFeatures,
        'transaction_frequency'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/reporting/templates/template-definitions.ts (Line 9:3 - Line 37:2), server/src/tests/fixtures/reporting/mock-templates.ts (Line 7:2 - Line 35:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn186" onclick="toggleCodeBlock('cloneGroup186', 'expandBtn186', 'collapseBtn186')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn186" onclick="toggleCodeBlock('cloneGroup186', 'expandBtn186', 'collapseBtn186')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup186"><code class="language-typescript text-sm text-gray-800">{
    id: 'INVESTIGATION_SUMMARY',
    name: 'Investigation Summary Report',
    description: 'A comprehensive overview of investigation findings',
    category: 'INVESTIGATION',
    sections: [
      'executive_summary',
      'investigation_timeline',
      'key_entities',
      'relationship_analysis',
      'evidence_summary',
      'findings_conclusions',
      'recommendations',
    ],
    parameters: [
      { name: 'investigationId', type: 'string', required: true },
      { name: 'includeClassifiedData', type: 'boolean', default: false },
      {
        name: 'summaryLevel',
        type: 'enum',
        options: ['brief', 'detailed', 'comprehensive'],
        default: 'detailed',
      },
      { name: 'timeRange', type: 'daterange', required: false },
    ],
    outputFormats: ['PDF', 'DOCX', 'HTML', 'JSON'],
    estimatedTime: 120000,
    accessLevel: 'ANALYST',
  },</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/reporting/templates/template-definitions.ts (Line 68:3 - Line 86:2), server/src/tests/fixtures/reporting/mock-templates.ts (Line 37:2 - Line 55:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn187" onclick="toggleCodeBlock('cloneGroup187', 'expandBtn187', 'collapseBtn187')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn187" onclick="toggleCodeBlock('cloneGroup187', 'expandBtn187', 'collapseBtn187')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup187"><code class="language-typescript text-sm text-gray-800">{
    id: 'ENTITY_ANALYSIS',
    name: 'Entity Analysis Report',
    description: 'Deep-dive analysis of a single entity',
    category: 'ENTITY',
    sections: [
      'entity_overview',
      'connection_analysis',
      'risk_assessment',
      'activity_timeline',
    ],
    parameters: [
      { name: 'entityId', type: 'string', required: true },
      { name: 'includeConnections', type: 'boolean', default: true },
    ],
    outputFormats: ['PDF', 'DOCX', 'HTML', 'JSON'],
    estimatedTime: 60000,
    accessLevel: 'ANALYST',
  },</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/reporting/templates/template-definitions.ts (Line 102:18 - Line 112:22), server/src/tests/fixtures/reporting/mock-templates.ts (Line 67:14 - Line 77:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn188" onclick="toggleCodeBlock('cloneGroup188', 'expandBtn188', 'collapseBtn188')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn188" onclick="toggleCodeBlock('cloneGroup188', 'expandBtn188', 'collapseBtn188')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup188"><code class="language-typescript text-sm text-gray-800">,
    ],
    parameters: [
      { name: 'investigationId', type: 'string', required: true },
      {
        name: 'analysisType',
        type: 'enum',
        options: ['full', 'communities', 'influence', 'flows'],
        default: 'full',
      },
      { name: 'minConnectionWeight'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/maestro/mcp/__tests__/servers-api.test.ts (Line 32:2 - Line 42:2), server/src/maestro/mcp/__tests__/servers-api.test.ts (Line 19:7 - Line 28:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn189" onclick="toggleCodeBlock('cloneGroup189', 'expandBtn189', 'collapseBtn189')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn189" onclick="toggleCodeBlock('cloneGroup189', 'expandBtn189', 'collapseBtn189')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup189"><code class="language-typescript text-sm text-gray-800">{
            id: 's1',
            name: 'local-graphops',
            url: 'ws://localhost:9010',
            auth_token: null,
            scopes: ['graph:read'],
            tags: ['local'],
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString(),
          }
        :</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/mcp/servers/files-server.ts (Line 184:7 - Line 194:3), server/src/conductor/mcp/servers/graphops-server.ts (Line 135:7 - Line 145:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn192" onclick="toggleCodeBlock('cloneGroup192', 'expandBtn192', 'collapseBtn192')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn192" onclick="toggleCodeBlock('cloneGroup192', 'expandBtn192', 'collapseBtn192')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup192"><code class="language-typescript text-sm text-gray-800">const authToken = this.extractAuthToken(request);
      if (!this.isValidToken(authToken)) {
        ws.close(1008, 'Invalid authentication token');
        return;
      }

      ws.on('message', async (data) =&gt; {
        try {
          const message: MCPRequest = JSON.parse(data.toString());

          if</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/mcp/servers/files-server.ts (Line 199:11 - Line 224:44), server/src/conductor/mcp/servers/graphops-server.ts (Line 152:11 - Line 177:47)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn193" onclick="toggleCodeBlock('cloneGroup193', 'expandBtn193', 'collapseBtn193')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn193" onclick="toggleCodeBlock('cloneGroup193', 'expandBtn193', 'collapseBtn193')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup193"><code class="language-typescript text-sm text-gray-800">switch (message.method) {
            case 'server/info':
              this.handleServerInfo(ws, message);
              break;
            case 'tools/list':
              this.handleToolsList(ws, message);
              break;
            case 'tools/execute':
              await this.handleToolExecute(ws, message, authToken);
              break;
            default:
              this.sendError(
                ws,
                message.id,
                -32601,
                `Method '${message.method}' not found`,
              );
          }
        } catch (error) {
          console.error('Error processing message:', error);
          this.sendError(ws, 'unknown', -32700, 'Parse error');
        }
      });

      ws.on('close', () =&gt; {
        console.log('MCP client disconnected from Files server'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/mcp/servers/files-server.ts (Line 224:44 - Line 243:6), server/src/conductor/mcp/servers/graphops-server.ts (Line 177:47 - Line 196:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn194" onclick="toggleCodeBlock('cloneGroup194', 'expandBtn194', 'collapseBtn194')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn194" onclick="toggleCodeBlock('cloneGroup194', 'expandBtn194', 'collapseBtn194')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup194"><code class="language-typescript text-sm text-gray-800">);
      });
    });
  }

  private extractAuthToken(request: any): string | null {
    const authHeader = request.headers.authorization;
    if (authHeader &amp;&amp; authHeader.startsWith('Bearer ')) {
      return authHeader.substring(7);
    }
    return null;
  }

  private isValidToken(token: string | null): boolean {
    return token !== null &amp;&amp; this.config.authTokens.includes(token);
  }

  private checkRateLimit(token: string): boolean {
    const now = Date.now();
    const limit</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/mcp/servers/files-server.ts (Line 249:7 - Line 266:19), server/src/conductor/mcp/servers/graphops-server.ts (Line 204:7 - Line 221:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn195" onclick="toggleCodeBlock('cloneGroup195', 'expandBtn195', 'collapseBtn195')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn195" onclick="toggleCodeBlock('cloneGroup195', 'expandBtn195', 'collapseBtn195')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup195"><code class="language-typescript text-sm text-gray-800">});
      return true;
    }

    if (limit.count &gt;= this.config.rateLimits.requestsPerSecond) {
      return false;
    }

    limit.count++;
    return true;
  }

  private handleServerInfo(ws: WebSocket, message: MCPRequest): void {
    const response: MCPResponse = {
      jsonrpc: '2.0',
      id: message.id,
      result: {
        name: 'Files MCP Server'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/mcp/servers/files-server.ts (Line 268:46 - Line 311:15), server/src/conductor/mcp/servers/graphops-server.ts (Line 223:33 - Line 266:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn196" onclick="toggleCodeBlock('cloneGroup196', 'expandBtn196', 'collapseBtn196')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn196" onclick="toggleCodeBlock('cloneGroup196', 'expandBtn196', 'collapseBtn196')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup196"><code class="language-typescript text-sm text-gray-800">,
        capabilities: {
          tools: true,
          resources: false,
          prompts: false,
        },
      },
    };
    ws.send(JSON.stringify(response));
  }

  private handleToolsList(ws: WebSocket, message: MCPRequest): void {
    const response: MCPResponse = {
      jsonrpc: '2.0',
      id: message.id,
      result: {
        tools: this.tools,
      },
    };
    ws.send(JSON.stringify(response));
  }

  private async handleToolExecute(
    ws: WebSocket,
    message: MCPRequest,
    token: string,
  ): Promise&lt;void&gt; {
    const { name, arguments: args } = message.params || {};

    if (!name) {
      this.sendError(ws, message.id, -32602, 'Missing tool name');
      return;
    }

    const tool = this.tools.find((t) =&gt; t.name === name);
    if (!tool) {
      this.sendError(ws, message.id, -32601, `Tool '${name}' not found`);
      return;
    }

    try {
      let result;
      switch (name) {
        case 'files.search'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/mcp/servers/files-server.ts (Line 327:11 - Line 350:12), server/src/conductor/mcp/servers/graphops-server.ts (Line 276:10 - Line 299:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn197" onclick="toggleCodeBlock('cloneGroup197', 'expandBtn197', 'collapseBtn197')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn197" onclick="toggleCodeBlock('cloneGroup197', 'expandBtn197', 'collapseBtn197')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup197"><code class="language-typescript text-sm text-gray-800">(args);
          break;
        default:
          throw new Error(`Unimplemented tool: ${name}`);
      }

      const response: MCPResponse = {
        jsonrpc: '2.0',
        id: message.id,
        result,
      };
      ws.send(JSON.stringify(response));
    } catch (error) {
      console.error(`Error executing tool ${name}:`, error);
      this.sendError(
        ws,
        message.id,
        -32000,
        `Tool execution failed: ${error.message}`,
      );
    }
  }

  private async searchFiles</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/cluster/failover.test.ts (Line 3:38 - Line 19:66), server/src/tests/cluster/routing.test.ts (Line 3:37 - Line 19:36)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn198" onclick="toggleCodeBlock('cloneGroup198', 'expandBtn198', 'collapseBtn198')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn198" onclick="toggleCodeBlock('cloneGroup198', 'expandBtn198', 'collapseBtn198')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup198"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
  // Placeholder for actual cluster connection and setup
  let driver: any; // Mock or actual driver

  beforeAll(async () =&gt; {
    // Initialize Neo4j driver for cluster
    // driver = neo4j.driver('bolt+routing://localhost:7687', neo4j.auth.basic('neo4j', 'password'));
    // await driver.verifyConnectivity();
    console.log('Simulating Neo4j cluster connection setup...');
  });

  afterAll(async () =&gt; {
    // await driver.close();
    console.log('Simulating Neo4j cluster connection teardown...');
  });

  it('should re-elect a leader within 10 seconds after leader failure'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/canonical/provenance.test.ts (Line 267:44 - Line 286:2), server/src/tests/canonical/provenance.test.ts (Line 206:41 - Line 226:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn199" onclick="toggleCodeBlock('cloneGroup199', 'expandBtn199', 'collapseBtn199')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn199" onclick="toggleCodeBlock('cloneGroup199', 'expandBtn199', 'collapseBtn199')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup199"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
      const chain = createProvenanceChain(
        'chain-1',
        {
          sourceId: 'api-1',
          sourceType: 'api',
          retrievedAt: new Date('2023-01-01'),
          sourceMetadata: {},
        },
        [
          {
            assertionId: 'assertion-1',
            claim: 'Person exists',
            assertedBy: { type: 'system', identifier: 'import-job' },
            assertedAt: new Date('2023-01-01'),
            confidence: 1.0,
            evidence: [],
          },
        ],
        []</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/canonical/provenance.test.ts (Line 323:2 - Line 344:6), server/src/tests/canonical/provenance.test.ts (Line 207:2 - Line 289:30)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn200" onclick="toggleCodeBlock('cloneGroup200', 'expandBtn200', 'collapseBtn200')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn200" onclick="toggleCodeBlock('cloneGroup200', 'expandBtn200', 'collapseBtn200')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup200"><code class="language-typescript text-sm text-gray-800">= createProvenanceChain(
        'chain-1',
        {
          sourceId: 'api-1',
          sourceType: 'api',
          retrievedAt: new Date('2023-01-01'),
          sourceMetadata: {},
        },
        [
          {
            assertionId: 'assertion-1',
            claim: 'Person exists',
            assertedBy: { type: 'system', identifier: 'import-job' },
            assertedAt: new Date('2023-01-01'),
            confidence: 1.0,
            evidence: [],
          },
        ],
        [],
      );

      const</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/canonical/provenance.test.ts (Line 415:38 - Line 440:29), server/src/tests/canonical/provenance.test.ts (Line 384:33 - Line 409:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn201" onclick="toggleCodeBlock('cloneGroup201', 'expandBtn201', 'collapseBtn201')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn201" onclick="toggleCodeBlock('cloneGroup201', 'expandBtn201', 'collapseBtn201')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup201"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
      const chain = createProvenanceChain(
        'chain-1',
        {
          sourceId: 'api-1',
          sourceType: 'api',
          retrievedAt: new Date('2023-01-01'),
          sourceMetadata: {},
        },
        [],
        [],
      );

      const manifest = createProvenanceManifest(
        {
          entityIds: ['entity-1'],
          entityTypes: ['Person'],
        },
        [chain],
        {
          generatedAt: new Date('2023-01-02'),
          generatedBy: 'export-service',
        },
      );

      // Tamper with manifest hash</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/canonical/provenance.test.ts (Line 449:46 - Line 474:43), server/src/tests/canonical/provenance.test.ts (Line 384:33 - Line 409:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn202" onclick="toggleCodeBlock('cloneGroup202', 'expandBtn202', 'collapseBtn202')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn202" onclick="toggleCodeBlock('cloneGroup202', 'expandBtn202', 'collapseBtn202')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup202"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
      const chain = createProvenanceChain(
        'chain-1',
        {
          sourceId: 'api-1',
          sourceType: 'api',
          retrievedAt: new Date('2023-01-01'),
          sourceMetadata: {},
        },
        [],
        [],
      );

      const manifest = createProvenanceManifest(
        {
          entityIds: ['entity-1'],
          entityTypes: ['Person'],
        },
        [chain],
        {
          generatedAt: new Date('2023-01-02'),
          generatedBy: 'export-service',
        },
      );

      // Tamper with a chain within the manifest</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/canonical/bitemporal.test.ts (Line 345:2 - Line 364:3), server/src/tests/canonical/bitemporal.test.ts (Line 282:2 - Line 301:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn203" onclick="toggleCodeBlock('cloneGroup203', 'expandBtn203', 'collapseBtn203')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn203" onclick="toggleCodeBlock('cloneGroup203', 'expandBtn203', 'collapseBtn203')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup203"><code class="language-typescript text-sm text-gray-800">,
          classifications: [],
          metadata: {},
          properties: {},
        },
        {
          id: personId,
          tenantId,
          validFrom: new Date('2023-01-01'),
          validTo: null,
          observedAt: new Date('2023-01-01'),
          recordedAt: new Date('2023-01-01'),
          version: 1,
          modifiedBy: userId,
          deleted: false,
        },
        'prov-1',
      );

      await createEntityVersion(pool, 'Person', v1</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/canonical/bitemporal.test.ts (Line 472:7 - Line 494:7), server/src/tests/canonical/bitemporal.test.ts (Line 225:7 - Line 301:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn204" onclick="toggleCodeBlock('cloneGroup204', 'expandBtn204', 'collapseBtn204')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn204" onclick="toggleCodeBlock('cloneGroup204', 'expandBtn204', 'collapseBtn204')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup204"><code class="language-typescript text-sm text-gray-800">const person = createPerson(
        {
          name: { full: 'John Doe' },
          identifiers: {},
          classifications: [],
          metadata: {},
          properties: {},
        },
        {
          id: personId,
          tenantId,
          validFrom: new Date('2023-01-01'),
          validTo: null,
          observedAt: new Date('2023-01-01'),
          recordedAt: new Date('2023-01-01'),
          version: 1,
          modifiedBy: userId,
          deleted: false,
        },
        'prov-1',
      );

      await createEntityVersion(pool, 'Person', person</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/xai-overlay/XAIOverlayService.ts (Line 797:12 - Line 809:20), server/src/services/xai-overlay/XAIOverlayService.ts (Line 723:16 - Line 735:34)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn205" onclick="toggleCodeBlock('cloneGroup205', 'expandBtn205', 'collapseBtn205')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn205" onclick="toggleCodeBlock('cloneGroup205', 'expandBtn205', 'collapseBtn205')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup205"><code class="language-typescript text-sm text-gray-800">,
      };
    } catch (error: any) {
      otelService.recordException(error);
      span.setStatus({ code: 2, message: error.message });
      throw error;
    } finally {
      span?.end();
    }
  }

  // ============================================================================
  // Cache Management</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/xai-overlay/ExternalVerifier.ts (Line 275:2 - Line 293:2), server/src/services/xai-overlay/XAIOverlayService.ts (Line 597:6 - Line 614:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn206" onclick="toggleCodeBlock('cloneGroup206', 'expandBtn206', 'collapseBtn206')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn206" onclick="toggleCodeBlock('cloneGroup206', 'expandBtn206', 'collapseBtn206')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup206"><code class="language-typescript text-sm text-gray-800">;
    }

    try {
      const notarized = {
        rootHex: Buffer.from(trace.traceDigest, 'hex').toString('hex'),
        timestamp: trace.signatureMetadata.signedAt,
        hsmSignature: trace.signatureMetadata.hsmSignature || '',
        tsaResponse: trace.signatureMetadata.tsaResponse,
        notarizedBy: trace.signatureMetadata.notarizedBy as any[],
        verification: {
          hsmValid: false,
          tsaValid: false,
        },
      };

      const verification = await dualNotary.verifyNotarizedRoot(notarized);

      return {</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/__tests__/GraphRAGQueryService.test.ts (Line 344:39 - Line 355:2), server/src/services/__tests__/GraphRAGQueryService.test.ts (Line 323:43 - Line 335:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn207" onclick="toggleCodeBlock('cloneGroup207', 'expandBtn207', 'collapseBtn207')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn207" onclick="toggleCodeBlock('cloneGroup207', 'expandBtn207', 'collapseBtn207')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup207"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const original = await graphRAGQueryService.query({
        investigationId: TEST_INVESTIGATION_ID,
        tenantId: TEST_TENANT_ID,
        userId: TEST_USER_ID,
        question: 'Original query',
        autoExecute: true,
      });

      const replayed = await graphRAGQueryService.replayRun(
        original.runId,
        TEST_USER_ID,</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/__tests__/AuthService.test.ts (Line 258:42 - Line 269:2), server/src/services/__tests__/AuthService.test.ts (Line 204:43 - Line 214:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn208" onclick="toggleCodeBlock('cloneGroup208', 'expandBtn208', 'collapseBtn208')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn208" onclick="toggleCodeBlock('cloneGroup208', 'expandBtn208', 'collapseBtn208')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup208"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockUser = {
        id: 'user-123',
        email: mockEmail,
        password_hash: mockHashedPassword,
        role: 'ANALYST',
        is_active: true,
        created_at: new Date(),
      };

      mockClient.query.mockResolvedValueOnce({ rows: [mockUser] });
      (</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/__tests__/AuthService.test.ts (Line 276:37 - Line 287:11), server/src/services/__tests__/AuthService.test.ts (Line 204:43 - Line 214:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn209" onclick="toggleCodeBlock('cloneGroup209', 'expandBtn209', 'collapseBtn209')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn209" onclick="toggleCodeBlock('cloneGroup209', 'expandBtn209', 'collapseBtn209')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup209"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockUser = {
        id: 'user-123',
        email: mockEmail,
        password_hash: mockHashedPassword,
        role: 'ANALYST',
        is_active: true,
        created_at: new Date(),
      };

      mockClient.query.mockResolvedValueOnce({ rows: [mockUser] });
      mockClient</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/__tests__/AuthService.test.ts (Line 301:43 - Line 320:13), server/src/services/__tests__/AuthService.test.ts (Line 204:43 - Line 223:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn210" onclick="toggleCodeBlock('cloneGroup210', 'expandBtn210', 'collapseBtn210')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn210" onclick="toggleCodeBlock('cloneGroup210', 'expandBtn210', 'collapseBtn210')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup210"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockUser = {
        id: 'user-123',
        email: mockEmail,
        password_hash: mockHashedPassword,
        role: 'ANALYST',
        is_active: true,
        created_at: new Date(),
      };

      mockClient.query.mockResolvedValueOnce({ rows: [mockUser] });
      mockClient.query.mockResolvedValueOnce(undefined); // Update last_login
      mockClient.query.mockResolvedValueOnce(undefined); // Insert session

      (argon2.verify as jest.Mock).mockResolvedValue(true);
      (jwt.sign as jest.Mock).mockReturnValue('jwt-token');

      const result = await authService.login(mockEmail, mockPassword);

      expect(result.refreshToken</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/__tests__/AuthService.test.ts (Line 391:41 - Line 402:6), server/src/services/__tests__/AuthService.test.ts (Line 329:44 - Line 340:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn211" onclick="toggleCodeBlock('cloneGroup211', 'expandBtn211', 'collapseBtn211')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn211" onclick="toggleCodeBlock('cloneGroup211', 'expandBtn211', 'collapseBtn211')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup211"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockToken = 'valid-jwt-token';
      const mockPayload = {
        userId: 'user-123',
        email: 'test@example.com',
        role: 'ANALYST',
      };
      const mockUser = {
        id: mockPayload.userId,
        email: mockPayload.email,
        role: mockPayload.role,
        is_active: false</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/__tests__/AuthService.test.ts (Line 589:36 - Line 611:2), server/src/services/__tests__/AuthService.test.ts (Line 329:44 - Line 351:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn212" onclick="toggleCodeBlock('cloneGroup212', 'expandBtn212', 'collapseBtn212')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn212" onclick="toggleCodeBlock('cloneGroup212', 'expandBtn212', 'collapseBtn212')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup212"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockToken = 'valid-jwt-token';
      const mockPayload = {
        userId: 'user-123',
        email: 'test@example.com',
        role: 'ANALYST',
      };
      const mockUser = {
        id: mockPayload.userId,
        email: mockPayload.email,
        role: mockPayload.role,
        is_active: true,
        first_name: 'John',
        last_name: 'Doe',
        created_at: new Date(),
      };

      (jwt.verify as jest.Mock).mockReturnValue(mockPayload);
      mockClient.query.mockResolvedValue({ rows: [mockUser] } as any);

      const result = await authService.verifyToken(mockToken);

      expect(result?</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/InvestigationRepo.test.ts (Line 130:24 - Line 142:24), server/src/repos/__tests__/InvestigationRepo.test.ts (Line 100:19 - Line 112:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn213" onclick="toggleCodeBlock('cloneGroup213', 'expandBtn213', 'collapseBtn213')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn213" onclick="toggleCodeBlock('cloneGroup213', 'expandBtn213', 'collapseBtn213')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup213"><code class="language-typescript text-sm text-gray-800">.name,
        description: null,
        status: 'active',
        props: {},
        created_at: new Date(),
        updated_at: new Date(),
        created_by: mockUserId,
      };

      mockPgPool.query.mockResolvedValue({ rows: [mockRow] } as any);

      const result = await investigationRepo.create(
        inputWithoutDescription</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/InvestigationRepo.test.ts (Line 158:18 - Line 170:18), server/src/repos/__tests__/InvestigationRepo.test.ts (Line 100:19 - Line 112:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn214" onclick="toggleCodeBlock('cloneGroup214', 'expandBtn214', 'collapseBtn214')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn214" onclick="toggleCodeBlock('cloneGroup214', 'expandBtn214', 'collapseBtn214')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup214"><code class="language-typescript text-sm text-gray-800">.name,
        description: null,
        status: 'active',
        props: {},
        created_at: new Date(),
        updated_at: new Date(),
        created_by: mockUserId,
      };

      mockPgPool.query.mockResolvedValue({ rows: [mockRow] } as any);

      const result = await investigationRepo.create(
        inputWithoutProps</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/InvestigationRepo.test.ts (Line 220:7 - Line 231:2), server/src/repos/__tests__/InvestigationRepo.test.ts (Line 190:9 - Line 201:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn215" onclick="toggleCodeBlock('cloneGroup215', 'expandBtn215', 'collapseBtn215')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn215" onclick="toggleCodeBlock('cloneGroup215', 'expandBtn215', 'collapseBtn215')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup215"><code class="language-typescript text-sm text-gray-800">,
        props: {},
        created_at: new Date(),
        updated_at: new Date(),
        created_by: 'user-456',
      };

      mockPgPool.query.mockResolvedValue({ rows: [mockRow] } as any);

      const result = await investigationRepo.update(updateInput);

      expect(result?</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/InvestigationRepo.test.ts (Line 249:6 - Line 259:5), server/src/repos/__tests__/InvestigationRepo.test.ts (Line 191:2 - Line 231:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn216" onclick="toggleCodeBlock('cloneGroup216', 'expandBtn216', 'collapseBtn216')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn216" onclick="toggleCodeBlock('cloneGroup216', 'expandBtn216', 'collapseBtn216')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup216"><code class="language-typescript text-sm text-gray-800">,
        created_at: new Date(),
        updated_at: new Date(),
        created_by: 'user-456',
      };

      mockPgPool.query.mockResolvedValue({ rows: [mockRow] } as any);

      const result = await investigationRepo.update(updateInput);

      expect(result?.name</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/InvestigationRepo.test.ts (Line 287:5 - Line 300:49), server/src/repos/__tests__/InvestigationRepo.test.ts (Line 189:18 - Line 202:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn217" onclick="toggleCodeBlock('cloneGroup217', 'expandBtn217', 'collapseBtn217')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn217" onclick="toggleCodeBlock('cloneGroup217', 'expandBtn217', 'collapseBtn217')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup217"><code class="language-typescript text-sm text-gray-800">,
        status: 'active',
        props: {},
        created_at: new Date(),
        updated_at: new Date(),
        created_by: 'user-456',
      };

      mockPgPool.query.mockResolvedValue({ rows: [mockRow] } as any);

      const result = await investigationRepo.update(updateInput);

      expect(result).not.toBeNull();
      // Should have called findById instead of UPDATE</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/InvestigationRepo.test.ts (Line 316:5 - Line 327:6), server/src/repos/__tests__/InvestigationRepo.test.ts (Line 286:16 - Line 297:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn218" onclick="toggleCodeBlock('cloneGroup218', 'expandBtn218', 'collapseBtn218')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn218" onclick="toggleCodeBlock('cloneGroup218', 'expandBtn218', 'collapseBtn218')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup218"><code class="language-typescript text-sm text-gray-800">,
        description: null,
        status: 'active',
        props: {},
        created_at: new Date(),
        updated_at: new Date(),
        created_by: 'user-456',
      };

      mockPgPool.query.mockResolvedValue({ rows: [mockRow] } as any);

      await</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/InvestigationRepo.test.ts (Line 389:14 - Line 399:9), server/src/repos/__tests__/InvestigationRepo.test.ts (Line 189:18 - Line 199:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn219" onclick="toggleCodeBlock('cloneGroup219', 'expandBtn219', 'collapseBtn219')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn219" onclick="toggleCodeBlock('cloneGroup219', 'expandBtn219', 'collapseBtn219')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup219"><code class="language-typescript text-sm text-gray-800">,
        status: 'active',
        props: {},
        created_at: new Date(),
        updated_at: new Date(),
        created_by: 'user-456',
      };

      mockPgPool.query.mockResolvedValue({ rows: [mockRow] } as any);

      const result = await investigationRepo.findById</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/InvestigationRepo.test.ts (Line 620:7 - Line 632:2), server/src/repos/__tests__/InvestigationRepo.test.ts (Line 434:7 - Line 446:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn220" onclick="toggleCodeBlock('cloneGroup220', 'expandBtn220', 'collapseBtn220')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn220" onclick="toggleCodeBlock('cloneGroup220', 'expandBtn220', 'collapseBtn220')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup220"><code class="language-typescript text-sm text-gray-800">const mockRows = [
        {
          id: 'inv-1',
          tenant_id: 'tenant-123',
          name: 'Investigation 1',
          description: null,
          status: 'active',
          props: {},
          created_at: new Date(),
          updated_at: new Date(),
          created_by: 'user-1',
        },
      ]</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/InvestigationRepo.test.ts (Line 666:8 - Line 684:9), server/src/repos/__tests__/InvestigationRepo.test.ts (Line 619:8 - Line 451:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn221" onclick="toggleCodeBlock('cloneGroup221', 'expandBtn221', 'collapseBtn221')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn221" onclick="toggleCodeBlock('cloneGroup221', 'expandBtn221', 'collapseBtn221')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup221"><code class="language-typescript text-sm text-gray-800">];
      const mockRows = [
        {
          id: 'inv-1',
          tenant_id: 'tenant-123',
          name: 'Investigation 1',
          description: null,
          status: 'active',
          props: {},
          created_at: new Date(),
          updated_at: new Date(),
          created_by: 'user-1',
        },
        {
          id: 'inv-2',
          tenant_id: 'tenant-123',
          name: 'Investigation 2',
          description: null,
          status: 'active'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/InvestigationRepo.test.ts (Line 682:18 - Line 696:2), server/src/repos/__tests__/InvestigationRepo.test.ts (Line 624:18 - Line 638:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn222" onclick="toggleCodeBlock('cloneGroup222', 'expandBtn222', 'collapseBtn222')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn222" onclick="toggleCodeBlock('cloneGroup222', 'expandBtn222', 'collapseBtn222')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup222"><code class="language-typescript text-sm text-gray-800">,
          description: null,
          status: 'active',
          props: {},
          created_at: new Date(),
          updated_at: new Date(),
          created_by: 'user-1',
        },
      ];

      mockPgPool.query.mockResolvedValue({ rows: mockRows } as any);

      const results = await investigationRepo.batchByIds(ids);

      expect(results[</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/EntityRepo.test.ts (Line 23:8 - Line 38:22), server/src/repos/__tests__/InvestigationRepo.test.ts (Line 24:11 - Line 39:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn223" onclick="toggleCodeBlock('cloneGroup223', 'expandBtn223', 'collapseBtn223')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn223" onclick="toggleCodeBlock('cloneGroup223', 'expandBtn223', 'collapseBtn223')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup223"><code class="language-typescript text-sm text-gray-800">&gt;;

  beforeEach(() =&gt; {
    // Mock PostgreSQL client
    mockPgClient = {
      query: jest.fn(),
      release: jest.fn(),
    } as any;

    // Mock PostgreSQL pool
    mockPgPool = {
      connect: jest.fn().mockResolvedValue(mockPgClient),
      query: jest.fn(),
    } as any;

    // Mock Neo4j session</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/EntityRepo.test.ts (Line 94:44 - Line 112:6), server/src/repos/__tests__/EntityRepo.test.ts (Line 66:37 - Line 84:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn224" onclick="toggleCodeBlock('cloneGroup224', 'expandBtn224', 'collapseBtn224')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn224" onclick="toggleCodeBlock('cloneGroup224', 'expandBtn224', 'collapseBtn224')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup224"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockEntityRow = {
        id: 'entity-789',
        tenant_id: mockEntityInput.tenantId,
        kind: mockEntityInput.kind,
        labels: mockEntityInput.labels,
        props: mockEntityInput.props,
        created_at: new Date(),
        updated_at: new Date(),
        created_by: mockUserId,
      };

      mockPgClient.query.mockResolvedValueOnce(undefined); // BEGIN
      mockPgClient.query.mockResolvedValueOnce({ rows: [mockEntityRow] }); // INSERT
      mockPgClient.query.mockResolvedValueOnce(undefined); // Outbox event
      mockPgClient.query.mockResolvedValueOnce(undefined); // COMMIT
      mockNeo4jSession.executeWrite.mockResolvedValue(undefined);

      await</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/EntityRepo.test.ts (Line 122:39 - Line 142:7), server/src/repos/__tests__/EntityRepo.test.ts (Line 66:37 - Line 114:35)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn225" onclick="toggleCodeBlock('cloneGroup225', 'expandBtn225', 'collapseBtn225')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn225" onclick="toggleCodeBlock('cloneGroup225', 'expandBtn225', 'collapseBtn225')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup225"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockEntityRow = {
        id: 'entity-789',
        tenant_id: mockEntityInput.tenantId,
        kind: mockEntityInput.kind,
        labels: mockEntityInput.labels,
        props: mockEntityInput.props,
        created_at: new Date(),
        updated_at: new Date(),
        created_by: mockUserId,
      };

      mockPgClient.query.mockResolvedValueOnce(undefined); // BEGIN
      mockPgClient.query.mockResolvedValueOnce({ rows: [mockEntityRow] }); // INSERT
      mockPgClient.query.mockResolvedValueOnce(undefined); // Outbox event
      mockPgClient.query.mockResolvedValueOnce(undefined); // COMMIT
      mockNeo4jSession.executeWrite.mockResolvedValue(undefined);

      await entityRepo.create(mockEntityInput, mockUserId);

      expect</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/EntityRepo.test.ts (Line 161:42 - Line 177:18), server/src/repos/__tests__/EntityRepo.test.ts (Line 66:37 - Line 82:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn226" onclick="toggleCodeBlock('cloneGroup226', 'expandBtn226', 'collapseBtn226')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn226" onclick="toggleCodeBlock('cloneGroup226', 'expandBtn226', 'collapseBtn226')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup226"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockEntityRow = {
        id: 'entity-789',
        tenant_id: mockEntityInput.tenantId,
        kind: mockEntityInput.kind,
        labels: mockEntityInput.labels,
        props: mockEntityInput.props,
        created_at: new Date(),
        updated_at: new Date(),
        created_by: mockUserId,
      };

      mockPgClient.query.mockResolvedValueOnce(undefined); // BEGIN
      mockPgClient.query.mockResolvedValueOnce({ rows: [mockEntityRow] }); // INSERT
      mockPgClient.query.mockResolvedValueOnce(undefined); // Outbox event
      mockPgClient.query.mockResolvedValueOnce(undefined); // COMMIT
      mockNeo4jSession.executeWrite.mockRejectedValue</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/EntityRepo.test.ts (Line 200:2 - Line 212:13), server/src/repos/__tests__/EntityRepo.test.ts (Line 72:6 - Line 84:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn227" onclick="toggleCodeBlock('cloneGroup227', 'expandBtn227', 'collapseBtn227')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn227" onclick="toggleCodeBlock('cloneGroup227', 'expandBtn227', 'collapseBtn227')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup227"><code class="language-typescript text-sm text-gray-800">,
        created_at: new Date(),
        updated_at: new Date(),
        created_by: mockUserId,
      };

      mockPgClient.query.mockResolvedValueOnce(undefined); // BEGIN
      mockPgClient.query.mockResolvedValueOnce({ rows: [mockEntityRow] }); // INSERT
      mockPgClient.query.mockResolvedValueOnce(undefined); // Outbox event
      mockPgClient.query.mockResolvedValueOnce(undefined); // COMMIT
      mockNeo4jSession.executeWrite.mockResolvedValue(undefined);

      const result = await entityRepo.create(minimalInput</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/EntityRepo.test.ts (Line 278:2 - Line 292:2), server/src/repos/__tests__/EntityRepo.test.ts (Line 232:6 - Line 246:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn228" onclick="toggleCodeBlock('cloneGroup228', 'expandBtn228', 'collapseBtn228')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn228" onclick="toggleCodeBlock('cloneGroup228', 'expandBtn228', 'collapseBtn228')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup228"><code class="language-typescript text-sm text-gray-800">,
        created_at: new Date(),
        updated_at: new Date(),
        created_by: 'user-456',
      };

      mockPgClient.query.mockResolvedValueOnce(undefined); // BEGIN
      mockPgClient.query.mockResolvedValueOnce({ rows: [mockEntityRow] }); // UPDATE
      mockPgClient.query.mockResolvedValueOnce(undefined); // Outbox event
      mockPgClient.query.mockResolvedValueOnce(undefined); // COMMIT
      mockNeo4jSession.executeWrite.mockResolvedValue(undefined);

      const result = await entityRepo.update(updateInput);

      expect(result?</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/EntityRepo.test.ts (Line 305:2 - Line 320:6), server/src/repos/__tests__/EntityRepo.test.ts (Line 231:7 - Line 292:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn229" onclick="toggleCodeBlock('cloneGroup229', 'expandBtn229', 'collapseBtn229')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn229" onclick="toggleCodeBlock('cloneGroup229', 'expandBtn229', 'collapseBtn229')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup229"><code class="language-typescript text-sm text-gray-800">,
        props: updateInput.props,
        created_at: new Date(),
        updated_at: new Date(),
        created_by: 'user-456',
      };

      mockPgClient.query.mockResolvedValueOnce(undefined); // BEGIN
      mockPgClient.query.mockResolvedValueOnce({ rows: [mockEntityRow] }); // UPDATE
      mockPgClient.query.mockResolvedValueOnce(undefined); // Outbox event
      mockPgClient.query.mockResolvedValueOnce(undefined); // COMMIT
      mockNeo4jSession.executeWrite.mockResolvedValue(undefined);

      const result = await entityRepo.update(updateInput);

      expect(result?.props</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/EntityRepo.test.ts (Line 369:30 - Line 380:7), server/src/repos/__tests__/EntityRepo.test.ts (Line 325:39 - Line 351:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn230" onclick="toggleCodeBlock('cloneGroup230', 'expandBtn230', 'collapseBtn230')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn230" onclick="toggleCodeBlock('cloneGroup230', 'expandBtn230', 'collapseBtn230')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup230"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const entityId = 'entity-789';

      mockPgClient.query.mockResolvedValueOnce(undefined); // BEGIN
      mockPgClient.query.mockResolvedValueOnce({ rowCount: 1 }); // DELETE
      mockPgClient.query.mockResolvedValueOnce(undefined); // Outbox event
      mockPgClient.query.mockResolvedValueOnce(undefined); // COMMIT
      mockNeo4jSession.executeWrite.mockResolvedValue(undefined);

      await entityRepo.delete(entityId);

      expect</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/EntityRepo.test.ts (Line 533:11 - Line 543:43), server/src/repos/__tests__/InvestigationRepo.test.ts (Line 608:18 - Line 618:49)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn231" onclick="toggleCodeBlock('cloneGroup231', 'expandBtn231', 'collapseBtn231')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn231" onclick="toggleCodeBlock('cloneGroup231', 'expandBtn231', 'collapseBtn231')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup231"><code class="language-typescript text-sm text-gray-800">.batchByIds(ids);

      expect(results).toHaveLength(3);
      expect(results.every((r) =&gt; r !== null)).toBe(true);
      expect(mockPgPool.query).toHaveBeenCalledWith(
        expect.stringContaining('WHERE id = ANY($1)'),
        [ids],
      );
    });

    it('should return nulls for missing entities'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/__tests__/EntityRepo.test.ts (Line 545:7 - Line 560:11), server/src/repos/__tests__/EntityRepo.test.ts (Line 436:7 - Line 451:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn232" onclick="toggleCodeBlock('cloneGroup232', 'expandBtn232', 'collapseBtn232')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn232" onclick="toggleCodeBlock('cloneGroup232', 'expandBtn232', 'collapseBtn232')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup232"><code class="language-typescript text-sm text-gray-800">const mockEntities = [
        {
          id: 'entity-1',
          tenant_id: 'tenant-123',
          kind: 'Person',
          labels: [],
          props: {},
          created_at: new Date(),
          updated_at: new Date(),
          created_by: 'user-1',
        },
      ];

      mockPgPool.query.mockResolvedValue({ rows: mockEntities } as any);

      const results = await entityRepo.batchByIds</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/publishing/__tests__/proof-carrying-publishing.test.ts (Line 320:7 - Line 353:7), server/src/publishing/__tests__/proof-carrying-publishing.test.ts (Line 271:7 - Line 304:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn233" onclick="toggleCodeBlock('cloneGroup233', 'expandBtn233', 'collapseBtn233')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn233" onclick="toggleCodeBlock('cloneGroup233', 'expandBtn233', 'collapseBtn233')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup233"><code class="language-typescript text-sm text-gray-800">const file1 = join(tempDir, 'test.txt');
      await fs.writeFile(file1, 'test data');

      const builder = new HashTreeBuilder('sha256');
      const hash = await builder.hashFile(file1);
      const tree = builder.buildMerkleTree([hash]);

      const manifest = {
        version: '1.0' as const,
        id: 'test-manifest',
        bundleId: 'test-bundle',
        hashTree: tree,
        modelCards: [],
        citations: [],
        licenses: [StandardLicenses['MIT']],
        metadata: {
          name: 'Test Bundle',
          description: 'Test',
          version: '1.0',
          createdAt: new Date().toISOString(),
          createdBy: 'test-user',
        },
        verification: {
          offlineVerifiable: true,
        },
        signature: 'test-signature',
        signatureAlgorithm: 'RSA-SHA256' as const,
        publicKey: 'test-key',
        createdAt: new Date().toISOString(),
        revocable: true,
        revocationCheckRequired: false,
      };

      const wallet</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/publishing/__tests__/proof-carrying-publishing.test.ts (Line 521:12 - Line 543:21), server/src/publishing/__tests__/proof-carrying-publishing.test.ts (Line 444:2 - Line 466:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn234" onclick="toggleCodeBlock('cloneGroup234', 'expandBtn234', 'collapseBtn234')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn234" onclick="toggleCodeBlock('cloneGroup234', 'expandBtn234', 'collapseBtn234')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup234"><code class="language-typescript text-sm text-gray-800">);

      const citation: Citation = {
        id: 'cit-1',
        type: 'data',
        required: true,
        title: 'Test Data',
        license: StandardLicenses['MIT'],
        verified: true,
        verifiedAt: new Date().toISOString(),
      };

      const result = await publisher.publish({
        name: 'Test Bundle',
        description: 'Test',
        version: '1.0',
        createdBy: 'test-user',
        artifacts: [file1],
        citations: [citation],
        licenses: [StandardLicenses['MIT']],
      });

      // Revoke the bundle</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/publishing/__tests__/proof-carrying-publishing.test.ts (Line 658:2 - Line 680:42), server/src/publishing/__tests__/proof-carrying-publishing.test.ts (Line 444:2 - Line 466:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn235" onclick="toggleCodeBlock('cloneGroup235', 'expandBtn235', 'collapseBtn235')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn235" onclick="toggleCodeBlock('cloneGroup235', 'expandBtn235', 'collapseBtn235')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup235"><code class="language-typescript text-sm text-gray-800">);

      const citation: Citation = {
        id: 'cit-1',
        type: 'data',
        required: true,
        title: 'Test Data',
        license: StandardLicenses['MIT'],
        verified: true,
        verifiedAt: new Date().toISOString(),
      };

      const result = await publisher.publish({
        name: 'Test Bundle',
        description: 'Test',
        version: '1.0',
        createdBy: 'test-user',
        artifacts: [file1],
        citations: [citation],
        licenses: [StandardLicenses['MIT']],
      });

      // Create wallets for different audiences</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/publishing/__tests__/proof-carrying-publishing.test.ts (Line 706:45 - Line 730:27), server/src/publishing/__tests__/proof-carrying-publishing.test.ts (Line 656:51 - Line 466:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn236" onclick="toggleCodeBlock('cloneGroup236', 'expandBtn236', 'collapseBtn236')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn236" onclick="toggleCodeBlock('cloneGroup236', 'expandBtn236', 'collapseBtn236')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup236"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const file1 = join(tempDir, 'data.json');
      await fs.writeFile(file1, JSON.stringify({ test: 'data' }));

      const citation: Citation = {
        id: 'cit-1',
        type: 'data',
        required: true,
        title: 'Test Data',
        license: StandardLicenses['MIT'],
        verified: true,
        verifiedAt: new Date().toISOString(),
      };

      const result = await publisher.publish({
        name: 'Test Bundle',
        description: 'Test',
        version: '1.0',
        createdBy: 'test-user',
        artifacts: [file1],
        citations: [citation],
        licenses: [StandardLicenses['MIT']],
      });

      // Create multiple wallets</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/privacy/dsar/connectors.ts (Line 154:4 - Line 164:6), server/src/privacy/dsar/connectors.ts (Line 53:4 - Line 63:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn237" onclick="toggleCodeBlock('cloneGroup237', 'expandBtn237', 'collapseBtn237')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn237" onclick="toggleCodeBlock('cloneGroup237', 'expandBtn237', 'collapseBtn237')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup237"><code class="language-typescript text-sm text-gray-800">.tenantId === tenantId,
    );
  }

  async rectify(
    subjectId: string,
    tenantId: string,
    patch: Record&lt;string, unknown&gt;,
  ): Promise&lt;void&gt; {
    this.calls.rectify += 1;
    Object.entries(patch).forEach(([index</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/notifications-hub/receivers/ChatReceiver.ts (Line 428:2 - Line 446:4), server/src/notifications-hub/receivers/ChatReceiver.ts (Line 380:3 - Line 398:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn238" onclick="toggleCodeBlock('cloneGroup238', 'expandBtn238', 'collapseBtn238')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn238" onclick="toggleCodeBlock('cloneGroup238', 'expandBtn238', 'collapseBtn238')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup238"><code class="language-typescript text-sm text-gray-800">;
  }

  async healthCheck(): Promise&lt;boolean&gt; {
    return true;
  }

  async shutdown(): Promise&lt;void&gt; {
    // Cleanup
  }

  private sleep(ms: number): Promise&lt;void&gt; {
    return new Promise((resolve) =&gt; setTimeout(resolve, ms));
  }
}

/**
 * Mattermost Adapter Implementation
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/notifications-hub/receivers/ChatReceiver.ts (Line 472:2 - Line 490:4), server/src/notifications-hub/receivers/ChatReceiver.ts (Line 380:3 - Line 398:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn239" onclick="toggleCodeBlock('cloneGroup239', 'expandBtn239', 'collapseBtn239')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn239" onclick="toggleCodeBlock('cloneGroup239', 'expandBtn239', 'collapseBtn239')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup239"><code class="language-typescript text-sm text-gray-800">;
  }

  async healthCheck(): Promise&lt;boolean&gt; {
    return true;
  }

  async shutdown(): Promise&lt;void&gt; {
    // Cleanup
  }

  private sleep(ms: number): Promise&lt;void&gt; {
    return new Promise((resolve) =&gt; setTimeout(resolve, ms));
  }
}

/**
 * Custom Chat Adapter for generic webhook-based chat systems
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/notifications-hub/receivers/ChatReceiver.ts (Line 513:13 - Line 531:2), server/src/notifications-hub/receivers/ChatReceiver.ts (Line 468:17 - Line 394:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn240" onclick="toggleCodeBlock('cloneGroup240', 'expandBtn240', 'collapseBtn240')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn240" onclick="toggleCodeBlock('cloneGroup240', 'expandBtn240', 'collapseBtn240')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup240"><code class="language-typescript text-sm text-gray-800">${Date.now()}`;
  }

  async validateChannel(channel: string): Promise&lt;boolean&gt; {
    return channel.length &gt; 0;
  }

  async healthCheck(): Promise&lt;boolean&gt; {
    return true;
  }

  async shutdown(): Promise&lt;void&gt; {
    // Cleanup
  }

  private sleep(ms: number): Promise&lt;void&gt; {
    return new Promise((resolve) =&gt; setTimeout(resolve, ms));
  }
}</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/notifications-hub/adapters/EventAdapters.ts (Line 339:18 - Line 359:4), server/src/notifications-hub/adapters/EventAdapters.ts (Line 210:22 - Line 230:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn241" onclick="toggleCodeBlock('cloneGroup241', 'expandBtn241', 'collapseBtn241')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn241" onclick="toggleCodeBlock('cloneGroup241', 'expandBtn241', 'collapseBtn241')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup241"><code class="language-typescript text-sm text-gray-800">)
      .build();

    await this.hub.notify(event);
  }

  async shutdown(): Promise&lt;void&gt; {
    this.hub = null;
    this.initialized = false;
  }

  async healthCheck(): Promise&lt;boolean&gt; {
    return this.initialized;
  }
}

/**
 * Copilot Event Adapter
 *
 * Converts copilot/AI events into canonical events
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/notifications-hub/adapters/EventAdapters.ts (Line 457:27 - Line 477:4), server/src/notifications-hub/adapters/EventAdapters.ts (Line 210:22 - Line 230:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn242" onclick="toggleCodeBlock('cloneGroup242', 'expandBtn242', 'collapseBtn242')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn242" onclick="toggleCodeBlock('cloneGroup242', 'expandBtn242', 'collapseBtn242')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup242"><code class="language-typescript text-sm text-gray-800">)
      .build();

    await this.hub.notify(event);
  }

  async shutdown(): Promise&lt;void&gt; {
    this.hub = null;
    this.initialized = false;
  }

  async healthCheck(): Promise&lt;boolean&gt; {
    return this.initialized;
  }
}

/**
 * Two-Person Control / Authority Event Adapter
 *
 * Converts authority/approval events into canonical events
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/notifications-hub/adapters/EventAdapters.ts (Line 495:5 - Line 505:28), server/src/notifications-hub/adapters/EventAdapters.ts (Line 297:5 - Line 307:27)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn243" onclick="toggleCodeBlock('cloneGroup243', 'expandBtn243', 'collapseBtn243')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn243" onclick="toggleCodeBlock('cloneGroup243', 'expandBtn243', 'collapseBtn243')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup243"><code class="language-typescript text-sm text-gray-800">: string }&gt;;
    reason: string;
    expiresAt: Date;
    tenantId: string;
    projectId?: string;
    approvalUrl?: string;
  }): Promise&lt;void&gt; {
    if (!this.hub) throw new Error('Adapter not initialized');

    const event = new EventBuilder()
      .type(EventType.AUTHORITY_APPROVAL_REQUIRED</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/notifications-hub/adapters/EventAdapters.ts (Line 637:21 - Line 655:4), server/src/notifications-hub/adapters/EventAdapters.ts (Line 210:22 - Line 230:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn244" onclick="toggleCodeBlock('cloneGroup244', 'expandBtn244', 'collapseBtn244')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn244" onclick="toggleCodeBlock('cloneGroup244', 'expandBtn244', 'collapseBtn244')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup244"><code class="language-typescript text-sm text-gray-800">)
      .build();

    await this.hub.notify(event);
  }

  async shutdown(): Promise&lt;void&gt; {
    this.hub = null;
    this.initialized = false;
  }

  async healthCheck(): Promise&lt;boolean&gt; {
    return this.initialized;
  }
}

/**
 * Investigation &amp; Evidence Event Adapter
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/notifications-hub/adapters/EventAdapters.ts (Line 703:23 - Line 722:4), server/src/notifications-hub/adapters/EventAdapters.ts (Line 210:22 - Line 230:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn245" onclick="toggleCodeBlock('cloneGroup245', 'expandBtn245', 'collapseBtn245')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn245" onclick="toggleCodeBlock('cloneGroup245', 'expandBtn245', 'collapseBtn245')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup245"><code class="language-typescript text-sm text-gray-800">)
      .build();

    await this.hub.notify(event);
  }

  async shutdown(): Promise&lt;void&gt; {
    this.hub = null;
    this.initialized = false;
  }

  async healthCheck(): Promise&lt;boolean&gt; {
    return this.initialized;
  }
}

/**
 * Adapter Registry
 * Central registry for all event adapters
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/middleware/__tests__/requestId.test.ts (Line 42:45 - Line 52:4), server/src/middleware/__tests__/requestId.test.ts (Line 9:51 - Line 19:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn246" onclick="toggleCodeBlock('cloneGroup246', 'expandBtn246', 'collapseBtn246')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn246" onclick="toggleCodeBlock('cloneGroup246', 'expandBtn246', 'collapseBtn246')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup246"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
    const req = requestFactory({
      headers: {},
    });
    const res = responseFactory();
    const next = nextFactory();

    const middleware = requestId();
    middleware(req as any, res, next);

    expect(res</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/middleware/__tests__/requestId.test.ts (Line 55:28 - Line 65:5), server/src/middleware/__tests__/requestId.test.ts (Line 9:51 - Line 19:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn247" onclick="toggleCodeBlock('cloneGroup247', 'expandBtn247', 'collapseBtn247')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn247" onclick="toggleCodeBlock('cloneGroup247', 'expandBtn247', 'collapseBtn247')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup247"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
    const req = requestFactory({
      headers: {},
    });
    const res = responseFactory();
    const next = nextFactory();

    const middleware = requestId();
    middleware(req as any, res, next);

    expect(next</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/middleware/__tests__/auth.test.ts (Line 42:2 - Line 54:2), server/src/middleware/__tests__/auth.test.ts (Line 24:2 - Line 36:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn248" onclick="toggleCodeBlock('cloneGroup248', 'expandBtn248', 'collapseBtn248')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn248" onclick="toggleCodeBlock('cloneGroup248', 'expandBtn248', 'collapseBtn248')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup248"><code class="language-typescript text-sm text-gray-800">},
      });
      const res = responseFactory();
      const next = nextFactory();

      mockAuthService.verifyToken = jest.fn().mockResolvedValue(user);

      await ensureAuthenticated(req as any, res, next);

      expect(mockAuthService.verifyToken).toHaveBeenCalledWith('valid-token');
      expect(req.user).toEqual(user);
      expect(next).toHaveBeenCalled();
    }</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/middleware/__tests__/auth.test.ts (Line 104:2 - Line 115:2), server/src/middleware/__tests__/auth.test.ts (Line 58:2 - Line 70:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn249" onclick="toggleCodeBlock('cloneGroup249', 'expandBtn249', 'collapseBtn249')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn249" onclick="toggleCodeBlock('cloneGroup249', 'expandBtn249', 'collapseBtn249')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup249"><code class="language-typescript text-sm text-gray-800">},
      });
      const res = responseFactory();
      const next = nextFactory();

      await ensureAuthenticated(req as any, res, next);

      expect(res.status).toHaveBeenCalledWith(401);
      expect(res.json).toHaveBeenCalledWith({ error: 'Unauthorized' });
      expect(next).not.toHaveBeenCalled();
    });
  }</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/maestro/runs/runs-api.ts (Line 141:16 - Line 151:59), server/src/maestro/runs/runs-api.ts (Line 69:16 - Line 78:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn250" onclick="toggleCodeBlock('cloneGroup250', 'expandBtn250', 'collapseBtn250')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn250" onclick="toggleCodeBlock('cloneGroup250', 'expandBtn250', 'collapseBtn250')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup250"><code class="language-typescript text-sm text-gray-800">.safeParse(req.body);
    if (!validation.success) {
      return res.status(400).json({
        error: 'Invalid input',
        details: validation.error.issues,
      });
    }

    const tenantId = (req.context as RequestContext).tenantId; // Get tenantId from context

    // Calculate duration if both start and end times provided</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/maestro/executors/executors-repo.ts (Line 15:2 - Line 40:6), server/src/maestro/pipelines/pipelines-repo.ts (Line 13:2 - Line 37:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn251" onclick="toggleCodeBlock('cloneGroup251', 'expandBtn251', 'collapseBtn251')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn251" onclick="toggleCodeBlock('cloneGroup251', 'expandBtn251', 'collapseBtn251')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup251"><code class="language-typescript text-sm text-gray-800">{
  private pool: Pool | null = null;
  private initialized = false;

  private getPool(): Pool {
    if (!this.pool) {
      this.pool = getPostgresPool();
    }
    return this.pool;
  }
  private async ensureTable() {
    if (this.initialized) return;
    // The table creation is handled by migrations now, but we keep this for initial setup if no migrations are run
    await this.getPool().query(`
      CREATE TABLE IF NOT EXISTS executors (
        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
        name TEXT NOT NULL UNIQUE,
        kind TEXT NOT NULL,
        labels TEXT[] NOT NULL DEFAULT '{}',
        capacity INT NOT NULL DEFAULT 1,
        status TEXT NOT NULL DEFAULT 'ready',
        last_heartbeat TIMESTAMP,
        tenant_id TEXT NOT NULL
      );
      CREATE INDEX IF NOT EXISTS idx_executors_tenant_id ON executors(tenant_id);
    `</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/mvp1-copilot.ts (Line 202:7 - Line 216:9), server/src/graphql/resolvers/mvp1-copilot.ts (Line 97:8 - Line 111:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn252" onclick="toggleCodeBlock('cloneGroup252', 'expandBtn252', 'collapseBtn252')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn252" onclick="toggleCodeBlock('cloneGroup252', 'expandBtn252', 'collapseBtn252')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup252"><code class="language-typescript text-sm text-gray-800">;
        };
      },
      context: AuthContext,
    ) =&gt; {
      // Feature flag check
      if (!isFeatureEnabled('COPILOT_SERVICE')) {
        throw new Error('Copilot service is not enabled');
      }

      if (!context.isAuthenticated || !context.user) {
        throw new AuthenticationError('Authentication required');
      }

      if (!input.entities</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/mvp1-copilot.ts (Line 290:15 - Line 304:52), server/src/graphql/resolvers/mvp1-copilot.ts (Line 202:20 - Line 111:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn253" onclick="toggleCodeBlock('cloneGroup253', 'expandBtn253', 'collapseBtn253')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn253" onclick="toggleCodeBlock('cloneGroup253', 'expandBtn253', 'collapseBtn253')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup253"><code class="language-typescript text-sm text-gray-800">?: number;
        };
      },
      context: AuthContext,
    ) =&gt; {
      // Feature flag check
      if (!isFeatureEnabled('COPILOT_SERVICE')) {
        throw new Error('Copilot service is not enabled');
      }

      if (!context.isAuthenticated || !context.user) {
        throw new AuthenticationError('Authentication required');
      }

      // Require elevated permissions for bulk processing</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/multimodalResolvers.ts (Line 546:14 - Line 557:30), server/src/graphql/resolvers/multimodalResolvers.ts (Line 483:17 - Line 494:50)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn254" onclick="toggleCodeBlock('cloneGroup254', 'expandBtn254', 'collapseBtn254')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn254" onclick="toggleCodeBlock('cloneGroup254', 'expandBtn254', 'collapseBtn254')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup254"><code class="language-typescript text-sm text-gray-800">: {
    // Resolve media source
    mediaSource: withAuthAndPolicy('read', () =&gt; ({
      type: 'media_source',
      id: 'related',
    }))(async (parent, _, context: MultimodalContext) =&gt; {
      return await context.multimodalDataService.getMediaSource(
        parent.mediaSourceId,
      );
    }),

    // Resolve extracted entities</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/legacy.ts (Line 288:6 - Line 300:7), server/src/graphql/resolvers/legacy.ts (Line 270:6 - Line 282:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn255" onclick="toggleCodeBlock('cloneGroup255', 'expandBtn255', 'collapseBtn255')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn255" onclick="toggleCodeBlock('cloneGroup255', 'expandBtn255', 'collapseBtn255')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup255"><code class="language-typescript text-sm text-gray-800">,
          description: 'Extracted from text',
          properties: { extractedFrom: 'text' },
          confidence: 0.8,
          source: 'text_extraction',
          verified: false,
          createdBy: user,
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString(),
        });
      });

      return</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/graphragQueryResolvers.ts (Line 160:12 - Line 174:16), server/src/graphql/resolvers/graphragQueryResolvers.ts (Line 127:13 - Line 141:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn256" onclick="toggleCodeBlock('cloneGroup256', 'expandBtn256', 'collapseBtn256')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn256" onclick="toggleCodeBlock('cloneGroup256', 'expandBtn256', 'collapseBtn256')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup256"><code class="language-typescript text-sm text-gray-800">: async (
      _parent: unknown,
      args: { id: string },
      context: Context
    ) =&gt; {
      const { userId } = context;

      if (!userId) {
        throw new GraphQLError('Authentication required', {
          extensions: { code: 'UNAUTHENTICATED' },
        });
      }

      try {
        const { glassBoxService</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/graphragQueryResolvers.ts (Line 240:2 - Line 253:8), server/src/graphql/resolvers/graphragQueryResolvers.ts (Line 200:7 - Line 213:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn257" onclick="toggleCodeBlock('cloneGroup257', 'expandBtn257', 'collapseBtn257')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn257" onclick="toggleCodeBlock('cloneGroup257', 'expandBtn257', 'collapseBtn257')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup257"><code class="language-typescript text-sm text-gray-800">},
      context: Context
    ) =&gt; {
      const { userId } = context;

      if (!userId) {
        throw new GraphQLError('Authentication required', {
          extensions: { code: 'UNAUTHENTICATED' },
        });
      }

      try {
        const { graphRAGQueryService } = createServices(context);
        const history</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/graphragQueryResolvers.ts (Line 328:7 - Line 342:12), server/src/graphql/resolvers/graphragQueryResolvers.ts (Line 129:2 - Line 142:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn258" onclick="toggleCodeBlock('cloneGroup258', 'expandBtn258', 'collapseBtn258')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn258" onclick="toggleCodeBlock('cloneGroup258', 'expandBtn258', 'collapseBtn258')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup258"><code class="language-typescript text-sm text-gray-800">},
      context: Context
    ) =&gt; {
      const { userId } = context;

      if (!userId) {
        throw new GraphQLError('Authentication required', {
          extensions: { code: 'UNAUTHENTICATED' },
        });
      }

      try {
        const { queryPreviewService } = createServices(context);

        const preview = await queryPreviewService.editPreview</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/graphragQueryResolvers.ts (Line 376:2 - Line 391:9), server/src/graphql/resolvers/graphragQueryResolvers.ts (Line 199:7 - Line 213:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn259" onclick="toggleCodeBlock('cloneGroup259', 'expandBtn259', 'collapseBtn259')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn259" onclick="toggleCodeBlock('cloneGroup259', 'expandBtn259', 'collapseBtn259')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup259"><code class="language-typescript text-sm text-gray-800">;
      },
      context: Context
    ) =&gt; {
      const { userId } = context;

      if (!userId) {
        throw new GraphQLError('Authentication required', {
          extensions: { code: 'UNAUTHENTICATED' },
        });
      }

      try {
        const { graphRAGQueryService } = createServices(context);

        const response</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/graphragQueryResolvers.ts (Line 426:8 - Line 442:10), server/src/graphql/resolvers/graphragQueryResolvers.ts (Line 375:7 - Line 391:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn260" onclick="toggleCodeBlock('cloneGroup260', 'expandBtn260', 'collapseBtn260')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn260" onclick="toggleCodeBlock('cloneGroup260', 'expandBtn260', 'collapseBtn260')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup260"><code class="language-typescript text-sm text-gray-800">;
        };
      },
      context: Context
    ) =&gt; {
      const { userId } = context;

      if (!userId) {
        throw new GraphQLError('Authentication required', {
          extensions: { code: 'UNAUTHENTICATED' },
        });
      }

      try {
        const { graphRAGQueryService } = createServices(context);

        const response = await graphRAGQueryService.replayRun</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/entity.ts (Line 294:13 - Line 311:59), server/src/graphql/resolvers/relationship.ts (Line 68:19 - Line 85:72)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn268" onclick="toggleCodeBlock('cloneGroup268', 'expandBtn268', 'collapseBtn268')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn268" onclick="toggleCodeBlock('cloneGroup268', 'expandBtn268', 'collapseBtn268')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup268"><code class="language-typescript text-sm text-gray-800">: async (
      _: any,
      {
        id,
        input,
        lastSeenTimestamp,
      }: {
        id: string;
        input: { type?: string; props?: any };
        lastSeenTimestamp: string;
      },
      context: any,
    ) =&gt; {
      const session = driver.session();
      try {
        const tenantId = requireTenant(context);
        const existing = await session.run(
          'MATCH (n:Entity {id: $id, tenantId: $tenantId}) RETURN n'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/docling.ts (Line 134:9 - Line 156:21), server/src/graphql/resolvers/docling.ts (Line 95:9 - Line 117:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn269" onclick="toggleCodeBlock('cloneGroup269', 'expandBtn269', 'collapseBtn269')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn269" onclick="toggleCodeBlock('cloneGroup269', 'expandBtn269', 'collapseBtn269')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup269"><code class="language-typescript text-sm text-gray-800">findings: result.findings.map((finding) =&gt; ({
          id: finding.id,
          label: finding.label,
          value: finding.value,
          confidence: finding.confidence,
          severity: finding.severity,
          fragmentId: finding.fragmentId,
          qualitySignals: finding.metadata || finding.qualitySignals,
        })),
        policySignals: result.policySignals.map((signal) =&gt; ({
          id: signal.id,
          classification: signal.classification,
          value: signal.value,
          purpose: signal.purpose,
          retention: signal.retention === 'short' ? 'SHORT' : 'STANDARD',
          fragmentId: signal.fragmentId,
          qualitySignals:
            signal.metadata?.qualitySignals || signal.qualitySignals,
        })),
      };
    },

    async generateReleaseNotes</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers/core.ts (Line 331:7 - Line 342:17), server/src/graphql/resolvers/core.ts (Line 287:2 - Line 298:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn270" onclick="toggleCodeBlock('cloneGroup270', 'expandBtn270', 'collapseBtn270')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn270" onclick="toggleCodeBlock('cloneGroup270', 'expandBtn270', 'collapseBtn270')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup270"><code class="language-typescript text-sm text-gray-800">});
      const userId = context.user?.sub || context.user?.id || 'system';

      // Add investigation context to props if provided
      if (parsed.investigationId) {
        parsed.props = {
          ...parsed.props,
          investigationId: parsed.investigationId,
        };
      }

      return await relationshipRepo</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/intelgraph/resolvers.ts (Line 303:10 - Line 316:12), server/src/graphql/intelgraph/resolvers.ts (Line 225:2 - Line 238:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn271" onclick="toggleCodeBlock('cloneGroup271', 'expandBtn271', 'collapseBtn271')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn271" onclick="toggleCodeBlock('cloneGroup271', 'expandBtn271', 'collapseBtn271')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup271"><code class="language-typescript text-sm text-gray-800">;
        } finally {
          await session.close();
        }
      } catch (error) {
        span.recordException(error as Error);
        span.setStatus({ code: 2, message: (error as Error).message });
        throw error;
      } finally {
        span.end();
      }
    },

    async entityGraph</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/intelgraph/resolvers.ts (Line 413:2 - Line 427:7), server/src/graphql/intelgraph/resolvers.ts (Line 224:5 - Line 238:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn272" onclick="toggleCodeBlock('cloneGroup272', 'expandBtn272', 'collapseBtn272')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn272" onclick="toggleCodeBlock('cloneGroup272', 'expandBtn272', 'collapseBtn272')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup272"><code class="language-typescript text-sm text-gray-800">,
          };
        } finally {
          await session.close();
        }
      } catch (error) {
        span.recordException(error as Error);
        span.setStatus({ code: 2, message: (error as Error).message });
        throw error;
      } finally {
        span.end();
      }
    },

    async health</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/directives/budgetDirective.ts (Line 250:2 - Line 264:10), server/src/graphql/directives/budgetDirective.ts (Line 222:13 - Line 236:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn273" onclick="toggleCodeBlock('cloneGroup273', 'expandBtn273', 'collapseBtn273')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn273" onclick="toggleCodeBlock('cloneGroup273', 'expandBtn273', 'collapseBtn273')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup273"><code class="language-typescript text-sm text-gray-800">}`,
                    {
                      estimated: {
                        tokens: estimation.totalTokens,
                        usd: estimation.totalUSD,
                      },
                      limits: { capUSD, tokenCeiling },
                      provider: estimation.provider,
                      model: estimation.model,
                    },
                  );

                  span.setAttributes({
                    'budget.denied': true,
                    'budget.denial_reason': 'cap_usd'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/__tests__/postgres.test.ts (Line 236:50 - Line 246:14), server/src/db/__tests__/postgres.test.ts (Line 221:49 - Line 231:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn274" onclick="toggleCodeBlock('cloneGroup274', 'expandBtn274', 'collapseBtn274')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn274" onclick="toggleCodeBlock('cloneGroup274', 'expandBtn274', 'collapseBtn274')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup274"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const breaker = new __private.CircuitBreaker('test-pool', 2, 100);

      breaker.recordFailure(new Error('Failure 1'));
      breaker.recordFailure(new Error('Failure 2'));
      expect(breaker.getState()).toBe('open');

      await new Promise((resolve) =&gt; setTimeout(resolve, 150));
      expect(breaker.getState()).toBe('half-open');

      breaker.recordFailure</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/security/opa-client.ts (Line 114:5 - Line 127:18), server/src/conductor/security/opa-client.ts (Line 87:2 - Line 100:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn275" onclick="toggleCodeBlock('cloneGroup275', 'expandBtn275', 'collapseBtn275')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn275" onclick="toggleCodeBlock('cloneGroup275', 'expandBtn275', 'collapseBtn275')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup275"><code class="language-typescript text-sm text-gray-800">: string,
  ): Promise&lt;OPAResult&gt; {
    const input: OPAInput = {
      user: {
        id: context.userId,
        roles: context.roles,
        permissions: context.permissions,
        clearance_level: context.clearanceLevel,
        budget_remaining: context.budgetRemaining,
        rate_limit: context.rateLimit,
        requests_last_hour: context.requestsLastHour,
        location: context.location,
      },
      action: 'preview_routing'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/security/opa-client.ts (Line 281:2 - Line 293:2), server/src/conductor/security/opa-client.ts (Line 88:10 - Line 100:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn276" onclick="toggleCodeBlock('cloneGroup276', 'expandBtn276', 'collapseBtn276')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn276" onclick="toggleCodeBlock('cloneGroup276', 'expandBtn276', 'collapseBtn276')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup276"><code class="language-typescript text-sm text-gray-800">&gt; {
  const input: OPAInput = {
    user: {
      id: context.userId,
      roles: context.roles,
      permissions: context.permissions,
      clearance_level: context.clearanceLevel,
      budget_remaining: context.budgetRemaining,
      rate_limit: context.rateLimit,
      requests_last_hour: context.requestsLastHour,
      location: context.location,
    },
    action,</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/runbooks/runbook-examples.ts (Line 206:12 - Line 231:7), server/src/conductor/runbooks/runbook-examples.ts (Line 41:2 - Line 66:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn277" onclick="toggleCodeBlock('cloneGroup277', 'expandBtn277', 'collapseBtn277')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn277" onclick="toggleCodeBlock('cloneGroup277', 'expandBtn277', 'collapseBtn277')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup277"><code class="language-typescript text-sm text-gray-800">,
    },
  });

  console.log('Execution Result:');
  console.log(`  Success: ${result.success}`);
  console.log(`  Duration: ${result.totalDuration}ms (Benchmark: ${dag.benchmarks.total}ms)`);
  console.log(`  Within Benchmark: ${result.benchmarkComparison.withinBenchmark}`);
  console.log(`  Evidence Count: ${result.evidence.length}`);
  console.log(`  Citation Count: ${result.citations.length}`);
  console.log(`  Proof Count: ${result.proofs.length}`);
  console.log(`  Publication Allowed: ${result.publicationAllowed}`);

  if (!result.publicationAllowed) {
    console.log('  Publication Blocked Reasons:');
    result.publicationBlockReasons.forEach((reason) =&gt; {
      console.log(`    - ${reason}`);
    });
  }

  console.log('\nKPIs:');
  Object.entries(result.kpis).forEach(([key, value]) =&gt; {
    console.log(`  ${key}: ${value}`);
  });

  return</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/runbooks/runbook-examples.ts (Line 266:14 - Line 296:4), server/src/conductor/runbooks/runbook-examples.ts (Line 41:2 - Line 236:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn278" onclick="toggleCodeBlock('cloneGroup278', 'expandBtn278', 'collapseBtn278')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn278" onclick="toggleCodeBlock('cloneGroup278', 'expandBtn278', 'collapseBtn278')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup278"><code class="language-typescript text-sm text-gray-800">,
    },
  });

  console.log('Execution Result:');
  console.log(`  Success: ${result.success}`);
  console.log(`  Duration: ${result.totalDuration}ms (Benchmark: ${dag.benchmarks.total}ms)`);
  console.log(`  Within Benchmark: ${result.benchmarkComparison.withinBenchmark}`);
  console.log(`  Evidence Count: ${result.evidence.length}`);
  console.log(`  Citation Count: ${result.citations.length}`);
  console.log(`  Proof Count: ${result.proofs.length}`);
  console.log(`  Publication Allowed: ${result.publicationAllowed}`);

  if (!result.publicationAllowed) {
    console.log('  Publication Blocked Reasons:');
    result.publicationBlockReasons.forEach((reason) =&gt; {
      console.log(`    - ${reason}`);
    });
  }

  console.log('\nKPIs:');
  Object.entries(result.kpis).forEach(([key, value]) =&gt; {
    console.log(`  ${key}: ${value}`);
  });

  return result;
}

/**
 * Run all examples
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/runbooks/runbook-dags.test.ts (Line 65:29 - Line 79:2), server/src/conductor/runbooks/runbook-dags.test.ts (Line 20:47 - Line 34:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn279" onclick="toggleCodeBlock('cloneGroup279', 'expandBtn279', 'collapseBtn279')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn279" onclick="toggleCodeBlock('cloneGroup279', 'expandBtn279', 'collapseBtn279')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup279"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const dag = createR1RapidAttributionRunbook();
      const executor = new DAGExecutor();

      const result = await executor.execute(dag, {
        tenantId: 'test-tenant',
        userId: 'test-analyst',
        legalBasis: LegalBasis.LEGITIMATE_INTERESTS,
        dataLicenses: [DataLicense.INTERNAL_USE_ONLY],
        inputData: {
          incidentData: {
            id: 'test-incident',
            reportUrl: 'https://example.com/incident',
            analyst: 'Test Analyst',
            ips: ['192.168.1.1']</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/runbooks/runbook-api.ts (Line 462:23 - Line 479:62), server/src/conductor/runbooks/runbook-api.ts (Line 129:14 - Line 146:37)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn280" onclick="toggleCodeBlock('cloneGroup280', 'expandBtn280', 'collapseBtn280')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn280" onclick="toggleCodeBlock('cloneGroup280', 'expandBtn280', 'collapseBtn280')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup280"><code class="language-typescript text-sm text-gray-800">, async (req, res) =&gt; {
  try {
    const { runbookId } = req.params;
    const { version } = req.query;

    const runbook = await runbookRegistry.getRunbook(
      runbookId,
      version as string,
    );

    if (!runbook) {
      return res.status(404).json({
        success: false,
        message: 'Runbook not found',
      });
    }

    // Signature verification is done automatically in getRunbook</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/runbooks/key-hygiene.ts (Line 607:7 - Line 628:22), server/src/conductor/runbooks/key-hygiene.ts (Line 576:8 - Line 597:27)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn281" onclick="toggleCodeBlock('cloneGroup281', 'expandBtn281', 'collapseBtn281')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn281" onclick="toggleCodeBlock('cloneGroup281', 'expandBtn281', 'collapseBtn281')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup281"><code class="language-typescript text-sm text-gray-800">);

      if (result.rows.length === 0) return null;

      const row = result.rows[0];
      return {
        keyId: row.key_id,
        publicKey: row.public_key,
        privateKey: row.private_key_encrypted,
        fingerprint: row.fingerprint,
        algorithm: row.algorithm,
        status: row.status,
        createdAt: row.created_at,
        expiresAt: row.expires_at,
        rotationDue: row.rotation_due,
      };
    } finally {
      client.release();
    }
  }

  private async storeRunbookSignature</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/observability/index.ts (Line 187:5 - Line 200:4), server/src/conductor/observability/index.ts (Line 139:5 - Line 152:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn282" onclick="toggleCodeBlock('cloneGroup282', 'expandBtn282', 'collapseBtn282')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn282" onclick="toggleCodeBlock('cloneGroup282', 'expandBtn282', 'collapseBtn282')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup282"><code class="language-typescript text-sm text-gray-800">if (error) {
      span.recordException(error);
      span.setStatus({ code: SpanStatusCode.ERROR, message: error.message });
    } else {
      span.setStatus({ code: SpanStatusCode.OK });
    }
  } finally {
    span.end();
  }
}

/**
 * Record MCP operation with tracing and metrics
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/observability/index.ts (Line 225:10 - Line 241:4), server/src/conductor/observability/index.ts (Line 136:11 - Line 152:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn283" onclick="toggleCodeBlock('cloneGroup283', 'expandBtn283', 'collapseBtn283')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn283" onclick="toggleCodeBlock('cloneGroup283', 'expandBtn283', 'collapseBtn283')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup283"><code class="language-typescript text-sm text-gray-800">,
    });

    if (error) {
      span.recordException(error);
      span.setStatus({ code: SpanStatusCode.ERROR, message: error.message });
    } else {
      span.setStatus({ code: SpanStatusCode.OK });
    }
  } finally {
    span.end();
  }
}

/**
 * Record security event with telemetry
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/observability/index.ts (Line 259:3 - Line 275:4), server/src/conductor/observability/index.ts (Line 136:11 - Line 152:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn284" onclick="toggleCodeBlock('cloneGroup284', 'expandBtn284', 'collapseBtn284')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn284" onclick="toggleCodeBlock('cloneGroup284', 'expandBtn284', 'collapseBtn284')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup284"><code class="language-typescript text-sm text-gray-800">,
    });

    if (error) {
      span.recordException(error);
      span.setStatus({ code: SpanStatusCode.ERROR, message: error.message });
    } else {
      span.setStatus({ code: SpanStatusCode.OK });
    }
  } finally {
    span.end();
  }
}

/**
 * Instrumented wrapper for async operations
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/learn/reward-api.ts (Line 382:22 - Line 401:4), server/src/conductor/scheduling/scheduler-api.ts (Line 266:11 - Line 285:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn285" onclick="toggleCodeBlock('cloneGroup285', 'expandBtn285', 'collapseBtn285')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn285" onclick="toggleCodeBlock('cloneGroup285', 'expandBtn285', 'collapseBtn285')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup285"><code class="language-typescript text-sm text-gray-800">();

    res.json({
      success: true,
      metrics,
      timestamp: Date.now(),
    });
  } catch (error) {
    console.error('Metrics retrieval error:', error);

    res.status(500).json({
      success: false,
      message: 'Failed to retrieve metrics',
    });
  }
});

/**
 * Get arm statistics
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/edge/verifiable-sync-log.ts (Line 646:2 - Line 657:2), server/src/conductor/edge/verifiable-sync-log.ts (Line 408:2 - Line 419:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn286" onclick="toggleCodeBlock('cloneGroup286', 'expandBtn286', 'collapseBtn286')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn286" onclick="toggleCodeBlock('cloneGroup286', 'expandBtn286', 'collapseBtn286')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup286"><code class="language-typescript text-sm text-gray-800">{
      entryId: row.entry_id,
      nodeId: row.node_id,
      timestamp: row.timestamp,
      sequenceNumber: row.sequence_number,
      operation: row.operation,
      previousHash: row.previous_hash,
      merkleRoot: row.merkle_root,
      signature: row.signature,
      tsaTimestamp: row.tsa_timestamp,
      metadata: row.metadata,
    };</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/edge/proof-carrying-results.ts (Line 638:2 - Line 649:2), server/src/conductor/edge/proof-carrying-results.ts (Line 611:2 - Line 622:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn287" onclick="toggleCodeBlock('cloneGroup287', 'expandBtn287', 'collapseBtn287')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn287" onclick="toggleCodeBlock('cloneGroup287', 'expandBtn287', 'collapseBtn287')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup287"><code class="language-typescript text-sm text-gray-800">{
      resultId: row.result_id,
      sessionId: row.session_id,
      nodeId: row.node_id,
      computationType: row.computation_type,
      inputs: row.inputs,
      outputs: row.outputs,
      proof: row.proof,
      attestation: row.attestation,
      timestamp: row.timestamp,
      metadata: row.metadata,
    })</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/edge/conflict-ui-controller.ts (Line 264:13 - Line 275:15), server/src/conductor/edge/conflict-ui-controller.ts (Line 121:7 - Line 132:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn288" onclick="toggleCodeBlock('cloneGroup288', 'expandBtn288', 'collapseBtn288')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn288" onclick="toggleCodeBlock('cloneGroup288', 'expandBtn288', 'collapseBtn288')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup288"><code class="language-typescript text-sm text-gray-800">const allFieldConflicts = [];
            for (const conflict of activeConflicts) {
              const conflictData = JSON.parse(conflict.conflicts);
              allFieldConflicts.push(...conflictData);
            }

            const resolutions = await this.conflictResolver.resolveConflicts(
              entityId,
              tenantId,
              allFieldConflicts,
              {
                userId: (req.headers['x-user-id'] as string) || 'batch-system'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/edge/claim-sync.ts (Line 67:2 - Line 78:6), server/src/conductor/edge/proof-carrying-results.ts (Line 107:2 - Line 118:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn289" onclick="toggleCodeBlock('cloneGroup289', 'expandBtn289', 'collapseBtn289')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn289" onclick="toggleCodeBlock('cloneGroup289', 'expandBtn289', 'collapseBtn289')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup289"><code class="language-typescript text-sm text-gray-800">{
  private redis: Redis;
  private pool: Pool;

  constructor() {
    this.redis = new Redis(process.env.REDIS_URL || 'redis://localhost:6379');
    this.pool = new Pool({ connectionString: process.env.DATABASE_URL });
  }

  /**
   * Convert CRDT operation to claims
   */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/compliance/compliance-api.ts (Line 544:11 - Line 557:6), server/src/conductor/compliance/compliance-api.ts (Line 165:13 - Line 178:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn290" onclick="toggleCodeBlock('cloneGroup290', 'expandBtn290', 'collapseBtn290')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn290" onclick="toggleCodeBlock('cloneGroup290', 'expandBtn290', 'collapseBtn290')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup290"><code class="language-typescript text-sm text-gray-800">, async (req, res) =&gt; {
  try {
    const tenantId = req.headers['x-tenant-id'] as string;

    if (!tenantId) {
      return res.status(400).json({
        success: false,
        message: 'Tenant ID is required',
      });
    }

    const dashboard = await complianceEngine.getComplianceDashboard(tenantId);

    const</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/compliance/compliance-api.ts (Line 578:2 - Line 590:40), server/src/conductor/scheduling/scheduler-api.ts (Line 266:2 - Line 278:29)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn291" onclick="toggleCodeBlock('cloneGroup291', 'expandBtn291', 'collapseBtn291')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn291" onclick="toggleCodeBlock('cloneGroup291', 'expandBtn291', 'collapseBtn291')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup291"><code class="language-typescript text-sm text-gray-800">;

    res.json({
      success: true,
      metrics,
      timestamp: Date.now(),
    });
  } catch (error) {
    console.error('Metrics retrieval error:', error);

    res.status(500).json({
      success: false,
      message: 'Failed to retrieve compliance metrics'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/audit/chain-verifier.ts (Line 242:5 - Line 254:14), server/src/conductor/audit/chain-verifier.ts (Line 210:5 - Line 222:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn292" onclick="toggleCodeBlock('cloneGroup292', 'expandBtn292', 'collapseBtn292')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn292" onclick="toggleCodeBlock('cloneGroup292', 'expandBtn292', 'collapseBtn292')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup292"><code class="language-typescript text-sm text-gray-800">const recordHashes = records.map((r) =&gt; this.hashAuditRecord(r));
    const chainHashes = chains.map((c) =&gt; c!.currentHash);

    const proofData = {
      fromRecord: fromRecordId,
      toRecord: toRecordId,
      recordCount: records.length,
      recordHashes,
      chainHashes,
      timestamp: Date.now(),
    };

    const expectedProof</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/api/agent-routes.ts (Line 278:2 - Line 298:15), server/src/conductor/api/agent-routes.ts (Line 198:2 - Line 217:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn293" onclick="toggleCodeBlock('cloneGroup293', 'expandBtn293', 'collapseBtn293')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn293" onclick="toggleCodeBlock('cloneGroup293', 'expandBtn293', 'collapseBtn293')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup293"><code class="language-typescript text-sm text-gray-800">reason } = req.body;

    const steps = agentSteps.get(runId) || [];
    const stepIndex = steps.findIndex(
      (s) =&gt;
        s.id === checkpointId ||
        hitlCheckpoints.get(runId)?.find((c) =&gt; c.id === checkpointId)
          ?.stepId === s.id,
    );

    if (stepIndex === -1) {
      return res.status(404).json({
        error: 'Step not found',
        code: 'STEP_NOT_FOUND',
        checkpointId,
      });
    }

    const step = steps[stepIndex];

    // Update step</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/api/agent-routes.ts (Line 355:5 - Line 374:25), server/src/conductor/api/agent-routes.ts (Line 200:5 - Line 219:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn294" onclick="toggleCodeBlock('cloneGroup294', 'expandBtn294', 'collapseBtn294')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn294" onclick="toggleCodeBlock('cloneGroup294', 'expandBtn294', 'collapseBtn294')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup294"><code class="language-typescript text-sm text-gray-800">const steps = agentSteps.get(runId) || [];
    const stepIndex = steps.findIndex(
      (s) =&gt;
        s.id === checkpointId ||
        hitlCheckpoints.get(runId)?.find((c) =&gt; c.id === checkpointId)
          ?.stepId === s.id,
    );

    if (stepIndex === -1) {
      return res.status(404).json({
        error: 'Step not found',
        code: 'STEP_NOT_FOUND',
        checkpointId,
      });
    }

    const step = steps[stepIndex];
    const originalText = step.text;

    // Update step with edit</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/admission/budget-ladder.ts (Line 57:2 - Line 72:6), server/src/conductor/edge/crdt-conflict-resolver.ts (Line 57:2 - Line 72:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn295" onclick="toggleCodeBlock('cloneGroup295', 'expandBtn295', 'collapseBtn295')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn295" onclick="toggleCodeBlock('cloneGroup295', 'expandBtn295', 'collapseBtn295')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup295"><code class="language-typescript text-sm text-gray-800">{
  private pool: Pool;
  private redis: Redis;

  constructor() {
    this.pool = new Pool({ connectionString: process.env.DATABASE_URL });
    this.redis = new Redis(process.env.REDIS_URL);
  }

  async connect(): Promise&lt;void&gt; {
    await this.redis.connect();
  }

  /**
   * Evaluate budget for incoming task request
   */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/coherence/intelligence/narrativeImpactModel.ts (Line 751:5 - Line 765:12), server/src/coherence/intelligence/narrativeImpactModel.ts (Line 549:10 - Line 563:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn296" onclick="toggleCodeBlock('cloneGroup296', 'expandBtn296', 'collapseBtn296')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn296" onclick="toggleCodeBlock('cloneGroup296', 'expandBtn296', 'collapseBtn296')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup296"><code class="language-typescript text-sm text-gray-800">;

    const start = new Date(
      signals.reduce(
        (earliest, s) =&gt; (s.ts &lt; earliest ? s.ts : earliest),
        signals[0].ts,
      ),
    );
    const end = new Date(
      signals.reduce(
        (latest, s) =&gt; (s.ts &gt; latest ? s.ts : latest),
        signals[0].ts,
      ),
    );
    const diffMinutes</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/coherence/intelligence/activityFingerprintIndex.ts (Line 362:15 - Line 376:22), server/src/coherence/intelligence/activityFingerprintIndex.ts (Line 264:7 - Line 278:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn297" onclick="toggleCodeBlock('cloneGroup297', 'expandBtn297', 'collapseBtn297')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn297" onclick="toggleCodeBlock('cloneGroup297', 'expandBtn297', 'collapseBtn297')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup297"><code class="language-typescript text-sm text-gray-800">.records.map((record) =&gt; {
        const fp = record.get('af');
        return {
          id: fp.fingerprint_id,
          tenantId: fp.tenant_id,
          type: fp.type,
          pattern: fp.pattern,
          confidence: fp.confidence,
          metadata: fp.metadata || {},
          firstSeen: fp.first_seen,
          lastSeen: fp.last_seen,
          frequency: fp.frequency,
          significance: fp.significance,
          relatedEntities: fp.relatedEntities || [],
          behavioralSignatures: fp.behavioral_signatures</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/coherence/intelligence/activityFingerprintIndex.ts (Line 740:2 - Line 750:12), server/src/coherence/intelligence/activityFingerprintIndex.ts (Line 700:2 - Line 710:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn298" onclick="toggleCodeBlock('cloneGroup298', 'expandBtn298', 'collapseBtn298')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn298" onclick="toggleCodeBlock('cloneGroup298', 'expandBtn298', 'collapseBtn298')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup298"><code class="language-typescript text-sm text-gray-800">) return 0;

    const intervals = [];
    for (let i = 1; i &lt; signals.length; i++) {
      const interval =
        new Date(signals[i].ts).getTime() -
        new Date(signals[i - 1].ts).getTime();
      intervals.push(interval);
    }

    const avgInterval</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/services/EmbeddingService.ts (Line 557:6 - Line 588:26), server/src/ai/services/EmbeddingService.ts (Line 502:7 - Line 533:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn299" onclick="toggleCodeBlock('cloneGroup299', 'expandBtn299', 'collapseBtn299')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn299" onclick="toggleCodeBlock('cloneGroup299', 'expandBtn299', 'collapseBtn299')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup299"><code class="language-typescript text-sm text-gray-800">];

      if (normalize) {
        args.push('--normalize');
      }

      if (this.config.enableGPU) {
        args.push('--device', 'cuda');
      }

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code === 0) {
          try {
            const result = JSON.parse(output);
            resolve(result.embedding || []);
          } catch (parseError) {
            reject(parseError);
          }
        } else {
          reject(new Error(`Image embedding failed: </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/services/EmbeddingService.ts (Line 612:10 - Line 643:26), server/src/ai/services/EmbeddingService.ts (Line 557:10 - Line 533:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn300" onclick="toggleCodeBlock('cloneGroup300', 'expandBtn300', 'collapseBtn300')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn300" onclick="toggleCodeBlock('cloneGroup300', 'expandBtn300', 'collapseBtn300')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup300"><code class="language-typescript text-sm text-gray-800">, '--model', model];

      if (normalize) {
        args.push('--normalize');
      }

      if (this.config.enableGPU) {
        args.push('--device', 'cuda');
      }

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code === 0) {
          try {
            const result = JSON.parse(output);
            resolve(result.embedding || []);
          } catch (parseError) {
            reject(parseError);
          }
        } else {
          reject(new Error(`Audio embedding failed: </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/services/EmbeddingService.ts (Line 756:7 - Line 772:9), server/src/ai/services/EmbeddingService.ts (Line 512:7 - Line 528:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn301" onclick="toggleCodeBlock('cloneGroup301', 'expandBtn301', 'collapseBtn301')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn301" onclick="toggleCodeBlock('cloneGroup301', 'expandBtn301', 'collapseBtn301')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup301"><code class="language-typescript text-sm text-gray-800">const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code === 0) {
          try {
            const result = JSON.parse(output);
            resolve(result.clusters</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/VideoFrameExtractor.ts (Line 152:2 - Line 162:8), server/src/ai/engines/VideoFrameExtractor.ts (Line 71:2 - Line 81:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn304" onclick="toggleCodeBlock('cloneGroup304', 'expandBtn304', 'collapseBtn304')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn304" onclick="toggleCodeBlock('cloneGroup304', 'expandBtn304', 'collapseBtn304')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup304"><code class="language-typescript text-sm text-gray-800">(resolve, reject) =&gt; {
      const command = ffmpeg(videoPath);

      if (startTime !== undefined) {
        command.seekInput(startTime);
      }
      if (endTime !== undefined) {
        command.duration(endTime - (startTime || 0));
      }

      command</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/TextAnalysisEngine.ts (Line 263:7 - Line 281:2), server/src/ai/services/EmbeddingService.ts (Line 754:7 - Line 528:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn305" onclick="toggleCodeBlock('cloneGroup305', 'expandBtn305', 'collapseBtn305')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn305" onclick="toggleCodeBlock('cloneGroup305', 'expandBtn305', 'collapseBtn305')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup305"><code class="language-typescript text-sm text-gray-800">];

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code === 0) {
          try {
            const result = JSON.parse(output);
            resolve({</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/TextAnalysisEngine.ts (Line 320:2 - Line 339:6), server/src/ai/services/EmbeddingService.ts (Line 753:10 - Line 528:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn306" onclick="toggleCodeBlock('cloneGroup306', 'expandBtn306', 'collapseBtn306')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn306" onclick="toggleCodeBlock('cloneGroup306', 'expandBtn306', 'collapseBtn306')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup306"><code class="language-typescript text-sm text-gray-800">,
      ];

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code === 0) {
          try {
            const result = JSON.parse(output);
            const</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/TextAnalysisEngine.ts (Line 374:19 - Line 394:6), server/src/ai/services/EmbeddingService.ts (Line 753:10 - Line 282:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn307" onclick="toggleCodeBlock('cloneGroup307', 'expandBtn307', 'collapseBtn307')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn307" onclick="toggleCodeBlock('cloneGroup307', 'expandBtn307', 'collapseBtn307')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup307"><code class="language-typescript text-sm text-gray-800">,
      ];

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code === 0) {
          try {
            const result = JSON.parse(output);
            resolve({
              label</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/TextAnalysisEngine.ts (Line 435:6 - Line 454:7), server/src/ai/services/EmbeddingService.ts (Line 753:10 - Line 339:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn308" onclick="toggleCodeBlock('cloneGroup308', 'expandBtn308', 'collapseBtn308')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn308" onclick="toggleCodeBlock('cloneGroup308', 'expandBtn308', 'collapseBtn308')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup308"><code class="language-typescript text-sm text-gray-800">,
      ];

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code === 0) {
          try {
            const result = JSON.parse(output);
            const topics</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/TextAnalysisEngine.ts (Line 491:11 - Line 510:11), server/src/ai/services/EmbeddingService.ts (Line 753:10 - Line 339:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn309" onclick="toggleCodeBlock('cloneGroup309', 'expandBtn309', 'collapseBtn309')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn309" onclick="toggleCodeBlock('cloneGroup309', 'expandBtn309', 'collapseBtn309')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup309"><code class="language-typescript text-sm text-gray-800">,
      ];

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code === 0) {
          try {
            const result = JSON.parse(output);
            const keyPhrases</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/TextAnalysisEngine.ts (Line 551:23 - Line 571:11), server/src/ai/services/EmbeddingService.ts (Line 753:10 - Line 282:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn310" onclick="toggleCodeBlock('cloneGroup310', 'expandBtn310', 'collapseBtn310')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn310" onclick="toggleCodeBlock('cloneGroup310', 'expandBtn310', 'collapseBtn310')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup310"><code class="language-typescript text-sm text-gray-800">,
      ];

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code === 0) {
          try {
            const result = JSON.parse(output);
            resolve({
              extractive</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/TextAnalysisEngine.ts (Line 604:9 - Line 622:11), server/src/ai/services/EmbeddingService.ts (Line 754:7 - Line 528:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn311" onclick="toggleCodeBlock('cloneGroup311', 'expandBtn311', 'collapseBtn311')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn311" onclick="toggleCodeBlock('cloneGroup311', 'expandBtn311', 'collapseBtn311')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup311"><code class="language-typescript text-sm text-gray-800">];

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code === 0) {
          try {
            const result = JSON.parse(output);
            resolve(result.intentions</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/SpeechToTextEngine.ts (Line 250:23 - Line 270:4), server/src/ai/services/EmbeddingService.ts (Line 505:14 - Line 525:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn312" onclick="toggleCodeBlock('cloneGroup312', 'expandBtn312', 'collapseBtn312')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn312" onclick="toggleCodeBlock('cloneGroup312', 'expandBtn312', 'collapseBtn312')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup312"><code class="language-typescript text-sm text-gray-800">);
      }

      if (this.config.enableGPU) {
        args.push('--device', 'cuda');
      }

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code !==</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/SpeechToTextEngine.ts (Line 402:2 - Line 419:30), server/src/ai/engines/TextAnalysisEngine.ts (Line 320:6 - Line 273:41)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn313" onclick="toggleCodeBlock('cloneGroup313', 'expandBtn313', 'collapseBtn313')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn313" onclick="toggleCodeBlock('cloneGroup313', 'expandBtn313', 'collapseBtn313')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup313"><code class="language-typescript text-sm text-gray-800">),
      ];

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code !== 0) {
          reject(new Error(`Speaker diarization failed: </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/SpeechToTextEngine.ts (Line 547:10 - Line 565:2), server/src/ai/services/EmbeddingService.ts (Line 754:7 - Line 528:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn314" onclick="toggleCodeBlock('cloneGroup314', 'expandBtn314', 'collapseBtn314')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn314" onclick="toggleCodeBlock('cloneGroup314', 'expandBtn314', 'collapseBtn314')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup314"><code class="language-typescript text-sm text-gray-800">];

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code === 0) {
          try {
            const result = JSON.parse(output);
            resolve(result)</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/ObjectDetectionEngine.ts (Line 223:2 - Line 246:36), server/src/ai/services/EmbeddingService.ts (Line 505:14 - Line 273:41)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn315" onclick="toggleCodeBlock('cloneGroup315', 'expandBtn315', 'collapseBtn315')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn315" onclick="toggleCodeBlock('cloneGroup315', 'expandBtn315', 'collapseBtn315')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup315"><code class="language-typescript text-sm text-gray-800">);
      }

      if (this.config.enableGPU) {
        args.push('--device', 'cuda');
      }

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code !== 0) {
          reject(
            new Error(
              `Object detection failed with code </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/ObjectDetectionEngine.ts (Line 309:2 - Line 332:42), server/src/ai/engines/ObjectDetectionEngine.ts (Line 223:4 - Line 273:41)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn316" onclick="toggleCodeBlock('cloneGroup316', 'expandBtn316', 'collapseBtn316')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn316" onclick="toggleCodeBlock('cloneGroup316', 'expandBtn316', 'collapseBtn316')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup316"><code class="language-typescript text-sm text-gray-800">));
      }

      if (this.config.enableGPU) {
        args.push('--device', 'cuda');
      }

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code !== 0) {
          reject(
            new Error(
              `Video object detection failed with code </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/ObjectDetectionEngine.ts (Line 452:2 - Line 469:29), server/src/ai/services/EmbeddingService.ts (Line 753:10 - Line 273:41)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn317" onclick="toggleCodeBlock('cloneGroup317', 'expandBtn317', 'collapseBtn317')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn317" onclick="toggleCodeBlock('cloneGroup317', 'expandBtn317', 'collapseBtn317')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup317"><code class="language-typescript text-sm text-gray-800">,
      ];

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code !== 0) {
          reject(new Error(`Feature extraction failed: </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/ObjectDetectionEngine.ts (Line 684:85 - Line 702:10), server/src/ai/engines/SpeechToTextEngine.ts (Line 684:78 - Line 702:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn318" onclick="toggleCodeBlock('cloneGroup318', 'expandBtn318', 'collapseBtn318')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn318" onclick="toggleCodeBlock('cloneGroup318', 'expandBtn318', 'collapseBtn318')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup318"><code class="language-typescript text-sm text-gray-800">,
            ),
          );
        }
      });

      python.on('error', () =&gt; {
        reject(new Error('Python not found or dependencies missing.'));
      });
    });
  }

  /**
   * Load available models
   */
  private async loadAvailableModels(): Promise&lt;void&gt; {
    try {
      const models = [
        'yolov8n'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/OCREngine.ts (Line 208:20 - Line 226:29), server/src/ai/engines/SpeechToTextEngine.ts (Line 402:12 - Line 273:41)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn319" onclick="toggleCodeBlock('cloneGroup319', 'expandBtn319', 'collapseBtn319')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn319" onclick="toggleCodeBlock('cloneGroup319', 'expandBtn319', 'collapseBtn319')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup319"><code class="language-typescript text-sm text-gray-800">.toString(),
      ];

      const python = spawn(this.config.pythonPath, args);
      let output = '';
      let errorOutput = '';

      python.stdout.on('data', (data) =&gt; {
        output += data.toString();
      });

      python.stderr.on('data', (data) =&gt; {
        errorOutput += data.toString();
      });

      python.on('close', (code) =&gt; {
        if (code !== 0) {
          reject(
            new Error(`PaddleOCR failed with code </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/engines/OCREngine.ts (Line 426:28 - Line 444:6), server/src/ai/engines/ObjectDetectionEngine.ts (Line 644:13 - Line 662:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn320" onclick="toggleCodeBlock('cloneGroup320', 'expandBtn320', 'collapseBtn320')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn320" onclick="toggleCodeBlock('cloneGroup320', 'expandBtn320', 'collapseBtn320')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup320"><code class="language-typescript text-sm text-gray-800">(box1: any, box2: any): number {
    const x1 = Math.max(box1.x, box2.x);
    const y1 = Math.max(box1.y, box2.y);
    const x2 = Math.min(box1.x + box1.width, box2.x + box2.width);
    const y2 = Math.min(box1.y + box1.height, box2.y + box2.height);

    if (x2 &lt;= x1 || y2 &lt;= y1) return 0;

    const intersectionArea = (x2 - x1) * (y2 - y1);
    const box1Area = box1.width * box1.height;
    const box2Area = box2.width * box2.height;
    const unionArea = box1Area + box2Area - intersectionArea;

    return intersectionArea / unionArea;
  }

  /**
   * Calculate text similarity between multiple texts
   */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/utils/input-sanitization.ts (Line 227:16 - Line 243:4), server/src/utils/input-sanitization.ts (Line 206:18 - Line 222:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn321" onclick="toggleCodeBlock('cloneGroup321', 'expandBtn321', 'collapseBtn321')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn321" onclick="toggleCodeBlock('cloneGroup321', 'expandBtn321', 'collapseBtn321')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup321"><code class="language-typescript text-sm text-gray-800">);
  }

  if (min !== undefined &amp;&amp; num &lt; min) {
    throw new Error(`Value must be at least ${min}`);
  }

  if (max !== undefined &amp;&amp; num &gt; max) {
    throw new Error(`Value must be at most ${max}`);
  }

  return num;
}

/**
 * Validate boolean input
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/dataRetentionEngine.test.ts (Line 68:46 - Line 80:2), server/src/tests/dataRetentionEngine.test.ts (Line 44:61 - Line 56:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn329" onclick="toggleCodeBlock('cloneGroup329', 'expandBtn329', 'collapseBtn329')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn329" onclick="toggleCodeBlock('cloneGroup329', 'expandBtn329', 'collapseBtn329')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup329"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
    const pool = createMockPool();
    const scheduler = new RetentionScheduler(1000);
    const auditLogger = createAuditLogger();
    const runCypher = jest.fn().mockResolvedValue([]);
    const engine = new DataRetentionEngine({
      pool,
      scheduler,
      auditLogger,
      runCypher,
    });

    const metadata = createMetadata({</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/dataRetentionEngine.test.ts (Line 103:2 - Line 114:20), server/src/tests/dataRetentionEngine.test.ts (Line 70:5 - Line 80:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn330" onclick="toggleCodeBlock('cloneGroup330', 'expandBtn330', 'collapseBtn330')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn330" onclick="toggleCodeBlock('cloneGroup330', 'expandBtn330', 'collapseBtn330')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup330"><code class="language-typescript text-sm text-gray-800">);
    const auditLogger = createAuditLogger();
    const runCypher = jest.fn().mockResolvedValue([]);
    const engine = new DataRetentionEngine({
      pool,
      scheduler,
      auditLogger,
      runCypher,
    });

    const metadata = createMetadata({
      datasetId: 'scheduled-dataset'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/dataRetentionEngine.test.ts (Line 139:58 - Line 151:17), server/src/tests/dataRetentionEngine.test.ts (Line 44:61 - Line 80:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn331" onclick="toggleCodeBlock('cloneGroup331', 'expandBtn331', 'collapseBtn331')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn331" onclick="toggleCodeBlock('cloneGroup331', 'expandBtn331', 'collapseBtn331')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup331"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
    const pool = createMockPool();
    const scheduler = new RetentionScheduler(1000);
    const auditLogger = createAuditLogger();
    const runCypher = jest.fn().mockResolvedValue([]);
    const engine = new DataRetentionEngine({
      pool,
      scheduler,
      auditLogger,
      runCypher,
    });

    const metadata = createMetadata({ datasetId: 'report-dataset'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/dataRetentionEngine.test.ts (Line 174:45 - Line 186:18), server/src/tests/dataRetentionEngine.test.ts (Line 44:61 - Line 80:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn332" onclick="toggleCodeBlock('cloneGroup332', 'expandBtn332', 'collapseBtn332')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn332" onclick="toggleCodeBlock('cloneGroup332', 'expandBtn332', 'collapseBtn332')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup332"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
    const pool = createMockPool();
    const scheduler = new RetentionScheduler(1000);
    const auditLogger = createAuditLogger();
    const runCypher = jest.fn().mockResolvedValue([]);
    const engine = new DataRetentionEngine({
      pool,
      scheduler,
      auditLogger,
      runCypher,
    });

    const metadata = createMetadata({ datasetId: 'archive-dataset'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/ai.webhook.test.ts (Line 70:7 - Line 80:31), server/src/tests/ai.webhook.test.ts (Line 24:2 - Line 63:38)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn337" onclick="toggleCodeBlock('cloneGroup337', 'expandBtn337', 'collapseBtn337')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn337" onclick="toggleCodeBlock('cloneGroup337', 'expandBtn337', 'collapseBtn337')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup337"><code class="language-typescript text-sm text-gray-800">],
    };
    const { sig } = sign(body);
    const res = await request(app)
      .post('/ai/webhook')
      .set('X-IntelGraph-Signature', sig)
      .send(body);
    expect(res.status).toBe(200);
  });

  it('handles NLP entities webhook'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/ai.webhook.test.ts (Line 91:9 - Line 102:39), server/src/tests/ai.webhook.test.ts (Line 69:2 - Line 63:38)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn338" onclick="toggleCodeBlock('cloneGroup338', 'expandBtn338', 'collapseBtn338')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn338" onclick="toggleCodeBlock('cloneGroup338', 'expandBtn338', 'collapseBtn338')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup338"><code class="language-typescript text-sm text-gray-800">},
      ],
    };
    const { sig } = sign(body);
    const res = await request(app)
      .post('/ai/webhook')
      .set('X-IntelGraph-Signature', sig)
      .send(body);
    expect(res.status).toBe(200);
  });

  it('handles malformed webhook gracefully'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/CaseRepo.test.ts (Line 72:2 - Line 85:2), server/src/tests/CaseRepo.test.ts (Line 39:13 - Line 52:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn340" onclick="toggleCodeBlock('cloneGroup340', 'expandBtn340', 'collapseBtn340')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn340" onclick="toggleCodeBlock('cloneGroup340', 'expandBtn340', 'collapseBtn340')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup340"><code class="language-typescript text-sm text-gray-800">],
        metadata: {},
        created_at: new Date(),
        updated_at: new Date(),
        created_by: 'user-123',
        closed_at: null,
        closed_by: null,
      };

      mockPool.query.mockResolvedValueOnce({ rows: [mockRow] } as any);

      const result = await repo.create(input, 'user-123');

      expect(result.</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/CaseRepo.test.ts (Line 98:12 - Line 109:9), server/src/tests/CaseRepo.test.ts (Line 39:13 - Line 50:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn341" onclick="toggleCodeBlock('cloneGroup341', 'expandBtn341', 'collapseBtn341')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn341" onclick="toggleCodeBlock('cloneGroup341', 'expandBtn341', 'collapseBtn341')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup341"><code class="language-typescript text-sm text-gray-800">],
        metadata: {},
        created_at: new Date(),
        updated_at: new Date(),
        created_by: 'user-123',
        closed_at: null,
        closed_by: null,
      };

      mockPool.query.mockResolvedValueOnce({ rows: [mockRow] } as any);

      const result = await repo.findById</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/CaseRepo.test.ts (Line 145:19 - Line 156:7), server/src/tests/CaseRepo.test.ts (Line 39:13 - Line 50:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn342" onclick="toggleCodeBlock('cloneGroup342', 'expandBtn342', 'collapseBtn342')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn342" onclick="toggleCodeBlock('cloneGroup342', 'expandBtn342', 'collapseBtn342')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup342"><code class="language-typescript text-sm text-gray-800">],
        metadata: {},
        created_at: new Date(),
        updated_at: new Date(),
        created_by: 'user-123',
        closed_at: null,
        closed_by: null,
      };

      mockPool.query.mockResolvedValueOnce({ rows: [mockRow] } as any);

      const result = await repo.update</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/CaseRepo.test.ts (Line 204:9 - Line 215:2), server/src/tests/CaseRepo.test.ts (Line 94:12 - Line 105:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn343" onclick="toggleCodeBlock('cloneGroup343', 'expandBtn343', 'collapseBtn343')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn343" onclick="toggleCodeBlock('cloneGroup343', 'expandBtn343', 'collapseBtn343')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup343"><code class="language-typescript text-sm text-gray-800">,
          description: null,
          status: 'open',
          compartment: 'SECRET',
          policy_labels: ['sensitive'],
          metadata: {},
          created_at: new Date(),
          updated_at: new Date(),
          created_by: 'user-123',
          closed_at: null,
          closed_by: null,
        },</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/CaseRepo.test.ts (Line 219:9 - Line 231:2), server/src/tests/CaseRepo.test.ts (Line 94:12 - Line 216:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn344" onclick="toggleCodeBlock('cloneGroup344', 'expandBtn344', 'collapseBtn344')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn344" onclick="toggleCodeBlock('cloneGroup344', 'expandBtn344', 'collapseBtn344')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup344"><code class="language-typescript text-sm text-gray-800">,
          description: null,
          status: 'open',
          compartment: 'SECRET',
          policy_labels: ['sensitive'],
          metadata: {},
          created_at: new Date(),
          updated_at: new Date(),
          created_by: 'user-123',
          closed_at: null,
          closed_by: null,
        },
      ]</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/CaseRepo.test.ts (Line 309:11 - Line 322:8), server/src/tests/CaseRepo.test.ts (Line 70:7 - Line 50:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn345" onclick="toggleCodeBlock('cloneGroup345', 'expandBtn345', 'collapseBtn345')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn345" onclick="toggleCodeBlock('cloneGroup345', 'expandBtn345', 'collapseBtn345')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup345"><code class="language-typescript text-sm text-gray-800">,
        compartment: null,
        policy_labels: [],
        metadata: {},
        created_at: new Date(),
        updated_at: new Date(),
        created_by: 'user-123',
        closed_at: null,
        closed_by: null,
      };

      mockPool.query.mockResolvedValueOnce({ rows: [mockRow] } as any);

      const result = await repo.archive</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/AuditAccessLogRepo.test.ts (Line 121:24 - Line 138:2), server/src/tests/AuditAccessLogRepo.test.ts (Line 44:5 - Line 61:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn346" onclick="toggleCodeBlock('cloneGroup346', 'expandBtn346', 'collapseBtn346')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn346" onclick="toggleCodeBlock('cloneGroup346', 'expandBtn346', 'collapseBtn346')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup346"><code class="language-typescript text-sm text-gray-800">,
        approval_chain: [],
        ip_address: null,
        user_agent: null,
        session_id: null,
        request_id: null,
        correlation_id: null,
        created_at: new Date(),
        hash: 'abc123',
        previous_hash: null,
        metadata: {},
      };

      mockPool.query.mockResolvedValueOnce({ rows: [mockRow] } as any);

      const result = await repo.logAccess(input);

      expect(result.</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/AuditAccessLogRepo.test.ts (Line 170:15 - Line 181:14), server/src/tests/AuditAccessLogRepo.test.ts (Line 50:5 - Line 138:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn347" onclick="toggleCodeBlock('cloneGroup347', 'expandBtn347', 'collapseBtn347')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn347" onclick="toggleCodeBlock('cloneGroup347', 'expandBtn347', 'collapseBtn347')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup347"><code class="language-typescript text-sm text-gray-800">,
        created_at: new Date(),
        hash: 'abc123',
        previous_hash: null,
        metadata: {},
      };

      mockPool.query.mockResolvedValueOnce({ rows: [mockRow] } as any);

      const result = await repo.logAccess(input);

      expect(result.correlationId</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/AuditAccessLogRepo.test.ts (Line 196:16 - Line 210:2), server/src/tests/AuditAccessLogRepo.test.ts (Line 41:27 - Line 55:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn348" onclick="toggleCodeBlock('cloneGroup348', 'expandBtn348', 'collapseBtn348')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn348" onclick="toggleCodeBlock('cloneGroup348', 'expandBtn348', 'collapseBtn348')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup348"><code class="language-typescript text-sm text-gray-800">,
          legal_basis: 'investigation',
          warrant_id: null,
          authority_reference: null,
          approval_chain: [],
          ip_address: null,
          user_agent: null,
          session_id: null,
          request_id: null,
          correlation_id: null,
          created_at: new Date(),
          hash: 'abc123',
          previous_hash: null,
          metadata: {},
        },</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/AuditAccessLogRepo.test.ts (Line 259:47 - Line 288:15), server/src/tests/AuditAccessLogRepo.test.ts (Line 186:39 - Line 215:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn349" onclick="toggleCodeBlock('cloneGroup349', 'expandBtn349', 'collapseBtn349')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn349" onclick="toggleCodeBlock('cloneGroup349', 'expandBtn349', 'collapseBtn349')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup349"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockRows = [
        {
          id: 'log-1',
          tenant_id: 'tenant-123',
          case_id: 'case-123',
          user_id: 'user-123',
          action: 'view',
          resource_type: 'case',
          resource_id: 'case-123',
          reason: 'Investigation',
          legal_basis: 'investigation',
          warrant_id: null,
          authority_reference: null,
          approval_chain: [],
          ip_address: null,
          user_agent: null,
          session_id: null,
          request_id: null,
          correlation_id: null,
          created_at: new Date(),
          hash: 'abc123',
          previous_hash: null,
          metadata: {},
        },
      ];

      mockPool.query.mockResolvedValueOnce({ rows: mockRows } as any);

      const results = await repo.getLogsForCase</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/tests/AuditAccessLogRepo.test.ts (Line 296:38 - Line 325:7), server/src/tests/AuditAccessLogRepo.test.ts (Line 186:39 - Line 215:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn350" onclick="toggleCodeBlock('cloneGroup350', 'expandBtn350', 'collapseBtn350')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn350" onclick="toggleCodeBlock('cloneGroup350', 'expandBtn350', 'collapseBtn350')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup350"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockRows = [
        {
          id: 'log-1',
          tenant_id: 'tenant-123',
          case_id: 'case-123',
          user_id: 'user-123',
          action: 'view',
          resource_type: 'case',
          resource_id: 'case-123',
          reason: 'Investigation',
          legal_basis: 'investigation',
          warrant_id: null,
          authority_reference: null,
          approval_chain: [],
          ip_address: null,
          user_agent: null,
          session_id: null,
          request_id: null,
          correlation_id: null,
          created_at: new Date(),
          hash: 'abc123',
          previous_hash: null,
          metadata: {},
        },
      ];

      mockPool.query.mockResolvedValueOnce({ rows: mockRows } as any);

      const result</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/ticket-links.ts (Line 102:13 - Line 121:55), server/src/services/ticket-links.ts (Line 44:6 - Line 63:55)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn351" onclick="toggleCodeBlock('cloneGroup351', 'expandBtn351', 'collapseBtn351')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn351" onclick="toggleCodeBlock('cloneGroup351', 'expandBtn351', 'collapseBtn351')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup351"><code class="language-typescript text-sm text-gray-800">} not found`);
  }

  // Check if ticket exists
  const ticketResult = await pool.query(
    'SELECT id FROM tickets WHERE provider = $1 AND external_id = $2',
    [ticket.provider, ticket.externalId],
  );

  if (safeRows(ticketResult).length === 0) {
    console.warn(
      `Ticket ${ticket.provider}:${ticket.externalId} not found, skipping link creation`,
    );
    return null;
  }

  await pool.query(
    `INSERT INTO ticket_deployments (provider, external_id, deployment_id, metadata, created_at)
     VALUES ($1, $2, $3, $4, NOW()) ON CONFLICT (provider, external_id, deployment_id) DO UPDATE SET
     metadata = EXCLUDED.metadata, created_at = NOW()`</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/provenance-ledger.ts (Line 510:7 - Line 524:2), server/src/services/provenance-ledger.ts (Line 464:10 - Line 479:46)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn354" onclick="toggleCodeBlock('cloneGroup354', 'expandBtn354', 'collapseBtn354')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn354" onclick="toggleCodeBlock('cloneGroup354', 'expandBtn354', 'collapseBtn354')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup354"><code class="language-typescript text-sm text-gray-800">,
    );

    return result.rows.map((row) =&gt; ({
      id: row.id,
      parent_hash: row.parent_hash,
      content_hash: row.content_hash,
      operation_type: row.operation_type,
      actor_id: row.actor_id,
      timestamp: row.timestamp,
      metadata: row.metadata,
      signature: row.signature,
    }));
  }
}</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/TenantDatabase.ts (Line 141:9 - Line 163:5), server/src/services/TenantDatabase.ts (Line 61:12 - Line 83:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn356" onclick="toggleCodeBlock('cloneGroup356', 'expandBtn356', 'collapseBtn356')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn356" onclick="toggleCodeBlock('cloneGroup356', 'expandBtn356', 'collapseBtn356')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup356"><code class="language-typescript text-sm text-gray-800">, parameters, tenantContext)
      : null;

    // Check cache first
    if (cacheKey &amp;&amp; this.redis) {
      try {
        const cached = await this.redis.get(cacheKey);
        if (cached) {
          logger.debug(
            `Cache hit for tenant ${tenantContext.tenantId}: ${cacheKey}`,
          );
          return JSON.parse(cached);
        }
      } catch (error) {
        logger.warn(
          `Cache read failed: ${error instanceof Error ? error.message : 'Unknown error'}`,
        );
      }
    }

    // Enhance query with tenant constraints
    const { query: enhancedQuery, parameters: enhancedParams } =
      this</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/TenantDatabase.ts (Line 181:11 - Line 192:7), server/src/services/TenantDatabase.ts (Line 102:2 - Line 113:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn357" onclick="toggleCodeBlock('cloneGroup357', 'expandBtn357', 'collapseBtn357')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn357" onclick="toggleCodeBlock('cloneGroup357', 'expandBtn357', 'collapseBtn357')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup357"><code class="language-typescript text-sm text-gray-800">);
          logger.debug(
            `Cached result for tenant ${tenantContext.tenantId}: ${cacheKey}`,
          );
        } catch (error) {
          logger.warn(
            `Cache write failed: ${error instanceof Error ? error.message : 'Unknown error'}`,
          );
        }
      }

      return result</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/SelectorMinimizationService.ts (Line 161:30 - Line 174:63), server/src/services/TripwireMetricsService.ts (Line 82:25 - Line 95:58)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn358" onclick="toggleCodeBlock('cloneGroup358', 'expandBtn358', 'collapseBtn358')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn358" onclick="toggleCodeBlock('cloneGroup358', 'expandBtn358', 'collapseBtn358')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup358"><code class="language-typescript text-sm text-gray-800">, {
      failureThreshold: 5,
      resetTimeout: 60000,
    });

    this.initializeConnections();
  }

  private async initializeConnections(): Promise&lt;void&gt; {
    try {
      this.redis = await getRedisClient();
      this.postgres = getPostgresPool();
    } catch (error) {
      logger.error('Failed to initialize SelectorMinimizationService connections'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/SecuredLLMService.ts (Line 284:5 - Line 296:6), server/src/services/SecuredLLMService.ts (Line 162:5 - Line 174:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn359" onclick="toggleCodeBlock('cloneGroup359', 'expandBtn359', 'collapseBtn359')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn359" onclick="toggleCodeBlock('cloneGroup359', 'expandBtn359', 'collapseBtn359')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup359"><code class="language-typescript text-sm text-gray-800">let finalResponse = rawResponse;
    let outputWarnings: string[] = [];
    let redacted = false;

    if (!params.skipGuardrails) {
      const outputCheck = await this.guardrails.validateOutput({
        output: rawResponse,
        auditId,
        privacyLevel: params.privacyLevel,
      });

      if (!outputCheck.safe) {
        throw</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/QueryPreviewService.ts (Line 317:5 - Line 330:6), server/src/services/QueryPreviewService.ts (Line 258:5 - Line 271:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn365" onclick="toggleCodeBlock('cloneGroup365', 'expandBtn365', 'collapseBtn365')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn365" onclick="toggleCodeBlock('cloneGroup365', 'expandBtn365', 'collapseBtn365')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup365"><code class="language-typescript text-sm text-gray-800">,
      generatedAt: new Date(),
      expiresAt: new Date(Date.now() + this.previewTTL * 1000),
      executed: false,
      createdAt: new Date(),
      updatedAt: new Date(),
    };

    return preview;
  }

  /**
   * Get a preview by ID
   */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/DoclingService.ts (Line 318:9 - Line 338:20), server/src/services/DoclingService.ts (Line 167:2 - Line 187:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn375" onclick="toggleCodeBlock('cloneGroup375', 'expandBtn375', 'collapseBtn375')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn375" onclick="toggleCodeBlock('cloneGroup375', 'expandBtn375', 'collapseBtn375')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup375"><code class="language-typescript text-sm text-gray-800">},
      })),
    );

    const findings: DocFinding[] = findingRecords.map((record) =&gt; ({
      id: record.id,
      fragmentId: record.fragmentId ?? undefined,
      label: record.label,
      value: record.value,
      confidence: record.confidence ?? 0,
      severity: (record.severity ?? undefined) as
        | DocFinding['severity']
        | undefined,
      metadata: record.metadata || {},
      qualitySignals:
        (record.metadata?.qualitySignals as
          | Record&lt;string, unknown&gt;
          | undefined) ?? {},
    }));

    const policySignalRecords</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/DoclingService.ts (Line 341:9 - Line 365:9), server/src/services/DoclingService.ts (Line 208:16 - Line 232:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn376" onclick="toggleCodeBlock('cloneGroup376', 'expandBtn376', 'collapseBtn376')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn376" onclick="toggleCodeBlock('cloneGroup376', 'expandBtn376', 'collapseBtn376')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup376"><code class="language-typescript text-sm text-gray-800">.policySignals.map((signal) =&gt; ({
        classification: signal.classification,
        value: signal.value,
        purpose: signal.purpose,
        retention: signal.retention,
        fragmentId: signal.fragmentId,
        metadata: { qualitySignals: signal.qualitySignals },
      })),
    );

    const policySignals = policySignalRecords.map((record) =&gt; ({
      id: record.id,
      classification: record.classification,
      value: record.value,
      purpose: record.purpose,
      retention: record.retention,
      fragmentId: record.fragmentId ?? undefined,
      metadata: record.metadata || {},
      qualitySignals:
        (record.metadata?.qualitySignals as
          | Record&lt;string, number&gt;
          | undefined) ?? undefined,
    }));

    if (fallback</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/DeterministicExportService.ts (Line 548:4 - Line 558:11), server/src/services/DeterministicExportService.ts (Line 503:8 - Line 513:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn377" onclick="toggleCodeBlock('cloneGroup377', 'expandBtn377', 'collapseBtn377')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn377" onclick="toggleCodeBlock('cloneGroup377', 'expandBtn377', 'collapseBtn377')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup377"><code class="language-typescript text-sm text-gray-800">, 'utf8');

    await import('fs/promises').then((fs) =&gt; fs.writeFile(filePath, buffer));

    const hash = createHash('sha256').update(buffer).digest('hex');

    return {
      filename: filePath.split('/').pop()!,
      sha256: hash,
      bytes: buffer.length,
      contentType: 'text/csv'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/DeterministicExportService.ts (Line 646:18 - Line 657:8), server/src/services/MediaUploadService.ts (Line 198:18 - Line 211:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn378" onclick="toggleCodeBlock('cloneGroup378', 'expandBtn378', 'collapseBtn378')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn378" onclick="toggleCodeBlock('cloneGroup378', 'expandBtn378', 'collapseBtn378')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup378"><code class="language-typescript text-sm text-gray-800">(filePath: string): Promise&lt;string&gt; {
    const hash = createHash('sha256');
    const stream = createReadStream(filePath);

    for await (const chunk of stream) {
      hash.update(chunk);
    }

    return hash.digest('hex');
  }

  private</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/services/CopilotIntegrationService.ts (Line 191:20 - Line 206:11), server/src/services/CopilotIntegrationService.ts (Line 70:19 - Line 85:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn379" onclick="toggleCodeBlock('cloneGroup379', 'expandBtn379', 'collapseBtn379')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn379" onclick="toggleCodeBlock('cloneGroup379', 'expandBtn379', 'collapseBtn379')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup379"><code class="language-typescript text-sm text-gray-800">&gt; {
    // Feature flag check
    if (!isFeatureEnabled('COPILOT_SERVICE')) {
      throw new Error('Copilot service is not enabled');
    }

    // Permission check
    const hasPermission = await this.rbacService.hasPermission({
      user: {
        id: user.id,
        email: user.email,
        role: user.role as any,
        tenantId: user.tenantId,
        isActive: true,
      },
      action: Permission.AI_SUGGEST</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/webhooks.ts (Line 77:5 - Line 87:18), server/src/routes/webhooks.ts (Line 63:3 - Line 73:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn387" onclick="toggleCodeBlock('cloneGroup387', 'expandBtn387', 'collapseBtn387')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn387" onclick="toggleCodeBlock('cloneGroup387', 'expandBtn387', 'collapseBtn387')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup387"><code class="language-typescript text-sm text-gray-800">);
    if (!webhook) {
        return res.status(404).json({ error: 'Webhook not found' });
    }
    res.json(webhook);
  } catch (error: any) {
    res.status(500).json({ error: error.message });
  }
});

// Delete Webhook</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/trust-center.ts (Line 134:27 - Line 144:26), server/src/routes/trust-center.ts (Line 86:23 - Line 96:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn388" onclick="toggleCodeBlock('cloneGroup388', 'expandBtn388', 'collapseBtn388')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn388" onclick="toggleCodeBlock('cloneGroup388', 'expandBtn388', 'collapseBtn388')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup388"><code class="language-typescript text-sm text-gray-800">, error);
    otelService.recordException(error);

    if (error.name === 'ZodError') {
      res
        .status(400)
        .json({ error: 'Invalid request data', details: error.errors });
    } else {
      res
        .status(500)
        .json({ error: 'SLSA attestation failed'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/siem.ts (Line 177:22 - Line 187:11), server/src/routes/siem.ts (Line 72:17 - Line 82:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn392" onclick="toggleCodeBlock('cloneGroup392', 'expandBtn392', 'collapseBtn392')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn392" onclick="toggleCodeBlock('cloneGroup392', 'expandBtn392', 'collapseBtn392')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup392"><code class="language-typescript text-sm text-gray-800">,
  rbacMiddleware(['admin', 'security_officer']),
  param('id').isString().notEmpty(),
  async (req: Request, res: Response) =&gt; {
    try {
      const errors = validationResult(req);
      if (!errors.isEmpty()) {
        throw new AppError('Invalid provider ID', 400, 'VALIDATION_ERROR');
      }

      const providerId</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/siem.ts (Line 231:7 - Line 241:6), server/src/routes/siem.ts (Line 119:10 - Line 129:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn393" onclick="toggleCodeBlock('cloneGroup393', 'expandBtn393', 'collapseBtn393')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn393" onclick="toggleCodeBlock('cloneGroup393', 'expandBtn393', 'collapseBtn393')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup393"><code class="language-typescript text-sm text-gray-800">).isArray().optional(),
  async (req: Request, res: Response) =&gt; {
    try {
      const errors = validationResult(req);
      if (!errors.isEmpty()) {
        throw new AppError('Validation failed', 400, 'VALIDATION_ERROR', {
          errors: errors.array(),
        });
      }

      const event</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/siem.ts (Line 440:13 - Line 450:6), server/src/routes/siem.ts (Line 119:10 - Line 129:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn394" onclick="toggleCodeBlock('cloneGroup394', 'expandBtn394', 'collapseBtn394')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn394" onclick="toggleCodeBlock('cloneGroup394', 'expandBtn394', 'collapseBtn394')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup394"><code class="language-typescript text-sm text-gray-800">).isArray().optional(),
  async (req: Request, res: Response) =&gt; {
    try {
      const errors = validationResult(req);
      if (!errors.isEmpty()) {
        throw new AppError('Validation failed', 400, 'VALIDATION_ERROR', {
          errors: errors.array(),
        });
      }

      const alert</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/quality-evaluation.ts (Line 487:42 - Line 501:4), server/src/routes/trust-center.ts (Line 351:36 - Line 362:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn396" onclick="toggleCodeBlock('cloneGroup396', 'expandBtn396', 'collapseBtn396')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn396" onclick="toggleCodeBlock('cloneGroup396', 'expandBtn396', 'collapseBtn396')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup396"><code class="language-typescript text-sm text-gray-800">, error);
    res.status(500).json({
      status: 'unhealthy',
      error: error.message,
      timestamp: new Date().toISOString(),
    });
  } finally {
    span?.end();
  }
});

/**
 * GET /api/quality-evaluation/benchmarks
 * Get recommended SLO thresholds and industry benchmarks
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/plaid.ts (Line 1:1 - Line 13:68), server/src/routes/segment.ts (Line 1:1 - Line 13:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn397" onclick="toggleCodeBlock('cloneGroup397', 'expandBtn397', 'collapseBtn397')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn397" onclick="toggleCodeBlock('cloneGroup397', 'expandBtn397', 'collapseBtn397')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup397"><code class="language-typescript text-sm text-gray-800">import { Router } from 'express';
import express from 'express';
import { replayGuard, webhookRatelimit } from '../middleware/webhook-guard';

const router = Router();

router.post(
  '/events',
  webhookRatelimit,
  replayGuard(),
  express.raw({ type: '*/*', limit: '2mb' }),
  async (_req, res) =&gt; {
    // Plaid v2 verification requires SDK/header parsing; stubbed route</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/paypal.ts (Line 1:1 - Line 13:63), server/src/routes/segment.ts (Line 1:1 - Line 13:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn398" onclick="toggleCodeBlock('cloneGroup398', 'expandBtn398', 'collapseBtn398')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn398" onclick="toggleCodeBlock('cloneGroup398', 'expandBtn398', 'collapseBtn398')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup398"><code class="language-typescript text-sm text-gray-800">import { Router } from 'express';
import express from 'express';
import { replayGuard, webhookRatelimit } from '../middleware/webhook-guard';

const router = Router();

router.post(
  '/events',
  webhookRatelimit,
  replayGuard(),
  express.raw({ type: '*/*', limit: '2mb' }),
  async (_req, res) =&gt; {
    // PayPal recommends server-side verify via API; stubbed route</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/narrative-sim.ts (Line 187:2 - Line 199:27), server/src/routes/narrative-sim.ts (Line 167:6 - Line 179:26)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn399" onclick="toggleCodeBlock('cloneGroup399', 'expandBtn399', 'collapseBtn399')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn399" onclick="toggleCodeBlock('cloneGroup399', 'expandBtn399', 'collapseBtn399')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup399"><code class="language-typescript text-sm text-gray-800">);
  } catch (error) {
    if (error instanceof z.ZodError) {
      res
        .status(400)
        .json({ error: 'invalid-request', details: error.flatten() });
      return;
    }
    res.status(404).json({ error: (error as Error).message });
  }
});

router.post('/simulations/:id/actions'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/narrative-sim.ts (Line 222:2 - Line 234:7), server/src/routes/narrative-sim.ts (Line 187:2 - Line 179:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn400" onclick="toggleCodeBlock('cloneGroup400', 'expandBtn400', 'collapseBtn400')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn400" onclick="toggleCodeBlock('cloneGroup400', 'expandBtn400', 'collapseBtn400')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup400"><code class="language-typescript text-sm text-gray-800">});
  } catch (error) {
    if (error instanceof z.ZodError) {
      res
        .status(400)
        .json({ error: 'invalid-request', details: error.flatten() });
      return;
    }
    res.status(404).json({ error: (error as Error).message });
  }
});

router.delete</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/monitoring.ts (Line 67:22 - Line 82:4), server/src/routes/monitoring.ts (Line 49:19 - Line 64:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn401" onclick="toggleCodeBlock('cloneGroup401', 'expandBtn401', 'collapseBtn401')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn401" onclick="toggleCodeBlock('cloneGroup401', 'expandBtn401', 'collapseBtn401')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup401"><code class="language-typescript text-sm text-gray-800">();
    const statusCode = health.status === 'healthy' ? 200 : 503;
    res.status(statusCode).json(health);
  } catch (error: any) {
    res.status(503).json({
      status: 'unhealthy',
      timestamp: new Date().toISOString(),
      error: error.message,
    });
  }
});

/**
 * Kubernetes liveness probe
 * GET /health/live
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/github-app.ts (Line 1:1 - Line 11:26), server/src/routes/github.ts (Line 1:1 - Line 11:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn405" onclick="toggleCodeBlock('cloneGroup405', 'expandBtn405', 'collapseBtn405')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn405" onclick="toggleCodeBlock('cloneGroup405', 'expandBtn405', 'collapseBtn405')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup405"><code class="language-typescript text-sm text-gray-800">import { Router } from 'express';
import express from 'express';
import { hmacHex, safeEqual } from '../utils/signature';

const router = Router();

router.post(
  '/events',
  express.raw({ type: 'application/json', limit: '1mb' }),
  async (req, res) =&gt; {
    const secret = process.env.GITHUB_APP_WEBHOOK_SECRET</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/dlp.ts (Line 125:13 - Line 135:11), server/src/routes/siem.ts (Line 119:10 - Line 129:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn408" onclick="toggleCodeBlock('cloneGroup408', 'expandBtn408', 'collapseBtn408')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn408" onclick="toggleCodeBlock('cloneGroup408', 'expandBtn408', 'collapseBtn408')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup408"><code class="language-typescript text-sm text-gray-800">).isArray().optional(),
  async (req: Request, res: Response) =&gt; {
    try {
      const errors = validationResult(req);
      if (!errors.isEmpty()) {
        throw new AppError('Validation failed', 400, 'VALIDATION_ERROR', {
          errors: errors.array(),
        });
      }

      const policyData</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/dlp.ts (Line 192:2 - Line 203:9), server/src/routes/dlp.ts (Line 124:2 - Line 129:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn409" onclick="toggleCodeBlock('cloneGroup409', 'expandBtn409', 'collapseBtn409')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn409" onclick="toggleCodeBlock('cloneGroup409', 'expandBtn409', 'collapseBtn409')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup409"><code class="language-typescript text-sm text-gray-800">),
  body('exemptions').isArray().optional(),
  async (req: Request, res: Response) =&gt; {
    try {
      const errors = validationResult(req);
      if (!errors.isEmpty()) {
        throw new AppError('Validation failed', 400, 'VALIDATION_ERROR', {
          errors: errors.array(),
        });
      }

      const policyId</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/dlp.ts (Line 308:23 - Line 319:6), server/src/routes/siem.ts (Line 72:17 - Line 267:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn410" onclick="toggleCodeBlock('cloneGroup410', 'expandBtn410', 'collapseBtn410')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn410" onclick="toggleCodeBlock('cloneGroup410', 'expandBtn410', 'collapseBtn410')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup410"><code class="language-typescript text-sm text-gray-800">,
  rbacMiddleware(['admin', 'security_officer']),
  param('id').isString().notEmpty(),
  async (req: Request, res: Response) =&gt; {
    try {
      const errors = validationResult(req);
      if (!errors.isEmpty()) {
        throw new AppError('Invalid policy ID', 400, 'VALIDATION_ERROR');
      }

      const policyId = req.params.id;
      const</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/dlp.ts (Line 372:2 - Line 383:8), server/src/routes/siem.ts (Line 119:2 - Line 129:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn411" onclick="toggleCodeBlock('cloneGroup411', 'expandBtn411', 'collapseBtn411')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn411" onclick="toggleCodeBlock('cloneGroup411', 'expandBtn411', 'collapseBtn411')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup411"><code class="language-typescript text-sm text-gray-800">)
    .optional(),
  async (req: Request, res: Response) =&gt; {
    try {
      const errors = validationResult(req);
      if (!errors.isEmpty()) {
        throw new AppError('Validation failed', 400, 'VALIDATION_ERROR', {
          errors: errors.array(),
        });
      }

      const context</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/data-residency.ts (Line 64:13 - Line 83:4), server/src/routes/data-residency.ts (Line 41:5 - Line 57:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn412" onclick="toggleCodeBlock('cloneGroup412', 'expandBtn412', 'collapseBtn412')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn412" onclick="toggleCodeBlock('cloneGroup412', 'expandBtn412', 'collapseBtn412')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup412"><code class="language-typescript text-sm text-gray-800">: z.string().min(1),
  dataClassification: z.object({
    level: z.enum([
      'public',
      'internal',
      'confidential',
      'restricted',
      'top-secret',
    ]),
    categories: z.array(z.string()).default([]),
    residencyRequirements: z.array(z.string()).default([]),
    encryptionRequired: z.boolean().default(true),
    auditRequired: z.boolean().default(true),
  }),
});

/**
 * POST /api/data-residency/configure-residency
 * Configure data residency requirements for a tenant
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/data-residency.ts (Line 401:2 - Line 418:4), server/src/routes/quality-evaluation.ts (Line 305:19 - Line 322:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn413" onclick="toggleCodeBlock('cloneGroup413', 'expandBtn413', 'collapseBtn413')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn413" onclick="toggleCodeBlock('cloneGroup413', 'expandBtn413', 'collapseBtn413')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup413"><code class="language-typescript text-sm text-gray-800">,
    });
  } catch (error: any) {
    console.error('Report generation failed:', error);
    otelService.recordException(error);
    res.status(500).json({
      error: 'Report generation failed',
      message: error.message,
    });
  } finally {
    span?.end();
  }
});

/**
 * GET /api/data-residency/health
 * Data residency service health check
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/data-residency.ts (Line 451:38 - Line 465:4), server/src/routes/trust-center.ts (Line 351:36 - Line 362:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn414" onclick="toggleCodeBlock('cloneGroup414', 'expandBtn414', 'collapseBtn414')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn414" onclick="toggleCodeBlock('cloneGroup414', 'expandBtn414', 'collapseBtn414')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup414"><code class="language-typescript text-sm text-gray-800">, error);
    res.status(500).json({
      status: 'unhealthy',
      error: error.message,
      timestamp: new Date().toISOString(),
    });
  } finally {
    span?.end();
  }
});

/**
 * GET /api/data-residency/supported-regions
 * Get list of supported regions and their compliance characteristics
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/coinbase.ts (Line 1:1 - Line 14:24), server/src/routes/shopify.ts (Line 1:1 - Line 14:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn417" onclick="toggleCodeBlock('cloneGroup417', 'expandBtn417', 'collapseBtn417')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn417" onclick="toggleCodeBlock('cloneGroup417', 'expandBtn417', 'collapseBtn417')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup417"><code class="language-typescript text-sm text-gray-800">import { Router } from 'express';
import express from 'express';
import crypto from 'crypto';
import { replayGuard, webhookRatelimit } from '../middleware/webhook-guard';

const router = Router();

router.post(
  '/events',
  webhookRatelimit,
  replayGuard(),
  express.raw({ type: '*/*', limit: '2mb' }),
  async (req: any, res) =&gt; {
    const secret = process.env.COINBASE_WEBHOOK_SECRET</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/cases.ts (Line 101:7 - Line 113:2), server/src/routes/cases.ts (Line 58:4 - Line 70:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn418" onclick="toggleCodeBlock('cloneGroup418', 'expandBtn418', 'collapseBtn418')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn418" onclick="toggleCodeBlock('cloneGroup418', 'expandBtn418', 'collapseBtn418')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup418"><code class="language-typescript text-sm text-gray-800">, async (req, res) =&gt; {
  try {
    const { tenantId, userId } = getRequestContext(req);

    if (!tenantId) {
      return res.status(400).json({ error: 'tenant_required' });
    }

    if (!userId) {
      return res.status(401).json({ error: 'user_required' });
    }

    const {</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/cases.ts (Line 160:4 - Line 174:51), server/src/routes/cases.ts (Line 101:4 - Line 115:46)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn419" onclick="toggleCodeBlock('cloneGroup419', 'expandBtn419', 'collapseBtn419')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn419" onclick="toggleCodeBlock('cloneGroup419', 'expandBtn419', 'collapseBtn419')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup419"><code class="language-typescript text-sm text-gray-800">('/:id', async (req, res) =&gt; {
  try {
    const { tenantId, userId } = getRequestContext(req);

    if (!tenantId) {
      return res.status(400).json({ error: 'tenant_required' });
    }

    if (!userId) {
      return res.status(401).json({ error: 'user_required' });
    }

    const { id } = req.params;

    // Require reason and legal basis for modification</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/cases.ts (Line 190:3 - Line 203:13), server/src/routes/cases.ts (Line 71:9 - Line 84:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn420" onclick="toggleCodeBlock('cloneGroup420', 'expandBtn420', 'collapseBtn420')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn420" onclick="toggleCodeBlock('cloneGroup420', 'expandBtn420', 'collapseBtn420')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup420"><code class="language-typescript text-sm text-gray-800">,
      title: req.body.title,
      description: req.body.description,
      status: req.body.status,
      compartment: req.body.compartment,
      policyLabels: req.body.policyLabels,
      metadata: req.body.metadata,
    };

    const pg = getPostgresPool();
    const service = new CaseService(pg);

    const auditContext = getAuditContext(req.body);
    auditContext</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/cases.ts (Line 261:15 - Line 275:48), server/src/routes/cases.ts (Line 58:4 - Line 115:46)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn421" onclick="toggleCodeBlock('cloneGroup421', 'expandBtn421', 'collapseBtn421')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn421" onclick="toggleCodeBlock('cloneGroup421', 'expandBtn421', 'collapseBtn421')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup421"><code class="language-typescript text-sm text-gray-800">, async (req, res) =&gt; {
  try {
    const { tenantId, userId } = getRequestContext(req);

    if (!tenantId) {
      return res.status(400).json({ error: 'tenant_required' });
    }

    if (!userId) {
      return res.status(401).json({ error: 'user_required' });
    }

    const { id } = req.params;

    // Require reason and legal basis for archiving</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/cases.ts (Line 298:3 - Line 310:25), server/src/routes/cases.ts (Line 207:6 - Line 152:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn422" onclick="toggleCodeBlock('cloneGroup422', 'expandBtn422', 'collapseBtn422')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn422" onclick="toggleCodeBlock('cloneGroup422', 'expandBtn422', 'collapseBtn422')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup422"><code class="language-typescript text-sm text-gray-800">,
      userId,
      tenantId,
      auditContext,
    );

    if (!caseRecord) {
      return res.status(404).json({ error: 'case_not_found' });
    }

    res.json(caseRecord);
  } catch (error) {
    routeLogger.error({ error: (error as Error).message }, 'Failed to archive case'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/cases.ts (Line 318:14 - Line 332:45), server/src/routes/cases.ts (Line 58:4 - Line 115:46)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn423" onclick="toggleCodeBlock('cloneGroup423', 'expandBtn423', 'collapseBtn423')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn423" onclick="toggleCodeBlock('cloneGroup423', 'expandBtn423', 'collapseBtn423')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup423"><code class="language-typescript text-sm text-gray-800">, async (req, res) =&gt; {
  try {
    const { tenantId, userId } = getRequestContext(req);

    if (!tenantId) {
      return res.status(400).json({ error: 'tenant_required' });
    }

    if (!userId) {
      return res.status(401).json({ error: 'user_required' });
    }

    const { id } = req.params;

    // Require reason and legal basis for export</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/cases.ts (Line 343:57 - Line 354:11), server/src/routes/cases.ts (Line 286:57 - Line 206:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn424" onclick="toggleCodeBlock('cloneGroup424', 'expandBtn424', 'collapseBtn424')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn424" onclick="toggleCodeBlock('cloneGroup424', 'expandBtn424', 'collapseBtn424')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup424"><code class="language-typescript text-sm text-gray-800">,
      });
    }

    const pg = getPostgresPool();
    const service = new CaseService(pg);

    const auditContext = getAuditContext(req.body);
    auditContext.ipAddress = req.ip;
    auditContext.userAgent = req.headers['user-agent'];

    const caseRecord = await service.exportCase</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/cases.ts (Line 357:7 - Line 367:24), server/src/routes/cases.ts (Line 209:9 - Line 152:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn425" onclick="toggleCodeBlock('cloneGroup425', 'expandBtn425', 'collapseBtn425')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn425" onclick="toggleCodeBlock('cloneGroup425', 'expandBtn425', 'collapseBtn425')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup425"><code class="language-typescript text-sm text-gray-800">,
      auditContext,
    );

    if (!caseRecord) {
      return res.status(404).json({ error: 'case_not_found' });
    }

    res.json(caseRecord);
  } catch (error) {
    routeLogger.error({ error: (error as Error).message }, 'Failed to export case'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/auth.ts (Line 1:1 - Line 11:6), server/src/routes/segment.ts (Line 1:1 - Line 11:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn426" onclick="toggleCodeBlock('cloneGroup426', 'expandBtn426', 'collapseBtn426')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn426" onclick="toggleCodeBlock('cloneGroup426', 'expandBtn426', 'collapseBtn426')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup426"><code class="language-typescript text-sm text-gray-800">import { Router } from 'express';
import express from 'express';
import { replayGuard, webhookRatelimit } from '../middleware/webhook-guard';

const router = Router();

router.post(
  '/events',
  webhookRatelimit,
  replayGuard(),
  express.raw({ type: '*/*', limit: '1mb'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/audit.ts (Line 73:39 - Line 87:38), server/src/routes/audit.ts (Line 8:34 - Line 22:33)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn427" onclick="toggleCodeBlock('cloneGroup427', 'expandBtn427', 'collapseBtn427')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn427" onclick="toggleCodeBlock('cloneGroup427', 'expandBtn427', 'collapseBtn427')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup427"><code class="language-typescript text-sm text-gray-800">, async (req, res) =&gt; {
  const tenant = String(
    (req.headers['x-tenant-id'] as any) ||
      (req.headers['x-tenant'] as any) ||
      '',
  );
  if (!tenant) return res.status(400).json({ error: 'tenant_required' });
  const { id } = req.params as { id: string };
  const pg = getPostgresPool();
  const prov = new ProvenanceRepo(pg);

  res.setHeader('Content-Type', 'application/zip');
  res.setHeader(
    'Content-Disposition',
    `attachment; filename=&quot;investigation-</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/audit.ts (Line 87:38 - Line 97:45), server/src/routes/audit.ts (Line 22:33 - Line 31:40)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn428" onclick="toggleCodeBlock('cloneGroup428', 'expandBtn428', 'collapseBtn428')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn428" onclick="toggleCodeBlock('cloneGroup428', 'expandBtn428', 'collapseBtn428')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup428"><code class="language-typescript text-sm text-gray-800">${id}-audit.zip&quot;`,
  );
  const archive = archiver('zip', { zlib: { level: 9 } });
  archive.on('error', (err) =&gt;
    res.status(500).end(`Archive error: ${err.message}`),
  );
  archive.pipe(res);

  try {
    const { rows } = await pg.query(
      'SELECT * FROM investigations WHERE id = $1'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/audit.ts (Line 126:16 - Line 142:7), server/src/routes/audit.ts (Line 57:11 - Line 73:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn429" onclick="toggleCodeBlock('cloneGroup429', 'expandBtn429', 'collapseBtn429')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn429" onclick="toggleCodeBlock('cloneGroup429', 'expandBtn429', 'collapseBtn429')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup429"><code class="language-typescript text-sm text-gray-800">, id, undefined, 5000, 0);
    archive.append(JSON.stringify(events, null, 2), {
      name: 'provenance.json',
    });
  } catch {
    archive.append(
      JSON.stringify({ error: 'failed to load provenance' }, null, 2),
      {
        name: 'provenance.json',
      },
    );
  }

  await archive.finalize();
});

export</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/assistant.ts (Line 163:17 - Line 196:8), server/src/routes/assistant.ts (Line 50:20 - Line 83:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn430" onclick="toggleCodeBlock('cloneGroup430', 'expandBtn430', 'collapseBtn430')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn430" onclick="toggleCodeBlock('cloneGroup430', 'expandBtn430', 'collapseBtn430')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup430"><code class="language-typescript text-sm text-gray-800">, code: 'SUSPICIOUS_INPUT' });
        return res.status(400).json({ error: 'input_rejected' });
      }

      let experimentVariant = 'control';
      let cites: any[] = []; // Declare cites here
      if (process.env.ASSISTANT_RAG === '1') {
        // Feature flag check
        // Simple random assignment for demonstration (replace with proper tenant assignment)
        if (Math.random() &lt; 0.1) {
          // 10% of requests go to RAG variant
          const graphContext = await fetchGraphContext({
            investigationId: reqId,
            focusIds,
          }); // Pass reqId as investigationId
          const textPassages = await fetchTextPassages(input);
          input = buildRagPrompt({
            question: input,
            graph: graphContext,
            passages: textPassages,
          });
          experimentVariant = 'rag_v1';
          cites = [
            ...graphContext.map((g: any) =&gt; ({ kind: 'graph', ...g })),
            ...textPassages.map((p: any) =&gt; ({ kind: 'doc', ...p })),
          ];
        }
      }
      logExperiment(reqId, userId, 'rag_experiment', experimentVariant); // Log experiment

      const tenant = (req as any).user?.org ?? 'public';
      const cached = await getCached(tenant, input);
      if (cached) {
        res.write(`data: </code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/assistant.ts (Line 317:7 - Line 345:7), server/src/routes/assistant.ts (Line 51:2 - Line 80:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn431" onclick="toggleCodeBlock('cloneGroup431', 'expandBtn431', 'collapseBtn431')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn431" onclick="toggleCodeBlock('cloneGroup431', 'expandBtn431', 'collapseBtn431')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup431"><code class="language-typescript text-sm text-gray-800">;
          }

          let experimentVariant = 'control';
          let cites: any[] = []; // Declare cites here
          if (process.env.ASSISTANT_RAG === '1') {
            // Feature flag check
            // Simple random assignment for demonstration (replace with proper tenant assignment)
            if (Math.random() &lt; 0.1) {
              // 10% of requests go to RAG variant
              const graphContext = await fetchGraphContext({
                investigationId: reqId,
                focusIds,
              }); // Pass reqId as investigationId
              const textPassages = await fetchTextPassages(input);
              input = buildRagPrompt({
                question: input,
                graph: graphContext,
                passages: textPassages,
              });
              experimentVariant = 'rag_v1';
              cites = [
                ...graphContext.map((g: any) =&gt; ({ kind: 'graph', ...g })),
                ...textPassages.map((p: any) =&gt; ({ kind: 'doc', ...p })),
              ];
            }
          }
          logExperiment(reqId, userId, 'rag_experiment', experimentVariant); // Log experiment
          const tenant = socket</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/assistant.ts (Line 373:13 - Line 385:9), server/src/routes/assistant.ts (Line 232:9 - Line 244:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn432" onclick="toggleCodeBlock('cloneGroup432', 'expandBtn432', 'collapseBtn432')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn432" onclick="toggleCodeBlock('cloneGroup432', 'expandBtn432', 'collapseBtn432')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup432"><code class="language-typescript text-sm text-gray-800">await setCached(tenant, input, fullResponseText, 60); // Cache full response

            // Store Answer node + CITED edges; bind Request + User
            const answerId = `${reqId}:${Date.now()}`;
            // Enqueue the creation of Answer node and its relationships
            enqueue({
              type: 'audit', // Using audit type for this initial node creation
              payload: {
                type: 'answer_creation',
                userId,
                reqId,
                answerId,
                mode: 'socket'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/assistant.ts (Line 385:9 - Line 401:3), server/src/routes/assistant.ts (Line 244:6 - Line 260:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn433" onclick="toggleCodeBlock('cloneGroup433', 'expandBtn433', 'collapseBtn433')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn433" onclick="toggleCodeBlock('cloneGroup433', 'expandBtn433', 'collapseBtn433')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup433"><code class="language-typescript text-sm text-gray-800">,
                tokens,
                exp: experimentVariant,
                // This payload will need to be processed by writeAudits
              },
            });

            for (const c of cites) {
              if (c.kind === 'graph') {
                enqueue({
                  type: 'cite',
                  payload: { answerId, id: c.id, kind: 'entity' },
                });
              } else if (c.kind === 'doc') {
                enqueue({
                  type: 'cite',
                  payload: { answerId, id: c.id</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/assistant.ts (Line 410:9 - Line 426:7), server/src/routes/assistant.ts (Line 269:6 - Line 285:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn434" onclick="toggleCodeBlock('cloneGroup434', 'expandBtn434', 'collapseBtn434')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn434" onclick="toggleCodeBlock('cloneGroup434', 'expandBtn434', 'collapseBtn434')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup434"><code class="language-typescript text-sm text-gray-800">,
                input,
                tokens,
                ms: Date.now() - started,
                status: ac.signal.aborted ? 'cancel' : 'ok',
              },
            });
            // Enqueue enrichment job
            await enqueueEnrichment({
              reqId,
              userId,
              input,
              outputPreview: 'assistant stream completed', // optional
              // investigationId: (req as any).investigationId, // Placeholder for investigationId
            });
          } catch (e: any) {
            socket</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/ai.ts (Line 152:28 - Line 174:4), server/src/routes/nl-graph-query.ts (Line 83:28 - Line 134:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn435" onclick="toggleCodeBlock('cloneGroup435', 'expandBtn435', 'collapseBtn435')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn435" onclick="toggleCodeBlock('cloneGroup435', 'expandBtn435', 'collapseBtn435')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup435"><code class="language-typescript text-sm text-gray-800">),
];

// Helper function to handle validation errors
const handleValidationErrors = (
  req: Request,
  res: Response,
  next: Function,
) =&gt; {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    return res.status(400).json({
      error: 'Validation failed',
      details: errors.array(),
    });
  }
  next();
};

/**
 * POST /api/ai/predict-links
 * Predict potential links between entities using GNN model
 */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/admin.ts (Line 488:2 - Line 537:27), server/src/routes/admin.ts (Line 318:5 - Line 367:58)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn436" onclick="toggleCodeBlock('cloneGroup436', 'expandBtn436', 'collapseBtn436')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn436" onclick="toggleCodeBlock('cloneGroup436', 'expandBtn436', 'collapseBtn436')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup436"><code class="language-typescript text-sm text-gray-800">});
  }
});

// OPA bundle status (checks whether data.maestro.n8n.allowed_flows exists)
router.get('/admin/opa/bundle-status', async (_req, res) =&gt; {
  try {
    const base = process.env.OPA_BASE_URL || '';
    if (!base) return res.json({ ok: false, message: 'OPA_BASE_URL not set' });
    const r = await axios.get(`${base}/v1/data/maestro/n8n/allowed_flows`, {
      timeout: 3000,
    });
    const flows = r.data?.result || {};
    const keys = Object.keys(flows || {});
    return res.json({
      ok: true,
      allowedFlowsCount: keys.length,
      sample: keys.slice(0, 10),
    });
  } catch (e: any) {
    return res.json({ ok: false, message: e?.message || 'lookup failed' });
  }
});

// Push current n8n allowed flows into OPA data API (writes to data.maestro.n8n.allowed_flows)
router.post('/admin/opa/push-n8n-flows', async (_req, res) =&gt; {
  try {
    const base = process.env.OPA_BASE_URL || '';
    if (!base)
      return res
        .status(200)
        .json({ ok: false, message: 'OPA_BASE_URL not set' });
    let cfg: any = { allowedFlows: [] };
    try {
      cfg = JSON.parse(fs.readFileSync(n8nCfgPath, 'utf8'));
    } catch {}
    const map: Record&lt;string, boolean&gt; = {};
    for (const f of cfg.allowedFlows || []) map[f] = true;
    await axios.put(`${base}/v1/data/maestro/n8n/allowed_flows`, map, {
      timeout: 5000,
    });
    return res.json({ ok: true, count: Object.keys(map).length });
  } catch (e: any) {
    return res
      .status(200)
      .json({ ok: false, message: e?.message || 'push failed' });
  }
});

// Temporal runtime toggle</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/routes/admin.ts (Line 533:2 - Line 554:2), server/src/routes/admin.ts (Line 395:2 - Line 416:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn437" onclick="toggleCodeBlock('cloneGroup437', 'expandBtn437', 'collapseBtn437')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn437" onclick="toggleCodeBlock('cloneGroup437', 'expandBtn437', 'collapseBtn437')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup437"><code class="language-typescript text-sm text-gray-800">});
  }
});

// Temporal runtime toggle
router.post('/admin/temporal/toggle', express.json(), async (req, res) =&gt; {
  const enabled = Boolean(req.body?.enabled);
  try {
    if (enabled) {
      await enableTemporal();
    } else {
      await disableTemporal();
    }
    (memConfig as any).TEMPORAL_ENABLED = enabled;
    process.env.TEMPORAL_ENABLED = enabled ? 'true' : 'false';
    return res.json({ ok: true, enabled });
  } catch (e: any) {
    return res
      .status(500)
      .json({ ok: false, error: e?.message || 'temporal toggle failed' });
  }
});</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/RelationshipRepo.ts (Line 343:5 - Line 360:6), server/src/workers/OutboxNeo4jSync.ts (Line 317:5 - Line 334:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn439" onclick="toggleCodeBlock('cloneGroup439', 'expandBtn439', 'collapseBtn439')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn439" onclick="toggleCodeBlock('cloneGroup439', 'expandBtn439', 'collapseBtn439')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup439"><code class="language-typescript text-sm text-gray-800">const session = this.neo4j.session();

    try {
      await session.executeWrite(async (tx) =&gt; {
        await tx.run(
          `MATCH ()-[r:REL {id: $id}]-()
           DELETE r`,
          { id },
        );
      });
    } finally {
      await session.close();
    }
  }

  /**
   * Map database row to domain object
   */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/EntityRepo.ts (Line 175:7 - Line 185:6), server/src/repos/EntityRepo.ts (Line 96:7 - Line 106:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn440" onclick="toggleCodeBlock('cloneGroup440', 'expandBtn440', 'collapseBtn440')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn440" onclick="toggleCodeBlock('cloneGroup440', 'expandBtn440', 'collapseBtn440')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup440"><code class="language-typescript text-sm text-gray-800">try {
        await this.upsertNeo4jNode({
          id: entity.id,
          tenantId: entity.tenant_id,
          kind: entity.kind,
          labels: entity.labels,
          props: entity.props,
        });
      } catch (neo4jError) {
        repoLogger.warn(
          { entityId: input</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/EntityRepo.ts (Line 229:45 - Line 248:6), server/src/repos/RelationshipRepo.ts (Line 174:58 - Line 193:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn441" onclick="toggleCodeBlock('cloneGroup441', 'expandBtn441', 'collapseBtn441')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn441" onclick="toggleCodeBlock('cloneGroup441', 'expandBtn441', 'collapseBtn441')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup441"><code class="language-typescript text-sm text-gray-800">,
          );
        }

        return true;
      } else {
        await client.query('ROLLBACK');
        return false;
      }
    } catch (error) {
      await client.query('ROLLBACK');
      throw error;
    } finally {
      client.release();
    }
  }

  /**
   * Find entity by ID
   */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/EntityRepo.ts (Line 364:5 - Line 381:6), server/src/workers/OutboxNeo4jSync.ts (Line 241:5 - Line 258:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn442" onclick="toggleCodeBlock('cloneGroup442', 'expandBtn442', 'collapseBtn442')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn442" onclick="toggleCodeBlock('cloneGroup442', 'expandBtn442', 'collapseBtn442')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup442"><code class="language-typescript text-sm text-gray-800">const session = this.neo4j.session();

    try {
      await session.executeWrite(async (tx) =&gt; {
        await tx.run(
          `MATCH (e:Entity {id: $id})
           DETACH DELETE e`,
          { id },
        );
      });
    } finally {
      await session.close();
    }
  }

  /**
   * Map database row to domain object
   */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/CaseRepo.ts (Line 119:6 - Line 134:68), server/src/repos/InvestigationRepo.ts (Line 112:5 - Line 126:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn443" onclick="toggleCodeBlock('cloneGroup443', 'expandBtn443', 'collapseBtn443')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn443" onclick="toggleCodeBlock('cloneGroup443', 'expandBtn443', 'collapseBtn443')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup443"><code class="language-typescript text-sm text-gray-800">);
      paramIndex++;
    }

    if (input.description !== undefined) {
      updateFields.push(`description = $${paramIndex}`);
      params.push(input.description);
      paramIndex++;
    }

    if (input.status !== undefined) {
      updateFields.push(`status = $${paramIndex}`);
      params.push(input.status);
      paramIndex++;

      // Auto-set closed_at and closed_by when status changes to 'closed'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/CaseRepo.ts (Line 317:67 - Line 338:6), server/src/repos/CaseRepo.ts (Line 272:51 - Line 293:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn444" onclick="toggleCodeBlock('cloneGroup444', 'expandBtn444', 'collapseBtn444')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn444" onclick="toggleCodeBlock('cloneGroup444', 'expandBtn444', 'collapseBtn444')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup444"><code class="language-typescript text-sm text-gray-800">;
    let paramIndex = 2;

    if (status) {
      query += ` AND status = $${paramIndex}`;
      params.push(status);
      paramIndex++;
    }

    if (compartment) {
      query += ` AND compartment = $${paramIndex}`;
      params.push(compartment);
      paramIndex++;
    }

    if (policyLabels &amp;&amp; policyLabels.length &gt; 0) {
      query += ` AND policy_labels &amp;&amp; $${paramIndex}`;
      params.push(policyLabels);
      paramIndex++;
    }

    const</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/repos/AuditAccessLogRepo.ts (Line 369:79 - Line 420:6), server/src/repos/AuditAccessLogRepo.ts (Line 261:63 - Line 312:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn445" onclick="toggleCodeBlock('cloneGroup445', 'expandBtn445', 'collapseBtn445')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn445" onclick="toggleCodeBlock('cloneGroup445', 'expandBtn445', 'collapseBtn445')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup445"><code class="language-typescript text-sm text-gray-800">;
    let paramIndex = 2;

    if (query.caseId) {
      sql += ` AND case_id = $${paramIndex}`;
      params.push(query.caseId);
      paramIndex++;
    }

    if (query.userId) {
      sql += ` AND user_id = $${paramIndex}`;
      params.push(query.userId);
      paramIndex++;
    }

    if (query.action) {
      sql += ` AND action = $${paramIndex}`;
      params.push(query.action);
      paramIndex++;
    }

    if (query.legalBasis) {
      sql += ` AND legal_basis = $${paramIndex}`;
      params.push(query.legalBasis);
      paramIndex++;
    }

    if (query.startTime) {
      sql += ` AND created_at &gt;= $${paramIndex}`;
      params.push(query.startTime);
      paramIndex++;
    }

    if (query.endTime) {
      sql += ` AND created_at &lt;= $${paramIndex}`;
      params.push(query.endTime);
      paramIndex++;
    }

    if (query.warrantId) {
      sql += ` AND warrant_id = $${paramIndex}`;
      params.push(query.warrantId);
      paramIndex++;
    }

    if (query.correlationId) {
      sql += ` AND correlation_id = $${paramIndex}`;
      params.push(query.correlationId);
      paramIndex++;
    }

    const</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/realtime/investigationAccess.ts (Line 20:2 - Line 40:59), server/src/realtime/investigationState.ts (Line 45:2 - Line 65:58)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn446" onclick="toggleCodeBlock('cloneGroup446', 'expandBtn446', 'collapseBtn446')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn446" onclick="toggleCodeBlock('cloneGroup446', 'expandBtn446', 'collapseBtn446')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup446"><code class="language-typescript text-sm text-gray-800">});

const redisUrl = process.env.REDIS_URL;
const redisHost = process.env.REDIS_HOST;
const redisPort = process.env.REDIS_PORT;
const redisPassword = process.env.REDIS_PASSWORD;

let redis: Redis | null = null;

try {
  if (redisUrl) {
    redis = new Redis(redisUrl);
  } else if (redisHost) {
    redis = new Redis({
      host: redisHost,
      port: Number(redisPort || 6379),
      password: redisPassword,
    });
  }
  redis?.on('error', (err) =&gt; {
    logger.warn({ err }, 'Redis unavailable for investigation access; using memory'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/publishing/revocation-registry.ts (Line 94:7 - Line 110:15), server/src/publishing/revocation-registry.ts (Line 55:2 - Line 71:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn447" onclick="toggleCodeBlock('cloneGroup447', 'expandBtn447', 'collapseBtn447')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn447" onclick="toggleCodeBlock('cloneGroup447', 'expandBtn447', 'collapseBtn447')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup447"><code class="language-typescript text-sm text-gray-800">bundleId,
      revokedAt: new Date().toISOString(),
      revokedBy: options.revokedBy,
      reason: options.reason,
      reasonDetail: options.reasonDetail,
      propagatedTo: [],
      propagationStatus: 'pending',
      signature: '',
      signatureAlgorithm: 'RSA-SHA256',
    };

    // Sign the revocation
    record.signature = this.signRevocation(record);

    // Store in registry
    this.revocations.set(revocationId, record);
    this.revokedBundles</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/publishing/revocation-registry.ts (Line 182:2 - Line 193:7), server/src/publishing/revocation-registry.ts (Line 162:2 - Line 173:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn448" onclick="toggleCodeBlock('cloneGroup448', 'expandBtn448', 'collapseBtn448')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn448" onclick="toggleCodeBlock('cloneGroup448', 'expandBtn448', 'collapseBtn448')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup448"><code class="language-typescript text-sm text-gray-800">{
    const data = JSON.stringify({
      id: record.id,
      walletId: record.walletId,
      bundleId: record.bundleId,
      revokedAt: record.revokedAt,
      revokedBy: record.revokedBy,
      reason: record.reason,
      reasonDetail: record.reasonDetail,
    });

    const verify</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/privacy/piiOntologyEngine.ts (Line 591:2 - Line 604:7), server/src/privacy/piiOntologyEngine.ts (Line 513:2 - Line 526:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn449" onclick="toggleCodeBlock('cloneGroup449', 'expandBtn449', 'collapseBtn449')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn449" onclick="toggleCodeBlock('cloneGroup449', 'expandBtn449', 'collapseBtn449')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup449"><code class="language-typescript text-sm text-gray-800">= {
      entityId: entity.id,
      recordId: entity.recordId,
      system: context.system,
      field: context.field,
      collection: context.collection,
      path:
        context.lineage?.path ??
        ([context.system, context.field].filter(Boolean) as string[]),
      transformations: context.lineage?.transformations ?? [],
      accessControls: context.accessControls ?? [],
    };

    return</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/observability/tracer.ts (Line 161:7 - Line 176:27), server/src/telemetry/tracing.ts (Line 265:2 - Line 282:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn450" onclick="toggleCodeBlock('cloneGroup450', 'expandBtn450', 'collapseBtn450')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn450" onclick="toggleCodeBlock('cloneGroup450', 'expandBtn450', 'collapseBtn450')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup450"><code class="language-typescript text-sm text-gray-800">);
      span.setStatus({ code: SpanStatusCode.OK });
      return result;
    } catch (error) {
      span.recordException(error as Error);
      span.setStatus({
        code: SpanStatusCode.ERROR,
        message: (error as Error).message,
      });
      throw error;
    } finally {
      span.end();
    }
  }

  // Get current active span</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/observability/standard-metrics.ts (Line 249:8 - Line 259:32), server/src/observability/standard-metrics.ts (Line 66:10 - Line 76:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn451" onclick="toggleCodeBlock('cloneGroup451', 'expandBtn451', 'collapseBtn451')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn451" onclick="toggleCodeBlock('cloneGroup451', 'expandBtn451', 'collapseBtn451')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup451"><code class="language-typescript text-sm text-gray-800">;

  constructor(registry: Registry, config: Partial&lt;MetricsConfig&gt; = {}) {
    this.registry = registry;
    this.config = {
      enabled: config.enabled ?? true,
      prefix: config.prefix || 'intelgraph',
      defaultLabels: config.defaultLabels || {},
    };

    // Utilization metrics (% busy)</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/observability/otel-full.ts (Line 135:5 - Line 148:2), server/src/telemetry/tracing.ts (Line 265:2 - Line 282:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn452" onclick="toggleCodeBlock('cloneGroup452', 'expandBtn452', 'collapseBtn452')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn452" onclick="toggleCodeBlock('cloneGroup452', 'expandBtn452', 'collapseBtn452')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup452"><code class="language-typescript text-sm text-gray-800">);
      span.setStatus({ code: SpanStatusCode.OK });
      return result;
    } catch (error) {
      span.recordException(error as Error);
      span.setStatus({
        code: SpanStatusCode.ERROR,
        message: (error as Error).message,
      });
      throw error;
    } finally {
      span.end();
    }
  })</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/observability/metrics-enhanced.ts (Line 273:6 - Line 285:82), server/src/observability/metrics.ts (Line 46:2 - Line 58:34)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn453" onclick="toggleCodeBlock('cloneGroup453', 'expandBtn453', 'collapseBtn453')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn453" onclick="toggleCodeBlock('cloneGroup453', 'expandBtn453', 'collapseBtn453')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup453"><code class="language-typescript text-sm text-gray-800">,
  registers: [registry],
});

export const httpRequestDuration = new Histogram({
  name: 'intelgraph_http_request_duration_seconds',
  help: 'HTTP request duration in seconds',
  labelNames: ['method', 'route', 'status'] as const,
  buckets: [0.01, 0.05, 0.1, 0.5, 1, 2, 5],
  registers: [registry],
});

// ==============================================================================</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/nl2cypher/index.ts (Line 51:8 - Line 61:29), server/src/nl2cypher/index.ts (Line 24:7 - Line 34:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn454" onclick="toggleCodeBlock('cloneGroup454', 'expandBtn454', 'collapseBtn454')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn454" onclick="toggleCodeBlock('cloneGroup454', 'expandBtn454', 'collapseBtn454')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup454"><code class="language-typescript text-sm text-gray-800">${label}`, clause: `MATCH (n:${label})` },
    ];
    if (prop &amp;&amp; value) {
      const val = value.trim();
      cypher += ` {${prop}: '${val}'}`;
      rationale.push({
        phrase: `where ${prop} is ${val}`,
        clause: `${prop}: '${val}'`,
      });
    }
    cypher += ') RETURN count(n) AS count'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/monitoring/opentelemetry.ts (Line 61:7 - Line 71:23), server/src/observability/tracing.ts (Line 81:7 - Line 89:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn459" onclick="toggleCodeBlock('cloneGroup459', 'expandBtn459', 'collapseBtn459')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn459" onclick="toggleCodeBlock('cloneGroup459', 'expandBtn459', 'collapseBtn459')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup459"><code class="language-typescript text-sm text-gray-800">const resource = Resource.default().merge(
        new Resource({
          [SemanticResourceAttributes.SERVICE_NAME]: this.config.serviceName,
          [SemanticResourceAttributes.SERVICE_VERSION]:
            this.config.serviceVersion,
          [SemanticResourceAttributes.DEPLOYMENT_ENVIRONMENT]:
            this.config.environment,
        }),
      );

      // Configure exporters</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/monitoring/opentelemetry.ts (Line 269:10 - Line 286:6), server/src/monitoring/opentelemetry.ts (Line 238:10 - Line 255:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn460" onclick="toggleCodeBlock('cloneGroup460', 'expandBtn460', 'collapseBtn460')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn460" onclick="toggleCodeBlock('cloneGroup460', 'expandBtn460', 'collapseBtn460')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup460"><code class="language-typescript text-sm text-gray-800">();
        span.setStatus({ code: SpanStatusCode.OK });
        return result;
      } catch (error) {
        span.setStatus({
          code: SpanStatusCode.ERROR,
          message: error instanceof Error ? error.message : 'Unknown error',
        });
        throw error;
      } finally {
        span.end();
      }
    });
  }

  /**
   * Add custom span attributes
   */</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/migrations/migrationFramework.ts (Line 396:17 - Line 409:15), server/src/services/CostOptimizationService.ts (Line 130:7 - Line 90:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn462" onclick="toggleCodeBlock('cloneGroup462', 'expandBtn462', 'collapseBtn462')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn462" onclick="toggleCodeBlock('cloneGroup462', 'expandBtn462', 'collapseBtn462')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup462"><code class="language-typescript text-sm text-gray-800">,
          });
        } catch (error) {
          span.recordException(error as Error);
          span.setStatus({ code: 2, message: (error as Error).message });
          throw error;
        } finally {
          span.end();
        }
      },
    );
  }

  private async executeSQLStep</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/migrations/migrationFramework.ts (Line 685:10 - Line 698:12), server/src/services/CostOptimizationService.ts (Line 130:7 - Line 90:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn463" onclick="toggleCodeBlock('cloneGroup463', 'expandBtn463', 'collapseBtn463')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn463" onclick="toggleCodeBlock('cloneGroup463', 'expandBtn463', 'collapseBtn463')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup463"><code class="language-typescript text-sm text-gray-800">,
          });
        } catch (error) {
          span.recordException(error as Error);
          span.setStatus({ code: 2, message: (error as Error).message });
          throw error;
        } finally {
          span.end();
        }
      },
    );
  }

  private async acquireLock</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/middleware/rbac.ts (Line 39:2 - Line 50:6), server/src/middleware/rbac.ts (Line 13:7 - Line 24:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn464" onclick="toggleCodeBlock('cloneGroup464', 'expandBtn464', 'collapseBtn464')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn464" onclick="toggleCodeBlock('cloneGroup464', 'expandBtn464', 'collapseBtn464')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup464"><code class="language-typescript text-sm text-gray-800">) {
  return (
    req: AuthenticatedRequest,
    res: Response,
    next: NextFunction,
  ): Response | void =&gt; {
    const user = req.user;
    if (!user) {
      return res.status(401).json({ error: 'Authentication required' });
    }

    const</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/middleware/rbac.ts (Line 68:22 - Line 79:7), server/src/middleware/rbac.ts (Line 39:21 - Line 50:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn465" onclick="toggleCodeBlock('cloneGroup465', 'expandBtn465', 'collapseBtn465')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn465" onclick="toggleCodeBlock('cloneGroup465', 'expandBtn465', 'collapseBtn465')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup465"><code class="language-typescript text-sm text-gray-800">(permissions: string[]) {
  return (
    req: AuthenticatedRequest,
    res: Response,
    next: NextFunction,
  ): Response | void =&gt; {
    const user = req.user;
    if (!user) {
      return res.status(401).json({ error: 'Authentication required' });
    }

    const hasAll</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/middleware/rbac.ts (Line 97:5 - Line 109:5), server/src/middleware/rbac.ts (Line 13:11 - Line 24:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn466" onclick="toggleCodeBlock('cloneGroup466', 'expandBtn466', 'collapseBtn466')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn466" onclick="toggleCodeBlock('cloneGroup466', 'expandBtn466', 'collapseBtn466')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup466"><code class="language-typescript text-sm text-gray-800">: string) {
  return (
    req: AuthenticatedRequest,
    res: Response,
    next: NextFunction,
  ): Response | void =&gt; {
    const user = req.user;
    if (!user) {
      return res.status(401).json({ error: 'Authentication required' });
    }

    if (
      user</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/middleware/opa-with-appeals.ts (Line 27:2 - Line 58:11), server/src/middleware/opa.ts (Line 15:21 - Line 46:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn467" onclick="toggleCodeBlock('cloneGroup467', 'expandBtn467', 'collapseBtn467')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn467" onclick="toggleCodeBlock('cloneGroup467', 'expandBtn467', 'collapseBtn467')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup467"><code class="language-typescript text-sm text-gray-800">;

interface User {
  id?: string;
  email?: string;
  role?: string;
  tenantId?: string;
  permissions?: string[];
}

interface PolicyInput {
  user?: User;
  action: string;
  resource: {
    type: string;
    field?: string;
    path?: string;
    method?: string;
    args?: any;
    params?: any;
    query?: any;
  };
  context: {
    investigationId?: string;
    entityType?: string;
    tenantId?: string;
    ip?: string;
    userAgent?: string;
  };
}

interface AppealPath</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/middleware/abuseGuard.ts (Line 101:5 - Line 116:25), server/src/middleware/graphAbuseGuard.ts (Line 237:2 - Line 252:31)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn469" onclick="toggleCodeBlock('cloneGroup469', 'expandBtn469', 'collapseBtn469')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn469" onclick="toggleCodeBlock('cloneGroup469', 'expandBtn469', 'collapseBtn469')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup469"><code class="language-typescript text-sm text-gray-800">);
  }

  // Express middleware factory
  public middleware() {
    return async (
      req: Request,
      res: Response,
      next: NextFunction,
    ): Promise&lt;void&gt; =&gt; {
      if (!this.config.enabled) {
        return next();
      }

      return tracer.startActiveSpan(
        'abuse_guard.middleware'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ingest/http.ts (Line 133:2 - Line 145:22), server/src/services/CostOptimizationService.ts (Line 131:11 - Line 90:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn470" onclick="toggleCodeBlock('cloneGroup470', 'expandBtn470', 'collapseBtn470')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn470" onclick="toggleCodeBlock('cloneGroup470', 'expandBtn470', 'collapseBtn470')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup470"><code class="language-typescript text-sm text-gray-800">});
        } catch (error) {
          span.recordException(error as Error);
          span.setStatus({ code: 2, message: (error as Error).message });
          throw error;
        } finally {
          span.end();
        }
      },
    );
  }

  private async updateCoherenceScores</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers.er.ts (Line 83:2 - Line 100:2), server/src/graphql/resolvers.er.ts (Line 42:2 - Line 59:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn473" onclick="toggleCodeBlock('cloneGroup473', 'expandBtn473', 'collapseBtn473')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn473" onclick="toggleCodeBlock('cloneGroup473', 'expandBtn473', 'collapseBtn473')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup473"><code class="language-typescript text-sm text-gray-800">{
          id: row.id,
          entityA: row.entity_a_id,
          entityB: row.entity_b_id,
          decision: row.decision,
          score: parseFloat(row.score),
          confidence: row.confidence ? parseFloat(row.confidence) : null,
          explanation: row.explanation,
          featureScores: row.feature_scores,
          modelVersion: row.model_version,
          method: row.method.toUpperCase(),
          riskScore: parseFloat(row.risk_score),
          reviewRequired: row.review_required,
          entityType: row.entity_type,
          createdAt: row.created_at,
          updatedAt: row.updated_at,
          createdBy: row.created_by,
        };</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers.er.ts (Line 448:2 - Line 458:2), server/src/graphql/resolvers.er.ts (Line 233:2 - Line 243:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn474" onclick="toggleCodeBlock('cloneGroup474', 'expandBtn474', 'collapseBtn474')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn474" onclick="toggleCodeBlock('cloneGroup474', 'expandBtn474', 'collapseBtn474')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup474"><code class="language-typescript text-sm text-gray-800">{
          id: row.id.toString(),
          prNumber: row.pr_number,
          commitSha: row.commit_sha,
          entityType: row.entity_type,
          precision: parseFloat(row.precision),
          sampleSize: row.sample_size,
          meetsThreshold: row.meets_threshold,
          threshold: parseFloat(row.threshold),
          createdAt: row.created_at,
        };</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers-tracing.ts (Line 136:9 - Line 147:2), server/src/telemetry/tracing.ts (Line 267:7 - Line 148:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn480" onclick="toggleCodeBlock('cloneGroup480', 'expandBtn480', 'collapseBtn480')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn480" onclick="toggleCodeBlock('cloneGroup480', 'expandBtn480', 'collapseBtn480')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup480"><code class="language-typescript text-sm text-gray-800">;
          } catch (error) {
            span.recordException(error as Error);
            span.setStatus({
              code: SpanStatusCode.ERROR,
              message: (error as Error).message,
            });
            throw error;
          } finally {
            span.end();
          }
        }),</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers-combined.ts (Line 9:14 - Line 38:22), server/src/graphql/resolvers/legacy.ts (Line 8:30 - Line 37:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn481" onclick="toggleCodeBlock('cloneGroup481', 'expandBtn481', 'collapseBtn481')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn481" onclick="toggleCodeBlock('cloneGroup481', 'expandBtn481', 'collapseBtn481')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup481"><code class="language-typescript text-sm text-gray-800">;

interface User {
  id: string;
  email?: string;
  firstName?: string;
  lastName?: string;
  role?: string;
  permissions?: string[];
}

interface Context {
  user?: User;
  req?: any;
  pubsub?: PubSub;
}

interface LoginInput {
  email: string;
  password: string;
}

interface RegisterInput {
  email: string;
  password: string;
  firstName?: string;
  lastName?: string;
}

interface CreateCopilotGoalArgs</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers-combined.ts (Line 44:3 - Line 58:10), server/src/graphql/resolvers/legacy.ts (Line 68:3 - Line 82:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn482" onclick="toggleCodeBlock('cloneGroup482', 'expandBtn482', 'collapseBtn482')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn482" onclick="toggleCodeBlock('cloneGroup482', 'expandBtn482', 'collapseBtn482')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup482"><code class="language-typescript text-sm text-gray-800">investigationId?: string;
}

const pubsub = new PubSub();
const authService = new AuthService();

const goals: Array&lt;{
  id: string;
  text: string;
  investigationId: string | null;
  createdAt: string;
}&gt; = []; // replace with DB later
let seq = 1;

export const resolvers</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/resolvers-combined.ts (Line 82:5 - Line 118:2), server/src/graphql/resolvers/legacy.ts (Line 84:5 - Line 121:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn483" onclick="toggleCodeBlock('cloneGroup483', 'expandBtn483', 'collapseBtn483')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn483" onclick="toggleCodeBlock('cloneGroup483', 'expandBtn483', 'collapseBtn483')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup483"><code class="language-typescript text-sm text-gray-800">login: async (
      _: any,
      { input }: { input: LoginInput },
      { req }: Context,
    ) =&gt; {
      const { email, password } = input;
      const ipAddress = req?.ip;
      const userAgent = req?.get('User-Agent');

      return await authService.login(email, password, ipAddress, userAgent);
    },

    register: async (_: any, { input }: { input: RegisterInput }) =&gt; {
      return await authService.register(input);
    },

    createCopilotGoal: async (
      _: any,
      { text, investigationId }: CreateCopilotGoalArgs,
    ) =&gt; {
      if (!text || !text.trim()) {
        throw new Error('Goal text is required');
      }
      const goal = {
        id: String(seq++),
        text: text.trim(),
        investigationId: investigationId ? String(investigationId) : null,
        createdAt: new Date().toISOString(),
      };
      goals.unshift(goal);
      return goal;
    },

    logout: async () =&gt; {
      return true;
    },
  }</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/graphql/ai-insights-schema.ts (Line 299:9 - Line 309:20), server/src/graphql/ai-insights-schema.ts (Line 263:9 - Line 273:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn484" onclick="toggleCodeBlock('cloneGroup484', 'expandBtn484', 'collapseBtn484')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn484" onclick="toggleCodeBlock('cloneGroup484', 'expandBtn484', 'collapseBtn484')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup484"><code class="language-typescript text-sm text-gray-800">try {
          // Convert entity to AI service format
          const aiEntity = {
            id: entity.id,
            name: entity.name || entity.title || 'Unknown',
            type: entity.type || 'unknown',
            attributes: entity.attributes || {},
            metadata: entity.metadata || {},
          };

          // Get entity score</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/federal/slsa3-verifier.ts (Line 625:2 - Line 639:2), server/src/federal/slsa3-verifier.ts (Line 564:2 - Line 578:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn485" onclick="toggleCodeBlock('cloneGroup485', 'expandBtn485', 'collapseBtn485')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn485" onclick="toggleCodeBlock('cloneGroup485', 'expandBtn485', 'collapseBtn485')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup485"><code class="language-typescript text-sm text-gray-800">{
            valid: false,
            level: 'SLSA_0',
            provenance: null,
            checks: {
              formatValid: false,
              signatureValid: false,
              builderTrusted: false,
              sourceIntegrity: false,
              hermetic: false,
              reproduced: false,
            },
            errors: [error.message],
            warnings: [],
          },</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/federal/hsm-enforcement.ts (Line 217:30 - Line 230:30), server/src/federal/hsm-enforcement.ts (Line 156:42 - Line 169:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn486" onclick="toggleCodeBlock('cloneGroup486', 'expandBtn486', 'collapseBtn486')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn486" onclick="toggleCodeBlock('cloneGroup486', 'expandBtn486', 'collapseBtn486')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup486"><code class="language-typescript text-sm text-gray-800">;
      const pkcs11 = await import('pkcs11js').catch(() =&gt; null);

      if (!pkcs11) {
        throw new Error('PKCS#11 library not available');
      }

      const p11 = new pkcs11.PKCS11();
      p11.load(libPath);
      p11.C_Initialize();

      const slots = p11.C_GetSlotList(true);
      if (slots.length === 0) {
        throw new Error('No Luna HSM slots available'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/pg.ts (Line 221:7 - Line 245:25), server/src/db/pg.ts (Line 148:9 - Line 172:29)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn487" onclick="toggleCodeBlock('cloneGroup487', 'expandBtn487', 'collapseBtn487')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn487" onclick="toggleCodeBlock('cloneGroup487', 'expandBtn487', 'collapseBtn487')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup487"><code class="language-typescript text-sm text-gray-800">,
            operation,
            tenant_id: options?.tenantId || 'unknown',
          },
          duration,
        );

        span.setAttributes({
          'db.rows_affected': result.rowCount || 0,
          'db.tenant_scoped': scopedQuery.wasScoped,
          'db.query_duration': duration,
        });

        return result.rows[0] || null;
      } catch (error) {
        span.recordException(error as Error);
        span.setStatus({ code: 2, message: (error as Error).message });
        throw error;
      } finally {
        span.end();
      }
    });
  },

  // Explicit write method</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/pg.ts (Line 269:8 - Line 284:8), server/src/db/pg.ts (Line 193:7 - Line 208:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn488" onclick="toggleCodeBlock('cloneGroup488', 'expandBtn488', 'collapseBtn488')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn488" onclick="toggleCodeBlock('cloneGroup488', 'expandBtn488', 'collapseBtn488')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup488"><code class="language-typescript text-sm text-gray-800">,
        'db.region': currentRegion,
        tenant_id: options?.tenantId || 'unknown',
      });

      const scopedQuery = validateAndScopeQuery(
        query,
        params,
        options?.tenantId,
      );
      const startTime = Date.now();

      try {
        dbConnectionsActive.inc({
          region: currentRegion,
          pool_type: 'write'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/pg.ts (Line 297:8 - Line 321:21), server/src/db/pg.ts (Line 148:9 - Line 172:29)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn489" onclick="toggleCodeBlock('cloneGroup489', 'expandBtn489', 'collapseBtn489')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn489" onclick="toggleCodeBlock('cloneGroup489', 'expandBtn489', 'collapseBtn489')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup489"><code class="language-typescript text-sm text-gray-800">,
            operation,
            tenant_id: options?.tenantId || 'unknown',
          },
          duration,
        );

        span.setAttributes({
          'db.rows_affected': result.rowCount || 0,
          'db.tenant_scoped': scopedQuery.wasScoped,
          'db.query_duration': duration,
        });

        return result.rows[0] || null;
      } catch (error) {
        span.recordException(error as Error);
        span.setStatus({ code: 2, message: (error as Error).message });
        throw error;
      } finally {
        span.end();
      }
    });
  },

  // Read many records</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/pg.ts (Line 333:47 - Line 354:6), server/src/db/pg.ts (Line 185:43 - Line 206:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn490" onclick="toggleCodeBlock('cloneGroup490', 'expandBtn490', 'collapseBtn490')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn490" onclick="toggleCodeBlock('cloneGroup490', 'expandBtn490', 'collapseBtn490')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup490"><code class="language-typescript text-sm text-gray-800">${operation}`,
        );
      }

      span.setAttributes({
        'db.system': 'postgresql',
        'db.statement': query,
        'db.operation': operation,
        'db.pool_type': 'read',
        'db.region': currentRegion,
        tenant_id: options?.tenantId || 'unknown',
      });

      const scopedQuery = validateAndScopeQuery(
        query,
        params,
        options?.tenantId,
      );
      const startTime = Date.now();

      try {
        const</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/pg.ts (Line 354:9 - Line 376:2), server/src/db/pg.ts (Line 212:9 - Line 234:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn491" onclick="toggleCodeBlock('cloneGroup491', 'expandBtn491', 'collapseBtn491')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn491" onclick="toggleCodeBlock('cloneGroup491', 'expandBtn491', 'collapseBtn491')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup491"><code class="language-typescript text-sm text-gray-800">const result = await readPool.query(
          scopedQuery.query,
          scopedQuery.params,
        );

        const duration = (Date.now() - startTime) / 1000;
        dbQueryDuration.observe(
          {
            region: currentRegion,
            pool_type: 'read',
            operation,
            tenant_id: options?.tenantId || 'unknown',
          },
          duration,
        );

        span.setAttributes({
          'db.rows_affected': result.rowCount || 0,
          'db.tenant_scoped': scopedQuery.wasScoped,
          'db.query_duration': duration,
        });

        return result.rows;</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/pg.ts (Line 376:5 - Line 387:5), server/src/services/CostOptimizationService.ts (Line 131:2 - Line 172:29)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn492" onclick="toggleCodeBlock('cloneGroup492', 'expandBtn492', 'collapseBtn492')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn492" onclick="toggleCodeBlock('cloneGroup492', 'expandBtn492', 'collapseBtn492')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup492"><code class="language-typescript text-sm text-gray-800">;
      } catch (error) {
        span.recordException(error as Error);
        span.setStatus({ code: 2, message: (error as Error).message });
        throw error;
      } finally {
        span.end();
      }
    });
  },

  many</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/pg.ts (Line 411:10 - Line 424:37), server/src/db/pg.ts (Line 373:9 - Line 172:29)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn493" onclick="toggleCodeBlock('cloneGroup493', 'expandBtn493', 'collapseBtn493')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn493" onclick="toggleCodeBlock('cloneGroup493', 'expandBtn493', 'collapseBtn493')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup493"><code class="language-typescript text-sm text-gray-800">,
        });
        return result.rows;
      } catch (error) {
        span.recordException(error as Error);
        span.setStatus({ code: 2, message: (error as Error).message });
        throw error;
      } finally {
        span.end();
      }
    });
  },

  // Tenant-scoped transaction support</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/pg.ts (Line 445:9 - Line 455:2), server/src/services/CostOptimizationService.ts (Line 131:2 - Line 90:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn494" onclick="toggleCodeBlock('cloneGroup494', 'expandBtn494', 'collapseBtn494')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn494" onclick="toggleCodeBlock('cloneGroup494', 'expandBtn494', 'collapseBtn494')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup494"><code class="language-typescript text-sm text-gray-800">);
        } catch (error) {
          span.recordException(error as Error);
          span.setStatus({ code: 2, message: (error as Error).message });
          throw error;
        } finally {
          span.end();
        }
      },
    );
  },</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/pg.ts (Line 610:3 - Line 625:2), server/src/db/pg.ts (Line 584:3 - Line 599:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn495" onclick="toggleCodeBlock('cloneGroup495', 'expandBtn495', 'collapseBtn495')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn495" onclick="toggleCodeBlock('cloneGroup495', 'expandBtn495', 'collapseBtn495')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup495"><code class="language-typescript text-sm text-gray-800">if (lowerQuery.includes('where')) {
    const scopedQuery = query + ` AND tenant_id = $${params.length + 1}`;
    return {
      query: scopedQuery,
      params: [...params, tenantId],
      wasScoped: true,
    };
  } else {
    const scopedQuery = query + ` WHERE tenant_id = $${params.length + 1}`;
    return {
      query: scopedQuery,
      params: [...params, tenantId],
      wasScoped: true,
    };
  }
}</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/indexManager.ts (Line 268:24 - Line 281:19), server/src/graphql/intelgraph/resolvers.ts (Line 227:6 - Line 90:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn496" onclick="toggleCodeBlock('cloneGroup496', 'expandBtn496', 'collapseBtn496')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn496" onclick="toggleCodeBlock('cloneGroup496', 'expandBtn496', 'collapseBtn496')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup496"><code class="language-typescript text-sm text-gray-800">();
          }
        } catch (error) {
          span.recordException(error as Error);
          span.setStatus({ code: 2, message: (error as Error).message });
          throw error;
        } finally {
          span.end();
        }
      },
    );
  }

  private async getNeo4jIndexStats</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/indexManager.ts (Line 380:16 - Line 392:21), server/src/services/CostOptimizationService.ts (Line 131:2 - Line 90:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn497" onclick="toggleCodeBlock('cloneGroup497', 'expandBtn497', 'collapseBtn497')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn497" onclick="toggleCodeBlock('cloneGroup497', 'expandBtn497', 'collapseBtn497')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup497"><code class="language-typescript text-sm text-gray-800">;
        } catch (error) {
          span.recordException(error as Error);
          span.setStatus({ code: 2, message: (error as Error).message });
          throw error;
        } finally {
          span.end();
        }
      },
    );
  }

  private analyzeQueryPatterns</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/db/budgetLedger.ts (Line 412:56 - Line 430:3), server/src/db/budgetLedger.ts (Line 281:54 - Line 299:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn498" onclick="toggleCodeBlock('cloneGroup498', 'expandBtn498', 'collapseBtn498')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn498" onclick="toggleCodeBlock('cloneGroup498', 'expandBtn498', 'collapseBtn498')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup498"><code class="language-typescript text-sm text-gray-800">,
        [tenantId],
      );

      if (result.rows.length === 0) {
        return null;
      }

      const row = result.rows[0];
      return {
        tenantId: row.tenant_id,
        monthlyUsdLimit: parseFloat(row.monthly_usd_limit),
        dailyUsdLimit: row.daily_usd_limit
          ? parseFloat(row.daily_usd_limit)
          : undefined,
        hardCap: row.hard_cap,
        notificationThreshold: parseFloat(row.notification_threshold),
        emergencyContact: row.emergency_contact,
        updatedBy: row.updated_by ||</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/crystal/worktree-engine.ts (Line 122:7 - Line 134:15), server/src/crystal/worktree-engine.ts (Line 93:7 - Line 105:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn499" onclick="toggleCodeBlock('cloneGroup499', 'expandBtn499', 'collapseBtn499')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn499" onclick="toggleCodeBlock('cloneGroup499', 'expandBtn499', 'collapseBtn499')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup499"><code class="language-typescript text-sm text-gray-800">,
  ): Promise&lt;WorktreeMetadata&gt; {
    const worktree = this.worktrees.get(worktreeId);
    if (!worktree) {
      throw new Error(`Unknown worktree ${worktreeId}`);
    }
    const queue = this.getQueue(worktree.repoPath);
    return queue.enqueue(async () =&gt; {
      const now = new Date().toISOString();
      const updated: WorktreeMetadata = {
        ...worktree,
        status: 'rebase',
        lastSquashedAt</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/context/tenant.ts (Line 184:14 - Line 196:21), server/src/services/CostOptimizationService.ts (Line 131:2 - Line 90:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn501" onclick="toggleCodeBlock('cloneGroup501', 'expandBtn501', 'collapseBtn501')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn501" onclick="toggleCodeBlock('cloneGroup501', 'expandBtn501', 'collapseBtn501')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup501"><code class="language-typescript text-sm text-gray-800">;
        } catch (error) {
          span.recordException(error as Error);
          span.setStatus({ code: 2, message: (error as Error).message });
          throw error;
        } finally {
          span.end();
        }
      },
    );
  }

  validateRegionAccess</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/context/tenant.ts (Line 398:5 - Line 416:28), server/src/middleware/tenantValidator.ts (Line 75:5 - Line 93:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn502" onclick="toggleCodeBlock('cloneGroup502', 'expandBtn502', 'collapseBtn502')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn502" onclick="toggleCodeBlock('cloneGroup502', 'expandBtn502', 'collapseBtn502')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup502"><code class="language-typescript text-sm text-gray-800">// Cross-tenant access validation
    if (
      validateOwnership &amp;&amp;
      resourceTenantId &amp;&amp;
      resourceTenantId !== userTenantId
    ) {
      logger.error(
        `Cross-tenant access denied: User ${userId} (tenant: ${userTenantId}) attempted to access resource (tenant: ${resourceTenantId})`,
      );
      throw new GraphQLError('Cross-tenant access denied', {
        extensions: {
          code: 'CROSS_TENANT_ACCESS_DENIED',
          userTenant: userTenantId,
          resourceTenant: resourceTenantId,
        },
      });
    }

    // Region access validation</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/context/tenant.ts (Line 454:2 - Line 468:12), server/src/middleware/tenantValidator.ts (Line 193:2 - Line 207:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn503" onclick="toggleCodeBlock('cloneGroup503', 'expandBtn503', 'collapseBtn503')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn503" onclick="toggleCodeBlock('cloneGroup503', 'expandBtn503', 'collapseBtn503')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup503"><code class="language-typescript text-sm text-gray-800">calculatePermissions(roles: string[]): string[] {
    const permissions: Set&lt;string&gt; = new Set();

    roles.forEach((role) =&gt; {
      switch (role.toUpperCase()) {
        case 'SUPER_ADMIN':
        case 'SYSTEM':
          permissions.add('*');
          break;
        case 'ADMIN':
          permissions.add('investigations:*');
          permissions.add('entities:*');
          permissions.add('relationships:*');
          permissions.add('users:read');
          permissions</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/context/tenant.ts (Line 468:16 - Line 484:5), server/src/middleware/tenantValidator.ts (Line 206:13 - Line 222:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn504" onclick="toggleCodeBlock('cloneGroup504', 'expandBtn504', 'collapseBtn504')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn504" onclick="toggleCodeBlock('cloneGroup504', 'expandBtn504', 'collapseBtn504')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup504"><code class="language-typescript text-sm text-gray-800">);
          break;
        case 'ANALYST':
          permissions.add('investigations:read');
          permissions.add('investigations:write');
          permissions.add('entities:read');
          permissions.add('entities:write');
          permissions.add('relationships:read');
          permissions.add('relationships:write');
          permissions.add('graphrag:query');
          break;
        case 'VIEWER':
          permissions.add('investigations:read');
          permissions.add('entities:read');
          permissions.add('relationships:read');
          break;
        case</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/connectors/jdbc.ts (Line 466:7 - Line 477:8), server/src/connectors/jdbc.ts (Line 298:9 - Line 309:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn505" onclick="toggleCodeBlock('cloneGroup505', 'expandBtn505', 'collapseBtn505')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn505" onclick="toggleCodeBlock('cloneGroup505', 'expandBtn505', 'collapseBtn505')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup505"><code class="language-typescript text-sm text-gray-800">,
          executionTime,
        });

        return result;
      } catch (error) {
        span.recordException?.(error as Error);
        span.setStatus?.({ message: (error as Error).message });
        jdbcOperations.inc({
          tenant_id: this.tenantId,
          database_type: this.config.type,
          operation: 'batch'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/connectors/jdbc.ts (Line 619:13 - Line 641:2), server/src/connectors/jdbc.ts (Line 557:11 - Line 579:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn506" onclick="toggleCodeBlock('cloneGroup506', 'expandBtn506', 'collapseBtn506')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn506" onclick="toggleCodeBlock('cloneGroup506', 'expandBtn506', 'collapseBtn506')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup506"><code class="language-typescript text-sm text-gray-800">]),
    ]);

    return {
      tables: tablesResult.rows.map((row) =&gt; ({
        name: row.table_name,
        schema: row.table_schema,
        type: row.table_type === 'BASE TABLE' ? 'TABLE' : 'VIEW',
        comment: row.comment,
      })),
      columns: columnsResult.rows.map((row) =&gt; ({
        table: row.table_name,
        name: row.column_name,
        type: row.data_type,
        nullable: row.nullable,
        defaultValue: row.default_value,
        isPrimaryKey: row.is_primary_key,
        isForeignKey: row.is_foreign_key,
      })),
      indexes: indexesResult.rows.map((row) =&gt; ({
        table: row.table_name,
        name: row.index_name,
        columns: row.columns.</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/connectors/gcs.ts (Line 21:9 - Line 38:11), server/src/connectors/jdbc.ts (Line 12:9 - Line 29:45)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn507" onclick="toggleCodeBlock('cloneGroup507', 'expandBtn507', 'collapseBtn507')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn507" onclick="toggleCodeBlock('cloneGroup507', 'expandBtn507', 'collapseBtn507')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup507"><code class="language-typescript text-sm text-gray-800">;

const tracer = {
  startActiveSpan: async (
    _name: string,
    fn: (span: any) =&gt; Promise&lt;any&gt; | any,
  ) =&gt; {
    const span = {
      setAttributes: (_a?: any) =&gt; {},
      recordException: (_e?: any) =&gt; {},
      setStatus: (_s?: any) =&gt; {},
      end: () =&gt; {},
    };
    return await fn(span);
  },
};

// Metrics</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/connectors/gcs.ts (Line 384:19 - Line 395:6), server/src/connectors/gcs.ts (Line 341:20 - Line 352:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn508" onclick="toggleCodeBlock('cloneGroup508', 'expandBtn508', 'collapseBtn508')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn508" onclick="toggleCodeBlock('cloneGroup508', 'expandBtn508', 'collapseBtn508')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup508"><code class="language-typescript text-sm text-gray-800">, async (span: any) =&gt; {
      span.setAttributes({
        tenant_id: this.tenantId,
        bucket: this.config.bucketName,
        object_name: objectName,
      });

      const startTime = Date.now();

      try {
        const file = this.bucket.file(objectName);
        const</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/connectors/azure.ts (Line 25:9 - Line 43:16), server/src/connectors/jdbc.ts (Line 12:9 - Line 39:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn509" onclick="toggleCodeBlock('cloneGroup509', 'expandBtn509', 'collapseBtn509')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn509" onclick="toggleCodeBlock('cloneGroup509', 'expandBtn509', 'collapseBtn509')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup509"><code class="language-typescript text-sm text-gray-800">;

const tracer = {
  startActiveSpan: async (
    _name: string,
    fn: (span: any) =&gt; Promise&lt;any&gt; | any,
  ) =&gt; {
    const span = {
      setAttributes: (_a?: any) =&gt; {},
      recordException: (_e?: any) =&gt; {},
      setStatus: (_s?: any) =&gt; {},
      end: () =&gt; {},
    };
    return await fn(span);
  },
};

// Metrics
const azureOperations</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/connectors/azure.ts (Line 782:17 - Line 795:16), server/src/connectors/gcs.ts (Line 614:15 - Line 627:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn510" onclick="toggleCodeBlock('cloneGroup510', 'expandBtn510', 'collapseBtn510')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn510" onclick="toggleCodeBlock('cloneGroup510', 'expandBtn510', 'collapseBtn510')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup510"><code class="language-typescript text-sm text-gray-800">.dec({ tenant_id: this.tenantId });
    this.emit('disconnected', { tenantId: this.tenantId });
  }

  // Health check method
  async healthCheck(): Promise&lt;{
    healthy: boolean;
    latency?: number;
    error?: string;
  }&gt; {
    const startTime = Date.now();

    try {
      await this.containerClient</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/connectors/azure.ts (Line 795:16 - Line 809:10), server/src/connectors/gcs.ts (Line 627:7 - Line 641:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn511" onclick="toggleCodeBlock('cloneGroup511', 'expandBtn511', 'collapseBtn511')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn511" onclick="toggleCodeBlock('cloneGroup511', 'expandBtn511', 'collapseBtn511')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup511"><code class="language-typescript text-sm text-gray-800">.exists();
      const latency = Date.now() - startTime;

      return { healthy: true, latency };
    } catch (error) {
      return {
        healthy: false,
        latency: Date.now() - startTime,
        error: (error as Error).message,
      };
    }
  }

  // Batch operations
  async batchDelete(blobNames</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/resolvers.ts (Line 73:8 - Line 88:50), server/src/conductor/resolvers.ts (Line 20:15 - Line 35:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn512" onclick="toggleCodeBlock('cloneGroup512', 'expandBtn512', 'collapseBtn512')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn512" onclick="toggleCodeBlock('cloneGroup512', 'expandBtn512', 'collapseBtn512')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup512"><code class="language-typescript text-sm text-gray-800">: async (
      _: any,
      { input }: { input: ConductInput },
      context: any,
    ) =&gt; {
      if (!conductor) {
        throw new Error('Conductor not initialized');
      }

      // Create security context and enforce policy
      const securityContext = OPAClient.createSecurityContext(context.user, {
        requestsLastHour: context.requestsLastHour || 0,
        location: context.location || 'Unknown',
      });

      // Get routing decision first to determine expert</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/conductor/config.ts (Line 172:27 - Line 186:27), server/src/conductor/mcp/servers/graphops-server.ts (Line 56:52 - Line 71:65)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn513" onclick="toggleCodeBlock('cloneGroup513', 'expandBtn513', 'collapseBtn513')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn513" onclick="toggleCodeBlock('cloneGroup513', 'expandBtn513', 'collapseBtn513')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup513"><code class="language-typescript text-sm text-gray-800">,
            schema: {
              type: 'object',
              properties: {
                cypher: { type: 'string' },
                params: { type: 'object' },
                tenantId: { type: 'string' },
              },
              required: ['cypher'],
            },
            scopes: ['graph:write'],
          },
          {
            name: 'graph.alg',
            description: 'Execute graph algorithms'</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/coherence/routes.ts (Line 488:12 - Line 501:13), server/src/coherence/routes.ts (Line 434:6 - Line 447:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn514" onclick="toggleCodeBlock('cloneGroup514', 'expandBtn514', 'collapseBtn514')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn514" onclick="toggleCodeBlock('cloneGroup514', 'expandBtn514', 'collapseBtn514')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup514"><code class="language-typescript text-sm text-gray-800">,
        startTime,
        endTime,
      } = req.query;

      if (!tenantId) {
        return res.status(400).json({
          error: 'tenantId is required',
        });
      }

      const options: any = {
        limit: parseInt(limit as string),
        minMagnitude</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/cases/CaseService.ts (Line 152:11 - Line 162:51), server/src/cases/CaseService.ts (Line 54:8 - Line 64:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn515" onclick="toggleCodeBlock('cloneGroup515', 'expandBtn515', 'collapseBtn515')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn515" onclick="toggleCodeBlock('cloneGroup515', 'expandBtn515', 'collapseBtn515')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup515"><code class="language-typescript text-sm text-gray-800">(
    id: string,
    tenantId: string,
    userId: string,
    auditContext: Pick&lt;AuditAccessLogInput, 'reason' | 'legalBasis'&gt; &amp;
      Partial&lt;AuditAccessLogInput&gt;,
  ): Promise&lt;Case | null&gt; {
    const caseRecord = await this.caseRepo.findById(id, tenantId);

    if (caseRecord) {
      // Log the export - this is a critical audit event</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/live-server.ts (Line 372:9 - Line 382:2), server/src/live-server.ts (Line 299:2 - Line 310:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn516" onclick="toggleCodeBlock('cloneGroup516', 'expandBtn516', 'collapseBtn516')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn516" onclick="toggleCodeBlock('cloneGroup516', 'expandBtn516', 'collapseBtn516')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup516"><code class="language-typescript text-sm text-gray-800">,
        relationshipsInferred: liveData.relationships.map((rel) =&gt; ({
          ...rel,
          sourceEntity: liveData.entities.find(
            (e) =&gt; e.id === rel.sourceEntity,
          ),
          targetEntity: liveData.entities.find(
            (e) =&gt; e.id === rel.targetEntity,
          ),
        })),
        anomaliesDetected: []</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/app.core.ts (Line 21:2 - Line 31:10), server/src/app.ts (Line 97:13 - Line 106:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn517" onclick="toggleCodeBlock('cloneGroup517', 'expandBtn517', 'collapseBtn517')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn517" onclick="toggleCodeBlock('cloneGroup517', 'expandBtn517', 'collapseBtn517')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup517"><code class="language-typescript text-sm text-gray-800">);

  app.use(
    rateLimit({
      windowMs: Number(process.env.RATE_LIMIT_WINDOW_MS || 60_000),
      max: Number(process.env.RATE_LIMIT_MAX || 600),
      message: { error: 'Too many requests, please try again later' },
    }),
  );

  app.get('/health'</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="json-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">json</h2><div class="divide-y divide-gray-200 border-b-2"><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="jsx-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">jsx</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.jsx (Line 122:7 - Line 132:23), client/src/store/slices/graphSlice.jsx (Line 109:8 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn11" onclick="toggleCodeBlock('cloneGroup11', 'expandBtn11', 'collapseBtn11')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn11" onclick="toggleCodeBlock('cloneGroup11', 'expandBtn11', 'collapseBtn11')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup11"><code class="language-jsx text-sm text-gray-800">);
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    toggleClusterExpansion</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.jsx (Line 160:2 - Line 170:8), client/src/store/slices/graphSlice.jsx (Line 109:2 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn12" onclick="toggleCodeBlock('cloneGroup12', 'expandBtn12', 'collapseBtn12')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn12" onclick="toggleCodeBlock('cloneGroup12', 'expandBtn12', 'collapseBtn12')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup12"><code class="language-jsx text-sm text-gray-800">;
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    addEdge</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.jsx (Line 171:6 - Line 187:11), client/src/store/slices/graphSlice.jsx (Line 154:6 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn13" onclick="toggleCodeBlock('cloneGroup13', 'expandBtn13', 'collapseBtn13')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn13" onclick="toggleCodeBlock('cloneGroup13', 'expandBtn13', 'collapseBtn13')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup13"><code class="language-jsx text-sm text-gray-800">.push(action.payload);
      // Update graph stats
      const numNodes = state.nodes.length;
      const numEdges = state.edges.length;
      const density =
        numNodes &gt; 1 ? (2 * numEdges) / (numNodes * (numNodes - 1)) : 0;
      state.graphStats = { numNodes, numEdges, density: density.toFixed(2) };
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    updateNode</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.jsx (Line 192:2 - Line 203:11), client/src/store/slices/graphSlice.jsx (Line 135:11 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn14" onclick="toggleCodeBlock('cloneGroup14', 'expandBtn14', 'collapseBtn14')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn14" onclick="toggleCodeBlock('cloneGroup14', 'expandBtn14', 'collapseBtn14')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup14"><code class="language-jsx text-sm text-gray-800">;
      }
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    deleteNode</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.jsx (Line 213:5 - Line 230:11), client/src/store/slices/graphSlice.jsx (Line 98:2 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn15" onclick="toggleCodeBlock('cloneGroup15', 'expandBtn15', 'collapseBtn15')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn15" onclick="toggleCodeBlock('cloneGroup15', 'expandBtn15', 'collapseBtn15')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup15"><code class="language-jsx text-sm text-gray-800">;
      }
      // Update graph stats
      const numNodes = state.nodes.length;
      const numEdges = state.edges.length;
      const density =
        numNodes &gt; 1 ? (2 * numEdges) / (numNodes * (numNodes - 1)) : 0;
      state.graphStats = { numNodes, numEdges, density: density.toFixed(2) };
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    deleteEdge</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.jsx (Line 236:2 - Line 253:17), client/src/store/slices/graphSlice.jsx (Line 213:2 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn16" onclick="toggleCodeBlock('cloneGroup16', 'expandBtn16', 'collapseBtn16')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn16" onclick="toggleCodeBlock('cloneGroup16', 'expandBtn16', 'collapseBtn16')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup16"><code class="language-jsx text-sm text-gray-800">= null;
      }
      // Update graph stats
      const numNodes = state.nodes.length;
      const numEdges = state.edges.length;
      const density =
        numNodes &gt; 1 ? (2 * numEdges) / (numNodes * (numNodes - 1)) : 0;
      state.graphStats = { numNodes, numEdges, density: density.toFixed(2) };
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    setSelectedNodes</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.jsx (Line 312:7 - Line 328:11), client/src/store/slices/graphSlice.jsx (Line 154:8 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn17" onclick="toggleCodeBlock('cloneGroup17', 'expandBtn17', 'collapseBtn17')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn17" onclick="toggleCodeBlock('cloneGroup17', 'expandBtn17', 'collapseBtn17')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup17"><code class="language-jsx text-sm text-gray-800">);
      // Update graph stats
      const numNodes = state.nodes.length;
      const numEdges = state.edges.length;
      const density =
        numNodes &gt; 1 ? (2 * numEdges) / (numNodes * (numNodes - 1)) : 0;
      state.graphStats = { numNodes, numEdges, density: density.toFixed(2) };
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    removeEdge</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/store/slices/graphSlice.jsx (Line 329:2 - Line 345:18), client/src/store/slices/graphSlice.jsx (Line 154:2 - Line 119:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn18" onclick="toggleCodeBlock('cloneGroup18', 'expandBtn18', 'collapseBtn18')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn18" onclick="toggleCodeBlock('cloneGroup18', 'expandBtn18', 'collapseBtn18')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup18"><code class="language-jsx text-sm text-gray-800">action.payload);
      // Update graph stats
      const numNodes = state.nodes.length;
      const numEdges = state.edges.length;
      const density =
        numNodes &gt; 1 ? (2 * numEdges) / (numNodes * (numNodes - 1)) : 0;
      state.graphStats = { numNodes, numEdges, density: density.toFixed(2) };
      // Push current state to history
      state.history = state.history.slice(0, state.historyPointer + 1);
      state.history.push({
        nodes: state.nodes,
        edges: state.edges,
        clusters: state.clusters,
      });
      state.historyPointer++;
    },
    setPathSourceNode</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/features/explorer/MapPane.jsx (Line 13:6 - Line 33:4), client/src/features/explorer/TimelinePane.jsx (Line 13:11 - Line 33:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn32" onclick="toggleCodeBlock('cloneGroup32', 'expandBtn32', 'collapseBtn32')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn32" onclick="toggleCodeBlock('cloneGroup32', 'expandBtn32', 'collapseBtn32')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup32"><code class="language-jsx text-sm text-gray-800">) return;
    const handler = (e) =&gt; {
      if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
        e.preventDefault();
        if (!visible.length) return;
        const idx = visible.findIndex((v) =&gt; v.id === selected);
        const nextIdx =
          e.key === 'ArrowDown'
            ? (idx + 1) % visible.length
            : (idx - 1 + visible.length) % visible.length;
        dispatch({ type: 'select', id: visible[nextIdx].id });
      }
    };
    window.addEventListener('keydown', handler);
    return () =&gt; window.removeEventListener('keydown', handler);
  }, [activePane, visible, selected, dispatch]);

  return (
    &lt;div
      role=&quot;region&quot;
      aria-label=&quot;Map</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/reports/ReportGenerator.jsx (Line 60:5 - Line 73:6), client/src/components/simulation/SimulationPanel.jsx (Line 50:2 - Line 63:32)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn55" onclick="toggleCodeBlock('cloneGroup55', 'expandBtn55', 'collapseBtn55')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn55" onclick="toggleCodeBlock('cloneGroup55', 'expandBtn55', 'collapseBtn55')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup55"><code class="language-jsx text-sm text-gray-800">&gt;
        &lt;CardContent&gt;
          &lt;Grid container spacing={2}&gt;
            &lt;Grid item xs={12} md={6}&gt;
              &lt;TextField
                label=&quot;Investigation ID&quot;
                fullWidth
                value={investigationId}
                onChange={(e) =&gt; setInvestigationId(e.target.value)}
              /&gt;
            &lt;/Grid&gt;
            &lt;Grid item xs={12} md={6}&gt;
              &lt;TextField
                label=&quot;Title</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/graph/IntelGraphCanvas.jsx (Line 113:15 - Line 139:3), client/src/components/graph/IntelGraphCanvas.jsx (Line 35:15 - Line 61:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn69" onclick="toggleCodeBlock('cloneGroup69', 'expandBtn69', 'collapseBtn69')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn69" onclick="toggleCodeBlock('cloneGroup69', 'expandBtn69', 'collapseBtn69')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup69"><code class="language-jsx text-sm text-gray-800">label: 'data(label)',
              color: '#FFFFFF',
              'text-valign': 'center',
              'text-halign': 'center',
              width: '60px',
              height: '60px',
              'font-size': '12px',
            },
          },
          {
            selector: 'edge',
            style: {
              width: 3,
              'line-color': '#ccc',
              'target-arrow-color': '#ccc',
              'target-arrow-shape': 'triangle',
              'curve-style': 'bezier',
            },
          },
        ],
        layout: {
          name: 'grid',
          rows: 1,
        },
      });

      cy</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/graph/GraphExplorer.jsx (Line 145:9 - Line 155:10), client/src/components/graph/GraphExplorer.jsx (Line 121:7 - Line 131:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn72" onclick="toggleCodeBlock('cloneGroup72', 'expandBtn72', 'collapseBtn72')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn72" onclick="toggleCodeBlock('cloneGroup72', 'expandBtn72', 'collapseBtn72')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup72"><code class="language-jsx text-sm text-gray-800">);

        if (sourceNode &amp;&amp; targetNode) {
          ctx.beginPath();
          ctx.moveTo(sourceNode.x, sourceNode.y);
          ctx.lineTo(targetNode.x, targetNode.y);
          ctx.stroke();

          const midX = (sourceNode.x + targetNode.x) / 2;
          const midY = (sourceNode.y + targetNode.y) / 2;
          ctx.fillStyle = '#FF00FF'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/graph/AdvancedGraphView.jsx (Line 92:8 - Line 114:17), client/src/components/graph/SubgraphExplorerDialog.jsx (Line 19:9 - Line 41:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn74" onclick="toggleCodeBlock('cloneGroup74', 'expandBtn74', 'collapseBtn74')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn74" onclick="toggleCodeBlock('cloneGroup74', 'expandBtn74', 'collapseBtn74')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup74"><code class="language-jsx text-sm text-gray-800">,
      style: [
        {
          selector: 'node',
          style: {
            'background-color': '#888',
            label: 'data(label)',
            'font-size': 10,
          },
        },
        {
          selector: 'edge',
          style: {
            width: 1,
            'line-color': '#bbb',
            'target-arrow-shape': 'triangle',
            'target-arrow-color': '#bbb',
            label: 'data(label)',
            'font-size': 8,
          },
        },
      ],
      wheelSensitivity</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/graph/AdvancedGraphView.jsx (Line 321:9 - Line 331:2), client/src/components/graph/AdvancedGraphView.jsx (Line 208:7 - Line 217:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn75" onclick="toggleCodeBlock('cloneGroup75', 'expandBtn75', 'collapseBtn75')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn75" onclick="toggleCodeBlock('cloneGroup75', 'expandBtn75', 'collapseBtn75')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup75"><code class="language-jsx text-sm text-gray-800">setEdgeDetail({
          id: e.id(),
          type: e.data('type'),
          label: e.data('label'),
          properties: e.data('properties'),
          source: e.source().data(),
          target: e.target().data(),
        });
        setEdgeInspectorOpen(true);
      }
    }</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/graph/AdvancedGraphView.jsx (Line 532:2 - Line 544:2), client/src/components/graph/AdvancedGraphView.jsx (Line 137:2 - Line 144:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn76" onclick="toggleCodeBlock('cloneGroup76', 'expandBtn76', 'collapseBtn76')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn76" onclick="toggleCodeBlock('cloneGroup76', 'expandBtn76', 'collapseBtn76')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup76"><code class="language-jsx text-sm text-gray-800">{
              const seedNodes = [
                { id: 'n1', label: 'Alice', type: 'PERSON' },
                { id: 'n2', label: 'Bob', type: 'PERSON' },
                { id: 'n3', label: 'Acme Corp', type: 'ORGANIZATION' },
              ];
              const seedEdges = [
                {
                  id: 'e1',
                  source: 'n1',
                  target: 'n2',
                  type: 'KNOWS',
                  label: 'KNOWS',</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/dashboard/ServiceHealthCard.jsx (Line 40:11 - Line 50:2), client/src/components/graph/EdgeInspectorDialog.jsx (Line 60:14 - Line 70:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn80" onclick="toggleCodeBlock('cloneGroup80', 'expandBtn80', 'collapseBtn80')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn80" onclick="toggleCodeBlock('cloneGroup80', 'expandBtn80', 'collapseBtn80')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup80"><code class="language-jsx text-sm text-gray-800">&gt;
        {loading &amp;&amp; (
          &lt;Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}&gt;
            &lt;CircularProgress size={16} /&gt;
            &lt;Typography variant=&quot;body2&quot; color=&quot;text.secondary&quot;&gt;
              Loading
            &lt;/Typography&gt;
          &lt;/Box&gt;
        )}
        {error &amp;&amp; (
          &lt;Typography variant=&quot;body2&quot; color=&quot;error&quot;&gt;</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/PerformanceMonitoringPanel.jsx (Line 342:15 - Line 364:13), client/src/components/analytics/PerformanceMonitoringPanel.jsx (Line 269:15 - Line 297:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn98" onclick="toggleCodeBlock('cloneGroup98', 'expandBtn98', 'collapseBtn98')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn98" onclick="toggleCodeBlock('cloneGroup98', 'expandBtn98', 'collapseBtn98')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup98"><code class="language-jsx text-sm text-gray-800">&lt;/Typography&gt;
              &lt;Box mt={1}&gt;
                &lt;Chip
                  label={
                    metrics.cacheHitRate &lt; 85
                      ? 'Low'
                      : metrics.cacheHitRate &lt; 95
                        ? 'Good'
                        : 'Excellent'
                  }
                  color={metrics.cacheHitRate &lt; 85 ? 'warning' : 'success'}
                  size=&quot;small&quot;
                /&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot; mb={1}&gt;
                &lt;NetworkCheck</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/PerformanceMonitoringPanel.jsx (Line 728:23 - Line 746:2), client/src/components/analytics/PerformanceMonitoringPanel.jsx (Line 715:23 - Line 740:27)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn99" onclick="toggleCodeBlock('cloneGroup99', 'expandBtn99', 'collapseBtn99')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn99" onclick="toggleCodeBlock('cloneGroup99', 'expandBtn99', 'collapseBtn99')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup99"><code class="language-jsx text-sm text-gray-800">&lt;/TableCell&gt;
                      &lt;TableCell align=&quot;center&quot;&gt;
                        &lt;Chip
                          label={strategy.compressionEnabled ? 'On' : 'Off'}
                          color={
                            strategy.compressionEnabled ? 'success' : 'default'
                          }
                          size=&quot;small&quot;
                        /&gt;
                      &lt;/TableCell&gt;
                      &lt;TableCell align=&quot;center&quot;&gt;
                        &lt;Chip
                          label={strategy.prefetchEnabled ? 'On' : 'Off'}
                          color={strategy.prefetchEnabled ? 'info' : 'default'}
                          size=&quot;small&quot;
                        /&gt;
                      &lt;/TableCell&gt;
                      &lt;TableCell align=&quot;center&quot;&gt;
                        &lt;Chip </code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/AdvancedAnalyticsDashboard.jsx (Line 401:2 - Line 413:11), client/src/components/analytics/AdvancedAnalyticsDashboard.jsx (Line 383:2 - Line 395:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn104" onclick="toggleCodeBlock('cloneGroup104', 'expandBtn104', 'collapseBtn104')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn104" onclick="toggleCodeBlock('cloneGroup104', 'expandBtn104', 'collapseBtn104')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup104"><code class="language-jsx text-sm text-gray-800">Threats
                  &lt;/Typography&gt;
                &lt;/Box&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={3}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Box display=&quot;flex&quot; alignItems=&quot;center&quot;&gt;
                &lt;Assessment</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/AdvancedAnalyticsDashboard.jsx (Line 733:9 - Line 743:4), client/src/components/analytics/PerformanceMonitoringPanel.jsx (Line 578:9 - Line 588:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn105" onclick="toggleCodeBlock('cloneGroup105', 'expandBtn105', 'collapseBtn105')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn105" onclick="toggleCodeBlock('cloneGroup105', 'expandBtn105', 'collapseBtn105')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup105"><code class="language-jsx text-sm text-gray-800">&lt;Grid item xs={12}&gt;
          &lt;Card&gt;
            &lt;CardHeader title=&quot;Database Connection Pools&quot; /&gt;
            &lt;CardContent&gt;
              &lt;Table&gt;
                &lt;TableHead&gt;
                  &lt;TableRow&gt;
                    &lt;TableCell&gt;Database&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;right&quot;&gt;Active&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;right&quot;&gt;Max&lt;/TableCell&gt;
                    &lt;TableCell align=&quot;right&quot;&gt;Avg</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/analytics/AdvancedAnalyticsDashboard.jsx (Line 802:4 - Line 832:3), client/src/components/analytics/PerformanceMonitoringPanel.jsx (Line 714:3 - Line 738:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn106" onclick="toggleCodeBlock('cloneGroup106', 'expandBtn106', 'collapseBtn106')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn106" onclick="toggleCodeBlock('cloneGroup106', 'expandBtn106', 'collapseBtn106')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup106"><code class="language-jsx text-sm text-gray-800">}&lt;/TableCell&gt;
                      &lt;TableCell align=&quot;center&quot;&gt;
                        &lt;Chip
                          label={strategy.priority.toUpperCase()}
                          color={
                            strategy.priority === 'high'
                              ? 'error'
                              : strategy.priority === 'medium'
                                ? 'warning'
                                : 'default'
                          }
                          size=&quot;small&quot;
                        /&gt;
                      &lt;/TableCell&gt;
                      &lt;TableCell align=&quot;center&quot;&gt;
                        &lt;Chip
                          label={strategy.compressionEnabled ? 'Yes' : 'No'}
                          color={
                            strategy.compressionEnabled ? 'success' : 'default'
                          }
                          size=&quot;small&quot;
                        /&gt;
                      &lt;/TableCell&gt;
                      &lt;TableCell align=&quot;center&quot;&gt;
                        &lt;Chip
                          label={strategy.prefetchEnabled ? 'Yes' : 'No'}
                          color={strategy.prefetchEnabled ? 'info' : 'default'}
                          size=&quot;small&quot;
                        /&gt;
                      &lt;/TableCell&gt;
                    &lt;/</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai/AdvancedPatternDetection.jsx (Line 63:56 - Line 74:8), client/src/components/timeline/InvestigationTimeline.jsx (Line 85:9 - Line 96:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn120" onclick="toggleCodeBlock('cloneGroup120', 'expandBtn120', 'collapseBtn120')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn120" onclick="toggleCodeBlock('cloneGroup120', 'expandBtn120', 'collapseBtn120')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup120"><code class="language-jsx text-sm text-gray-800">,
      });
    }

    // Burst detection
    const hourlyActivity = {};
    events.forEach((event) =&gt; {
      const hour = new Date(event.timestamp).getHours();
      hourlyActivity[hour] = (hourlyActivity[hour] || 0) + 1;
    });

    const maxHour</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/components/ai/AISuggestionsPanel.jsx (Line 52:7 - Line 66:6), client/src/components/simulation/SimulationPanel.jsx (Line 49:7 - Line 63:32)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn122" onclick="toggleCodeBlock('cloneGroup122', 'expandBtn122', 'collapseBtn122')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn122" onclick="toggleCodeBlock('cloneGroup122', 'expandBtn122', 'collapseBtn122')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup122"><code class="language-jsx text-sm text-gray-800">&lt;/Typography&gt;
      &lt;Card sx={{ mb: 2 }}&gt;
        &lt;CardContent&gt;
          &lt;Grid container spacing={2}&gt;
            &lt;Grid item xs={12} md={4}&gt;
              &lt;TextField
                label=&quot;Investigation ID&quot;
                fullWidth
                value={investigationId}
                onChange={(e) =&gt; setInvestigationId(e.target.value)}
              /&gt;
            &lt;/Grid&gt;
            &lt;Grid item xs={12} md={2}&gt;
              &lt;TextField
                label=&quot;Top K</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/main.progressive.jsx (Line 6:44 - Line 23:45), client/src/main.router.jsx (Line 6:39 - Line 23:55)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn149" onclick="toggleCodeBlock('cloneGroup149', 'expandBtn149', 'collapseBtn149')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn149" onclick="toggleCodeBlock('cloneGroup149', 'expandBtn149', 'collapseBtn149')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup149"><code class="language-jsx text-sm text-gray-800">);

// Global error handlers
window.addEventListener('error', (event) =&gt; {
  console.error(' GLOBAL ERROR:', event.error);
});

window.addEventListener('unhandledrejection', (event) =&gt; {
  console.error(' UNHANDLED PROMISE REJECTION:', event.reason);
});

const root = document.getElementById('root');

if (!root) {
  console.error(' CRITICAL: Root element not found!');
} else {
  try {
    console.log(' Creating React root with Redux + MUI...'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/main.jsx (Line 7:44 - Line 24:44), client/src/main.router.jsx (Line 6:39 - Line 23:55)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn151" onclick="toggleCodeBlock('cloneGroup151', 'expandBtn151', 'collapseBtn151')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn151" onclick="toggleCodeBlock('cloneGroup151', 'expandBtn151', 'collapseBtn151')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup151"><code class="language-jsx text-sm text-gray-800">);

// Global error handlers
window.addEventListener('error', (event) =&gt; {
  console.error(' GLOBAL ERROR:', event.error);
});

window.addEventListener('unhandledrejection', (event) =&gt; {
  console.error(' UNHANDLED PROMISE REJECTION:', event.reason);
});

const root = document.getElementById('root');

if (!root) {
  console.error(' CRITICAL: Root element not found!');
} else {
  try {
    console.log(' Creating React root with full stack...'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/main.apollo.jsx (Line 6:39 - Line 23:54), client/src/main.router.jsx (Line 6:39 - Line 23:55)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn153" onclick="toggleCodeBlock('cloneGroup153', 'expandBtn153', 'collapseBtn153')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn153" onclick="toggleCodeBlock('cloneGroup153', 'expandBtn153', 'collapseBtn153')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup153"><code class="language-jsx text-sm text-gray-800">);

// Global error handlers
window.addEventListener('error', (event) =&gt; {
  console.error(' GLOBAL ERROR:', event.error);
});

window.addEventListener('unhandledrejection', (event) =&gt; {
  console.error(' UNHANDLED PROMISE REJECTION:', event.reason);
});

const root = document.getElementById('root');

if (!root) {
  console.error(' CRITICAL: Root element not found!');
} else {
  try {
    console.log(' Creating React root with Redux + MUI + Apollo...'</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.jsx (Line 19:14 - Line 32:2), client/src/App.router.jsx (Line 93:2 - Line 105:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn161" onclick="toggleCodeBlock('cloneGroup161', 'expandBtn161', 'collapseBtn161')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn161" onclick="toggleCodeBlock('cloneGroup161', 'expandBtn161', 'collapseBtn161')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup161"><code class="language-jsx text-sm text-gray-800">;

// Connection Status Component
function ConnectionStatus() {
  const [backendStatus, setBackendStatus] = React.useState('checking');

  React.useEffect(() =&gt; {
    const checkBackend = async () =&gt; {
      try {
        const response = await fetch('http://localhost:4000/graphql', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            query: '{ __typename }',</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.jsx (Line 49:5 - Line 73:37), client/src/App.router.jsx (Line 115:5 - Line 138:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn162" onclick="toggleCodeBlock('cloneGroup162', 'expandBtn162', 'collapseBtn162')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn162" onclick="toggleCodeBlock('cloneGroup162', 'expandBtn162', 'collapseBtn162')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup162"><code class="language-jsx text-sm text-gray-800">return () =&gt; clearInterval(interval);
  }, []);

  const statusConfig = {
    checking: { color: 'info', message: ' Checking backend connection...' },
    connected: {
      color: 'success',
      message: ' Backend connected successfully!',
    },
    error: {
      color: 'error',
      message: ' Backend connection failed. Check if server is running.',
    },
  };

  const { color, message } = statusConfig[backendStatus];

  return (
    &lt;Alert severity={color} sx={{ mb: 2 }}&gt;
      {message}
    &lt;/Alert&gt;
  );
}

// Dashboard with Apollo integration</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.jsx (Line 79:7 - Line 90:2), client/src/App.progressive.jsx (Line 22:7 - Line 33:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn163" onclick="toggleCodeBlock('cloneGroup163', 'expandBtn163', 'collapseBtn163')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn163" onclick="toggleCodeBlock('cloneGroup163', 'expandBtn163', 'collapseBtn163')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup163"><code class="language-jsx text-sm text-gray-800">&lt;Grid container spacing={3}&gt;
        &lt;Grid item xs={12}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h3&quot; component=&quot;h1&quot; gutterBottom&gt;
                 IntelGraph Platform
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;h6&quot; color=&quot;text.secondary&quot; gutterBottom&gt;
                AI-Augmented Intelligence Analysis Platform
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;body1&quot; sx={{ mt: 2 }}&gt;
                 React + Material-UI + Redux +</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.jsx (Line 90:8 - Line 107:2), client/src/App.progressive.jsx (Line 33:13 - Line 50:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn164" onclick="toggleCodeBlock('cloneGroup164', 'expandBtn164', 'collapseBtn164')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn164" onclick="toggleCodeBlock('cloneGroup164', 'expandBtn164', 'collapseBtn164')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup164"><code class="language-jsx text-sm text-gray-800">!
              &lt;/Typography&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={6}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h5&quot; component=&quot;h2&quot; gutterBottom&gt;
                 System Status
              &lt;/Typography&gt;
              &lt;Box component=&quot;ul&quot; sx={{ pl: 2 }}&gt;
                &lt;li&gt; React 18 application&lt;/li&gt;
                &lt;li&gt; Material-UI components&lt;/li&gt;
                &lt;li&gt; Redux state management&lt;/li&gt;
                &lt;li&gt; Custom theming&lt;/li&gt;
                &lt;li&gt;</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.jsx (Line 109:2 - Line 126:5), client/src/App.progressive.jsx (Line 51:2 - Line 68:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn165" onclick="toggleCodeBlock('cloneGroup165', 'expandBtn165', 'collapseBtn165')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn165" onclick="toggleCodeBlock('cloneGroup165', 'expandBtn165', 'collapseBtn165')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup165"><code class="language-jsx text-sm text-gray-800">(next step)&lt;/li&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12} md={6}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h5&quot; component=&quot;h2&quot; gutterBottom&gt;
                 Platform Features
              &lt;/Typography&gt;
              &lt;Box
                sx={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 1 }}
              &gt;
                &lt;div&gt; Graph Analytics&lt;/div&gt;
                &lt;div&gt; AI Copilot&lt;/div&gt;
                &lt;div&gt; Real</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.jsx (Line 127:2 - Line 145:19), client/src/App.progressive.jsx (Line 69:2 - Line 86:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn166" onclick="toggleCodeBlock('cloneGroup166', 'expandBtn166', 'collapseBtn166')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn166" onclick="toggleCodeBlock('cloneGroup166', 'expandBtn166', 'collapseBtn166')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup166"><code class="language-jsx text-sm text-gray-800">Visualization&lt;/div&gt;
                &lt;div&gt; Sentiment Analysis&lt;/div&gt;
                &lt;div&gt; GeoInt Mapping&lt;/div&gt;
                &lt;div&gt; Report Generation&lt;/div&gt;
                &lt;div&gt; Data Federation&lt;/div&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h5&quot; component=&quot;h2&quot; gutterBottom&gt;
                 Quick Actions
              &lt;/Typography&gt;
              &lt;Box sx={{ display: 'flex', gap: 2, flexWrap: 'wrap' }}&gt;
                &lt;Button
                  </code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.jsx (Line 169:17 - Line 188:7), client/src/App.progressive.jsx (Line 95:2 - Line 114:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn167" onclick="toggleCodeBlock('cloneGroup167', 'expandBtn167', 'collapseBtn167')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn167" onclick="toggleCodeBlock('cloneGroup167', 'expandBtn167', 'collapseBtn167')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup167"><code class="language-jsx text-sm text-gray-800">&gt;
                  AI Copilot
                &lt;/Button&gt;
              &lt;/Box&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;

        &lt;Grid item xs={12}&gt;
          &lt;Card&gt;
            &lt;CardContent&gt;
              &lt;Typography variant=&quot;h6&quot; gutterBottom&gt;
                 Debug Information
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;body2&quot; color=&quot;text.secondary&quot;&gt;
                Started: {new Date().toLocaleString()}
                &lt;br /&gt;
                URL: {window.location.href}
                &lt;br /&gt;
                Apollo</code></pre></div><div class="py-4"><p class="text-gray-600">client/src/App.apollo.jsx (Line 191:15 - Line 217:39), client/src/App.progressive.jsx (Line 115:15 - Line 141:44)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn168" onclick="toggleCodeBlock('cloneGroup168', 'expandBtn168', 'collapseBtn168')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn168" onclick="toggleCodeBlock('cloneGroup168', 'expandBtn168', 'collapseBtn168')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup168"><code class="language-jsx text-sm text-gray-800">&lt;/Typography&gt;
            &lt;/CardContent&gt;
          &lt;/Card&gt;
        &lt;/Grid&gt;
      &lt;/Grid&gt;
    &lt;/Container&gt;
  );
}

// Themed App Shell
function ThemedAppShell({ children }) {
  const mode = useSelector((state) =&gt; state.ui?.theme || 'light');
  const theme = useMemo(() =&gt; getIntelGraphTheme(mode), [mode]);

  return (
    &lt;ThemeProvider theme={theme}&gt;
      &lt;CssBaseline /&gt;
      &lt;Box sx={{ bgcolor: 'background.default', minHeight: '100vh' }}&gt;
        {children}
      &lt;/Box&gt;
    &lt;/ThemeProvider&gt;
  );
}

function App() {
  useEffect(() =&gt; {
    console.log(' Apollo IntelGraph App mounting...'</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="graphql-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">graphql</h2><div class="divide-y divide-gray-200 border-b-2"><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="css-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">css</h2><div class="divide-y divide-gray-200 border-b-2"><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="sql-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">sql</h2><div class="divide-y divide-gray-200 border-b-2"><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="markdown-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">markdown</h2><div class="divide-y divide-gray-200 border-b-2"><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="python-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">python</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">server/src/ai/models/text_embedding.py (Line 235:9 - Line 248:11), server/src/ai/models/text_embedding.py (Line 181:9 - Line 194:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn302" onclick="toggleCodeBlock('cloneGroup302', 'expandBtn302', 'collapseBtn302')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn302" onclick="toggleCodeBlock('cloneGroup302', 'expandBtn302', 'collapseBtn302')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup302"><code class="language-python text-sm text-gray-800">with torch.no_grad():
            outputs = self.model(**inputs)

            # Apply pooling strategy
            if pooling_strategy == &quot;mean&quot;:
                # Mean pooling
                token_embeddings = outputs.last_hidden_state
                attention_mask = inputs[&quot;attention_mask&quot;]
                input_mask_expanded = (
                    attention_mask.unsqueeze(-1).expand(token_embeddings.size()).float()
                )
                sum_embeddings = torch.sum(token_embeddings * input_mask_expanded, 1)
                sum_mask = torch.clamp(input_mask_expanded.sum(1), min=1e-9)
                embeddings</code></pre></div><div class="py-4"><p class="text-gray-600">server/src/ai/models/text_embedding.py (Line 248:2 - Line 258:11), server/src/ai/models/text_embedding.py (Line 194:2 - Line 204:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn303" onclick="toggleCodeBlock('cloneGroup303', 'expandBtn303', 'collapseBtn303')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn303" onclick="toggleCodeBlock('cloneGroup303', 'expandBtn303', 'collapseBtn303')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup303"><code class="language-python text-sm text-gray-800">= sum_embeddings / sum_mask

            elif pooling_strategy == &quot;max&quot;:
                # Max pooling
                token_embeddings = outputs.last_hidden_state
                attention_mask = inputs[&quot;attention_mask&quot;]
                input_mask_expanded = (
                    attention_mask.unsqueeze(-1).expand(token_embeddings.size()).float()
                )
                token_embeddings[input_mask_expanded == 0] = -1e9
                embeddings</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div></section><!-- Add more sections for other formats and clone groups as needed--></main><footer class="bg-white shadow mt-8 py-4"><div class="container mx-auto px-4 text-center"><p class="text-sm text-gray-600">This report is generated by jscpd, an open-source copy/paste detector.</p><p class="text-sm text-gray-600">jscpd is licensed under the MIT License.</p><a class="text-blue-500 text-sm" href="https://github.com/kucherenko/jscpd" target="_blank" rel="noopener noreferrer">View jscpd on GitHub</a></div></footer><script src="js/prism.js"></script><script>function toggleCodeBlock(codeBlockId, expandBtnId, collapseBtnId) {
  const codeBlock = document.getElementById(codeBlockId);
  const expandBtn = document.getElementById(expandBtnId);
  const collapseBtn = document.getElementById(collapseBtnId);

  codeBlock.classList.toggle('hidden');
  expandBtn.classList.toggle('hidden');
  collapseBtn.classList.toggle('hidden');
}</script></body></html>