{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Provenance Receipt Schema v1",
  "type": "object",
  "required": [
    "spec_version",
    "id",
    "timestamp",
    "correlation_id",
    "tenant_id",
    "actor",
    "action",
    "resource",
    "policy",
    "result"
  ],
  "properties": {
    "spec_version": {
      "type": "string",
      "const": "1.0.0"
    },
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this receipt"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of when the action occurred"
    },
    "correlation_id": {
      "type": "string",
      "format": "uuid",
      "description": "Trace ID linking this action to a broader workflow"
    },
    "tenant_id": {
      "type": "string",
      "description": "Tenant context for this action"
    },
    "actor": {
      "type": "object",
      "required": ["id", "principal_type"],
      "properties": {
        "id": { "type": "string" },
        "email": { "type": "string" },
        "principal_type": { "type": "string", "enum": ["user", "service_account", "system"] },
        "roles": { "type": "array", "items": { "type": "string" } },
        "ip_address": { "type": "string" }
      }
    },
    "action": {
      "type": "string",
      "description": "The operation being performed (e.g., 'document.delete', 'user.promote')"
    },
    "resource": {
      "type": "object",
      "required": ["id", "type"],
      "properties": {
        "id": { "type": "string" },
        "type": { "type": "string" },
        "attributes": { "type": "object" }
      }
    },
    "policy": {
      "type": "object",
      "required": ["decision_id", "policy_set"],
      "properties": {
        "decision_id": { "type": "string" },
        "policy_set": {
          "type": "string",
          "description": "Hash or version of the policy bundle used"
        },
        "evaluation_timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "result": {
      "type": "object",
      "required": ["status"],
      "properties": {
        "status": { "type": "string", "enum": ["success", "failure", "denied"] },
        "details": { "type": "string" },
        "rationale_hash": {
          "type": "string",
          "description": "SHA-256 hash of the approval rationale if applicable"
        }
      }
    },
    "signature": {
      "type": "object",
      "description": "Cryptographic signature of the canonicalized receipt",
      "properties": {
        "key_id": { "type": "string" },
        "algorithm": { "type": "string", "default": "RS256" },
        "value": { "type": "string" }
      }
    }
  }
}
