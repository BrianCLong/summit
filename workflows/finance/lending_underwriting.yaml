name: lending_underwriting
version: 1.0.0
description: "Hybrid Human-GenAI workflow for lending underwriting"
nodes:
  - id: ingest_application
    type: ingest
    data_class: PII
    next: analyze_risk

  - id: analyze_risk
    type: agent_task
    agent: agent_risk_analyst
    inputs: ["ingest_application.output"]
    tools: ["read_credit_report", "analyze_income"]
    next: propose_decision

  - id: propose_decision
    type: agent_task
    agent: agent_underwriter
    inputs: ["analyze_risk.output"]
    tools: ["draft_decision_memo"]
    next: hitl_review_gate

  - id: hitl_review_gate
    type: hitl_review
    required_role: "senior_underwriter"
    inputs: ["propose_decision.output"]
    policy_check: "finance_policy"
    next_approved: execute_decision
    next_denied: notify_rejection

  - id: execute_decision
    type: execute
    tool: "approve_loan_system"
    data_class: FINANCIAL_SENSITIVE
    next: evidence_emit

  - id: notify_rejection
    type: execute
    tool: "send_rejection_email"
    next: evidence_emit

  - id: evidence_emit
    type: evidence_writer
    inputs: ["execute_decision.output", "notify_rejection.output"]
    schema: "finance_report"
