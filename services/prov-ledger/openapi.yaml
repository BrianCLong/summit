openapi: 3.0.3
info:
  title: Provenance & Claim Ledger
  version: 1.0.0
  description: |
    Append-only ledger that records evidence, binds claims, and exports signed manifests.
servers:
  - url: http://localhost:4010
paths:
  /health:
    get:
      summary: Health check
      responses:
        '200':
          description: Healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
  /evidence:
    post:
      summary: Register evidence
      description: Accepts binary or JSON payload and returns a deterministic checksum and evidenceId.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  description: Arbitrary payload or base64 encoded buffer
                attributes:
                  type: object
                  additionalProperties: true
          application/octet-stream:
            schema:
              type: string
              format: binary
      responses:
        '200':
          description: Evidence registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvidenceResponse'
  /claims:
    post:
      summary: Create claim
      description: Links evidence IDs to an assertion and returns a claim identifier.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateClaimRequest'
      responses:
        '200':
          description: Claim created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClaimResponse'
  /manifests/{claimId}:
    get:
      summary: Export signed manifest
      parameters:
        - in: path
          name: claimId
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Manifest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Manifest'
        '404':
          description: Not found
  /verify:
    post:
      summary: Offline manifest verification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Manifest'
      responses:
        '200':
          description: Verification result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerificationResult'
  /lineage/{claimId}:
    get:
      summary: Lineage adjacency list
      parameters:
        - in: path
          name: claimId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: adjacency
          content:
            application/json:
              schema:
                type: object
                properties:
                  claimId:
                    type: string
                  adjacency:
                    type: array
                    items:
                      $ref: '#/components/schemas/Edge'
components:
  schemas:
    EvidenceResponse:
      type: object
      properties:
        evidenceId:
          type: string
        checksum:
          type: string
        signature:
          type: string
    CreateClaimRequest:
      type: object
      properties:
        evidenceIds:
          type: array
          items:
            type: string
        assertion:
          type: object
          additionalProperties: true
        actor:
          type: string
    ClaimResponse:
      type: object
      properties:
        claimId:
          type: string
        signature:
          type: string
    Manifest:
      type: object
      properties:
        schemaVersion:
          type: string
        claimId:
          type: string
        merkleRoot:
          type: string
        leaves:
          type: array
          items:
            $ref: '#/components/schemas/MerkleLeaf'
        adjacency:
          type: array
          items:
            $ref: '#/components/schemas/Edge'
        manifestSignature:
          type: string
        generatedAt:
          type: string
          format: date-time
    MerkleLeaf:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
        hash:
          type: string
        prevHash:
          type: string
        signature:
          type: string
    Edge:
      type: object
      properties:
        from:
          type: string
        to:
          type: string
        kind:
          type: string
        signature:
          type: string
        prevHash:
          type: string
        recordHash:
          type: string
    VerificationResult:
      type: object
      properties:
        valid:
          type: boolean
        reasons:
          type: array
          items:
            type: string
