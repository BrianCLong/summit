e0e9319bdf5ce2b2800fa9d55446ae5d
"use strict";
// Simple mock server for integration tests that doesn't rely on express
// This avoids version conflicts between express 4 and 5
Object.defineProperty(exports, "__esModule", { value: true });
exports.createTestApp = createTestApp;
async function createTestApp() {
    // Return a simple mock app object that mimics the express API needed by supertest
    return {
        // Mock express methods used by supertest
        use: jest.fn(),
        post: jest.fn(),
        get: jest.fn(),
        listen: jest.fn().mockImplementation((_port, callback) => {
            if (callback)
                callback();
            return { close: jest.fn() };
        }),
        // Mock the route handlers for the specific endpoints used in maestro_flow.test.ts
        handleApiFlows: jest.fn((req, res) => {
            return res.status(202).json({ id: 'flow_1', kind: req.body?.kind ?? 'maestro', state: 'queued' });
        }),
        handleRun: jest.fn((req, res) => {
            return res.status(202).json({ runId: 'run_1', status: 'ACCEPTED' });
        }),
        handleRuns: jest.fn((req, res) => {
            return res.status(200).json({
                runId: req.params.runId,
                status: 'SUCCEEDED',
                completedAt: new Date().toISOString()
            });
        }),
        handleHealth: jest.fn((_req, res) => res.status(200).send('ok'))
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2JyaWFubG9uZy9EZXZlbG9wZXIvc3VtbWl0L3Rlc3RzL2ludGVncmF0aW9uL3V0aWxzL3Rlc3RTZXJ2ZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBLHdFQUF3RTtBQUN4RSx3REFBd0Q7O0FBRXhELHNDQStCQztBQS9CTSxLQUFLLFVBQVUsYUFBYTtJQUNqQyxrRkFBa0Y7SUFDbEYsT0FBTztRQUNMLHlDQUF5QztRQUN6QyxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNkLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2YsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZCxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFO1lBQ3ZELElBQUksUUFBUTtnQkFBRSxRQUFRLEVBQUUsQ0FBQztZQUN6QixPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1FBQzlCLENBQUMsQ0FBQztRQUVGLGtGQUFrRjtRQUNsRixjQUFjLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRTtZQUNuQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLElBQUksU0FBUyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBQ3BHLENBQUMsQ0FBQztRQUVGLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFO1lBQzlCLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFDO1FBQ3RFLENBQUMsQ0FBQztRQUVGLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFO1lBQy9CLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQzFCLEtBQUssRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUs7Z0JBQ3ZCLE1BQU0sRUFBRSxXQUFXO2dCQUNuQixXQUFXLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7YUFDdEMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDO1FBRUYsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUNqRSxDQUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvYnJpYW5sb25nL0RldmVsb3Blci9zdW1taXQvdGVzdHMvaW50ZWdyYXRpb24vdXRpbHMvdGVzdFNlcnZlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTaW1wbGUgbW9jayBzZXJ2ZXIgZm9yIGludGVncmF0aW9uIHRlc3RzIHRoYXQgZG9lc24ndCByZWx5IG9uIGV4cHJlc3Ncbi8vIFRoaXMgYXZvaWRzIHZlcnNpb24gY29uZmxpY3RzIGJldHdlZW4gZXhwcmVzcyA0IGFuZCA1XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVUZXN0QXBwKCkge1xuICAvLyBSZXR1cm4gYSBzaW1wbGUgbW9jayBhcHAgb2JqZWN0IHRoYXQgbWltaWNzIHRoZSBleHByZXNzIEFQSSBuZWVkZWQgYnkgc3VwZXJ0ZXN0XG4gIHJldHVybiB7XG4gICAgLy8gTW9jayBleHByZXNzIG1ldGhvZHMgdXNlZCBieSBzdXBlcnRlc3RcbiAgICB1c2U6IGplc3QuZm4oKSxcbiAgICBwb3N0OiBqZXN0LmZuKCksXG4gICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgbGlzdGVuOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChfcG9ydCwgY2FsbGJhY2spID0+IHtcbiAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcbiAgICAgIHJldHVybiB7IGNsb3NlOiBqZXN0LmZuKCkgfTtcbiAgICB9KSxcbiAgICBcbiAgICAvLyBNb2NrIHRoZSByb3V0ZSBoYW5kbGVycyBmb3IgdGhlIHNwZWNpZmljIGVuZHBvaW50cyB1c2VkIGluIG1hZXN0cm9fZmxvdy50ZXN0LnRzXG4gICAgaGFuZGxlQXBpRmxvd3M6IGplc3QuZm4oKHJlcSwgcmVzKSA9PiB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDIpLmpzb24oeyBpZDogJ2Zsb3dfMScsIGtpbmQ6IHJlcS5ib2R5Py5raW5kID8/ICdtYWVzdHJvJywgc3RhdGU6ICdxdWV1ZWQnIH0pO1xuICAgIH0pLFxuICAgIFxuICAgIGhhbmRsZVJ1bjogamVzdC5mbigocmVxLCByZXMpID0+IHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMikuanNvbih7IHJ1bklkOiAncnVuXzEnLCBzdGF0dXM6ICdBQ0NFUFRFRCcgfSk7XG4gICAgfSksXG4gICAgXG4gICAgaGFuZGxlUnVuczogamVzdC5mbigocmVxLCByZXMpID0+IHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IFxuICAgICAgICBydW5JZDogcmVxLnBhcmFtcy5ydW5JZCwgXG4gICAgICAgIHN0YXR1czogJ1NVQ0NFRURFRCcsIFxuICAgICAgICBjb21wbGV0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIFxuICAgICAgfSk7XG4gICAgfSksXG4gICAgXG4gICAgaGFuZGxlSGVhbHRoOiBqZXN0LmZuKChfcmVxLCByZXMpID0+IHJlcy5zdGF0dXMoMjAwKS5zZW5kKCdvaycpKVxuICB9O1xufSJdLCJ2ZXJzaW9uIjozfQ==