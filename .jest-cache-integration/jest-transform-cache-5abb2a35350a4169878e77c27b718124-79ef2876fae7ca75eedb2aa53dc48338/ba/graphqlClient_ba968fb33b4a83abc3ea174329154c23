b7e710fd2fbbd09bd645f567852abe0a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createGraphQLClient = void 0;
const server_1 = require("@apollo/server");
const toPayload = (input) => typeof input === 'string' ? { query: input } : input;
const createGraphQLClient = async (options) => {
    const server = new server_1.ApolloServer(options);
    await server.start();
    const execute = async (input) => {
        const payload = toPayload(input);
        const response = await server.executeOperation(payload);
        const headers = response.http?.headers
            ? Object.fromEntries(response.http.headers)
            : { 'content-type': 'application/json' };
        return {
            status: response.http?.status ?? 200,
            body: response.body,
            headers,
        };
    };
    return {
        query: execute,
        mutate: execute,
        close: () => server.stop(),
    };
};
exports.createGraphQLClient = createGraphQLClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2JyaWFubG9uZy9EZXZlbG9wZXIvc3VtbWl0L3Rlc3RzL2ludGVncmF0aW9uL3V0aWxzL2dyYXBocWxDbGllbnQudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMkNBQW1GO0FBZ0JuRixNQUFNLFNBQVMsR0FBRyxDQUFDLEtBQW1CLEVBQWtCLEVBQUUsQ0FDeEQsT0FBTyxLQUFLLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0FBRWhELE1BQU0sbUJBQW1CLEdBQUcsS0FBSyxFQUN0QyxPQUFzQyxFQUNWLEVBQUU7SUFDOUIsTUFBTSxNQUFNLEdBQUcsSUFBSSxxQkFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3pDLE1BQU0sTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBRXJCLE1BQU0sT0FBTyxHQUFHLEtBQUssRUFBRSxLQUFtQixFQUFtQyxFQUFFO1FBQzdFLE1BQU0sT0FBTyxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNqQyxNQUFNLFFBQVEsR0FBRyxNQUFNLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN4RCxNQUFNLE9BQU8sR0FBRyxRQUFRLENBQUMsSUFBSSxFQUFFLE9BQU87WUFDcEMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDM0MsQ0FBQyxDQUFDLEVBQUUsY0FBYyxFQUFFLGtCQUFrQixFQUFFLENBQUM7UUFFM0MsT0FBTztZQUNMLE1BQU0sRUFBRSxRQUFRLENBQUMsSUFBSSxFQUFFLE1BQU0sSUFBSSxHQUFHO1lBQ3BDLElBQUksRUFBRSxRQUFRLENBQUMsSUFBSTtZQUNuQixPQUFPO1NBQ1IsQ0FBQztJQUNKLENBQUMsQ0FBQztJQUVGLE9BQU87UUFDTCxLQUFLLEVBQUUsT0FBTztRQUNkLE1BQU0sRUFBRSxPQUFPO1FBQ2YsS0FBSyxFQUFFLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUU7S0FDM0IsQ0FBQztBQUNKLENBQUMsQ0FBQztBQXpCVyxRQUFBLG1CQUFtQix1QkF5QjlCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9icmlhbmxvbmcvRGV2ZWxvcGVyL3N1bW1pdC90ZXN0cy9pbnRlZ3JhdGlvbi91dGlscy9ncmFwaHFsQ2xpZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwb2xsb1NlcnZlciwgQXBvbGxvU2VydmVyT3B0aW9ucywgR3JhcGhRTFJlcXVlc3QgfSBmcm9tICdAYXBvbGxvL3NlcnZlcic7XG5cbnR5cGUgUmVxdWVzdElucHV0ID0gc3RyaW5nIHwgR3JhcGhRTFJlcXVlc3Q7XG5cbnR5cGUgR3JhcGhRTFJlc3BvbnNlUGF5bG9hZCA9IHtcbiAgc3RhdHVzOiBudW1iZXI7XG4gIGJvZHk6IGFueTtcbiAgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbn07XG5cbnR5cGUgR3JhcGhRTFRlc3RDbGllbnQgPSB7XG4gIHF1ZXJ5OiAoaW5wdXQ6IFJlcXVlc3RJbnB1dCkgPT4gUHJvbWlzZTxHcmFwaFFMUmVzcG9uc2VQYXlsb2FkPjtcbiAgbXV0YXRlOiAoaW5wdXQ6IFJlcXVlc3RJbnB1dCkgPT4gUHJvbWlzZTxHcmFwaFFMUmVzcG9uc2VQYXlsb2FkPjtcbiAgY2xvc2U6ICgpID0+IFByb21pc2U8dm9pZD47XG59O1xuXG5jb25zdCB0b1BheWxvYWQgPSAoaW5wdXQ6IFJlcXVlc3RJbnB1dCk6IEdyYXBoUUxSZXF1ZXN0ID0+XG4gIHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycgPyB7IHF1ZXJ5OiBpbnB1dCB9IDogaW5wdXQ7XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVHcmFwaFFMQ2xpZW50ID0gYXN5bmMgPFRDb250ZXh0ID0gdW5rbm93bj4oXG4gIG9wdGlvbnM6IEFwb2xsb1NlcnZlck9wdGlvbnM8VENvbnRleHQ+LFxuKTogUHJvbWlzZTxHcmFwaFFMVGVzdENsaWVudD4gPT4ge1xuICBjb25zdCBzZXJ2ZXIgPSBuZXcgQXBvbGxvU2VydmVyKG9wdGlvbnMpO1xuICBhd2FpdCBzZXJ2ZXIuc3RhcnQoKTtcblxuICBjb25zdCBleGVjdXRlID0gYXN5bmMgKGlucHV0OiBSZXF1ZXN0SW5wdXQpOiBQcm9taXNlPEdyYXBoUUxSZXNwb25zZVBheWxvYWQ+ID0+IHtcbiAgICBjb25zdCBwYXlsb2FkID0gdG9QYXlsb2FkKGlucHV0KTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHNlcnZlci5leGVjdXRlT3BlcmF0aW9uKHBheWxvYWQpO1xuICAgIGNvbnN0IGhlYWRlcnMgPSByZXNwb25zZS5odHRwPy5oZWFkZXJzXG4gICAgICA/IE9iamVjdC5mcm9tRW50cmllcyhyZXNwb25zZS5odHRwLmhlYWRlcnMpXG4gICAgICA6IHsgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXR1czogcmVzcG9uc2UuaHR0cD8uc3RhdHVzID8/IDIwMCxcbiAgICAgIGJvZHk6IHJlc3BvbnNlLmJvZHksXG4gICAgICBoZWFkZXJzLFxuICAgIH07XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBxdWVyeTogZXhlY3V0ZSxcbiAgICBtdXRhdGU6IGV4ZWN1dGUsXG4gICAgY2xvc2U6ICgpID0+IHNlcnZlci5zdG9wKCksXG4gIH07XG59O1xuIl0sInZlcnNpb24iOjN9