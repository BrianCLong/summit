7b6934b02e85fe61bc45bd498ff87d1c
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SemanticMemory = void 0;
const crypto_1 = require("crypto");
const promises_1 = require("fs/promises");
const path_1 = require("path");
const util_1 = require("util");
const child_process_1 = require("child_process");
const execAsync = (0, util_1.promisify)(child_process_1.exec);
class SemanticMemory {
    memoryPath;
    indexPath;
    entries;
    vectorDimension = 1536; // OpenAI embedding dimension
    maxEntries = 10000;
    constructor(projectRoot = process.cwd()) {
        this.memoryPath = (0, path_1.join)(projectRoot, '.maestro', 'memory');
        this.indexPath = (0, path_1.join)(this.memoryPath, 'index.json');
        this.entries = new Map();
    }
    async initialize() {
        try {
            await (0, promises_1.mkdir)(this.memoryPath, { recursive: true });
            await this.loadMemory();
        }
        catch (error) {
            console.warn('Failed to initialize semantic memory:', error.message);
        }
    }
    async store(content, type, metadata = {}) {
        const id = this.generateId(content, type);
        const existing = this.entries.get(id);
        if (existing) {
            // Update existing entry
            existing.metadata.frequency += 1;
            existing.metadata.lastAccessed = new Date().toISOString();
            await this.persistMemory();
            return id;
        }
        // Create new entry
        const entry = {
            id,
            type,
            content: this.normalizeContent(content),
            metadata: {
                timestamp: new Date().toISOString(),
                project: this.extractProjectName(),
                frequency: 1,
                lastAccessed: new Date().toISOString(),
                success: true,
                tags: [],
                ...metadata
            },
            relations: []
        };
        // Generate embedding for semantic search
        try {
            entry.embedding = await this.generateEmbedding(content);
        }
        catch (error) {
            console.warn(`Failed to generate embedding for ${id}:`, error.message);
        }
        // Extract tags automatically
        entry.metadata.tags = [
            ...entry.metadata.tags,
            ...this.extractTags(content, type)
        ];
        this.entries.set(id, entry);
        // Enforce memory limits
        await this.enforceMemoryLimits();
        await this.persistMemory();
        return id;
    }
    async retrieve(query) {
        let candidates = Array.from(this.entries.values());
        // Filter by type
        if (query.type && query.type.length > 0) {
            candidates = candidates.filter(entry => query.type.includes(entry.type));
        }
        // Filter by tags
        if (query.tags && query.tags.length > 0) {
            candidates = candidates.filter(entry => query.tags.some(tag => entry.metadata.tags.includes(tag)));
        }
        // Semantic similarity search
        const results = [];
        if (candidates.length === 0) {
            return results;
        }
        try {
            const queryEmbedding = await this.generateEmbedding(query.query);
            for (const entry of candidates) {
                if (!entry.embedding)
                    continue;
                const similarity = this.cosineSimilarity(queryEmbedding, entry.embedding);
                if (similarity >= (query.similarity || 0.7)) {
                    results.push({
                        entry,
                        similarity,
                        rank: 0 // Will be set after sorting
                    });
                }
            }
        }
        catch (error) {
            console.warn('Failed to perform semantic search, falling back to text search');
            // Fallback to text-based search
            const queryLower = query.query.toLowerCase();
            for (const entry of candidates) {
                const contentLower = entry.content.toLowerCase();
                if (contentLower.includes(queryLower)) {
                    const similarity = this.textSimilarity(queryLower, contentLower);
                    results.push({
                        entry,
                        similarity,
                        rank: 0
                    });
                }
            }
        }
        // Sort by similarity and frequency
        results.sort((a, b) => {
            const scoreA = a.similarity * 0.7 + (a.entry.metadata.frequency / 100) * 0.3;
            const scoreB = b.similarity * 0.7 + (b.entry.metadata.frequency / 100) * 0.3;
            return scoreB - scoreA;
        });
        // Set ranks and limit results
        results.forEach((result, index) => {
            result.rank = index + 1;
            // Update access time
            result.entry.metadata.lastAccessed = new Date().toISOString();
        });
        const limited = results.slice(0, query.limit || 10);
        // Persist updated access times
        if (limited.length > 0) {
            await this.persistMemory();
        }
        return limited;
    }
    async addRelation(fromId, toId) {
        const fromEntry = this.entries.get(fromId);
        const toEntry = this.entries.get(toId);
        if (fromEntry && toEntry) {
            if (!fromEntry.relations.includes(toId)) {
                fromEntry.relations.push(toId);
            }
            if (!toEntry.relations.includes(fromId)) {
                toEntry.relations.push(fromId);
            }
            await this.persistMemory();
        }
    }
    async recordSuccess(id, success) {
        const entry = this.entries.get(id);
        if (entry) {
            entry.metadata.success = success;
            entry.metadata.frequency += success ? 1 : -0.5;
            entry.metadata.lastAccessed = new Date().toISOString();
            await this.persistMemory();
        }
    }
    async forget(id) {
        this.entries.delete(id);
        await this.persistMemory();
    }
    async cleanup(olderThanDays = 90) {
        const cutoff = new Date();
        cutoff.setDate(cutoff.getDate() - olderThanDays);
        let removed = 0;
        for (const [id, entry] of this.entries.entries()) {
            const lastAccessed = new Date(entry.metadata.lastAccessed);
            if (lastAccessed < cutoff && entry.metadata.frequency < 2) {
                this.entries.delete(id);
                removed++;
            }
        }
        if (removed > 0) {
            await this.persistMemory();
        }
        return removed;
    }
    async getStats() {
        const typeDistribution = {};
        let totalFrequency = 0;
        for (const entry of this.entries.values()) {
            typeDistribution[entry.type] = (typeDistribution[entry.type] || 0) + 1;
            totalFrequency += entry.metadata.frequency;
        }
        return {
            totalEntries: this.entries.size,
            typeDistribution,
            averageFrequency: totalFrequency / this.entries.size || 0,
            memorySize: JSON.stringify(Array.from(this.entries.values())).length
        };
    }
    generateId(content, type) {
        return (0, crypto_1.createHash)('sha256')
            .update(content + type)
            .digest('hex')
            .substring(0, 16);
    }
    normalizeContent(content) {
        return content
            .trim()
            .replace(/\s+/g, ' ')
            .substring(0, 10000); // Limit content size
    }
    extractProjectName() {
        try {
            const packageJson = require((0, path_1.join)(process.cwd(), 'package.json'));
            return packageJson.name || 'unknown';
        }
        catch {
            return 'unknown';
        }
    }
    extractTags(content, type) {
        const tags = [];
        // Language/framework tags
        const patterns = {
            typescript: /\.ts|interface|type|export/i,
            javascript: /\.js|function|const|let|var/i,
            react: /jsx|tsx|useEffect|useState|Component/i,
            node: /require|module\.exports|process\./i,
            git: /git|commit|branch|merge/i,
            test: /test|spec|describe|it\(/i,
            error: /error|exception|fail|throw/i,
            api: /api|endpoint|route|express/i,
            database: /sql|query|database|db\./i,
            security: /auth|token|password|security/i
        };
        for (const [tag, pattern] of Object.entries(patterns)) {
            if (pattern.test(content)) {
                tags.push(tag);
            }
        }
        // Add type as tag
        tags.push(type);
        return [...new Set(tags)]; // Remove duplicates
    }
    async generateEmbedding(text) {
        // This would normally call OpenAI API or similar
        // For now, we'll use a simple hash-based approach
        const hash = (0, crypto_1.createHash)('sha256').update(text).digest();
        const embedding = [];
        for (let i = 0; i < Math.min(this.vectorDimension, hash.length * 8); i++) {
            const byteIndex = Math.floor(i / 8);
            const bitIndex = i % 8;
            const bit = (hash[byteIndex] >> bitIndex) & 1;
            embedding.push(bit * 2 - 1); // Convert to -1 or 1
        }
        // Pad if necessary
        while (embedding.length < this.vectorDimension) {
            embedding.push(0);
        }
        return embedding.slice(0, this.vectorDimension);
    }
    cosineSimilarity(a, b) {
        if (a.length !== b.length)
            return 0;
        let dotProduct = 0;
        let normA = 0;
        let normB = 0;
        for (let i = 0; i < a.length; i++) {
            dotProduct += a[i] * b[i];
            normA += a[i] * a[i];
            normB += b[i] * b[i];
        }
        const magnitude = Math.sqrt(normA) * Math.sqrt(normB);
        return magnitude === 0 ? 0 : dotProduct / magnitude;
    }
    textSimilarity(query, content) {
        const queryWords = query.split(/\s+/);
        const contentWords = content.split(/\s+/);
        const querySet = new Set(queryWords);
        const contentSet = new Set(contentWords);
        const intersection = new Set([...querySet].filter(x => contentSet.has(x)));
        const union = new Set([...querySet, ...contentSet]);
        return intersection.size / union.size; // Jaccard similarity
    }
    async loadMemory() {
        try {
            await (0, promises_1.access)(this.indexPath);
            const data = await (0, promises_1.readFile)(this.indexPath, 'utf8');
            const entries = JSON.parse(data);
            this.entries.clear();
            for (const entry of entries) {
                this.entries.set(entry.id, entry);
            }
        }
        catch (error) {
            // File doesn't exist or is corrupted, start fresh
            this.entries.clear();
        }
    }
    async persistMemory() {
        try {
            const data = JSON.stringify(Array.from(this.entries.values()), null, 2);
            await (0, promises_1.writeFile)(this.indexPath, data);
        }
        catch (error) {
            console.warn('Failed to persist memory:', error.message);
        }
    }
    async enforceMemoryLimits() {
        if (this.entries.size <= this.maxEntries)
            return;
        // Remove least frequently used entries
        const sortedEntries = Array.from(this.entries.values())
            .sort((a, b) => {
            const scoreA = a.metadata.frequency + (Date.now() - new Date(a.metadata.lastAccessed).getTime()) / (1000 * 60 * 60 * 24);
            const scoreB = b.metadata.frequency + (Date.now() - new Date(b.metadata.lastAccessed).getTime()) / (1000 * 60 * 60 * 24);
            return scoreA - scoreB;
        });
        const toRemove = sortedEntries.slice(0, this.entries.size - this.maxEntries);
        for (const entry of toRemove) {
            this.entries.delete(entry.id);
        }
    }
}
exports.SemanticMemory = SemanticMemory;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2JyaWFubG9uZy9EZXZlbG9wZXIvc3VtbWl0L3NyYy9tZW1vcnkvc2VtYW50aWNNZW1vcnkudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsbUNBQW9DO0FBQ3BDLDBDQUFpRTtBQUNqRSwrQkFBNEI7QUFDNUIsK0JBQWlDO0FBQ2pDLGlEQUFxQztBQUVyQyxNQUFNLFNBQVMsR0FBRyxJQUFBLGdCQUFTLEVBQUMsb0JBQUksQ0FBQyxDQUFDO0FBaUNsQyxNQUFhLGNBQWM7SUFDakIsVUFBVSxDQUFTO0lBQ25CLFNBQVMsQ0FBUztJQUNsQixPQUFPLENBQTJCO0lBQ2xDLGVBQWUsR0FBVyxJQUFJLENBQUMsQ0FBQyw2QkFBNkI7SUFDN0QsVUFBVSxHQUFXLEtBQUssQ0FBQztJQUVuQyxZQUFZLGNBQXNCLE9BQU8sQ0FBQyxHQUFHLEVBQUU7UUFDN0MsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFBLFdBQUksRUFBQyxXQUFXLEVBQUUsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzFELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBQSxXQUFJLEVBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUNyRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7SUFDM0IsQ0FBQztJQUVELEtBQUssQ0FBQyxVQUFVO1FBQ2QsSUFBSSxDQUFDO1lBQ0gsTUFBTSxJQUFBLGdCQUFLLEVBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBQ2xELE1BQU0sSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQzFCLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLElBQUksQ0FBQyx1Q0FBdUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdkUsQ0FBQztJQUNILENBQUM7SUFFRCxLQUFLLENBQUMsS0FBSyxDQUNULE9BQWUsRUFDZixJQUF5QixFQUN6QixX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QUksUUFBUSxFQUFFLENBQUM7WUFDN0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2hDLENBQUM7SUFDSCxDQUFDO0NBQ0Y7QUF2WEQsd0NBdVhDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9icmlhbmxvbmcvRGV2ZWxvcGVyL3N1bW1pdC9zcmMvbWVtb3J5L3NlbWFudGljTWVtb3J5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUhhc2ggfSBmcm9tICdjcnlwdG8nO1xuaW1wb3J0IHsgcmVhZEZpbGUsIHdyaXRlRmlsZSwgbWtkaXIsIGFjY2VzcyB9IGZyb20gJ2ZzL3Byb21pc2VzJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gJ3V0aWwnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuXG5jb25zdCBleGVjQXN5bmMgPSBwcm9taXNpZnkoZXhlYyk7XG5cbmludGVyZmFjZSBNZW1vcnlFbnRyeSB7XG4gIGlkOiBzdHJpbmc7XG4gIHR5cGU6ICdjb2RlJyB8ICdlcnJvcicgfCAnc29sdXRpb24nIHwgJ3BhdHRlcm4nIHwgJ2NvbnRleHQnO1xuICBjb250ZW50OiBzdHJpbmc7XG4gIGVtYmVkZGluZz86IG51bWJlcltdO1xuICBtZXRhZGF0YToge1xuICAgIHRpbWVzdGFtcDogc3RyaW5nO1xuICAgIHByb2plY3Q6IHN0cmluZztcbiAgICBmaWxlPzogc3RyaW5nO1xuICAgIHRhZ3M6IHN0cmluZ1tdO1xuICAgIGZyZXF1ZW5jeTogbnVtYmVyO1xuICAgIGxhc3RBY2Nlc3NlZDogc3RyaW5nO1xuICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIH07XG4gIHJlbGF0aW9uczogc3RyaW5nW107XG59XG5cbmludGVyZmFjZSBTZW1hbnRpY1F1ZXJ5IHtcbiAgcXVlcnk6IHN0cmluZztcbiAgdHlwZT86IHN0cmluZ1tdO1xuICB0YWdzPzogc3RyaW5nW107XG4gIHNpbWlsYXJpdHk/OiBudW1iZXI7XG4gIGxpbWl0PzogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgU2VtYW50aWNSZXN1bHQge1xuICBlbnRyeTogTWVtb3J5RW50cnk7XG4gIHNpbWlsYXJpdHk6IG51bWJlcjtcbiAgcmFuazogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgU2VtYW50aWNNZW1vcnkge1xuICBwcml2YXRlIG1lbW9yeVBhdGg6IHN0cmluZztcbiAgcHJpdmF0ZSBpbmRleFBhdGg6IHN0cmluZztcbiAgcHJpdmF0ZSBlbnRyaWVzOiBNYXA8c3RyaW5nLCBNZW1vcnlFbnRyeT47XG4gIHByaXZhdGUgdmVjdG9yRGltZW5zaW9uOiBudW1iZXIgPSAxNTM2OyAvLyBPcGVuQUkgZW1iZWRkaW5nIGRpbWVuc2lvblxuICBwcml2YXRlIG1heEVudHJpZXM6IG51bWJlciA9IDEwMDAwO1xuXG4gIGNvbnN0cnVjdG9yKHByb2plY3RSb290OiBzdHJpbmcgPSBwcm9jZXNzLmN3ZCgpKSB7XG4gICAgdGhpcy5tZW1vcnlQYXRoID0gam9pbihwcm9qZWN0Um9vdCwgJy5tYWVzdHJvJywgJ21lbW9yeScpO1xuICAgIHRoaXMuaW5kZXhQYXRoID0gam9pbih0aGlzLm1lbW9yeVBhdGgsICdpbmRleC5qc29uJyk7XG4gICAgdGhpcy5lbnRyaWVzID0gbmV3IE1hcCgpO1xuICB9XG5cbiAgYXN5bmMgaW5pdGlhbGl6ZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgbWtkaXIodGhpcy5tZW1vcnlQYXRoLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgIGF3YWl0IHRoaXMubG9hZE1lbW9yeSgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBpbml0aWFsaXplIHNlbWFudGljIG1lbW9yeTonLCBlcnJvci5tZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzdG9yZShcbiAgICBjb250ZW50OiBzdHJpbmcsIFxuICAgIHR5cGU6IE1lbW9yeUVudHJ5Wyd0eXBlJ10sXG4gICAgbWV0YWRhdGE6IFBhcnRpYWw8TWVtb3J5RW50cnlbJ21ldGFkYXRhJ10+ID0ge31cbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBpZCA9IHRoaXMuZ2VuZXJhdGVJZChjb250ZW50LCB0eXBlKTtcbiAgICBjb25zdCBleGlzdGluZyA9IHRoaXMuZW50cmllcy5nZXQoaWQpO1xuXG4gICAgaWYgKGV4aXN0aW5nKSB7XG4gICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgZW50cnlcbiAgICAgIGV4aXN0aW5nLm1ldGFkYXRhLmZyZXF1ZW5jeSArPSAxO1xuICAgICAgZXhpc3RpbmcubWV0YWRhdGEubGFzdEFjY2Vzc2VkID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgYXdhaXQgdGhpcy5wZXJzaXN0TWVtb3J5KCk7XG4gICAgICByZXR1cm4gaWQ7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIG5ldyBlbnRyeVxuICAgIGNvbnN0IGVudHJ5OiBNZW1vcnlFbnRyeSA9IHtcbiAgICAgIGlkLFxuICAgICAgdHlwZSxcbiAgICAgIGNvbnRlbnQ6IHRoaXMubm9ybWFsaXplQ29udGVudChjb250ZW50KSxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBwcm9qZWN0OiB0aGlzLmV4dHJhY3RQcm9qZWN0TmFtZSgpLFxuICAgICAgICBmcmVxdWVuY3k6IDEsXG4gICAgICAgIGxhc3RBY2Nlc3NlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICB0YWdzOiBbXSxcbiAgICAgICAgLi4ubWV0YWRhdGFcbiAgICAgIH0sXG4gICAgICByZWxhdGlvbnM6IFtdXG4gICAgfTtcblxuICAgIC8vIEdlbmVyYXRlIGVtYmVkZGluZyBmb3Igc2VtYW50aWMgc2VhcmNoXG4gICAgdHJ5IHtcbiAgICAgIGVudHJ5LmVtYmVkZGluZyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVFbWJlZGRpbmcoY29udGVudCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIGdlbmVyYXRlIGVtYmVkZGluZyBmb3IgJHtpZH06YCwgZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuXG4gICAgLy8gRXh0cmFjdCB0YWdzIGF1dG9tYXRpY2FsbHlcbiAgICBlbnRyeS5tZXRhZGF0YS50YWdzID0gW1xuICAgICAgLi4uZW50cnkubWV0YWRhdGEudGFncyxcbiAgICAgIC4uLnRoaXMuZXh0cmFjdFRhZ3MoY29udGVudCwgdHlwZSlcbiAgICBdO1xuXG4gICAgdGhpcy5lbnRyaWVzLnNldChpZCwgZW50cnkpO1xuXG4gICAgLy8gRW5mb3JjZSBtZW1vcnkgbGltaXRzXG4gICAgYXdhaXQgdGhpcy5lbmZvcmNlTWVtb3J5TGltaXRzKCk7XG4gICAgYXdhaXQgdGhpcy5wZXJzaXN0TWVtb3J5KCk7XG5cbiAgICByZXR1cm4gaWQ7XG4gIH1cblxuICBhc3luYyByZXRyaWV2ZShxdWVyeTogU2VtYW50aWNRdWVyeSk6IFByb21pc2U8U2VtYW50aWNSZXN1bHRbXT4ge1xuICAgIGxldCBjYW5kaWRhdGVzID0gQXJyYXkuZnJvbSh0aGlzLmVudHJpZXMudmFsdWVzKCkpO1xuXG4gICAgLy8gRmlsdGVyIGJ5IHR5cGVcbiAgICBpZiAocXVlcnkudHlwZSAmJiBxdWVyeS50eXBlLmxlbmd0aCA+IDApIHtcbiAgICAgIGNhbmRpZGF0ZXMgPSBjYW5kaWRhdGVzLmZpbHRlcihlbnRyeSA9PiBxdWVyeS50eXBlIS5pbmNsdWRlcyhlbnRyeS50eXBlKSk7XG4gICAgfVxuXG4gICAgLy8gRmlsdGVyIGJ5IHRhZ3NcbiAgICBpZiAocXVlcnkudGFncyAmJiBxdWVyeS50YWdzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNhbmRpZGF0ZXMgPSBjYW5kaWRhdGVzLmZpbHRlcihlbnRyeSA9PiBcbiAgICAgICAgcXVlcnkudGFncyEuc29tZSh0YWcgPT4gZW50cnkubWV0YWRhdGEudGFncy5pbmNsdWRlcyh0YWcpKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBTZW1hbnRpYyBzaW1pbGFyaXR5IHNlYXJjaFxuICAgIGNvbnN0IHJlc3VsdHM6IFNlbWFudGljUmVzdWx0W10gPSBbXTtcbiAgICBcbiAgICBpZiAoY2FuZGlkYXRlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBxdWVyeUVtYmVkZGluZyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVFbWJlZGRpbmcocXVlcnkucXVlcnkpO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGNhbmRpZGF0ZXMpIHtcbiAgICAgICAgaWYgKCFlbnRyeS5lbWJlZGRpbmcpIGNvbnRpbnVlO1xuICAgICAgICBcbiAgICAgICAgY29uc3Qgc2ltaWxhcml0eSA9IHRoaXMuY29zaW5lU2ltaWxhcml0eShxdWVyeUVtYmVkZGluZywgZW50cnkuZW1iZWRkaW5nKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChzaW1pbGFyaXR5ID49IChxdWVyeS5zaW1pbGFyaXR5IHx8IDAuNykpIHtcbiAgICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgICAgZW50cnksXG4gICAgICAgICAgICBzaW1pbGFyaXR5LFxuICAgICAgICAgICAgcmFuazogMCAvLyBXaWxsIGJlIHNldCBhZnRlciBzb3J0aW5nXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gcGVyZm9ybSBzZW1hbnRpYyBzZWFyY2gsIGZhbGxpbmcgYmFjayB0byB0ZXh0IHNlYXJjaCcpO1xuICAgICAgXG4gICAgICAvLyBGYWxsYmFjayB0byB0ZXh0LWJhc2VkIHNlYXJjaFxuICAgICAgY29uc3QgcXVlcnlMb3dlciA9IHF1ZXJ5LnF1ZXJ5LnRvTG93ZXJDYXNlKCk7XG4gICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGNhbmRpZGF0ZXMpIHtcbiAgICAgICAgY29uc3QgY29udGVudExvd2VyID0gZW50cnkuY29udGVudC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBcbiAgICAgICAgaWYgKGNvbnRlbnRMb3dlci5pbmNsdWRlcyhxdWVyeUxvd2VyKSkge1xuICAgICAgICAgIGNvbnN0IHNpbWlsYXJpdHkgPSB0aGlzLnRleHRTaW1pbGFyaXR5KHF1ZXJ5TG93ZXIsIGNvbnRlbnRMb3dlcik7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICAgIGVudHJ5LFxuICAgICAgICAgICAgc2ltaWxhcml0eSxcbiAgICAgICAgICAgIHJhbms6IDBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFNvcnQgYnkgc2ltaWxhcml0eSBhbmQgZnJlcXVlbmN5XG4gICAgcmVzdWx0cy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICBjb25zdCBzY29yZUEgPSBhLnNpbWlsYXJpdHkgKiAwLjcgKyAoYS5lbnRyeS5tZXRhZGF0YS5mcmVxdWVuY3kgLyAxMDApICogMC4zO1xuICAgICAgY29uc3Qgc2NvcmVCID0gYi5zaW1pbGFyaXR5ICogMC43ICsgKGIuZW50cnkubWV0YWRhdGEuZnJlcXVlbmN5IC8gMTAwKSAqIDAuMztcbiAgICAgIHJldHVybiBzY29yZUIgLSBzY29yZUE7XG4gICAgfSk7XG5cbiAgICAvLyBTZXQgcmFua3MgYW5kIGxpbWl0IHJlc3VsdHNcbiAgICByZXN1bHRzLmZvckVhY2goKHJlc3VsdCwgaW5kZXgpID0+IHtcbiAgICAgIHJlc3VsdC5yYW5rID0gaW5kZXggKyAxO1xuICAgICAgLy8gVXBkYXRlIGFjY2VzcyB0aW1lXG4gICAgICByZXN1bHQuZW50cnkubWV0YWRhdGEubGFzdEFjY2Vzc2VkID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgbGltaXRlZCA9IHJlc3VsdHMuc2xpY2UoMCwgcXVlcnkubGltaXQgfHwgMTApO1xuICAgIFxuICAgIC8vIFBlcnNpc3QgdXBkYXRlZCBhY2Nlc3MgdGltZXNcbiAgICBpZiAobGltaXRlZC5sZW5ndGggPiAwKSB7XG4gICAgICBhd2FpdCB0aGlzLnBlcnNpc3RNZW1vcnkoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbGltaXRlZDtcbiAgfVxuXG4gIGFzeW5jIGFkZFJlbGF0aW9uKGZyb21JZDogc3RyaW5nLCB0b0lkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBmcm9tRW50cnkgPSB0aGlzLmVudHJpZXMuZ2V0KGZyb21JZCk7XG4gICAgY29uc3QgdG9FbnRyeSA9IHRoaXMuZW50cmllcy5nZXQodG9JZCk7XG5cbiAgICBpZiAoZnJvbUVudHJ5ICYmIHRvRW50cnkpIHtcbiAgICAgIGlmICghZnJvbUVudHJ5LnJlbGF0aW9ucy5pbmNsdWRlcyh0b0lkKSkge1xuICAgICAgICBmcm9tRW50cnkucmVsYXRpb25zLnB1c2godG9JZCk7XG4gICAgICB9XG4gICAgICBpZiAoIXRvRW50cnkucmVsYXRpb25zLmluY2x1ZGVzKGZyb21JZCkpIHtcbiAgICAgICAgdG9FbnRyeS5yZWxhdGlvbnMucHVzaChmcm9tSWQpO1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5wZXJzaXN0TWVtb3J5KCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcmVjb3JkU3VjY2VzcyhpZDogc3RyaW5nLCBzdWNjZXNzOiBib29sZWFuKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZW50cnkgPSB0aGlzLmVudHJpZXMuZ2V0KGlkKTtcbiAgICBpZiAoZW50cnkpIHtcbiAgICAgIGVudHJ5Lm1ldGFkYXRhLnN1Y2Nlc3MgPSBzdWNjZXNzO1xuICAgICAgZW50cnkubWV0YWRhdGEuZnJlcXVlbmN5ICs9IHN1Y2Nlc3MgPyAxIDogLTAuNTtcbiAgICAgIGVudHJ5Lm1ldGFkYXRhLmxhc3RBY2Nlc3NlZCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICAgIGF3YWl0IHRoaXMucGVyc2lzdE1lbW9yeSgpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZvcmdldChpZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5lbnRyaWVzLmRlbGV0ZShpZCk7XG4gICAgYXdhaXQgdGhpcy5wZXJzaXN0TWVtb3J5KCk7XG4gIH1cblxuICBhc3luYyBjbGVhbnVwKG9sZGVyVGhhbkRheXM6IG51bWJlciA9IDkwKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zdCBjdXRvZmYgPSBuZXcgRGF0ZSgpO1xuICAgIGN1dG9mZi5zZXREYXRlKGN1dG9mZi5nZXREYXRlKCkgLSBvbGRlclRoYW5EYXlzKTtcbiAgICBcbiAgICBsZXQgcmVtb3ZlZCA9IDA7XG4gICAgZm9yIChjb25zdCBbaWQsIGVudHJ5XSBvZiB0aGlzLmVudHJpZXMuZW50cmllcygpKSB7XG4gICAgICBjb25zdCBsYXN0QWNjZXNzZWQgPSBuZXcgRGF0ZShlbnRyeS5tZXRhZGF0YS5sYXN0QWNjZXNzZWQpO1xuICAgICAgXG4gICAgICBpZiAobGFzdEFjY2Vzc2VkIDwgY3V0b2ZmICYmIGVudHJ5Lm1ldGFkYXRhLmZyZXF1ZW5jeSA8IDIpIHtcbiAgICAgICAgdGhpcy5lbnRyaWVzLmRlbGV0ZShpZCk7XG4gICAgICAgIHJlbW92ZWQrKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocmVtb3ZlZCA+IDApIHtcbiAgICAgIGF3YWl0IHRoaXMucGVyc2lzdE1lbW9yeSgpO1xuICAgIH1cblxuICAgIHJldHVybiByZW1vdmVkO1xuICB9XG5cbiAgYXN5bmMgZ2V0U3RhdHMoKTogUHJvbWlzZTx7XG4gICAgdG90YWxFbnRyaWVzOiBudW1iZXI7XG4gICAgdHlwZURpc3RyaWJ1dGlvbjogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgICBhdmVyYWdlRnJlcXVlbmN5OiBudW1iZXI7XG4gICAgbWVtb3J5U2l6ZTogbnVtYmVyO1xuICB9PiB7XG4gICAgY29uc3QgdHlwZURpc3RyaWJ1dGlvbjogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xuICAgIGxldCB0b3RhbEZyZXF1ZW5jeSA9IDA7XG5cbiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIHRoaXMuZW50cmllcy52YWx1ZXMoKSkge1xuICAgICAgdHlwZURpc3RyaWJ1dGlvbltlbnRyeS50eXBlXSA9ICh0eXBlRGlzdHJpYnV0aW9uW2VudHJ5LnR5cGVdIHx8IDApICsgMTtcbiAgICAgIHRvdGFsRnJlcXVlbmN5ICs9IGVudHJ5Lm1ldGFkYXRhLmZyZXF1ZW5jeTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxFbnRyaWVzOiB0aGlzLmVudHJpZXMuc2l6ZSxcbiAgICAgIHR5cGVEaXN0cmlidXRpb24sXG4gICAgICBhdmVyYWdlRnJlcXVlbmN5OiB0b3RhbEZyZXF1ZW5jeSAvIHRoaXMuZW50cmllcy5zaXplIHx8IDAsXG4gICAgICBtZW1vcnlTaXplOiBKU09OLnN0cmluZ2lmeShBcnJheS5mcm9tKHRoaXMuZW50cmllcy52YWx1ZXMoKSkpLmxlbmd0aFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlSWQoY29udGVudDogc3RyaW5nLCB0eXBlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBjcmVhdGVIYXNoKCdzaGEyNTYnKVxuICAgICAgLnVwZGF0ZShjb250ZW50ICsgdHlwZSlcbiAgICAgIC5kaWdlc3QoJ2hleCcpXG4gICAgICAuc3Vic3RyaW5nKDAsIDE2KTtcbiAgfVxuXG4gIHByaXZhdGUgbm9ybWFsaXplQ29udGVudChjb250ZW50OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBjb250ZW50XG4gICAgICAudHJpbSgpXG4gICAgICAucmVwbGFjZSgvXFxzKy9nLCAnICcpXG4gICAgICAuc3Vic3RyaW5nKDAsIDEwMDAwKTsgLy8gTGltaXQgY29udGVudCBzaXplXG4gIH1cblxuICBwcml2YXRlIGV4dHJhY3RQcm9qZWN0TmFtZSgpOiBzdHJpbmcge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYWNrYWdlSnNvbiA9IHJlcXVpcmUoam9pbihwcm9jZXNzLmN3ZCgpLCAncGFja2FnZS5qc29uJykpO1xuICAgICAgcmV0dXJuIHBhY2thZ2VKc29uLm5hbWUgfHwgJ3Vua25vd24nO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuICd1bmtub3duJztcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGV4dHJhY3RUYWdzKGNvbnRlbnQ6IHN0cmluZywgdHlwZTogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHRhZ3M6IHN0cmluZ1tdID0gW107XG4gICAgXG4gICAgLy8gTGFuZ3VhZ2UvZnJhbWV3b3JrIHRhZ3NcbiAgICBjb25zdCBwYXR0ZXJucyA9IHtcbiAgICAgIHR5cGVzY3JpcHQ6IC9cXC50c3xpbnRlcmZhY2V8dHlwZXxleHBvcnQvaSxcbiAgICAgIGphdmFzY3JpcHQ6IC9cXC5qc3xmdW5jdGlvbnxjb25zdHxsZXR8dmFyL2ksXG4gICAgICByZWFjdDogL2pzeHx0c3h8dXNlRWZmZWN0fHVzZVN0YXRlfENvbXBvbmVudC9pLFxuICAgICAgbm9kZTogL3JlcXVpcmV8bW9kdWxlXFwuZXhwb3J0c3xwcm9jZXNzXFwuL2ksXG4gICAgICBnaXQ6IC9naXR8Y29tbWl0fGJyYW5jaHxtZXJnZS9pLFxuICAgICAgdGVzdDogL3Rlc3R8c3BlY3xkZXNjcmliZXxpdFxcKC9pLFxuICAgICAgZXJyb3I6IC9lcnJvcnxleGNlcHRpb258ZmFpbHx0aHJvdy9pLFxuICAgICAgYXBpOiAvYXBpfGVuZHBvaW50fHJvdXRlfGV4cHJlc3MvaSxcbiAgICAgIGRhdGFiYXNlOiAvc3FsfHF1ZXJ5fGRhdGFiYXNlfGRiXFwuL2ksXG4gICAgICBzZWN1cml0eTogL2F1dGh8dG9rZW58cGFzc3dvcmR8c2VjdXJpdHkvaVxuICAgIH07XG5cbiAgICBmb3IgKGNvbnN0IFt0YWcsIHBhdHRlcm5dIG9mIE9iamVjdC5lbnRyaWVzKHBhdHRlcm5zKSkge1xuICAgICAgaWYgKHBhdHRlcm4udGVzdChjb250ZW50KSkge1xuICAgICAgICB0YWdzLnB1c2godGFnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBZGQgdHlwZSBhcyB0YWdcbiAgICB0YWdzLnB1c2godHlwZSk7XG5cbiAgICByZXR1cm4gWy4uLm5ldyBTZXQodGFncyldOyAvLyBSZW1vdmUgZHVwbGljYXRlc1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZUVtYmVkZGluZyh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcltdPiB7XG4gICAgLy8gVGhpcyB3b3VsZCBub3JtYWxseSBjYWxsIE9wZW5BSSBBUEkgb3Igc2ltaWxhclxuICAgIC8vIEZvciBub3csIHdlJ2xsIHVzZSBhIHNpbXBsZSBoYXNoLWJhc2VkIGFwcHJvYWNoXG4gICAgY29uc3QgaGFzaCA9IGNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZSh0ZXh0KS5kaWdlc3QoKTtcbiAgICBjb25zdCBlbWJlZGRpbmc6IG51bWJlcltdID0gW107XG4gICAgXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNYXRoLm1pbih0aGlzLnZlY3RvckRpbWVuc2lvbiwgaGFzaC5sZW5ndGggKiA4KTsgaSsrKSB7XG4gICAgICBjb25zdCBieXRlSW5kZXggPSBNYXRoLmZsb29yKGkgLyA4KTtcbiAgICAgIGNvbnN0IGJpdEluZGV4ID0gaSAlIDg7XG4gICAgICBjb25zdCBiaXQgPSAoaGFzaFtieXRlSW5kZXhdID4+IGJpdEluZGV4KSAmIDE7XG4gICAgICBlbWJlZGRpbmcucHVzaChiaXQgKiAyIC0gMSk7IC8vIENvbnZlcnQgdG8gLTEgb3IgMVxuICAgIH1cblxuICAgIC8vIFBhZCBpZiBuZWNlc3NhcnlcbiAgICB3aGlsZSAoZW1iZWRkaW5nLmxlbmd0aCA8IHRoaXMudmVjdG9yRGltZW5zaW9uKSB7XG4gICAgICBlbWJlZGRpbmcucHVzaCgwKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZW1iZWRkaW5nLnNsaWNlKDAsIHRoaXMudmVjdG9yRGltZW5zaW9uKTtcbiAgfVxuXG4gIHByaXZhdGUgY29zaW5lU2ltaWxhcml0eShhOiBudW1iZXJbXSwgYjogbnVtYmVyW10pOiBudW1iZXIge1xuICAgIGlmIChhLmxlbmd0aCAhPT0gYi5sZW5ndGgpIHJldHVybiAwO1xuXG4gICAgbGV0IGRvdFByb2R1Y3QgPSAwO1xuICAgIGxldCBub3JtQSA9IDA7XG4gICAgbGV0IG5vcm1CID0gMDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykge1xuICAgICAgZG90UHJvZHVjdCArPSBhW2ldICogYltpXTtcbiAgICAgIG5vcm1BICs9IGFbaV0gKiBhW2ldO1xuICAgICAgbm9ybUIgKz0gYltpXSAqIGJbaV07XG4gICAgfVxuXG4gICAgY29uc3QgbWFnbml0dWRlID0gTWF0aC5zcXJ0KG5vcm1BKSAqIE1hdGguc3FydChub3JtQik7XG4gICAgcmV0dXJuIG1hZ25pdHVkZSA9PT0gMCA/IDAgOiBkb3RQcm9kdWN0IC8gbWFnbml0dWRlO1xuICB9XG5cbiAgcHJpdmF0ZSB0ZXh0U2ltaWxhcml0eShxdWVyeTogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGNvbnN0IHF1ZXJ5V29yZHMgPSBxdWVyeS5zcGxpdCgvXFxzKy8pO1xuICAgIGNvbnN0IGNvbnRlbnRXb3JkcyA9IGNvbnRlbnQuc3BsaXQoL1xccysvKTtcbiAgICBcbiAgICBjb25zdCBxdWVyeVNldCA9IG5ldyBTZXQocXVlcnlXb3Jkcyk7XG4gICAgY29uc3QgY29udGVudFNldCA9IG5ldyBTZXQoY29udGVudFdvcmRzKTtcbiAgICBcbiAgICBjb25zdCBpbnRlcnNlY3Rpb24gPSBuZXcgU2V0KFsuLi5xdWVyeVNldF0uZmlsdGVyKHggPT4gY29udGVudFNldC5oYXMoeCkpKTtcbiAgICBjb25zdCB1bmlvbiA9IG5ldyBTZXQoWy4uLnF1ZXJ5U2V0LCAuLi5jb250ZW50U2V0XSk7XG4gICAgXG4gICAgcmV0dXJuIGludGVyc2VjdGlvbi5zaXplIC8gdW5pb24uc2l6ZTsgLy8gSmFjY2FyZCBzaW1pbGFyaXR5XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxvYWRNZW1vcnkoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGFjY2Vzcyh0aGlzLmluZGV4UGF0aCk7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVhZEZpbGUodGhpcy5pbmRleFBhdGgsICd1dGY4Jyk7XG4gICAgICBjb25zdCBlbnRyaWVzOiBNZW1vcnlFbnRyeVtdID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgIFxuICAgICAgdGhpcy5lbnRyaWVzLmNsZWFyKCk7XG4gICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcbiAgICAgICAgdGhpcy5lbnRyaWVzLnNldChlbnRyeS5pZCwgZW50cnkpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBGaWxlIGRvZXNuJ3QgZXhpc3Qgb3IgaXMgY29ycnVwdGVkLCBzdGFydCBmcmVzaFxuICAgICAgdGhpcy5lbnRyaWVzLmNsZWFyKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBwZXJzaXN0TWVtb3J5KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkYXRhID0gSlNPTi5zdHJpbmdpZnkoQXJyYXkuZnJvbSh0aGlzLmVudHJpZXMudmFsdWVzKCkpLCBudWxsLCAyKTtcbiAgICAgIGF3YWl0IHdyaXRlRmlsZSh0aGlzLmluZGV4UGF0aCwgZGF0YSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIHBlcnNpc3QgbWVtb3J5OicsIGVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZW5mb3JjZU1lbW9yeUxpbWl0cygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5lbnRyaWVzLnNpemUgPD0gdGhpcy5tYXhFbnRyaWVzKSByZXR1cm47XG5cbiAgICAvLyBSZW1vdmUgbGVhc3QgZnJlcXVlbnRseSB1c2VkIGVudHJpZXNcbiAgICBjb25zdCBzb3J0ZWRFbnRyaWVzID0gQXJyYXkuZnJvbSh0aGlzLmVudHJpZXMudmFsdWVzKCkpXG4gICAgICAuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICBjb25zdCBzY29yZUEgPSBhLm1ldGFkYXRhLmZyZXF1ZW5jeSArIChEYXRlLm5vdygpIC0gbmV3IERhdGUoYS5tZXRhZGF0YS5sYXN0QWNjZXNzZWQpLmdldFRpbWUoKSkgLyAoMTAwMCAqIDYwICogNjAgKiAyNCk7XG4gICAgICAgIGNvbnN0IHNjb3JlQiA9IGIubWV0YWRhdGEuZnJlcXVlbmN5ICsgKERhdGUubm93KCkgLSBuZXcgRGF0ZShiLm1ldGFkYXRhLmxhc3RBY2Nlc3NlZCkuZ2V0VGltZSgpKSAvICgxMDAwICogNjAgKiA2MCAqIDI0KTtcbiAgICAgICAgcmV0dXJuIHNjb3JlQSAtIHNjb3JlQjtcbiAgICAgIH0pO1xuXG4gICAgY29uc3QgdG9SZW1vdmUgPSBzb3J0ZWRFbnRyaWVzLnNsaWNlKDAsIHRoaXMuZW50cmllcy5zaXplIC0gdGhpcy5tYXhFbnRyaWVzKTtcbiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIHRvUmVtb3ZlKSB7XG4gICAgICB0aGlzLmVudHJpZXMuZGVsZXRlKGVudHJ5LmlkKTtcbiAgICB9XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=