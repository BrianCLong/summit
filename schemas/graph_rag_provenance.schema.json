{
  "$id": "https://summit.dev/schemas/graph-rag-provenance",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "GraphRAG Provenance Artifact",
  "description": "Schema for recording the lineage, inputs, and outputs of a deterministic GraphRAG execution.",
  "type": "object",
  "required": [
    "run_id",
    "timestamp",
    "inputs",
    "retrieval",
    "context",
    "model_invocation",
    "outputs"
  ],
  "properties": {
    "run_id": {
      "type": "string",
      "description": "Unique identifier for this execution run (UUID)."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO8601 timestamp of execution."
    },
    "inputs": {
      "type": "object",
      "required": ["query"],
      "properties": {
        "query": {
          "type": "string",
          "description": "The original user query or agent intent."
        },
        "config": {
          "type": "object",
          "description": "Runtime configuration used for this run.",
          "properties": {
            "model": { "type": "string" },
            "temperature": { "type": "number" },
            "max_tokens": { "type": "integer" },
            "depth": { "type": "integer" }
          }
        }
      }
    },
    "retrieval": {
      "type": "object",
      "required": ["traversal_path", "ranked_candidates"],
      "properties": {
        "traversal_path": {
          "type": "array",
          "description": "Ordered list of node IDs visited during graph traversal.",
          "items": { "type": "string" }
        },
        "ranked_candidates": {
          "type": "array",
          "description": "Final ordered list of candidates selected for context.",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "score": { "type": "number" },
              "source": { "type": "string", "enum": ["vector", "graph"] }
            },
            "required": ["id", "score"]
          }
        }
      }
    },
    "context": {
      "type": "object",
      "required": ["content_hash", "payload_size"],
      "properties": {
        "content_hash": {
          "type": "string",
          "pattern": "^sha256:[a-f0-9]{64}$",
          "description": "SHA-256 hash of the assembled context payload."
        },
        "payload_size": {
          "type": "integer",
          "description": "Size of the context payload in bytes."
        }
      }
    },
    "model_invocation": {
      "type": "object",
      "properties": {
        "provider": { "type": "string" },
        "model": { "type": "string" },
        "prompt_tokens": { "type": "integer" },
        "completion_tokens": { "type": "integer" }
      }
    },
    "outputs": {
      "type": "object",
      "required": ["answer", "citations"],
      "properties": {
        "answer": {
          "type": "string",
          "description": "The final generated text response."
        },
        "citations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "node_id": { "type": "string" },
              "text": { "type": "string" }
            }
          }
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    }
  }
}
