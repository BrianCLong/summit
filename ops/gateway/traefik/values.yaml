deployment:
  replicas: 2
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9100"
  additionalVolumes:
    - name: dynamic-config
      projected:
        sources:
          - configMap:
              name: traefik-dynamic
  additionalVolumeMounts:
    - name: dynamic-config
      mountPath: /etc/traefik/dynamic
      readOnly: true

logs:
  general:
    level: INFO
  access:
    enabled: true
    format: json
    fields:
      names:
        StartUTC: drop
        DownstreamStatus: keep
        RequestProtocol: keep
        ClientAddr: keep

pilot:
  enabled: false

providers:
  kubernetesCRD:
    enabled: true
  kubernetesIngress:
    enabled: false
  file:
    directory: /etc/traefik/dynamic
    watch: true

entryPoints:
  web:
    address: ":80"
    http:
      redirections:
        entryPoint:
          to: websecure
          scheme: https
  websecure:
    address: ":443"
    http:
      tls:
        options: default
      middlewares:
        - secure-headers@kubernetescrd

ports:
  web:
    redirectTo: websecure
  websecure:
    tls:
      enabled: true
      options: "default"

service:
  enabled: true

metrics:
  prometheus:
    enabled: true
    buckets:
      - 0.1
      - 0.3
      - 1
      - 3
    addEntryPointsLabels: true
    addServicesLabels: true

tracing:
  otlp:
    enabled: true
    grpc:
      endpoint: jaeger-collector.observability:4317
      insecure: true
    serviceName: traefik-gateway

serversTransport:
  insecureSkipVerify: false
  forwardingTimeouts:
    dialTimeout: 3s
    responseHeaderTimeout: 6s
    idleConnTimeout: 90s

additionalArguments:
  - "--api.dashboard=true"
  - "--serversTransport.forwardingTimeouts.responseHeaderTimeout=6s"
  - "--entryPoints.websecure.http.tls.options=default"
  - "--entryPoints.web.http.redirections.entryPoint.to=websecure"
  - "--entryPoints.web.http.redirections.entryPoint.scheme=https"

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 6
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 60
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 70

podSecurityPolicy:
  enabled: false

ssl:
  enabled: true
  enforced: true
  permanentRedirect: true

middleware:
  defaultSecureHeaders:
    stsSeconds: 31536000
    stsIncludeSubdomains: true
    stsPreload: true
    forceSTSHeader: true
    contentTypeNosniff: true
    browserXssFilter: true
    referrerPolicy: strict-origin-when-cross-origin
