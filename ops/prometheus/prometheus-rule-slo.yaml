groups:
  - name: intelgraph-slos
    interval: 30s
    rules:
      - record: job:graph_query_latency_p95:rate5m
        expr: histogram_quantile(0.95, sum(rate(graph_query_latency_seconds_bucket[5m])) by (le))
      - alert: GraphQuerySLOBurnFast
        expr: job:graph_query_latency_p95:rate5m > 1.5
        for: 10m
        labels: { severity: page, domain: 'graph' }
        annotations:
          summary: 'p95 graph query latency breaching'
          description: 'p95 > 1.5s for 10m (N=3 hops, ~50k nodes).'
      - alert: ErrorBudgetBurn2x
        expr: (sum(rate(http_request_errors_total[5m])) / sum(rate(http_requests_total[5m]))) > 0.02
        for: 15m
        labels: { severity: page, domain: 'api' }
        annotations:
          summary: 'Error budget burning >2x'
          description: 'Investigate hot paths; check cost guards & caches.'
      - record: job:ml_engine_inference_latency_p95:rate5m
        expr: histogram_quantile(0.95, sum(rate(ml_engine_inference_latency_seconds_bucket[5m])) by (le))
      - record: job:disclosure_packager_batch_latency_p95:rate5m
        expr: histogram_quantile(0.95, sum(rate(disclosure_packager_batch_duration_seconds_bucket[5m])) by (le))
      - alert: MLEngineAvailabilitySLOViolation
        expr: (1 - avg_over_time(up{job="ml-engine"}[15m])) > 0.001
        for: 15m
        labels: { severity: page, domain: 'ml-engine', slo: '99.9%' }
        annotations:
          summary: 'ML Engine availability below 99.9%'
          description: 'Availability dipped under 99.9% for 15m. Inspect otel collector health and Jaeger traces for cascading failures.'
      - alert: DisclosurePackagerAvailabilitySLOViolation
        expr: (1 - avg_over_time(up{job="disclosure-packager"}[15m])) > 0.001
        for: 15m
        labels: { severity: page, domain: 'disclosure', slo: '99.9%' }
        annotations:
          summary: 'Disclosure packager availability below 99.9%'
          description: 'Pipeline availability fell under SLO for 15m. Review retry counts, queue backlog, and Jaeger traces for root cause.'
