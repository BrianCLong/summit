groups:
  - name: price-aware-orchestration
    rules:
      - alert: PricingRefreshStale
        expr: (time() - max(pao_pricing_last_success_timestamp_seconds)) > 1800 or sum(rate(pao_pricing_refresh_success_total[15m])) == 0
        for: 10m
        labels:
          severity: page
        annotations:
          summary: "PAO pricing refresh is stale"
          description: "Last successful pricing refresh is older than 30m or no successes in the past 15m. Investigate refresh pipeline and upstream auth."
          runbook: "docs/runbooks/price-aware-orchestration.md"
      - alert: PricingRefreshErrorsHigh
        expr: sum(rate(pao_pricing_refresh_errors_total[5m])) > 0.1
        for: 5m
        labels:
          severity: page
        annotations:
          summary: "PAO pricing refresh errors elevated"
          description: "Pricing refresh error rate exceeds threshold. Check upstream pricing API, auth tokens, and DB connectivity."
          runbook: "docs/runbooks/price-aware-orchestration.md#pricing-refresh-failing-auth-parse-db-errors"
      - alert: UnknownPoolSelections
        expr: sum(rate(pao_unknown_pool_selections_total[10m])) > 0.05
        for: 5m
        labels:
          severity: warn
        annotations:
          summary: "Unknown poolId selections detected"
          description: "Selector is emitting unknown poolId results. Verify pool_registry/pool_pricing alignment and residency filters."
          runbook: "docs/runbooks/price-aware-orchestration.md#pool-selection-returning-none--unknown"
      - alert: NoEligiblePools
        expr: sum(rate(pao_selector_no_eligible_total[10m])) > 0.05
        for: 5m
        labels:
          severity: warn
        annotations:
          summary: "No eligible pools for PAO selection"
          description: "Selector returned no eligible pools. Check residency/label filters and pricing completeness. If metric unavailable, replace with log-based metric `pao_selector_no_eligible_total` when implemented."
          runbook: "docs/runbooks/price-aware-orchestration.md#residency-filter-causing-no-eligible-pools"
      - alert: ReservationErrorsHigh
        expr: sum(rate(pao_reservation_actions_total{status=\"error\"}[10m])) > 0.05
        for: 5m
        labels:
          severity: warn
        annotations:
          summary: "Capacity reservation errors elevated"
          description: "Reservation create/release operations are failing. Check DB, API auth, and stuck reservations."
          runbook: "docs/runbooks/price-aware-orchestration.md#capacity-reservations-stuck-active--not-released"
