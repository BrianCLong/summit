# üéâ Evidence ID Consistency Gate v1.3.0 - NOW AVAILABLE

**Release Date**: January 15, 2026  
**Version**: v1.3.0  
**Status**: General Availability (GA) - Production Ready

## Overview

We're excited to announce the **Evidence ID Consistency Gate v1.3.0** - a deterministic governance verification tool that ensures all `Evidence-IDs` in your governance documents have corresponding entries in the evidence registry.

This gate helps maintain **traceability and completeness** of governance artifacts by validating that:
- All referenced Evidence-IDs exist in the evidence registry
- Evidence-IDs follow the correct format (`/^[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)*$/`)
- Governance documents contain properly structured Evidence-IDs headers

## Key Features

### üîê Enterprise Security
- **PII/Secret redaction**: All sensitive content scrubbed before AI processing
- **Hash-only audit trail**: No content leakage in `ai_ledger.json`
- **Replay-only protection**: CI environments locked to cached responses by default
- **Network isolation**: Prevents unexpected calls to AI providers during verification

### ‚ö° Performance & Reliability
- **Fast execution**: <100ms on average for 200+ governance documents
- **Deterministic output**: Identical results for identical repo state
- **Parallel processing**: Efficient batch processing with configurable concurrency
- **Graceful degradation**: Continues to work when AI services unavailable

### ü§ñ AI-Assisted Analysis (Optional)
- **Qwen integration**: Powered by OpenAI-compatible DashScope endpoints
- **Patch generation**: Creates RFC-compliant unified diffs for common fixes
- **Orphan detection**: Identifies evidence IDs in registry that aren't used by any document
- **Smart validation**: Advanced Evidence-ID format and mapping analysis

## Installation & Upgrade Guide

### For Existing Repositories

1. **Update your package.json** to use the latest version:
```bash
# If using npm
npm install intelgraph-platform@latest

# If using pnpm (recommended)
pnpm add intelgraph-platform@latest
```

2. **Verify the installation**:
```bash
npm run ci:evidence-id-consistency -- --sha=upgrade-test
```

3. **Check output artifacts** at `artifacts/governance/evidence-id-consistency/<sha>/`

### For New Repositories

1. **Add the gate to your CI** by including this script execution in your CI workflow:
```yaml
name: Governance / Evidence ID Consistency
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  evidence-id-consistency:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: Install dependencies
      run: npm ci
      
    - name: Run Evidence ID Consistency Check
      run: npm run ci:evidence-id-consistency -- --sha=${{ github.sha }}
      
    - name: Upload Evidence Artifacts
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: evidence-id-consistency-${{ github.sha }}
        path: artifacts/governance/evidence-id-consistency/${{ github.sha }}/
```

## Configuration

### Default Behavior (Non-Blocking)
By default, the gate runs without AI features and reports issues without failing your CI:
- **Status**: Informational warnings only
- **Failures**: Only on parsing errors or severe issues
- **AI**: Disabled by default
- **Patches**: Not generated by default

### Opt-In Advanced Features

To enable AI-assisted analysis:
```bash
ENABLE_QWEN_ANALYSIS=true npm run ci:evidence-id-consistency
```

To enable AI patch generation:
```bash
ENABLE_QWEN_PATCHES=true npm run ci:evidence-id-consistency
```

To make high-severity patches fail the build:
```bash
QWEN_PATCHES_FAIL_ON_HIGH=true npm run ci:evidence-id-consistency
```

## Operational Guidance

### Expected Runtime Behavior
- **Normal execution**: ~55ms for typical repositories
- **With AI analysis**: ~200-500ms depending on document count
- **Cache behavior**: Subsequent runs in CI use cached responses, ~10ms execution time
- **File discovery**: Uses Git index when available for deterministic ordering

### Troubleshooting Common Issues

1. **"Missing Evidence Mapping" Errors**: Add missing evidence IDs to `evidence/map.yml`
2. **"Invalid Format" Warnings**: Ensure Evidence-IDs follow the correct pattern
3. **Performance Issues**: Limit to governance documents (avoid large binary files)
4. **CI Failures**: Check for file size limits (10MB max) or format issues

### Emergency Procedures
- **Disable AI analysis instantly**: Set `ENABLE_QWEN_ANALYSIS=false`
- **Disable patch generation instantly**: Set `ENABLE_QWEN_PATCHES=false`  
- **Rollback to previous behavior**: Remove the gate from CI configuration

## Integration Points

### Evidence Registry
- **Location**: `evidence/map.yml` (default) or canonical `docs/ga/evidence_map.yml`
- **Format**: YAML mapping evidence IDs to their artifact locations
- **Example**:
```yaml
governance-docs-integrity:
  path: "artifacts/governance/docs-integrity/${sha}/stamp.json"
  description: "Documentation integrity verification results"
  generator: "governance_docs_verifier"
```

### Governance Documents
- **Location**: `docs/governance/**/*.md` files
- **Header format**: `**Evidence-IDs:** id1,id2,id3` (comma-separated list)
- **Special case**: Use `**Evidence-IDs:** none` for documents that shouldn't have evidence

## Artifact Output Structure

```
artifacts/governance/evidence-id-consistency/<sha>/
‚îú‚îÄ‚îÄ report.json          # Deterministic content validation results (no timestamps)
‚îú‚îÄ‚îÄ report.md            # Human-readable summary
‚îú‚îÄ‚îÄ stamp.json           # Runtime metadata (timestamp, exit status, generator)
‚îî‚îÄ‚îÄ ai_patches/          # (AI patches enabled only)
    ‚îú‚îÄ‚îÄ index.json       # Patch metadata and status
    ‚îú‚îÄ‚îÄ validation.json  # Applicability assessment
    ‚îú‚îÄ‚îÄ <patch-id>.patch # Individual unified diffs
    ‚îî‚îÄ‚îÄ bundle.patch     # Aggregate patch bundle
```

## Migration Path

### From Previous Governance Checks
- **Backward compatible**: Existing governance workflows continue unaffected
- **New artifacts**: Only additional artifact output in new directory structure
- **Transition period**: Both old and new systems can run in parallel

## Support & Escalation

- **Questions**: #governance-tooling Slack channel
- **Issues**: Tag `@governance-team` in this thread
- **Emergency**: For urgent issues preventing CI, contact primary maintainer
- **Training**: Contact governance team for integration workshops

## Known Limitations

- Maximum 50 Evidence-IDs per document
- Maximum 10MB file size for processing
- Requires Node.js 18+ for ESM module compatibility
- AI features require internet connectivity when not in replay mode (cache miss)

## Roadmap

- **v1.4.0**: Advanced policy validation with custom rule configuration
- **v1.5.0**: Evidence lifecycle tracking (creation, update, deprecation)
- **v1.6.0**: Multi-tenant evidence registry support

---

**Questions?** Join #governance-tooling for discussion!  
**Feedback?** Tag @governance-team with suggestions for improvement!

The gate is ready for deployment across all Summit repositories. Start with canary deployments to non-critical repos first.