#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd)"
INSTALLER="${PROJECT_ROOT}/install.sh"
PREFLIGHT="${PROJECT_ROOT}/scripts/preflight.sh"

print_help() {
  cat <<'USAGE'
Summit Flywheel Setup (sfs) CLI

Usage: sfs <command> [options]

Commands:
  install       Run the installer scaffolding
  preflight     Run preflight scaffolding
  doctor        Reserved for future health checks
  onboard       Reserved for onboarding flow
  print-plan    Reserved for execution plan preview
  help          Show this message
  version       Show CLI version

This is the scaffolding version (PR1). Functional subcommands will be delivered
in subsequent PRs.
USAGE
}

print_version() {
  echo "sfs-cli 0.1.0-pr1"
}

command="install"
if [[ $# -gt 0 ]]; then
  command="$1"
  shift
fi

case "$command" in
  install)
    exec "${INSTALLER}" install "$@"
    ;;
  preflight)
    exec "${PREFLIGHT}" "$@"
    ;;
  doctor|onboard|print-plan)
    echo "[SFS] '$command' stubbed in scaffolding. Full behavior coming soon." >&2
    exit 0
    ;;
  help|-h|--help)
    print_help
    ;;
  version|-v|--version)
    print_version
    ;;
  *)
    echo "[SFS] Unknown command '$command'." >&2
    print_help
    exit 1
    ;;
esac
