
> intelgraph-server@4.0.1 test /Users/brianlong/Developer/summit/server
> jest --config jest.config.ts "tests/services/VectorStoreService.test.ts" "src/ai/copilot/__tests__/guardrails.service.test.ts" "src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts"

üöÄ Starting Jest Global Setup...
‚úÖ Jest Global Setup completed successfully
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.test -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (../node_modules/.pnpm/dotenv@17.2.3/node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.test -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (../node_modules/.pnpm/dotenv@17.2.3/node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.test -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (../node_modules/.pnpm/dotenv@17.2.3/node_modules/dotenv/lib/main.js:142:11)

{"level":30,"time":1767421368739,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","config":{"requireCitations":true,"minCitationsRequired":1,"minConfidenceThreshold":0.1,"logRiskyPrompts":true,"riskScoreThreshold":0.1,"blockHighRiskPrompts":true,"maxAnswerLength":10000,"deniedKeywords":["delete all","drop database","export credentials","bypass","ignore restrictions"]},"msg":"Guardrail config updated"}
{"level":30,"time":1767421369329,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"redaction-service","answerId":"test-answer-123","redactedCount":1,"uncertaintyLevel":"high","decisions":[{"decisionId":"fdccf05c-71ec-4727-a7b7-57c74c60f194","field":"citation_[1]","redacted":true,"reason":"Policy labels require redaction","policyLabels":["PII"],"timestamp":"2026-01-03T06:22:49.328Z"},{"decisionId":"1817ea5a-dce3-4e7c-8c89-515d417a9f19","field":"answer_text","redacted":true,"reason":"Policy labels require redaction","policyLabels":["PII"],"timestamp":"2026-01-03T06:22:49.328Z"},{"decisionId":"9eaa9cf5-6819-4699-b9a0-706ec7cb58f5","field":"provenance","redacted":true,"reason":"Removed references to redacted content","policyLabels":[],"timestamp":"2026-01-03T06:22:49.328Z"}],"msg":"Redaction applied to answer"}
PASS src/ai/copilot/__tests__/guardrails.service.test.ts (159.832 s)
  GuardrailsService
    Citation Requirements
      ‚úì should pass validation when answer has citations (50 ms)
      ‚úì should generate refusal for injection in original prompt (50 ms)
      ‚úì should fail validation when answer has no citations (9 ms)
      ‚úì should fail when citations below minimum threshold (346 ms)
      ‚úì should pass when citations disabled
    Prompt Injection Detection
      ‚úì should block prompts with instruction override attempts (18 ms)
      ‚úì should block prompts asking for system prompt (2 ms)
      ‚úì should block role manipulation attempts (2 ms)
      ‚úì should block jailbreak attempts (2 ms)
      ‚úì should allow legitimate queries (2 ms)
      ‚úì should allow complex but legitimate queries (1 ms)
    Denied Keywords
      ‚úì should block prompts with denied keywords (13 ms)
      ‚úì should block "export credentials" requests (1 ms)
      ‚úì should block bypass attempts
    Risky Prompt Logging
      ‚úì should log high-risk prompts for review (8 ms)
      ‚úì should track blocked prompts (4 ms)
      ‚úì should categorize risk levels (14 ms)
      ‚úì should return prompts requiring review (23 ms)
      ‚úì should allow marking prompts as reviewed (4 ms)
    Answer Content Validation
      ‚úì should fail validation for empty answers (3 ms)
      ‚úì should fail validation for very short answers (1 ms)
      ‚úì should pass validation for substantive answers (1 ms)
    Refusal Generation
      ‚úì should generate refusal for citation failures (7 ms)
      ‚úì should generate refusal for injection in original prompt (1 ms)
      ‚úì should include helpful suggestions in refusals (6 ms)
      ‚úì should create policy refusal with audit ID (1 ms)
    Configuration
      ‚úì should allow updating configuration (4 ms)
      ‚úì should return current configuration (5 ms)
  RedactionService
    Policy Label Redaction
      ‚úì should redact citations with denied policy labels (13 ms)
      ‚úì should not redact citations with allowed policy labels (2 ms)
      ‚úì should redact citations above user clearance level (3 ms)
    PII Pattern Detection
      ‚úì should redact SSN patterns in answer text (2 ms)
      ‚úì should redact email addresses (26 ms)
      ‚úì should redact phone numbers (1 ms)
      ‚úì should redact classification markers (2 ms)
    Uncertainty Indication
      ‚úì should indicate low uncertainty for minimal redaction (49 ms)
      ‚úì should indicate high uncertainty for extensive redaction (2 ms)
      ‚úì should update answer warnings for redaction uncertainty (3 ms)
    Provenance Adjustment
      ‚úì should remove redacted entity IDs from provenance (2 ms)
      ‚úì should adjust chain confidence for redacted provenance (5 ms)
    Policy Updates
      ‚úì should allow updating redaction policy (5 ms)
      ‚úì should return current policy (7 ms)

{"level":40,"time":1767421368779,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"9905cc70-7f07-4992-ab7c-accab2dc348b","riskLevel":"critical","riskFactors":["no_injection_detected"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":30,"time":1767421368787,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","config":{"requireCitations":true,"minCitationsRequired":1,"minConfidenceThreshold":0.1,"logRiskyPrompts":true,"riskScoreThreshold":0.1,"blockHighRiskPrompts":false,"maxAnswerLength":10000,"deniedKeywords":["delete all","drop database","export credentials","bypass","ignore restrictions"]},"msg":"Guardrail config updated"}
{"level":40,"time":1767421368792,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"c3d9c78f-5865-421a-8466-be2b7505eb9a","riskLevel":"high","riskFactors":["has_citations"],"blocked":false,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369145,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"72701439-e5fd-44f2-be7e-e0863e49dcf4","riskLevel":"critical","riskFactors":["show\\s+(me\\s+)?(the\\s+)?(system\\s+)?(prompt|instructions|rules)","guard-service-detection"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369163,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"ecc928cf-27bf-4edc-948e-b3a19aa228f0","riskLevel":"critical","riskFactors":["what\\s+(is|are)\\s+(your\\s+)?(system\\s+)?(prompt|instructions|rules)","guard-service-detection"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369164,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"60de6803-f85d-4aa6-a13e-b8777e4d6c94","riskLevel":"critical","riskFactors":["you\\s+are\\s+now\\s+(a|an)\\s+\\w+","pretend\\s+(to\\s+be|you\\s+are)","(DAN|STAN)(\\s+mode)?"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369167,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"bc8ea2cd-5cb2-4e29-9cc1-cbcc529959a2","riskLevel":"critical","riskFactors":["developer\\s+mode"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369172,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"6d4c73b0-16ec-4d79-8fa9-b550286ac4dc","riskLevel":"high","riskFactors":["denied_keyword:delete all"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369184,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"9201d7aa-719b-4149-a7ef-b9d05266ae2c","riskLevel":"high","riskFactors":["denied_keyword:export credentials"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369185,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"1c77ee44-2653-4d87-8a20-638c9e2ab352","riskLevel":"high","riskFactors":["denied_keyword:bypass"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369186,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"9b8c0390-9f17-4b75-af20-7d69841c3e45","riskLevel":"critical","riskFactors":["ignore\\s+(previous|prior|above|all)\\s+(instructions|prompts|rules|context)","guard-service-detection"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369196,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"d4a4e777-8464-401b-b2a3-1d8c21fc80e1","riskLevel":"high","riskFactors":["denied_keyword:delete all"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369210,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"2ff3c6f3-2b7d-43c3-b1f6-81fbb8baf738","riskLevel":"high","riskFactors":["denied_keyword:delete all"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369284,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"26be0447-0f93-4e79-ac99-eedd4441f36a","riskLevel":"critical","riskFactors":["ignore\\s+(previous|prior|above|all)\\s+(instructions|prompts|rules|context)","guard-service-detection"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369285,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"2a8370c0-495f-4046-a63f-abd3dd13727a","riskLevel":"high","riskFactors":["denied_keyword:bypass"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369293,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"c4e2bcce-f57e-4064-9a96-0748f853d71a","riskLevel":"high","riskFactors":["answer_not_empty"],"blocked":false,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369294,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"369a1dfb-962f-4b6a-a504-a3d5c6a232ae","riskLevel":"high","riskFactors":["answer_not_empty"],"blocked":false,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369296,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"d987e160-1874-4bf5-a55f-854e6ba0f212","riskLevel":"high","riskFactors":["has_citations"],"blocked":false,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369304,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"9e72bc93-219b-4d9b-b033-82a9890b3bc9","riskLevel":"critical","riskFactors":["no_injection_detected"],"blocked":true,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369305,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","logId":"f23c61c5-575c-441e-b05e-61675e9e9ca5","riskLevel":"high","riskFactors":["has_citations"],"blocked":false,"requiresReview":true,"msg":"Risky prompt logged for review"}
{"level":40,"time":1767421369312,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","reason":"User lacks authorization","context":{"userId":"user-123"},"msg":"Policy refusal created"}
{"level":30,"time":1767421369314,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"guardrails-service","config":{"requireCitations":true,"minCitationsRequired":5,"minConfidenceThreshold":0.1,"logRiskyPrompts":true,"riskScoreThreshold":0.5,"blockHighRiskPrompts":false,"maxAnswerLength":10000,"deniedKeywords":["delete all","drop database","export credentials","bypass","ignore restrictions"]},"msg":"Guardrail config updated"}
{"level":30,"time":1767421369339,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"redaction-service","answerId":"test-answer-123","redactedCount":1,"uncertaintyLevel":"high","decisions":[{"decisionId":"dd3fa61c-f618-489b-9389-1604f909e3c7","field":"citation_[1]","redacted":true,"reason":"Policy labels require redaction","policyLabels":["TOP_SECRET"],"timestamp":"2026-01-03T06:22:49.339Z"},{"decisionId":"14cf943a-f021-4f62-b27c-08856eddb1c3","field":"answer_text","redacted":true,"reason":"Policy labels require redaction","policyLabels":["TOP_SECRET"],"timestamp":"2026-01-03T06:22:49.339Z"},{"decisionId":"bcf76970-a7be-4a6d-ad59-a7af87cf50c6","field":"provenance","redacted":true,"reason":"Removed references to redacted content","policyLabels":[],"timestamp":"2026-01-03T06:22:49.339Z"}],"msg":"Redaction applied to answer"}
{"level":30,"time":1767421369342,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"redaction-service","answerId":"test-answer-123","redactedCount":1,"uncertaintyLevel":"high","decisions":[{"decisionId":"a49a43ea-ab20-4b75-b428-4aaa8a2c4f9d","field":"answer_text_SSN","redacted":true,"reason":"Pattern SSN detected and redacted","policyLabels":[],"timestamp":"2026-01-03T06:22:49.342Z"}],"msg":"Redaction applied to answer"}
{"level":30,"time":1767421369347,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"redaction-service","answerId":"test-answer-123","redactedCount":1,"uncertaintyLevel":"high","decisions":[{"decisionId":"7267a683-6268-495b-bf76-e40cc92c9440","field":"answer_text_EMAIL","redacted":true,"reason":"Pattern EMAIL detected and redacted","policyLabels":[],"timestamp":"2026-01-03T06:22:49.347Z"}],"msg":"Redaction applied to answer"}
{"level":30,"time":1767421369370,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"redaction-service","answerId":"test-answer-123","redactedCount":1,"uncertaintyLevel":"high","decisions":[{"decisionId":"91b1b75d-4090-489e-bb8b-4f74494ec859","field":"answer_text_PHONE","redacted":true,"reason":"Pattern PHONE detected and redacted","policyLabels":[],"timestamp":"2026-01-03T06:22:49.370Z"}],"msg":"Redaction applied to answer"}
{"level":30,"time":1767421369371,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"redaction-service","answerId":"test-answer-123","redactedCount":1,"uncertaintyLevel":"high","decisions":[{"decisionId":"82ecfe09-c8d4-4b86-bdd2-bbb9cbcb1aa7","field":"answer_text_CLASSIFICATION_MARKER","redacted":true,"reason":"Pattern CLASSIFICATION_MARKER detected and redacted","policyLabels":[],"timestamp":"2026-01-03T06:22:49.371Z"}],"msg":"Redaction applied to answer"}
{"level":30,"time":1767421369375,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"redaction-service","answerId":"test-answer-123","redactedCount":1,"uncertaintyLevel":"medium","decisions":[{"decisionId":"c339f270-3ca5-409c-8488-3c3b7579f2a7","field":"citation_[3]","redacted":true,"reason":"Policy labels require redaction","policyLabels":["PII"],"timestamp":"2026-01-03T06:22:49.372Z"},{"decisionId":"493a964b-18f9-48d5-bca7-2b4090116fd0","field":"answer_text","redacted":true,"reason":"Policy labels require redaction","policyLabels":["PII"],"timestamp":"2026-01-03T06:22:49.374Z"}],"msg":"Redaction applied to answer"}
{"level":30,"time":1767421369422,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"redaction-service","answerId":"test-answer-123","redactedCount":2,"uncertaintyLevel":"high","decisions":[{"decisionId":"669c9041-1a43-4b8d-8ad5-f5f53f040e6d","field":"citation_[1]","redacted":true,"reason":"Policy labels require redaction","policyLabels":["CLASSIFIED"],"timestamp":"2026-01-03T06:22:49.422Z"},{"decisionId":"fa22ae0f-ddff-41fd-9358-452e92726c67","field":"citation_[2]","redacted":true,"reason":"Policy labels require redaction","policyLabels":["RESTRICTED"],"timestamp":"2026-01-03T06:22:49.422Z"},{"decisionId":"72f9b271-73c8-4166-96c3-948ca137d17b","field":"answer_text","redacted":true,"reason":"Policy labels require redaction","policyLabels":["CLASSIFIED","RESTRICTED"],"timestamp":"2026-01-03T06:22:49.422Z"}],"msg":"Redaction applied to answer"}
{"level":30,"time":1767421369423,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"redaction-service","answerId":"test-answer-123","redactedCount":1,"uncertaintyLevel":"high","decisions":[{"decisionId":"37d34d12-5908-4a3d-a393-cd0a6c687086","field":"citation_[1]","redacted":true,"reason":"Policy labels require redaction","policyLabels":["PII"],"timestamp":"2026-01-03T06:22:49.423Z"},{"decisionId":"4990eac3-1e8e-4d72-a02d-8ce14385f214","field":"answer_text","redacted":true,"reason":"Policy labels require redaction","policyLabels":["PII"],"timestamp":"2026-01-03T06:22:49.423Z"}],"msg":"Redaction applied to answer"}
{"level":30,"time":1767421369427,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"redaction-service","answerId":"test-answer-123","redactedCount":1,"uncertaintyLevel":"high","decisions":[{"decisionId":"6ecb1e2f-160c-4c51-be1e-5b3c84c5c4a2","field":"citation_[1]","redacted":true,"reason":"Policy labels require redaction","policyLabels":["CLASSIFIED"],"timestamp":"2026-01-03T06:22:49.427Z"},{"decisionId":"ff5e572c-508f-472d-ac21-615d74c94b5c","field":"answer_text","redacted":true,"reason":"Policy labels require redaction","policyLabels":["CLASSIFIED"],"timestamp":"2026-01-03T06:22:49.427Z"},{"decisionId":"e6f58ea0-4646-4121-a720-bbec0b2764be","field":"provenance","redacted":true,"reason":"Removed references to redacted content","policyLabels":[],"timestamp":"2026-01-03T06:22:49.427Z"}],"msg":"Redaction applied to answer"}
{"level":30,"time":1767421369429,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"redaction-service","answerId":"test-answer-123","redactedCount":1,"uncertaintyLevel":"high","decisions":[{"decisionId":"f3496395-5745-4abe-90d9-849e3a457769","field":"citation_[1]","redacted":true,"reason":"Policy labels require redaction","policyLabels":["CLASSIFIED"],"timestamp":"2026-01-03T06:22:49.429Z"},{"decisionId":"c75fdc99-337a-4fc7-bf1c-a84e4480a60f","field":"answer_text","redacted":true,"reason":"Policy labels require redaction","policyLabels":["CLASSIFIED"],"timestamp":"2026-01-03T06:22:49.429Z"},{"decisionId":"83a2e263-5dbf-4d9a-ba63-5f35878dca9c","field":"provenance","redacted":true,"reason":"Removed references to redacted content","policyLabels":[],"timestamp":"2026-01-03T06:22:49.429Z"}],"msg":"Redaction applied to answer"}
{"level":30,"time":1767421369434,"pid":62569,"hostname":"Brians-MacBook-Pro.local","name":"redaction-service","policy":{"userClearance":"SECRET","allowedPolicyLabels":["PUBLIC","UNCLASSIFIED"],"deniedPolicyLabels":["PII","CLASSIFIED","RESTRICTED"],"showPartialContent":false,"redactionPlaceholder":"[REDACTED]","auditRedactions":true},"msg":"Redaction policy updated"}
FAIL tests/services/VectorStoreService.test.ts (196.017 s)
  VectorStoreService
    ‚úï should ingest a document correctly (16 ms)
    ‚úï should search for documents (6 ms)

  ‚óè VectorStoreService ‚Ä∫ should ingest a document correctly

    TypeError: Cannot read properties of undefined (reading 'write')

      84 |     };
      85 |
    > 86 |     mockPool.write.mockResolvedValueOnce({ rowCount: 1 }); // Insert doc
         |              ^
      87 |
      88 |     const result = await service.ingestDocument(tenantId, docData);
      89 |

      at Object.<anonymous> (tests/services/VectorStoreService.test.ts:86:14)

  ‚óè VectorStoreService ‚Ä∫ should search for documents

    TypeError: Cannot read properties of undefined (reading 'read')

      103 |
      104 |     // Mock search result
    > 105 |     mockPool.read.mockResolvedValueOnce({
          |              ^
      106 |       rows: [
      107 |         {
      108 |           id: 'chunk-1',

      at Object.<anonymous> (tests/services/VectorStoreService.test.ts:105:14)

{"level":"error","time":"2026-01-03T06:23:27.011Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
(node:62570) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 hypotheses_generated listeners added to [EventEmitter]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
(node:62570) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 queries_generated listeners added to [EventEmitter]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:62570) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 results_analyzed listeners added to [EventEmitter]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:62570) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 findings_enriched listeners added to [EventEmitter]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:62570) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 remediation_completed listeners added to [EventEmitter]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:62570) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 ioc_confirmed listeners added to [EventEmitter]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
FAIL src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts (197.048 s)
  ThreatHuntingOrchestrator
    initialization
      ‚úï should initialize successfully (19 ms)
      ‚úï should be idempotent for multiple initializations (3 ms)
    startHunt
      ‚úï should start a hunt with default configuration (1 ms)
      ‚úï should start a hunt with custom scope (2 ms)
      ‚úï should start a hunt with auto-remediation enabled (4 ms)
      ‚úï should accept custom hypotheses
    getHuntStatus
      ‚úï should return status for an active hunt
      ‚úì should throw error for non-existent hunt (4 ms)
    cancelHunt
      ‚úï should cancel a running hunt (5 ms)
      ‚úì should throw error for non-existent hunt (4 ms)
    getActiveHunts
      ‚úï should return list of active hunts
      ‚úï should not include cancelled hunts (1 ms)
    getExecutionStats
      ‚úì should return execution statistics (1 ms)
    event emission
      ‚úï should emit hunt_started event (1 ms)
      ‚úï should emit phase_started events during execution (1 ms)
  CypherTemplateEngine
    validateQuery
      ‚úï should validate safe read-only queries
      ‚úï should reject queries with DELETE
      ‚úï should reject queries with SET
      ‚úï should reject queries with CREATE (1 ms)
      ‚úï should warn about queries without LIMIT (1 ms)
    ensureLimit
      ‚úï should add LIMIT to query without one
      ‚úï should not modify query with existing LIMIT
    estimateComplexity
      ‚úï should estimate higher complexity for multiple MATCH clauses
      ‚úï should estimate higher complexity for variable length paths (1 ms)
  LLMChainExecutor
    generateHypotheses
      ‚úï should generate hypotheses from context (1 ms)
    getExecutionStats
      ‚úï should track execution statistics
  AutoRemediationHooks
    enrichFindings
      ‚úï should enrich findings with CTI and OSINT data
    createRemediationPlan
      ‚úï should create a remediation plan from findings (1 ms)
      ‚úï should create approved plan when approval not required (4 ms)
    approvePlan
      ‚úï should approve a pending plan
      ‚úï should throw error for non-existent plan
    getPendingApprovals
      ‚úï should return list of pending approvals (1 ms)
  Integration Tests
    Full Hunt Workflow
      ‚úï should complete a full hunt workflow (1 ms)
    Precision Targeting
      ‚úï should achieve target precision of 91%

  ‚óè ThreatHuntingOrchestrator ‚Ä∫ initialization ‚Ä∫ should initialize successfully

    expect(received).resolves.not.toThrow()

    Received promise rejected instead of resolved
    Rejected to value: [TypeError: Cannot read properties of undefined (reading 'length')]

      387 |   describe('initialization', () => {
      388 |     it('should initialize successfully', async () => {
    > 389 |       await expect(orchestrator.initialize()).resolves.not.toThrow();
          |                   ^
      390 |     });
      391 |
      392 |     it('should be idempotent for multiple initializations', async () => {

      at expect (../node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:389:19)

  ‚óè ThreatHuntingOrchestrator ‚Ä∫ initialization ‚Ä∫ should be idempotent for multiple initializations

    TypeError: Cannot read properties of undefined (reading 'length')

      100 |       this.isInitialized = true;
      101 |       logger.info('Threat Hunting Orchestrator initialized', {
    > 102 |         templatesLoaded: this.templateEngine.getAllTemplates().length,
          |                                                               ^
      103 |       });
      104 |     } catch (error: any) {
      105 |       logger.error('Failed to initialize orchestrator', {

      at ThreatHuntingOrchestrator.initialize (src/hunting/ThreatHuntingOrchestrator.ts:102:63)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:393:7)

  ‚óè ThreatHuntingOrchestrator ‚Ä∫ startHunt ‚Ä∫ should start a hunt with default configuration

    TypeError: Cannot read properties of undefined (reading 'length')

      100 |       this.isInitialized = true;
      101 |       logger.info('Threat Hunting Orchestrator initialized', {
    > 102 |         templatesLoaded: this.templateEngine.getAllTemplates().length,
          |                                                               ^
      103 |       });
      104 |     } catch (error: any) {
      105 |       logger.error('Failed to initialize orchestrator', {

      at ThreatHuntingOrchestrator.initialize (src/hunting/ThreatHuntingOrchestrator.ts:102:63)
      at ThreatHuntingOrchestrator.ensureInitialized (src/hunting/ThreatHuntingOrchestrator.ts:943:7)
      at ThreatHuntingOrchestrator.startHunt (src/hunting/ThreatHuntingOrchestrator.ts:116:5)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:400:24)

  ‚óè ThreatHuntingOrchestrator ‚Ä∫ startHunt ‚Ä∫ should start a hunt with custom scope

    TypeError: Cannot read properties of undefined (reading 'length')

      100 |       this.isInitialized = true;
      101 |       logger.info('Threat Hunting Orchestrator initialized', {
    > 102 |         templatesLoaded: this.templateEngine.getAllTemplates().length,
          |                                                               ^
      103 |       });
      104 |     } catch (error: any) {
      105 |       logger.error('Failed to initialize orchestrator', {

      at ThreatHuntingOrchestrator.initialize (src/hunting/ThreatHuntingOrchestrator.ts:102:63)
      at ThreatHuntingOrchestrator.ensureInitialized (src/hunting/ThreatHuntingOrchestrator.ts:943:7)
      at ThreatHuntingOrchestrator.startHunt (src/hunting/ThreatHuntingOrchestrator.ts:116:5)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:410:24)

  ‚óè ThreatHuntingOrchestrator ‚Ä∫ startHunt ‚Ä∫ should start a hunt with auto-remediation enabled

    TypeError: Cannot read properties of undefined (reading 'length')

      100 |       this.isInitialized = true;
      101 |       logger.info('Threat Hunting Orchestrator initialized', {
    > 102 |         templatesLoaded: this.templateEngine.getAllTemplates().length,
          |                                                               ^
      103 |       });
      104 |     } catch (error: any) {
      105 |       logger.error('Failed to initialize orchestrator', {

      at ThreatHuntingOrchestrator.initialize (src/hunting/ThreatHuntingOrchestrator.ts:102:63)
      at ThreatHuntingOrchestrator.ensureInitialized (src/hunting/ThreatHuntingOrchestrator.ts:943:7)
      at ThreatHuntingOrchestrator.startHunt (src/hunting/ThreatHuntingOrchestrator.ts:116:5)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:419:24)

  ‚óè ThreatHuntingOrchestrator ‚Ä∫ startHunt ‚Ä∫ should accept custom hypotheses

    TypeError: Cannot read properties of undefined (reading 'length')

      100 |       this.isInitialized = true;
      101 |       logger.info('Threat Hunting Orchestrator initialized', {
    > 102 |         templatesLoaded: this.templateEngine.getAllTemplates().length,
          |                                                               ^
      103 |       });
      104 |     } catch (error: any) {
      105 |       logger.error('Failed to initialize orchestrator', {

      at ThreatHuntingOrchestrator.initialize (src/hunting/ThreatHuntingOrchestrator.ts:102:63)
      at ThreatHuntingOrchestrator.ensureInitialized (src/hunting/ThreatHuntingOrchestrator.ts:943:7)
      at ThreatHuntingOrchestrator.startHunt (src/hunting/ThreatHuntingOrchestrator.ts:116:5)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:446:24)

  ‚óè ThreatHuntingOrchestrator ‚Ä∫ getHuntStatus ‚Ä∫ should return status for an active hunt

    TypeError: Cannot read properties of undefined (reading 'length')

      100 |       this.isInitialized = true;
      101 |       logger.info('Threat Hunting Orchestrator initialized', {
    > 102 |         templatesLoaded: this.templateEngine.getAllTemplates().length,
          |                                                               ^
      103 |       });
      104 |     } catch (error: any) {
      105 |       logger.error('Failed to initialize orchestrator', {

      at ThreatHuntingOrchestrator.initialize (src/hunting/ThreatHuntingOrchestrator.ts:102:63)
      at ThreatHuntingOrchestrator.ensureInitialized (src/hunting/ThreatHuntingOrchestrator.ts:943:7)
      at ThreatHuntingOrchestrator.startHunt (src/hunting/ThreatHuntingOrchestrator.ts:116:5)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:456:29)

  ‚óè ThreatHuntingOrchestrator ‚Ä∫ cancelHunt ‚Ä∫ should cancel a running hunt

    TypeError: Cannot read properties of undefined (reading 'length')

      100 |       this.isInitialized = true;
      101 |       logger.info('Threat Hunting Orchestrator initialized', {
    > 102 |         templatesLoaded: this.templateEngine.getAllTemplates().length,
          |                                                               ^
      103 |       });
      104 |     } catch (error: any) {
      105 |       logger.error('Failed to initialize orchestrator', {

      at ThreatHuntingOrchestrator.initialize (src/hunting/ThreatHuntingOrchestrator.ts:102:63)
      at ThreatHuntingOrchestrator.ensureInitialized (src/hunting/ThreatHuntingOrchestrator.ts:943:7)
      at ThreatHuntingOrchestrator.startHunt (src/hunting/ThreatHuntingOrchestrator.ts:116:5)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:475:29)

  ‚óè ThreatHuntingOrchestrator ‚Ä∫ getActiveHunts ‚Ä∫ should return list of active hunts

    TypeError: Cannot read properties of undefined (reading 'length')

      100 |       this.isInitialized = true;
      101 |       logger.info('Threat Hunting Orchestrator initialized', {
    > 102 |         templatesLoaded: this.templateEngine.getAllTemplates().length,
          |                                                               ^
      103 |       });
      104 |     } catch (error: any) {
      105 |       logger.error('Failed to initialize orchestrator', {

      at ThreatHuntingOrchestrator.initialize (src/hunting/ThreatHuntingOrchestrator.ts:102:63)
      at ThreatHuntingOrchestrator.ensureInitialized (src/hunting/ThreatHuntingOrchestrator.ts:943:7)
      at ThreatHuntingOrchestrator.startHunt (src/hunting/ThreatHuntingOrchestrator.ts:116:5)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:490:7)

  ‚óè ThreatHuntingOrchestrator ‚Ä∫ getActiveHunts ‚Ä∫ should not include cancelled hunts

    TypeError: Cannot read properties of undefined (reading 'length')

      100 |       this.isInitialized = true;
      101 |       logger.info('Threat Hunting Orchestrator initialized', {
    > 102 |         templatesLoaded: this.templateEngine.getAllTemplates().length,
          |                                                               ^
      103 |       });
      104 |     } catch (error: any) {
      105 |       logger.error('Failed to initialize orchestrator', {

      at ThreatHuntingOrchestrator.initialize (src/hunting/ThreatHuntingOrchestrator.ts:102:63)
      at ThreatHuntingOrchestrator.ensureInitialized (src/hunting/ThreatHuntingOrchestrator.ts:943:7)
      at ThreatHuntingOrchestrator.startHunt (src/hunting/ThreatHuntingOrchestrator.ts:116:5)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:500:24)

  ‚óè ThreatHuntingOrchestrator ‚Ä∫ event emission ‚Ä∫ should emit hunt_started event

    TypeError: Cannot read properties of undefined (reading 'length')

      100 |       this.isInitialized = true;
      101 |       logger.info('Threat Hunting Orchestrator initialized', {
    > 102 |         templatesLoaded: this.templateEngine.getAllTemplates().length,
          |                                                               ^
      103 |       });
      104 |     } catch (error: any) {
      105 |       logger.error('Failed to initialize orchestrator', {

      at ThreatHuntingOrchestrator.initialize (src/hunting/ThreatHuntingOrchestrator.ts:102:63)
      at ThreatHuntingOrchestrator.ensureInitialized (src/hunting/ThreatHuntingOrchestrator.ts:943:7)
      at ThreatHuntingOrchestrator.startHunt (src/hunting/ThreatHuntingOrchestrator.ts:116:5)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:528:7)

  ‚óè ThreatHuntingOrchestrator ‚Ä∫ event emission ‚Ä∫ should emit phase_started events during execution

    TypeError: Cannot read properties of undefined (reading 'length')

      100 |       this.isInitialized = true;
      101 |       logger.info('Threat Hunting Orchestrator initialized', {
    > 102 |         templatesLoaded: this.templateEngine.getAllTemplates().length,
          |                                                               ^
      103 |       });
      104 |     } catch (error: any) {
      105 |       logger.error('Failed to initialize orchestrator', {

      at ThreatHuntingOrchestrator.initialize (src/hunting/ThreatHuntingOrchestrator.ts:102:63)
      at ThreatHuntingOrchestrator.ensureInitialized (src/hunting/ThreatHuntingOrchestrator.ts:943:7)
      at ThreatHuntingOrchestrator.startHunt (src/hunting/ThreatHuntingOrchestrator.ts:116:5)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:542:7)

  ‚óè CypherTemplateEngine ‚Ä∫ validateQuery ‚Ä∫ should validate safe read-only queries

    TypeError: engine.validateQuery is not a function

      561 |     it('should validate safe read-only queries', () => {
      562 |       const query = 'MATCH (n:Entity) RETURN n LIMIT 100';
    > 563 |       const result = engine.validateQuery(query);
          |                             ^
      564 |
      565 |       expect(result.isValid).toBe(true);
      566 |       expect(result.isReadOnly).toBe(true);

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:563:29)

  ‚óè CypherTemplateEngine ‚Ä∫ validateQuery ‚Ä∫ should reject queries with DELETE

    TypeError: engine.validateQuery is not a function

      570 |     it('should reject queries with DELETE', () => {
      571 |       const query = 'MATCH (n:Entity) DELETE n';
    > 572 |       const result = engine.validateQuery(query);
          |                             ^
      573 |
      574 |       expect(result.isValid).toBe(false);
      575 |       expect(result.isReadOnly).toBe(false);

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:572:29)

  ‚óè CypherTemplateEngine ‚Ä∫ validateQuery ‚Ä∫ should reject queries with SET

    TypeError: engine.validateQuery is not a function

      578 |     it('should reject queries with SET', () => {
      579 |       const query = 'MATCH (n:Entity) SET n.name = "malicious"';
    > 580 |       const result = engine.validateQuery(query);
          |                             ^
      581 |
      582 |       expect(result.isReadOnly).toBe(false);
      583 |     });

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:580:29)

  ‚óè CypherTemplateEngine ‚Ä∫ validateQuery ‚Ä∫ should reject queries with CREATE

    TypeError: engine.validateQuery is not a function

      585 |     it('should reject queries with CREATE', () => {
      586 |       const query = 'CREATE (n:Entity {name: "test"})';
    > 587 |       const result = engine.validateQuery(query);
          |                             ^
      588 |
      589 |       expect(result.isReadOnly).toBe(false);
      590 |     });

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:587:29)

  ‚óè CypherTemplateEngine ‚Ä∫ validateQuery ‚Ä∫ should warn about queries without LIMIT

    TypeError: engine.validateQuery is not a function

      592 |     it('should warn about queries without LIMIT', () => {
      593 |       const query = 'MATCH (n:Entity) RETURN n';
    > 594 |       const result = engine.validateQuery(query);
          |                             ^
      595 |
      596 |       expect(result.hasLimit).toBe(false);
      597 |     });

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:594:29)

  ‚óè CypherTemplateEngine ‚Ä∫ ensureLimit ‚Ä∫ should add LIMIT to query without one

    TypeError: engine.ensureLimit is not a function

      601 |     it('should add LIMIT to query without one', () => {
      602 |       const query = 'MATCH (n:Entity) RETURN n';
    > 603 |       const result = engine.ensureLimit(query, 100);
          |                             ^
      604 |
      605 |       expect(result).toContain('LIMIT 100');
      606 |     });

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:603:29)

  ‚óè CypherTemplateEngine ‚Ä∫ ensureLimit ‚Ä∫ should not modify query with existing LIMIT

    TypeError: engine.ensureLimit is not a function

      608 |     it('should not modify query with existing LIMIT', () => {
      609 |       const query = 'MATCH (n:Entity) RETURN n LIMIT 50';
    > 610 |       const result = engine.ensureLimit(query, 100);
          |                             ^
      611 |
      612 |       expect(result).toContain('LIMIT 50');
      613 |       expect(result).not.toContain('LIMIT 100');

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:610:29)

  ‚óè CypherTemplateEngine ‚Ä∫ estimateComplexity ‚Ä∫ should estimate higher complexity for multiple MATCH clauses

    TypeError: engine.validateQuery is not a function

      620 |       const complexQuery = 'MATCH (a) MATCH (b) MATCH (c) RETURN a, b, c';
      621 |
    > 622 |       const simpleResult = engine.validateQuery(simpleQuery);
          |                                   ^
      623 |       const complexResult = engine.validateQuery(complexQuery);
      624 |
      625 |       expect(complexResult.complexity).toBeGreaterThan(simpleResult.complexity);

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:622:35)

  ‚óè CypherTemplateEngine ‚Ä∫ estimateComplexity ‚Ä∫ should estimate higher complexity for variable length paths

    TypeError: engine.validateQuery is not a function

      630 |       const complexQuery = 'MATCH (a)-[*1..5]->(b) RETURN a, b';
      631 |
    > 632 |       const simpleResult = engine.validateQuery(simpleQuery);
          |                                   ^
      633 |       const complexResult = engine.validateQuery(complexQuery);
      634 |
      635 |       expect(complexResult.complexity).toBeGreaterThan(simpleResult.complexity);

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:632:35)

  ‚óè LLMChainExecutor ‚Ä∫ generateHypotheses ‚Ä∫ should generate hypotheses from context

    TypeError: executor.initialize is not a function

      646 |
      647 |     // Initialize with mock provider
    > 648 |     executor.initialize({
          |              ^
      649 |       complete: jest.fn<() => Promise<unknown>>().mockResolvedValue({
      650 |         content: JSON.stringify({
      651 |           hypotheses: [

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:648:14)

  ‚óè LLMChainExecutor ‚Ä∫ getExecutionStats ‚Ä∫ should track execution statistics

    TypeError: executor.initialize is not a function

      646 |
      647 |     // Initialize with mock provider
    > 648 |     executor.initialize({
          |              ^
      649 |       complete: jest.fn<() => Promise<unknown>>().mockResolvedValue({
      650 |         content: JSON.stringify({
      651 |           hypotheses: [

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:648:14)

  ‚óè AutoRemediationHooks ‚Ä∫ enrichFindings ‚Ä∫ should enrich findings with CTI and OSINT data

    TypeError: hooks.enrichFindings is not a function

      783 |       ];
      784 |
    > 785 |       const enriched = await hooks.enrichFindings(findings);
          |                                    ^
      786 |
      787 |       expect(enriched).toBeDefined();
      788 |       expect(enriched.length).toBe(1);

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:785:36)

  ‚óè AutoRemediationHooks ‚Ä∫ createRemediationPlan ‚Ä∫ should create a remediation plan from findings

    TypeError: hooks.createRemediationPlan is not a function

      842 |       ];
      843 |
    > 844 |       const plan = await hooks.createRemediationPlan('hunt-1', findings, true);
          |                                ^
      845 |
      846 |       expect(plan).toBeDefined();
      847 |       expect(plan.id).toBeDefined();

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:844:32)

  ‚óè AutoRemediationHooks ‚Ä∫ createRemediationPlan ‚Ä∫ should create approved plan when approval not required

    TypeError: hooks.createRemediationPlan is not a function

      852 |     it('should create approved plan when approval not required', async () => {
      853 |       const findings: EnrichedFinding[] = [];
    > 854 |       const plan = await hooks.createRemediationPlan('hunt-1', findings, false);
          |                                ^
      855 |
      856 |       expect(plan.status).toBe('approved');
      857 |     });

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:854:32)

  ‚óè AutoRemediationHooks ‚Ä∫ approvePlan ‚Ä∫ should approve a pending plan

    TypeError: hooks.createRemediationPlan is not a function

      861 |     it('should approve a pending plan', async () => {
      862 |       const findings: EnrichedFinding[] = [];
    > 863 |       const plan = await hooks.createRemediationPlan('hunt-1', findings, true);
          |                                ^
      864 |
      865 |       await hooks.approvePlan(plan.id, 'test-user');
      866 |

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:863:32)

  ‚óè AutoRemediationHooks ‚Ä∫ approvePlan ‚Ä∫ should throw error for non-existent plan

    TypeError: hooks.approvePlan is not a function

      871 |
      872 |     it('should throw error for non-existent plan', async () => {
    > 873 |       await expect(hooks.approvePlan('non-existent', 'user')).rejects.toThrow();
          |                          ^
      874 |     });
      875 |   });
      876 |

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:873:26)

  ‚óè AutoRemediationHooks ‚Ä∫ getPendingApprovals ‚Ä∫ should return list of pending approvals

    TypeError: hooks.createRemediationPlan is not a function

      878 |     it('should return list of pending approvals', async () => {
      879 |       const findings: EnrichedFinding[] = [];
    > 880 |       const plan = await hooks.createRemediationPlan('hunt-pending-test', findings, true);
          |                                ^
      881 |
      882 |       const pending = hooks.getPendingApprovals();
      883 |

      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:880:32)

  ‚óè Integration Tests ‚Ä∫ Full Hunt Workflow ‚Ä∫ should complete a full hunt workflow

    TypeError: Cannot read properties of undefined (reading 'length')

      100 |       this.isInitialized = true;
      101 |       logger.info('Threat Hunting Orchestrator initialized', {
    > 102 |         templatesLoaded: this.templateEngine.getAllTemplates().length,
          |                                                               ^
      103 |       });
      104 |     } catch (error: any) {
      105 |       logger.error('Failed to initialize orchestrator', {

      at ThreatHuntingOrchestrator.initialize (src/hunting/ThreatHuntingOrchestrator.ts:102:63)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:897:7)

  ‚óè Integration Tests ‚Ä∫ Precision Targeting ‚Ä∫ should achieve target precision of 91%

    TypeError: Cannot read properties of undefined (reading 'length')

      100 |       this.isInitialized = true;
      101 |       logger.info('Threat Hunting Orchestrator initialized', {
    > 102 |         templatesLoaded: this.templateEngine.getAllTemplates().length,
          |                                                               ^
      103 |       });
      104 |     } catch (error: any) {
      105 |       logger.error('Failed to initialize orchestrator', {

      at ThreatHuntingOrchestrator.initialize (src/hunting/ThreatHuntingOrchestrator.ts:102:63)
      at Object.<anonymous> (src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts:943:7)

{"level":"error","time":"2026-01-03T06:23:27.089Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
{"level":"error","time":"2026-01-03T06:23:27.114Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
{"level":"error","time":"2026-01-03T06:23:27.119Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
{"level":"error","time":"2026-01-03T06:23:27.124Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
{"level":"error","time":"2026-01-03T06:23:27.125Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
{"level":"error","time":"2026-01-03T06:23:27.126Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
{"level":"error","time":"2026-01-03T06:23:27.135Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
{"level":"error","time":"2026-01-03T06:23:27.140Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
{"level":"error","time":"2026-01-03T06:23:27.142Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
{"level":"error","time":"2026-01-03T06:23:27.145Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
{"level":"error","time":"2026-01-03T06:23:27.146Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
{"level":"error","time":"2026-01-03T06:23:27.172Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
{"level":"error","time":"2026-01-03T06:23:27.172Z","service":"intelgraph-api","msg":"Failed to initialize orchestrator"}
A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Test Suites: 2 failed, 1 passed, 3 total
Tests:       33 failed, 45 passed, 78 total
Snapshots:   0 total
Time:        206.725 s
Ran all test suites matching /tests\/services\/VectorStoreService.test.ts|src\/ai\/copilot\/__tests__\/guardrails.service.test.ts|src\/hunting\/__tests__\/ThreatHuntingOrchestrator.test.ts/i.
üßπ Starting Jest Global Teardown...
üóëÔ∏è Cleaning up temporary directories...
üîå Closing global connections...
‚úÖ Jest Global Teardown completed successfully
‚ÄâELIFECYCLE‚Äâ Test failed. See above for more details.
