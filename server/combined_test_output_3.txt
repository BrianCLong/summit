
> intelgraph-server@4.0.1 test /Users/brianlong/Developer/summit/server
> jest --config jest.config.ts "tests/services/VectorStoreService.test.ts" "src/ai/copilot/__tests__/guardrails.service.test.ts" "src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts"

ğŸš€ Starting Jest Global Setup...
âœ… Jest Global Setup completed successfully
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.test -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

      at _log (../node_modules/.pnpm/dotenv@17.2.3/node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.test -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

      at _log (../node_modules/.pnpm/dotenv@17.2.3/node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.test -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

      at _log (../node_modules/.pnpm/dotenv@17.2.3/node_modules/dotenv/lib/main.js:142:11)

FAIL tests/services/VectorStoreService.test.ts
  â— Test suite failed to run

    Cannot find module '<rootDir>/src/db/postgres.js' from 'tests/services/VectorStoreService.test.ts'

       9 | // Mock Postgres Pool
      10 | // Mock Postgres Pool
    > 11 | jest.mock('<rootDir>/src/db/postgres.js', () => ({
         |      ^
      12 |   getPostgresPool: jest.fn().mockReturnValue({
      13 |     write: jest.fn(),
      14 |     read: jest.fn(),

      at Resolver._throwModNotFoundError (../node_modules/.pnpm/jest-resolve@29.7.0/node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/services/VectorStoreService.test.ts:11:6)

FAIL src/ai/copilot/__tests__/guardrails.service.test.ts
  â— Test suite failed to run

    [96msrc/ai/copilot/__tests__/guardrails.service.test.ts[0m:[93m97[0m:[93m40[0m - [91merror[0m[90m TS2339: [0mProperty 'validateAndGuard' does not exist on type 'GuardrailsService'.

    [7m97[0m       const result = guardrailsService.validateAndGuard(
    [7m  [0m [91m                                       ~~~~~~~~~~~~~~~~[0m

FAIL src/hunting/__tests__/ThreatHuntingOrchestrator.test.ts
  â— Test suite failed to run

    [96msrc/hunting/__tests__/ThreatHuntingOrchestrator.test.ts[0m:[93m92[0m:[93m45[0m - [91merror[0m[90m TS2345: [0mArgument of type 'undefined' is not assignable to parameter of type 'never'.

    [7m92[0m     initialize: jest.fn().mockResolvedValue(undefined),
    [7m  [0m [91m                                            ~~~~~~~~~[0m
    [96msrc/hunting/__tests__/ThreatHuntingOrchestrator.test.ts[0m:[93m96[0m:[93m26[0m - [91merror[0m[90m TS18046: [0m'query' is of type 'unknown'.

    [7m96[0m       const upperQuery = query.toUpperCase();
    [7m  [0m [91m                         ~~~~~[0m
    [96msrc/hunting/__tests__/ThreatHuntingOrchestrator.test.ts[0m:[93m99[0m:[93m44[0m - [91merror[0m[90m TS2345: [0mArgument of type 'unknown' is not assignable to parameter of type 'string'.

    [7m99[0m       let hasLimit = /\bLIMIT\s+\d+/i.test(query);
    [7m  [0m [91m                                           ~~~~~[0m
    [96msrc/hunting/__tests__/ThreatHuntingOrchestrator.test.ts[0m:[93m105[0m:[93m12[0m - [91merror[0m[90m TS18046: [0m'query' is of type 'unknown'.

    [7m105[0m       if ((query.match(/MATCH/gi) || []).length > 1) complexity = 20;
    [7m   [0m [91m           ~~~~~[0m
    [96msrc/hunting/__tests__/ThreatHuntingOrchestrator.test.ts[0m:[93m106[0m:[93m12[0m - [91merror[0m[90m TS18046: [0m'query' is of type 'unknown'.

    [7m106[0m       if ((query.match(/\*\d*\.\./gi) || []).length > 0) complexity = 30;
    [7m   [0m [91m           ~~~~~[0m
    [96msrc/hunting/__tests__/ThreatHuntingOrchestrator.test.ts[0m:[93m110[0m:[93m33[0m - [91merror[0m[90m TS2345: [0mArgument of type 'unknown' is not assignable to parameter of type 'string'.

    [7m110[0m       if (/\bLIMIT\s+\d+/i.test(query)) return query;
    [7m   [0m [91m                                ~~~~~[0m
    [96msrc/hunting/__tests__/ThreatHuntingOrchestrator.test.ts[0m:[93m111[0m:[93m17[0m - [91merror[0m[90m TS18046: [0m'query' is of type 'unknown'.

    [7m111[0m       return `${query.trim()} LIMIT ${limit}`;
    [7m   [0m [91m                ~~~~~[0m

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Test Suites: 3 failed, 3 total
Tests:       0 total
Snapshots:   0 total
Time:        80.695 s
Ran all test suites matching /tests\/services\/VectorStoreService.test.ts|src\/ai\/copilot\/__tests__\/guardrails.service.test.ts|src\/hunting\/__tests__\/ThreatHuntingOrchestrator.test.ts/i.
ğŸ§¹ Starting Jest Global Teardown...
ğŸ—‘ï¸ Cleaning up temporary directories...
ğŸ”Œ Closing global connections...
âœ… Jest Global Teardown completed successfully
â€‰ELIFECYCLEâ€‰ Test failed. See above for more details.
