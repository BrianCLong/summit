import { Component, Vulnerability } from './types';

// Mock database of known vulnerabilities
const KNOWN_VULNS: Record<string, Omit<Vulnerability, 'affectedComponent'>> = {
  'log4j-core@2.14.1': {
    cveId: 'CVE-2021-44228',
    severity: 'critical',
    score: 10.0,
    description: 'Remote Code Execution in Log4j 2.x',
  },
  'lodash@4.17.15': {
    cveId: 'CVE-2020-8203',
    severity: 'high',
    score: 7.4,
    description: 'Prototype pollution in lodash',
  },
  'express@4.16.0': {
    cveId: 'CVE-2019-1234',
    severity: 'medium',
    score: 5.0,
    description: 'Mock vulnerability for Express',
  }
};

export class VulnerabilityService {
  /**
   * Scans a list of components for known vulnerabilities.
   */
  async scanComponents(components: Component[]): Promise<Vulnerability[]> {
    const findings: Vulnerability[] = [];

    for (const comp of components) {
      const key = `${comp.name}@${comp.version}`;
      const hit = KNOWN_VULNS[key];
      if (hit) {
        findings.push({
          ...hit,
          affectedComponent: key,
        });
      }
    }
    return findings;
  }
}
