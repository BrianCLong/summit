<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Data Spine Lineage Explorer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: light dark;
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }
      body {
        margin: 0;
        padding: 1.5rem;
        background: radial-gradient(circle at top, #0f172a, #020617);
        color: #e2e8f0;
      }
      h1 {
        margin-top: 0;
        font-size: 2rem;
      }
      .card {
        background: rgba(15, 23, 42, 0.7);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 20px 40px rgba(15, 23, 42, 0.4);
      }
      .events {
        display: grid;
        gap: 1rem;
      }
      .event {
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 12px;
        padding: 1rem;
        background: rgba(30, 41, 59, 0.65);
      }
      .event h2 {
        margin: 0 0 0.25rem;
        font-size: 1.1rem;
      }
      .event pre {
        margin: 0.5rem 0 0;
        max-height: 200px;
        overflow: auto;
        background: rgba(15, 23, 42, 0.6);
        padding: 0.75rem;
        border-radius: 8px;
      }
      .status {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        background: rgba(56, 189, 248, 0.15);
        padding: 0.25rem 0.75rem;
        border-radius: 999px;
      }
      .metadata {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 0.75rem;
        font-size: 0.875rem;
        color: #cbd5f5;
      }
      @media (max-width: 600px) {
        body {
          padding: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <main class="card">
      <h1>Data Spine Lineage Explorer</h1>
      <p>Streaming OpenLineage events from <code>services/data-spine/lineage-events.json</code>.</p>
      <section id="event-list" class="events"></section>
    </main>
    <template id="event-template">
      <article class="event">
        <header>
          <span class="status"></span>
          <div class="metadata"></div>
        </header>
        <pre></pre>
      </article>
    </template>
    <script>
      async function loadEvents() {
        const target = document.getElementById('event-list');
        target.innerHTML = '';
        try {
          const response = await fetch('../../services/data-spine/lineage-events.json', {
            cache: 'no-store'
          });
          if (!response.ok) {
            throw new Error(`Failed to load lineage events (${response.status})`);
          }
          const events = await response.json();
          if (!Array.isArray(events) || events.length === 0) {
            target.innerHTML = '<p>No lineage events captured yet.</p>';
            return;
          }
          const template = document.getElementById('event-template');
          events.slice(-25).reverse().forEach((event) => {
            const clone = template.content.cloneNode(true);
            const status = clone.querySelector('.status');
            status.textContent = `${event.eventType} · ${event.job?.name || 'unknown job'}`;
            const metadata = clone.querySelector('.metadata');
            metadata.innerHTML = [
              `Run: <strong>${event.run?.runId}</strong>`,
              `Namespace: <strong>${event.job?.namespace}</strong>`,
              `Emitted: <strong>${new Date(event.eventTime).toLocaleString()}</strong>`
            ].join('<span>•</span>');
            clone.querySelector('pre').textContent = JSON.stringify(event, null, 2);
            target.appendChild(clone);
          });
        } catch (error) {
          target.innerHTML = `<p style="color:#f87171;">${error.message}</p>`;
        }
      }

      loadEvents();
      setInterval(loadEvents, 10000);
    </script>
  </body>
</html>
