# IntelGraph Deployment Freeze Windows Configuration
# Controls when deployments are allowed/blocked across environments

global:
  # Global settings applied to all environments unless overridden
  approvers:
    - "release-manager"
    - "security-lead"
    - "platform-lead"

  override_process: |
    To override a freeze window:
    1. Create GitHub issue with template: .github/ISSUE_TEMPLATE/deployment-override.md
    2. Get approval from 2+ authorized approvers
    3. Set CD_OVERRIDE=true in workflow or use /deploy-override command
    4. Document business justification and risk assessment

environments:
  production:
    # Permanent freeze (use for emergency lockdown)
    permanent_freeze: false

    # Emergency freeze (temporary)
    emergency_freeze:
      active: false
      reason: ""
      until: ""
      initiated_by: ""

    # Scheduled freeze windows
    freeze_windows:
      - name: "Holiday Freeze 2024"
        description: "Annual holiday freeze to ensure stability"
        start: "2024-12-20T00:00:00Z"
        end: "2025-01-06T08:00:00Z"
        reason: "holiday_freeze"

      - name: "Black Friday Stability"
        description: "Freeze during high-traffic period"
        start: "2024-11-28T00:00:00Z"
        end: "2024-12-02T08:00:00Z"
        reason: "high_traffic_period"

      - name: "Quarterly Business Review"
        description: "Stability during QBR presentations"
        recurring:
          pattern: "quarterly"
          months: [3, 6, 9, 12]  # March, June, September, December
          start_day: 25
          end_day: 30
          start_time: "00:00"
          end_time: "23:59"
        reason: "business_review"

      - name: "Weekend Freeze"
        description: "No prod deployments during weekends"
        recurring:
          pattern: "weekly"
          days_of_week: [0, 6]  # Sunday=0, Saturday=6
          start_time: "18:00"   # Friday 6pm
          end_time: "08:00"     # Monday 8am
        reason: "weekend_stability"
        exceptions:
          - "2024-12-29"  # Allow holiday exception

    # Environment-specific approvers (overrides global)
    approvers:
      - "production-release-manager"
      - "ciso"
      - "engineering-director"

    override_process: |
      Production override requires:
      1. P0/P1 incident or critical security fix
      2. CISO or Engineering Director approval
      3. Incident commander validation
      4. Post-deployment review within 24h

  staging:
    permanent_freeze: false

    freeze_windows:
      - name: "Production Deployment Window"
        description: "Freeze staging during prod deployments"
        recurring:
          pattern: "weekly"
          days_of_week: [2, 4]  # Tuesday, Thursday
          start_time: "09:00"
          end_time: "17:00"
        reason: "production_deployment_window"

    approvers:
      - "qa-lead"
      - "platform-engineer"

  development:
    permanent_freeze: false
    # Dev environment has minimal restrictions
    freeze_windows: []

    approvers:
      - "any-developer"

# Notification settings
notifications:
  slack:
    channels:
      - "#deployments"
      - "#incidents"

  email:
    recipients:
      - "deployments@intelgraph.com"
      - "sre@intelgraph.com"

# Monitoring and alerting
monitoring:
  metrics:
    freeze_window_blocks: true
    override_usage: true
    deployment_frequency: true

  alerts:
    override_threshold: 5  # Alert if >5 overrides per week
    freeze_duration_hours: 72  # Alert if freeze >72h