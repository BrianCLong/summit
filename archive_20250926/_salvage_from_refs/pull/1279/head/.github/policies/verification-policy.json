{
  "version": "1.0.0",
  "description": "IntelGraph provenance verification policy for supply chain security",
  "metadata": {
    "created": "2024-01-01T00:00:00Z",
    "updated": "2024-01-01T00:00:00Z",
    "owner": "security-team@intelgraph.com"
  },
  "required": [
    "subjects",
    "provenance",
    "provenance.predicate.builder.id",
    "provenance.predicate.metadata.buildStartedOn",
    "provenance.predicate.metadata.slsaLevel"
  ],
  "builders": {
    "description": "Trusted builder requirements",
    "allowed": [
      "https://github.com/slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@v1.9.0",
      "https://github.com/slsa-framework/slsa-github-generator/.github/workflows/generator_container_slsa3.yml@v1.9.0",
      "https://sigstore.dev/cosign",
      "https://github.com/actions/runner"
    ],
    "denied": [],
    "patterns": {
      "allowedGitHubOrgs": ["intelgraph", "slsa-framework"],
      "requiredSuffix": "@v1.9.0"
    }
  },
  "slsa": {
    "minLevel": 2,
    "preferredLevel": 3,
    "requirements": {
      "2": {
        "buildPlatform": "required",
        "buildService": "required",
        "reproducibleBuild": "preferred"
      },
      "3": {
        "buildPlatform": "required",
        "buildService": "required",
        "reproducibleBuild": "required",
        "isolatedBuild": "required"
      }
    }
  },
  "attestations": {
    "description": "Required and optional attestations",
    "required": [
      "https://cyclonedx.org/bom",
      "https://slsa.dev/provenance/v1"
    ],
    "optional": [
      "https://spdx.dev/Document",
      "https://github.com/TestResults/v1",
      "https://github.com/CodeQL/v1"
    ],
    "signers": {
      "required": true,
      "trusted": [
        "https://github.com/intelgraph",
        "keyid:SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"
      ],
      "algorithm": "ES256"
    }
  },
  "subjects": {
    "description": "Subject validation rules",
    "minCount": 1,
    "maxCount": 10,
    "digestAlgorithms": ["sha256", "sha512"],
    "requiredFields": ["name", "digest"],
    "namePatterns": {
      "allowed": [
        "^build-artifacts-[a-f0-9]{40}$",
        "^.*\\.(tar\\.gz|zip|jar|war|ear)$",
        "^.*\\.(js|ts|jsx|tsx|css|html)$"
      ],
      "denied": [
        ".*\\.exe$",
        ".*\\.bat$",
        ".*\\.sh$"
      ]
    }
  },
  "temporal": {
    "description": "Time-based validation rules",
    "maxAge": "7d",
    "clockSkewTolerance": "5m",
    "buildDuration": {
      "min": "30s",
      "max": "2h",
      "warning": "30m"
    }
  },
  "security": {
    "description": "Security validation requirements",
    "vulnerabilities": {
      "maxCritical": 0,
      "maxHigh": 5,
      "maxMedium": 20,
      "databases": ["NVD", "GitHub Advisory", "OSV"]
    },
    "licenses": {
      "allowed": [
        "MIT", "Apache-2.0", "BSD-3-Clause", "BSD-2-Clause",
        "ISC", "GPL-2.0", "GPL-3.0", "LGPL-2.1", "LGPL-3.0",
        "MPL-2.0", "Unlicense", "CC0-1.0", "Proprietary"
      ],
      "denied": [
        "GPL-3.0-only", "AGPL-3.0", "SSPL-1.0"
      ],
      "requiresApproval": [
        "GPL-2.0", "GPL-3.0", "LGPL-2.1", "LGPL-3.0"
      ]
    },
    "secrets": {
      "scanRequired": true,
      "patterns": [
        "(?i)(password|passwd|pwd)\\s*[=:]\\s*[\"']?\\w+",
        "(?i)(api[_-]?key|apikey)\\s*[=:]\\s*[\"']?\\w+",
        "(?i)(secret|token)\\s*[=:]\\s*[\"']?\\w+",
        "-----BEGIN [A-Z ]+-----[\\s\\S]*?-----END [A-Z ]+-----"
      ]
    }
  },
  "repository": {
    "description": "Source repository validation",
    "allowedHosts": [
      "github.com",
      "gitlab.com"
    ],
    "requiredProtections": {
      "branchProtection": true,
      "requireReviews": true,
      "minReviewers": 1,
      "dismissStaleReviews": true,
      "requireCodeowners": true
    },
    "allowedActions": [
      "actions/checkout@v4",
      "actions/setup-node@v4",
      "actions/upload-artifact@v4",
      "slsa-framework/slsa-github-generator/*@v1.9.0"
    ]
  },
  "environment": {
    "description": "Build environment validation",
    "allowedOS": ["ubuntu-latest", "ubuntu-22.04", "ubuntu-20.04"],
    "allowedArchitectures": ["x64", "amd64"],
    "requiredTools": [
      "node@18",
      "node@20",
      "npm@9",
      "npm@10"
    ],
    "environmentVariables": {
      "required": ["NODE_ENV", "CI"],
      "forbidden": ["AWS_SECRET_ACCESS_KEY", "GITHUB_TOKEN"]
    }
  },
  "compliance": {
    "description": "Regulatory and organizational compliance",
    "standards": ["SLSA", "NIST-SSDF", "ISO-27001"],
    "frameworks": ["SOC2", "PCI-DSS"],
    "policies": {
      "dataRetention": "90d",
      "auditTrail": "required",
      "changeManagement": "required"
    }
  },
  "scoring": {
    "description": "Verification scoring system",
    "weights": {
      "provenance": 30,
      "attestations": 25,
      "security": 20,
      "compliance": 15,
      "temporal": 10
    },
    "thresholds": {
      "minimum": 70,
      "recommended": 85,
      "excellent": 95
    },
    "penalties": {
      "missingProvenance": -50,
      "expiredAttestation": -20,
      "criticalVulnerability": -30,
      "untrustedBuilder": -40
    }
  },
  "exceptions": {
    "description": "Exception handling rules",
    "emergencyBypass": {
      "enabled": true,
      "requiresApproval": true,
      "approvers": ["security-admin", "release-manager"],
      "auditRequired": true,
      "maxDuration": "24h"
    },
    "knownIssues": [
      {
        "id": "npm-audit-1094",
        "description": "Known false positive in dev dependencies",
        "expires": "2024-12-31T23:59:59Z",
        "severity": "medium"
      }
    ]
  },
  "notifications": {
    "description": "Notification configuration",
    "channels": {
      "slack": "#security-alerts",
      "email": ["security-team@intelgraph.com"],
      "webhook": "https://api.intelgraph.com/security/alerts"
    },
    "triggers": {
      "verificationFailure": ["slack", "email"],
      "criticalVulnerability": ["slack", "email", "webhook"],
      "emergencyBypass": ["slack", "email", "webhook"]
    }
  }
}
