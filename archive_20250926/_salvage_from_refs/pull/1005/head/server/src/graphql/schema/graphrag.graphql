# GraphRAG Schema - Explainable Graph-based Retrieval Augmented Generation

"""
Input for GraphRAG queries with explainable output
"""
input GraphRAGQueryInput {
  """Investigation to query within"""
  investigationId: ID!
  
  """Natural language question"""
  question: String!
  
  """Optional entity IDs to focus the search around"""
  focusEntityIds: [ID!]
  
  """Maximum hops for graph traversal (1-3, default: 2)"""
  maxHops: Int
  
  """LLM temperature for response generation (0-1, default: 0)"""
  temperature: Float
  
  """Maximum tokens for LLM response (100-2000, default: 1000)"""
  maxTokens: Int
}

"""
GraphRAG response with explainable reasoning
"""
type GraphRAGResponse {
  """Generated answer based on graph context"""
  answer: String!
  
  """Confidence score 0-1 based on context completeness"""
  confidence: Float!
  
  """Entity citations that support the answer"""
  citations: Citations!
  
  """Relationship paths that explain the reasoning"""
  why_paths: [WhyPath!]!
}

"""
Entity citations supporting the answer
"""
type Citations {
  """Entity IDs that were referenced in generating the answer"""
  entityIds: [ID!]!
}

"""
Explainable reasoning path through relationships
"""
type WhyPath {
  """Source entity ID"""
  from: ID!
  
  """Target entity ID"""
  to: ID!
  
  """Relationship ID connecting from -> to"""
  relId: ID!
  
  """Relationship type"""
  type: String!
  
  """Support score for this path (0-1, optional)"""
  supportScore: Float
}

"""
Similar entity result with similarity score
"""
type SimilarEntity {
  """The similar entity"""
  entity: Entity!
  
  """Similarity score 0-1"""
  similarity: Float!
}

"""
Cache operation result
"""
type CacheOperationResult {
  """Whether the operation succeeded"""
  success: Boolean!
  
  """Human readable message"""
  message: String!
}

# Query extensions
extend type Query {
  """
  Query the knowledge graph using explainable GraphRAG.
  Returns structured response with answer, confidence, citations, and why_paths.
  """
  graphRagAnswer(input: GraphRAGQueryInput!): GraphRAGResponse!
  
  """
  Find entities similar to the given entity or text.
  Uses vector embeddings for semantic similarity.
  """
  similarEntities(
    entityId: ID
    text: String
    topK: Int = 10
    investigationId: ID!
  ): [SimilarEntity!]!
}

# Mutation extensions  
extend type Mutation {
  """
  Clear GraphRAG cache for an investigation.
  Useful when investigation data has changed significantly.
  """
  clearGraphRAGCache(investigationId: ID!): CacheOperationResult!
}