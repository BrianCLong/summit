name: acceptance-s26
on: [workflow_dispatch, pull_request]
jobs:
  load-fixtures:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm ci --workspace acceptance
      - run: node acceptance/scripts/load_golden.js
        env:
          NEO4J_URL: ${{ secrets.NEO4J_URL }}
          NEO4J_USER: ${{ secrets.NEO4J_USER }}
          NEO4J_PASS: ${{ secrets.NEO4J_PASS }}
          PG_URL: ${{ secrets.PG_URL }}
  e2e-web:
    runs-on: ubuntu-latest
    needs: load-fixtures
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: '20' }
      - run: npx playwright install --with-deps
      - run: npx playwright test acceptance/e2e/web
        env:
          WEB_URL: ${{ secrets.WEB_URL }}
          GQL_URL: ${{ secrets.GQL_URL }}
          TOKEN: ${{ secrets.TOKEN }}
  e2e-gateway:
    runs-on: ubuntu-latest
    needs: load-fixtures
    steps:
      - uses: actions/checkout@v4
      - run: npx playwright test acceptance/e2e/gateway
        env:
          GQL_URL: ${{ secrets.GQL_URL }}
  policy:
    runs-on: ubuntu-latest
    needs: load-fixtures
    steps:
      - uses: actions/checkout@v4
      - run: npx playwright test acceptance/e2e/policy
        env:
          GQL_URL: ${{ secrets.GQL_URL }}
