# Falco runtime security rules for IntelGraph workloads
# This is a placeholder file.

- rule: Detect Suspicious IntelGraph Process
  desc: >
    Detects suspicious process execution patterns within IntelGraph containers.
  condition: >
    container.name in ("intelgraph-server", "intelgraph-client", "intelgraph-ml") and
    proc.name in ("bash", "sh", "python", "node") and
    proc.args contains "evil_script.sh"
  output: >
    Suspicious process detected in IntelGraph container (container=%container.name user=%user.name process=%proc.name cmdline=%proc.cmdline)
  priority: WARNING
  tags: [intelgraph, security, process]

- rule: Detect Unauthorized File Access in IntelGraph Uploads
  desc: >
    Detects unauthorized read/write access to the IntelGraph uploads directory.
  condition: >
    container.name in ("intelgraph-server") and
    (evt.type = "open" or evt.type = "creat") and
    fd.name contains "/app/uploads/" and
    not user.name = "appuser" # Assuming 'appuser' is the legitimate user
  output: >
    Unauthorized file access in IntelGraph uploads directory (container=%container.name user=%user.name file=%fd.name)
  priority: CRITICAL
  tags: [intelgraph, security, file_access]

# Add more rules based on IntelGraph specific behaviors and known threats

- rule: Detect Suspicious SocketIO Access
  desc: Detect unexpected access to Socket.IO endpoints
  condition: evt.type in (accept, connect) and fd.name contains "/socket.io/"
  output: Suspicious Socket.IO connection to %fd.name
  priority: NOTICE

- rule: Detect Excessive GraphQL Queries
  desc: Detect high rate of GraphQL requests which may indicate abuse
  condition: evt.type=recv and fd.name contains "/graphql" and evt.count > 100
  output: High volume GraphQL traffic detected on %fd.name
  priority: WARNING
