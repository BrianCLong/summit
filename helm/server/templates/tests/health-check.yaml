apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "server.fullname" . }}-health-check"
  labels:
    {{- include "server.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-weight": "1"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  restartPolicy: Never
  containers:
  - name: health-check
    image: curlimages/curl:8.1.0
    command: ["/bin/sh"]
    args:
      - -c
      - |
        echo "Testing health endpoint..."
        curl -f http://{{ include "server.fullname" . }}:{{ .Values.service.port }}/health

        echo "Testing detailed health endpoint..."
        curl -f http://{{ include "server.fullname" . }}:{{ .Values.service.port }}/health/detailed

        echo "All health checks passed!"