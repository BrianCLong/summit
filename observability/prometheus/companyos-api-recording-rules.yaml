groups:
  - name: companyos-api-slo
    rules:
      - record: companyos_api:request_total:rate5m
        expr: sum by (status_code) (
          rate(http_requests_total{job="companyos-api"}[5m])
        )

      - record: companyos_api:error_rate:ratio5m
        expr: |
          (
            sum(rate(http_requests_total{job="companyos-api", status_code=~"5.."}[5m]))
          )
          /
          (
            sum(rate(http_requests_total{job="companyos-api"}[5m]))
          )

      - record: companyos_api:availability:ratio5m
        expr: |
          (
            sum(rate(http_requests_total{job="companyos-api", status_code!~"5.."}[5m]))
          )
          /
          (
            sum(rate(http_requests_total{job="companyos-api"}[5m]))
          )

      - record: companyos_api:latency_p95:seconds5m
        expr: |
          histogram_quantile(
            0.95,
            sum by (le) (
              rate(http_request_duration_seconds_bucket{job="companyos-api"}[5m])
            )
          )
