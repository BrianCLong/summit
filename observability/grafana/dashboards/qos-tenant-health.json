{
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "type": "datasource",
      "pluginId": "prometheus"
    }
  ],
  "folder": {
    "name": "/Platform/QoS"
  },
  "title": "QoS Tenant Health",
  "panels": [
    {
      "title": "Top Tenants by Exploration Cap Denies (30d)",
      "type": "table",
      "datasource": "DS_PROMETHEUS",
      "targets": [
        {
          "expr": "topk(20, sum by (tenant) (increase(admission_decision_total{decision=\"deny\",reason=~\"exploration cap.*\"}[30d])))",
          "legendFormat": "{{tenant}}"
        }
      ],
      "overrides": [
        {
          "matcher": {
            "id": "byName",
            "options": "tenant"
          },
          "properties": [
            {
              "id": "links",
              "value": [
                {
                  "title": "Create Upgrade Ticket",
                  "url": "https://slack.com/app_redirect?team=T012345&channel=C67890&text=Upgrade%20ticket%20for%20tenant%3A%20${__cell:text}"
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
