{
  "title": "Canary Release Overview",
  "uid": "canary-overview",
  "tags": ["canary", "reliability"],
  "timezone": "browser",
  "panels": [
    {
      "type": "timeseries",
      "title": "Composite Canary Score",
      "targets": [
        {
          "refId": "A",
          "expr": "maestro_api_canary_composite_score{env=~\"staging|preprod|prod\"}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 1
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Synthetic Availability vs Latency",
      "targets": [
        {
          "refId": "A",
          "expr": "synthetic_probe_availability{suite=\"maestro-api-canary\"}"
        },
        {
          "refId": "B",
          "expr": "synthetic_probe_latency_seconds{suite=\"maestro-api-canary\",quantile=\"0.95\"}"
        }
      ],
      "fieldConfig": {
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "synthetic_probe_latency_seconds"
            },
            "properties": [{ "id": "unit", "value": "s" }]
          }
        ]
      }
    },
    {
      "type": "timeseries",
      "title": "Error Budget Burn",
      "targets": [
        {
          "refId": "A",
          "expr": "sum(rate(maestro_api_error_budget_burn{env=~\"staging|preprod|prod\"}[5m]))"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent"
        }
      },
      "thresholds": {
        "mode": "absolute",
        "steps": [
          { "color": "green", "value": 0 },
          { "color": "orange", "value": 0.05 },
          { "color": "red", "value": 0.1 }
        ]
      }
    },
    {
      "type": "stat",
      "title": "Median Rollback Duration (5m)",
      "targets": [
        {
          "refId": "A",
          "expr": "histogram_quantile(0.5, sum(rate(maestro_api_rollback_duration_seconds_bucket[5m])) by (le))"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "decimals": 0
        }
      }
    }
  ],
  "refresh": "30s"
}
