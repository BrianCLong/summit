# MC v0.3.2-mc Local Kit - Docker Compose
# Usage: docker compose -f docker-compose.local-kit.yml up -d
services:
  a2a-gateway:
    image: python:3.12-alpine
    working_dir: /app
    command: sh -c "pip install --no-cache-dir waitress && python mock/a2a_server.py"
    volumes:
      - ./:/app
    ports:
      - "8080:8080"
    environment:
      - PYTHONUNBUFFERED=1
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/health", "||", "exit", "1"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 5s

  mc-kit-runner:
    image: python:3.12-alpine
    working_dir: /app
    depends_on:
      - a2a-gateway
    volumes:
      - ./:/app
    environment:
      - A2A_URL=http://a2a-gateway:8080
      - MC_VERSION=v0.3.2-mc
      - MC_SIGNING_KEY=docker-demo-key
    command: sh -c "
      apk add --no-cache jq curl make &&
      sleep 2 &&
      make slo gates a2a evidence verify
    "
    profiles:
      - test