040c96c51e9f1ab162e5b3355a7f86a7
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cleanroomJoin = cleanroomJoin;
const dp_1 = require("../../dp");
async function cleanroomJoin(ctx, step) {
    const cfg = step.inputs || {};
    const joined = await ctx.enclave.join(cfg.joinKeys || [], cfg.select || []);
    if (cfg.dp && Array.isArray(cfg.dp.columns)) {
        for (const col of cfg.dp.columns)
            joined[col] = (0, dp_1.applyDp)(joined[col], cfg.dp);
    }
    ctx.emitArtifact('cleanroom.json', Buffer.from(JSON.stringify(joined)));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2JyaWFubG9uZy9EZXZlbG9wZXIvc3VtbWl0L3NlcnZlci9zcmMvY29uZHVjdG9yL3N0ZXBzL2NsZWFucm9vbUpvaW4udHMiLCJtYXBwaW5ncyI6Ijs7QUFFQSxzQ0FPQztBQVRELGlDQUFtQztBQUU1QixLQUFLLFVBQVUsYUFBYSxDQUFDLEdBQVEsRUFBRSxJQUFTO0lBQ3JELE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDO0lBQzlCLE1BQU0sTUFBTSxHQUFHLE1BQU0sR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsSUFBSSxFQUFFLEVBQUUsR0FBRyxDQUFDLE1BQU0sSUFBSSxFQUFFLENBQUMsQ0FBQztJQUM1RSxJQUFJLEdBQUcsQ0FBQyxFQUFFLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDNUMsS0FBSyxNQUFNLEdBQUcsSUFBSSxHQUFHLENBQUMsRUFBRSxDQUFDLE9BQU87WUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBQSxZQUFPLEVBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUMvRSxDQUFDO0lBQ0QsR0FBRyxDQUFDLFlBQVksQ0FBQyxnQkFBZ0IsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzFFLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2JyaWFubG9uZy9EZXZlbG9wZXIvc3VtbWl0L3NlcnZlci9zcmMvY29uZHVjdG9yL3N0ZXBzL2NsZWFucm9vbUpvaW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXBwbHlEcCB9IGZyb20gJy4uLy4uL2RwJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFucm9vbUpvaW4oY3R4OiBhbnksIHN0ZXA6IGFueSkge1xuICBjb25zdCBjZmcgPSBzdGVwLmlucHV0cyB8fCB7fTtcbiAgY29uc3Qgam9pbmVkID0gYXdhaXQgY3R4LmVuY2xhdmUuam9pbihjZmcuam9pbktleXMgfHwgW10sIGNmZy5zZWxlY3QgfHwgW10pO1xuICBpZiAoY2ZnLmRwICYmIEFycmF5LmlzQXJyYXkoY2ZnLmRwLmNvbHVtbnMpKSB7XG4gICAgZm9yIChjb25zdCBjb2wgb2YgY2ZnLmRwLmNvbHVtbnMpIGpvaW5lZFtjb2xdID0gYXBwbHlEcChqb2luZWRbY29sXSwgY2ZnLmRwKTtcbiAgfVxuICBjdHguZW1pdEFydGlmYWN0KCdjbGVhbnJvb20uanNvbicsIEJ1ZmZlci5mcm9tKEpTT04uc3RyaW5naWZ5KGpvaW5lZCkpKTtcbn1cblxuIl0sInZlcnNpb24iOjN9