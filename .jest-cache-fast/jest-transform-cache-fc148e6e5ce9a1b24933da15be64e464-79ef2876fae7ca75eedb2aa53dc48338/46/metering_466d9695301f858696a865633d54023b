7bc51f1f9180b1b52ac559f40a6a441f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.recordMeters = recordMeters;
exports.exportBillingCSV = exportBillingCSV;
const pg_1 = require("pg");
const pg = new pg_1.Pool({ connectionString: process.env.DATABASE_URL });
async function recordMeters(tenant, m) {
    await pg.query(`INSERT INTO meters(tenant, ts, cpu_sec, gb_sec, egress_gb, dp_epsilon, plugin_calls)
     VALUES ($1, now(), $2, $3, $4, $5, $6)`, [tenant, m.cpuSec, m.gbSec, m.egressGb, m.dpEpsilon, m.pluginCalls]);
}
async function exportBillingCSV(tenant, month) {
    // Placeholder: return an S3 URI where an export job would write.
    return `s3://billing/${tenant}/${month}.csv`;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2JyaWFubG9uZy9EZXZlbG9wZXIvc3VtbWl0L3NlcnZlci9zcmMvY29uZHVjdG9yL21ldGVyaW5nLnRzIiwibWFwcGluZ3MiOiI7O0FBSUEsb0NBU0M7QUFFRCw0Q0FHQztBQWxCRCwyQkFBMEI7QUFFMUIsTUFBTSxFQUFFLEdBQUcsSUFBSSxTQUFJLENBQUMsRUFBRSxnQkFBZ0IsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUM7QUFFN0QsS0FBSyxVQUFVLFlBQVksQ0FDaEMsTUFBYyxFQUNkLENBQThGO0lBRTlGLE1BQU0sRUFBRSxDQUFDLEtBQUssQ0FDWjs0Q0FDd0MsRUFDeEMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLENBQ3BFLENBQUM7QUFDSixDQUFDO0FBRU0sS0FBSyxVQUFVLGdCQUFnQixDQUFDLE1BQWMsRUFBRSxLQUFhO0lBQ2xFLGlFQUFpRTtJQUNqRSxPQUFPLGdCQUFnQixNQUFNLElBQUksS0FBSyxNQUFNLENBQUM7QUFDL0MsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvYnJpYW5sb25nL0RldmVsb3Blci9zdW1taXQvc2VydmVyL3NyYy9jb25kdWN0b3IvbWV0ZXJpbmcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUG9vbCB9IGZyb20gJ3BnJztcblxuY29uc3QgcGcgPSBuZXcgUG9vbCh7IGNvbm5lY3Rpb25TdHJpbmc6IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCB9KTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlY29yZE1ldGVycyhcbiAgdGVuYW50OiBzdHJpbmcsXG4gIG06IHsgY3B1U2VjOiBudW1iZXI7IGdiU2VjOiBudW1iZXI7IGVncmVzc0diOiBudW1iZXI7IGRwRXBzaWxvbjogbnVtYmVyOyBwbHVnaW5DYWxsczogbnVtYmVyIH0sXG4pIHtcbiAgYXdhaXQgcGcucXVlcnkoXG4gICAgYElOU0VSVCBJTlRPIG1ldGVycyh0ZW5hbnQsIHRzLCBjcHVfc2VjLCBnYl9zZWMsIGVncmVzc19nYiwgZHBfZXBzaWxvbiwgcGx1Z2luX2NhbGxzKVxuICAgICBWQUxVRVMgKCQxLCBub3coKSwgJDIsICQzLCAkNCwgJDUsICQ2KWAsXG4gICAgW3RlbmFudCwgbS5jcHVTZWMsIG0uZ2JTZWMsIG0uZWdyZXNzR2IsIG0uZHBFcHNpbG9uLCBtLnBsdWdpbkNhbGxzXSxcbiAgKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4cG9ydEJpbGxpbmdDU1YodGVuYW50OiBzdHJpbmcsIG1vbnRoOiBzdHJpbmcpIHtcbiAgLy8gUGxhY2Vob2xkZXI6IHJldHVybiBhbiBTMyBVUkkgd2hlcmUgYW4gZXhwb3J0IGpvYiB3b3VsZCB3cml0ZS5cbiAgcmV0dXJuIGBzMzovL2JpbGxpbmcvJHt0ZW5hbnR9LyR7bW9udGh9LmNzdmA7XG59XG5cbiJdLCJ2ZXJzaW9uIjozfQ==