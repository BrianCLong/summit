{"file":"/Users/brianlong/Developer/summit/server/src/conductor/__tests__/mission-control-conflict-resolution.test.ts","mappings":"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","names":[],"sources":["/Users/brianlong/Developer/summit/server/src/conductor/__tests__/mission-control-conflict-resolution.test.ts"],"sourcesContent":["import { MissionControlConflictResolver } from '../mission-control/conflict-resolution';\n\ndescribe('MissionControlConflictResolver', () => {\n  const resolver = new MissionControlConflictResolver();\n\n  const primarySlot = { start: '2025-01-01T00:00:00Z', end: '2025-01-01T01:00:00Z' };\n  const fallbackSlot = { start: '2025-01-01T01:00:00Z', end: '2025-01-01T02:00:00Z' };\n\n  it('assigns highest priority mission to contested slot and negotiates fallback for lower priority mission', () => {\n    const resolution = resolver.resolve({\n      conflictId: 'conflict-1',\n      resourceType: 'uplink-window',\n      currentMissionId: 'mission-alpha',\n      participants: [\n        {\n          missionId: 'mission-alpha',\n          priorityLevel: 'critical',\n          basePriority: 92,\n          missionImpact: 0.95,\n          regulatoryRisk: 0.6,\n          urgencyMinutes: 20,\n          requestedSlot: primarySlot,\n          flexibility: { maxDelayMinutes: 10 },\n        },\n        {\n          missionId: 'mission-beta',\n          priorityLevel: 'medium',\n          basePriority: 55,\n          missionImpact: 0.5,\n          regulatoryRisk: 0.3,\n          urgencyMinutes: 120,\n          requestedSlot: primarySlot,\n          flexibility: {\n            maxDelayMinutes: 90,\n            fallbackSlots: [fallbackSlot],\n            negotiationStance: 'defensive',\n          },\n        },\n      ],\n    });\n\n    const alphaAssignment = resolution.assignments.find((a: any) => a.missionId === 'mission-alpha');\n    const betaAssignment = resolution.assignments.find((a: any) => a.missionId === 'mission-beta');\n\n    expect(alphaAssignment).toBeDefined();\n    expect(alphaAssignment?.decision).toBe('primary');\n    expect(alphaAssignment?.negotiated).toBe(false);\n\n    expect(betaAssignment).toBeDefined();\n    expect(betaAssignment?.decision).toBe('fallback');\n    expect(betaAssignment?.slot).toEqual(fallbackSlot);\n    expect(betaAssignment?.negotiated).toBe(true);\n\n    expect(resolution.allowProceed).toBe(true);\n    expect(resolution.arbitrationSummary.totalConcessions).toBe(1);\n    expect(resolution.arbitrationSummary.fairnessIndex).toBe(1);\n  });\n\n  it('defers mission without viable fallback when arbitration favors higher priority mission', () => {\n    const resolution = resolver.resolve({\n      conflictId: 'conflict-2',\n      resourceType: 'analysis-lab',\n      currentMissionId: 'mission-low',\n      participants: [\n        {\n          missionId: 'mission-critical',\n          priorityLevel: 'critical',\n          basePriority: 88,\n          missionImpact: 0.8,\n          regulatoryRisk: 0.5,\n          urgencyMinutes: 15,\n          requestedSlot: primarySlot,\n          flexibility: { maxDelayMinutes: 5 },\n        },\n        {\n          missionId: 'mission-low',\n          priorityLevel: 'low',\n          basePriority: 40,\n          missionImpact: 0.3,\n          regulatoryRisk: 0.1,\n          urgencyMinutes: 240,\n          requestedSlot: primarySlot,\n          flexibility: { maxDelayMinutes: 0 },\n        },\n      ],\n    });\n\n    expect(resolution.allowProceed).toBe(false);\n    expect(resolution.deferred).toEqual(\n      expect.arrayContaining([\n        expect.objectContaining({ missionId: 'mission-low' }),\n      ]),\n    );\n    expect(resolution.arbitrationSummary.fairnessIndex).toBeLessThan(1);\n    expect(\n      resolution.negotiationLog.some(\n        (event: any) => event.type === 'defer' && event.actors.includes('mission-low'),\n      ),\n    ).toBe(true);\n  });\n\n  it('calculates fairness index and concession totals across mixed outcomes', () => {\n    const resolution = resolver.resolve({\n      conflictId: 'conflict-3',\n      resourceType: 'downlink-pipeline',\n      currentMissionId: 'mission-alpha',\n      participants: [\n        {\n          missionId: 'mission-alpha',\n          priorityLevel: 'critical',\n          basePriority: 85,\n          missionImpact: 0.8,\n          regulatoryRisk: 0.4,\n          urgencyMinutes: 30,\n          requestedSlot: primarySlot,\n          flexibility: { maxDelayMinutes: 5 },\n        },\n        {\n          missionId: 'mission-beta',\n          priorityLevel: 'high',\n          basePriority: 70,\n          missionImpact: 0.6,\n          regulatoryRisk: 0.4,\n          urgencyMinutes: 90,\n          requestedSlot: primarySlot,\n          flexibility: { maxDelayMinutes: 60, fallbackSlots: [fallbackSlot] },\n        },\n        {\n          missionId: 'mission-gamma',\n          priorityLevel: 'medium',\n          basePriority: 55,\n          missionImpact: 0.5,\n          regulatoryRisk: 0.2,\n          urgencyMinutes: 180,\n          requestedSlot: primarySlot,\n          flexibility: { maxDelayMinutes: 5 },\n        },\n      ],\n    });\n\n    expect(resolution.assignments.some((a: any) => a.missionId === 'mission-gamma')).toBe(false);\n    expect(resolution.deferred).toHaveLength(1);\n    expect(resolution.arbitrationSummary.totalConcessions).toBe(1);\n    expect(resolution.arbitrationSummary.fairnessIndex).toBeGreaterThan(0.7);\n    expect(resolution.arbitrationSummary.fairnessIndex).toBeLessThan(0.8);\n  });\n});\n"],"version":3}