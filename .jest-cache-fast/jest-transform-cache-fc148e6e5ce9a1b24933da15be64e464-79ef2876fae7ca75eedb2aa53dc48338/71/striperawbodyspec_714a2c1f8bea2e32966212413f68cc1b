54fb54217a239711eb135e7c57b5802c
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const supertest_1 = __importDefault(require("supertest"));
const express_1 = __importDefault(require("express"));
const stripe_1 = __importDefault(require("../src/routes/stripe"));
describe('Stripe raw-body route', () => {
    const app = (0, express_1.default)();
    app.use('/webhooks/stripe', stripe_1.default);
    const enabled = !!process.env.STRIPE_WEBHOOK_SECRET;
    (enabled ? it : it.skip)('accepts raw payload', async () => {
        const res = await (0, supertest_1.default)(app)
            .post('/webhooks/stripe/events')
            .set('Content-Type', 'application/json')
            .set('Stripe-Signature', 'v1=dummy')
            .send(Buffer.from(JSON.stringify({ ok: true }), 'utf8'));
        expect([200, 400, 503]).toContain(res.status);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2JyaWFubG9uZy9EZXZlbG9wZXIvc3VtbWl0L3NlcnZlci90ZXN0cy9zdHJpcGUtcmF3LWJvZHkuc3BlYy50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLDBEQUFnQztBQUNoQyxzREFBOEI7QUFDOUIsa0VBQWdEO0FBRWhELFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7SUFDckMsTUFBTSxHQUFHLEdBQUcsSUFBQSxpQkFBTyxHQUFFLENBQUM7SUFDdEIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxnQkFBbUIsQ0FBQyxDQUFDO0lBRWpELE1BQU0sT0FBTyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDO0lBQ3BELENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxxQkFBcUIsRUFBRSxLQUFLLElBQUksRUFBRTtRQUN6RCxNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7YUFDM0IsSUFBSSxDQUFDLHlCQUF5QixDQUFDO2FBQy9CLEdBQUcsQ0FBQyxjQUFjLEVBQUUsa0JBQWtCLENBQUM7YUFDdkMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLFVBQVUsQ0FBQzthQUNuQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUMzRCxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNoRCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9icmlhbmxvbmcvRGV2ZWxvcGVyL3N1bW1pdC9zZXJ2ZXIvdGVzdHMvc3RyaXBlLXJhdy1ib2R5LnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHJlcXVlc3QgZnJvbSAnc3VwZXJ0ZXN0JztcbmltcG9ydCBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHN0cmlwZVJvdXRlciBmcm9tICcuLi9zcmMvcm91dGVzL3N0cmlwZSc7XG5cbmRlc2NyaWJlKCdTdHJpcGUgcmF3LWJvZHkgcm91dGUnLCAoKSA9PiB7XG4gIGNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbiAgYXBwLnVzZSgnL3dlYmhvb2tzL3N0cmlwZScsIHN0cmlwZVJvdXRlciBhcyBhbnkpO1xuXG4gIGNvbnN0IGVuYWJsZWQgPSAhIXByb2Nlc3MuZW52LlNUUklQRV9XRUJIT09LX1NFQ1JFVDtcbiAgKGVuYWJsZWQgPyBpdCA6IGl0LnNraXApKCdhY2NlcHRzIHJhdyBwYXlsb2FkJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgLnBvc3QoJy93ZWJob29rcy9zdHJpcGUvZXZlbnRzJylcbiAgICAgIC5zZXQoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJylcbiAgICAgIC5zZXQoJ1N0cmlwZS1TaWduYXR1cmUnLCAndjE9ZHVtbXknKVxuICAgICAgLnNlbmQoQnVmZmVyLmZyb20oSlNPTi5zdHJpbmdpZnkoeyBvazogdHJ1ZSB9KSwgJ3V0ZjgnKSk7XG4gICAgZXhwZWN0KFsyMDAsIDQwMCwgNTAzXSkudG9Db250YWluKHJlcy5zdGF0dXMpO1xuICB9KTtcbn0pO1xuXG4iXSwidmVyc2lvbiI6M30=