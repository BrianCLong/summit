be6c48c1fac342a7086b8add64e71dbb
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RiskEngine = void 0;
class RiskEngine {
    weights;
    bias;
    version;
    constructor(weights, bias, version = 'v1') {
        this.weights = weights;
        this.bias = bias;
        this.version = version;
    }
    score(features, window) {
        let z = this.bias;
        const contributions = Object.keys(features).map(f => {
            const w = this.weights[f] ?? 0;
            const v = features[f] ?? 0;
            const delta = w * v;
            z += delta;
            return { feature: f, value: v, weight: w, delta };
        });
        const s = 1 / (1 + Math.exp(-z));
        const band = s < 0.33 ? 'low' : s < 0.66 ? 'medium' : s < 0.85 ? 'high' : 'critical';
        return { score: s, band, contributions, window, computedAt: new Date().toISOString(), modelVersion: this.version };
    }
}
exports.RiskEngine = RiskEngine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2JyaWFubG9uZy9EZXZlbG9wZXIvc3VtbWl0L3NlcnZlci9zcmMvcmlzay9SaXNrRW5naW5lLnRzIiwibWFwcGluZ3MiOiI7OztBQVdBLE1BQWEsVUFBVTtJQUNRO0lBQXlDO0lBQStCO0lBQXJHLFlBQTZCLE9BQXNCLEVBQW1CLElBQVksRUFBbUIsVUFBVSxJQUFJO1FBQXRGLFlBQU8sR0FBUCxPQUFPLENBQWU7UUFBbUIsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUFtQixZQUFPLEdBQVAsT0FBTyxDQUFPO0lBQUcsQ0FBQztJQUV2SCxLQUFLLENBQUMsUUFBdUIsRUFBRSxNQUE0QjtRQUN6RCxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ2xCLE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ2xELE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQy9CLE1BQU0sQ0FBQyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0IsTUFBTSxLQUFLLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNwQixDQUFDLElBQUksS0FBSyxDQUFDO1lBQ1gsT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDO1FBQ3BELENBQUMsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sSUFBSSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQztRQUNyRixPQUFPLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsRUFBRSxZQUFZLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ3JILENBQUM7Q0FDRjtBQWhCRCxnQ0FnQkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2JyaWFubG9uZy9EZXZlbG9wZXIvc3VtbWl0L3NlcnZlci9zcmMvcmlzay9SaXNrRW5naW5lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZlYXR1cmVWZWN0b3IgfSBmcm9tICcuL0ZlYXR1cmVTdG9yZSc7XG5cbmV4cG9ydCB0eXBlIFJpc2tSZXN1bHQgPSB7XG4gIHNjb3JlOiBudW1iZXI7XG4gIGJhbmQ6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcgfCAnY3JpdGljYWwnO1xuICBjb250cmlidXRpb25zOiBBcnJheTx7IGZlYXR1cmU6IHN0cmluZzsgdmFsdWU6IG51bWJlcjsgd2VpZ2h0OiBudW1iZXI7IGRlbHRhOiBudW1iZXIgfT47XG4gIHdpbmRvdzogJzI0aCcgfCAnN2QnIHwgJzMwZCc7XG4gIGNvbXB1dGVkQXQ6IHN0cmluZztcbiAgbW9kZWxWZXJzaW9uOiBzdHJpbmc7XG59O1xuXG5leHBvcnQgY2xhc3MgUmlza0VuZ2luZSB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgd2VpZ2h0czogRmVhdHVyZVZlY3RvciwgcHJpdmF0ZSByZWFkb25seSBiaWFzOiBudW1iZXIsIHByaXZhdGUgcmVhZG9ubHkgdmVyc2lvbiA9ICd2MScpIHt9XG5cbiAgc2NvcmUoZmVhdHVyZXM6IEZlYXR1cmVWZWN0b3IsIHdpbmRvdzogUmlza1Jlc3VsdFsnd2luZG93J10pOiBSaXNrUmVzdWx0IHtcbiAgICBsZXQgeiA9IHRoaXMuYmlhcztcbiAgICBjb25zdCBjb250cmlidXRpb25zID0gT2JqZWN0LmtleXMoZmVhdHVyZXMpLm1hcChmID0+IHtcbiAgICAgIGNvbnN0IHcgPSB0aGlzLndlaWdodHNbZl0gPz8gMDtcbiAgICAgIGNvbnN0IHYgPSBmZWF0dXJlc1tmXSA/PyAwO1xuICAgICAgY29uc3QgZGVsdGEgPSB3ICogdjtcbiAgICAgIHogKz0gZGVsdGE7XG4gICAgICByZXR1cm4geyBmZWF0dXJlOiBmLCB2YWx1ZTogdiwgd2VpZ2h0OiB3LCBkZWx0YSB9O1xuICAgIH0pO1xuICAgIGNvbnN0IHMgPSAxIC8gKDEgKyBNYXRoLmV4cCgteikpO1xuICAgIGNvbnN0IGJhbmQgPSBzIDwgMC4zMyA/ICdsb3cnIDogcyA8IDAuNjYgPyAnbWVkaXVtJyA6IHMgPCAwLjg1ID8gJ2hpZ2gnIDogJ2NyaXRpY2FsJztcbiAgICByZXR1cm4geyBzY29yZTogcywgYmFuZCwgY29udHJpYnV0aW9ucywgd2luZG93LCBjb21wdXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksIG1vZGVsVmVyc2lvbjogdGhpcy52ZXJzaW9uIH07XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==