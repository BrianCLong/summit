{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://intelgraph.com/schema/evidence-bundle/v1.json",
  "title": "Evidence Bundle Schema v1",
  "description": "A unified bundle of compliance, security, and quality evidence for a release artifact.",
  "type": "object",
  "required": [
    "schemaVersion",
    "meta",
    "governance",
    "artifacts",
    "verification",
    "provenance"
  ],
  "properties": {
    "schemaVersion": {
      "type": "string",
      "const": "1.0.0",
      "description": "The version of this schema."
    },
    "meta": {
      "type": "object",
      "required": ["timestamp", "git_sha", "repo", "branch", "build_env"],
      "properties": {
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of bundle generation."
        },
        "git_sha": {
          "type": "string",
          "pattern": "^[0-9a-f]{40}$",
          "description": "The full git commit SHA."
        },
        "repo": {
          "type": "string",
          "description": "The repository name (e.g., owner/repo)."
        },
        "branch": {
          "type": "string",
          "description": "The git branch name."
        },
        "build_env": {
          "type": "object",
          "properties": {
            "node_version": { "type": "string" },
            "pnpm_version": { "type": "string" }
          }
        }
      }
    },
    "governance": {
      "type": "object",
      "description": "Verdicts from governance checks.",
      "required": ["verdict", "checks"],
      "properties": {
        "verdict": {
          "type": "string",
          "enum": ["approved", "rejected", "pending", "unknown"]
        },
        "checks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "status": { "type": "string", "enum": ["pass", "fail", "skip"] },
              "description": { "type": "string" }
            },
            "required": ["name", "status"]
          }
        }
      }
    },
    "artifacts": {
      "type": "object",
      "description": "Snapshots of artifact metadata (SBOM, Licenses).",
      "required": ["sbom", "licenses"],
      "properties": {
        "sbom": {
          "type": "object",
          "description": "The SBOM content or metadata.",
          "required": ["format", "content"],
          "properties": {
            "format": { "type": "string", "enum": ["cyclonedx", "spdx"] },
            "content": { "type": "object" }
          }
        },
        "licenses": {
          "type": "object",
          "description": "License inventory.",
          "required": ["summary"],
          "properties": {
            "summary": {
              "type": "object",
              "patternProperties": {
                "^.*$": { "type": "number" }
              }
            },
            "unknown_licenses": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        }
      }
    },
    "verification": {
      "type": "object",
      "description": "Results of test and verification suites.",
      "required": ["summary", "verdicts"],
      "properties": {
        "summary": {
          "type": "object",
          "properties": {
            "total": { "type": "number" },
            "passed": { "type": "number" },
            "failed": { "type": "number" },
            "skipped": { "type": "number" }
          }
        },
        "verdicts": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "suite": { "type": "string" },
              "verdict": { "type": "string", "enum": ["pass", "fail"] },
              "duration_ms": { "type": "number" }
            },
            "required": ["suite", "verdict"]
          }
        }
      }
    },
    "provenance": {
      "type": "object",
      "description": "SLSA provenance data.",
      "required": ["attestationStatus", "issueLink", "attestation"],
      "properties": {
        "attestationStatus": {
          "type": "string",
          "enum": ["stub", "attested"]
        },
        "issueLink": {
          "type": "string",
          "format": "uri"
        },
        "attestation": {
          "type": "object",
          "description": "The raw provenance attestation (stub or real)."
        }
      }
    }
  }
}
